<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: NAMTrace Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>NAMTrace Class Reference</h1><code>#include &lt;NAMTrace.h&gt;</code>
<p>
<a href="class_n_a_m_trace-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Provides a central place for storing the output stream of an ns2 nam trace.<p>
Only one NAMTrace module should be in a network (or, per subnetwork), and hosts/routers should contain a <a class="el" href="class_n_a_m_trace_writer.html">NAMTraceWriter</a> module each. Every NAMTraceWriters write to an output stream which they obtain from the <a class="el" href="class_n_a_m_trace.html#a5">out()</a> method of the shared NAMTrace module.<p>
See NED file for more info.<p>
<dl compact><dt><b>Author:</b></dt><dd>Andras Varga </dd></dl>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#a0">NAMTrace</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#a1">~NAMTrace</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#a2">assignNamId</a> (cModule *node, int namid=-1)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#a3">getNamId</a> (cModule *node) const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#a4">enabled</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">std::ostream &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#a5">out</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#b0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#b1">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">std::ofstream *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#r0">nams</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#r1">lastnamid</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">std::map&lt; int, int &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_n_a_m_trace.html#r2">modid2namid</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="NAMTrace::NAMTrace"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">NAMTrace::NAMTrace           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00026 {
00027     <a class="code" href="class_n_a_m_trace.html#r0">nams</a> = NULL;
00028 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="NAMTrace::~NAMTrace"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">NAMTrace::~<a class="el" href="class_n_a_m_trace.html">NAMTrace</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00031 {
00032     <span class="keywordflow">if</span> (nams)
00033     {
00034         <a class="code" href="class_n_a_m_trace.html#r0">nams</a>-&gt;close();
00035         <span class="keyword">delete</span> <a class="code" href="class_n_a_m_trace.html#r0">nams</a>;
00036     }
00037 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a2" doxytag="NAMTrace::assignNamId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int NAMTrace::assignNamId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cModule *&nbsp;</td>
          <td class="mdname" nowrap> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>namid</em> = <code>-1</code></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Assign a nam ID to the given module (host or router). -1 means auto-assigned ID. <div class="fragment"><pre class="fragment">00075 {
00076     <span class="comment">// FIXME make sure nobody's using that namid yet</span>
00077     <span class="keywordflow">return</span> <a class="code" href="class_n_a_m_trace.html#r2">modid2namid</a>[node-&gt;id()] = namid==-1 ? ++<a class="code" href="class_n_a_m_trace.html#r1">lastnamid</a> : namid;
00078 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="NAMTrace::enabled"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool NAMTrace::enabled           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns true if nam trace recording is enabled (filename was not ""). <div class="fragment"><pre class="fragment">00070 {<span class="keywordflow">return</span> <a class="code" href="class_n_a_m_trace.html#r0">nams</a>!=NULL;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="NAMTrace::getNamId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int NAMTrace::getNamId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cModule *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>node</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the nam ID of the given module (host or router). <a class="el" href="class_n_a_m_trace.html#a2">assignNamId()</a> must have been called for the given module before, at least with -1 (auto-ID). <div class="fragment"><pre class="fragment">00081 {
00082     <span class="keywordtype">int</span> modid = node-&gt;id();
00083     std::map&lt;int,int&gt;::const_iterator it = <a class="code" href="class_n_a_m_trace.html#r2">modid2namid</a>.find(modid);
00084     <span class="keywordflow">if</span> (it == <a class="code" href="class_n_a_m_trace.html#r2">modid2namid</a>.end())
00085         error(<span class="stringliteral">"getNamId(): assignNamId() on module '%s' not yet called"</span>, node-&gt;fullPath().c_str());
00086     <span class="keywordflow">return</span> it-&gt;second;
00087 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="NAMTrace::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void NAMTrace::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00070 {
00071     error(<span class="stringliteral">"This module doesn't process messages"</span>);
00072 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="NAMTrace::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void NAMTrace::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00040 {
00041     <a class="code" href="class_n_a_m_trace.html#r1">lastnamid</a> = 0;
00042     <a class="code" href="class_n_a_m_trace.html#r0">nams</a> = NULL;
00043     <span class="keyword">const</span> <span class="keywordtype">char</span> *namlog = par(<span class="stringliteral">"logfile"</span>);
00044     <span class="keywordflow">if</span> (namlog &amp;&amp; namlog[0])
00045     {
00046         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"nam tracing enabled (file "</span> &lt;&lt; namlog &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
00047 
00048         <span class="comment">// open namlog for write</span>
00049         <span class="keywordflow">if</span> (unlink(namlog)!=0 &amp;&amp; errno!=ENOENT)
00050             error("cannot remove old `%s' file: %s", namlog, strerror(errno));
00051         nams = new std::ofstream;
00052         nams-&gt;open(namlog, std::ios::out);
00053         if (nams-&gt;fail())
00054             error("cannot open `%s' for write", namlog);
00055 
00056         <span class="comment">// print prolog into the file</span>
00057         const <span class="keywordtype">char</span> *prolog = par("prolog");
00058         if (strlen(prolog))
00059         {
00060             cStringTokenizer tokenizer(prolog, <span class="stringliteral">";"</span>);
00061             <span class="keyword">const</span> <span class="keywordtype">char</span> *token;
00062             <span class="keywordflow">while</span>((token = tokenizer.nextToken())!=NULL)
00063                     *<a class="code" href="class_n_a_m_trace.html#r0">nams</a> &lt;&lt; token &lt;&lt; endl;
00064             *<a class="code" href="class_n_a_m_trace.html#r0">nams</a> &lt;&lt; std::flush;
00065         }
00066     }
00067 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="NAMTrace::out"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">std::ostream&amp; NAMTrace::out           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the stream to which the trace events can be written. <div class="fragment"><pre class="fragment">00075 {ASSERT(nams!=NULL); <span class="keywordflow">return</span> *<a class="code" href="class_n_a_m_trace.html#r0">nams</a>;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="r1" doxytag="NAMTrace::lastnamid"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_n_a_m_trace.html#r1">NAMTrace::lastnamid</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r2" doxytag="NAMTrace::modid2namid"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">std::map&lt;int,int&gt; <a class="el" href="class_n_a_m_trace.html#r2">NAMTrace::modid2namid</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r0" doxytag="NAMTrace::nams"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">std::ofstream* <a class="el" href="class_n_a_m_trace.html#r0">NAMTrace::nams</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_n_a_m_trace_8h.html">NAMTrace.h</a><li><a class="el" href="_n_a_m_trace_8cc.html">NAMTrace.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:27 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
