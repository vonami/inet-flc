<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: TED Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TED Class Reference</h1><code>#include &lt;TED.h&gt;</code>
<p>
<a href="class_t_e_d-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Contains the Traffic Engineering Database and provides public methods to access it from <a class="el" href="class_m_p_l_s.html">MPLS</a> signalling protocols (<a class="el" href="class_l_d_p.html">LDP</a>, RSVP-TE).<p>
See NED file for more info. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#a0">TED</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#a1">~TED</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#a2">checkLinkValidity</a> (<a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> link, <a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> *&amp;match)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#a3">updateTimestamp</a> (<a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> *link)</td></tr>

<tr><td colspan="2"><div class="groupHeader">Public interface to the Traffic Engineering Database</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_0">interfaceAddrByPeerAddress</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> peerIP)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_1">peerRemoteInterface</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> peerIP)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_2">peerByLocalAddress</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> localInf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_3">primaryAddress</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> localInf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_4">isLocalPeer</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> inetAddr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_5">isLocalAddress</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> addr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_6">linkIndex</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> localInf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_7">linkIndex</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> advrouter, <a class="el" href="class_i_p_address.html">IPAddress</a> linkid)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_8">getLocalAddress</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#z61_9">rebuildRoutingTable</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_t_e_d__m_8h.html#a2">TELinkStateInfoVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#o0">ted</a></td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#b0">initialize</a> (int stage)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#b1">numInitStages</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#b2">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#b3">calculateShortestPath</a> (<a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a> dest, const <a class="el" href="_t_e_d__m_8h.html#a2">TELinkStateInfoVector</a> &amp;topology, double req_bandwidth, int priority)</td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#d0">assignIndex</a> (std::vector&lt; <a class="el" href="struct_t_e_d_1_1vertex__t.html">vertex_t</a> &gt; &amp;vertices, <a class="el" href="class_i_p_address.html">IPAddress</a> nodeAddr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">std::vector&lt; <a class="el" href="struct_t_e_d_1_1vertex__t.html">vertex_t</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#d1">calculateShortestPaths</a> (const <a class="el" href="_t_e_d__m_8h.html#a2">TELinkStateInfoVector</a> &amp;topology, double req_bandwidth, int priority)</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_routing_table.html">RoutingTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#r0">rt</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#r1">ift</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#r2">routerId</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_notification_board.html">NotificationBoard</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#r3">nb</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#r4">interfaceAddrs</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_e_d.html#r5">maxMessageId</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_t_e_d_1_1edge__t.html">edge_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_t_e_d_1_1vertex__t.html">vertex_t</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="TED::TED"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">TED::TED           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00031 {
00032 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="TED::~TED"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">TED::~<a class="el" href="class_t_e_d.html">TED</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00035 {
00036 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="d0" doxytag="TED::assignIndex"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int TED::assignIndex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">std::vector&lt; <a class="el" href="struct_t_e_d_1_1vertex__t.html">vertex_t</a> &gt; &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>vertices</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nodeAddr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00156 {
00157     <span class="comment">// find node in vertices[] whose IP address is nodeAddr</span>
00158     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0 ; i &lt; vertices.size(); i++)
00159         <span class="keywordflow">if</span>(vertices[i].node == nodeAddr)
00160             <span class="keywordflow">return</span> i;
00161 
00162     <span class="comment">// if not found, create</span>
00163     vertex_t newVertex;
00164     newVertex.node = nodeAddr;
00165     newVertex.dist = <a class="code" href="_o_s_p_fcommon_8h.html#a6">LS_INFINITY</a>;
00166     newVertex.parent = -1;
00167 
00168     vertices.push_back(newVertex);
00169     <span class="keywordflow">return</span> vertices.size() - 1;
00170 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="TED::calculateShortestPath"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a> TED::calculateShortestPath           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="_t_e_d__m_8h.html#a2">TELinkStateInfoVector</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>topology</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>req_bandwidth</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>priority</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00174 {
00175     <span class="comment">// FIXME comment: what do we do here?</span>
00176     std::vector&lt;vertex_t&gt; V = <a class="code" href="class_t_e_d.html#d1">calculateShortestPaths</a>(topology, req_bandwidth, priority);
00177 
00178     <span class="keywordtype">double</span> minDist = <a class="code" href="_o_s_p_fcommon_8h.html#a6">LS_INFINITY</a>;
00179     <span class="keywordtype">int</span> minIndex = -1;
00180 
00181     <span class="comment">// FIXME comment: what do we do in this block?</span>
00182     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; V.size(); i++)
00183     {
00184         <span class="keywordflow">if</span>(V[i].dist &gt;= minDist)
00185             <span class="keywordflow">continue</span>;
00186 
00187         <span class="keywordflow">if</span>(<a class="code" href="_r_s_v_p___t_e_2_utils_8cc.html#a2">find</a>(dest.begin(), dest.end(), V[i].node) == dest.end())
00188             <span class="keywordflow">continue</span>;
00189 
00190         minDist = V[i].dist;
00191         minIndex = i;
00192     }
00193 
00194     <a class="code" href="_int_serv__m_8h.html#a1">IPAddressVector</a> result;
00195 
00196     <span class="keywordflow">if</span>(minIndex &lt; 0)
00197         <span class="keywordflow">return</span> result;
00198 
00199     result.push_back(V[minIndex].node);
00200     <span class="keywordflow">while</span> (V[minIndex].parent != -1)
00201     {
00202         minIndex = V[minIndex].parent;
00203         result.insert(result.begin(), V[minIndex].node);
00204     }
00205 
00206     <span class="keywordflow">return</span> result;
00207 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d1" doxytag="TED::calculateShortestPaths"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">std::vector&lt; <a class="el" href="struct_t_e_d_1_1vertex__t.html">TED::vertex_t</a> &gt; TED::calculateShortestPaths           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="_t_e_d__m_8h.html#a2">TELinkStateInfoVector</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>topology</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>req_bandwidth</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>priority</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00342 {
00343     std::vector&lt;vertex_t&gt; vertices;
00344     std::vector&lt;edge_t&gt; edges;
00345 
00346     <span class="comment">// select edges that have enough bandwidth left, and store them into edges[].</span>
00347     <span class="comment">// meanwhile, collect vertices in vectices[].</span>
00348     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; topology.size(); i++)
00349     {
00350         <span class="keywordflow">if</span>(!topology[i].state)
00351             <span class="keywordflow">continue</span>;
00352 
00353         <span class="keywordflow">if</span>(topology[i].UnResvBandwidth[priority] &lt; req_bandwidth)
00354             <span class="keywordflow">continue</span>;
00355 
00356         edge_t edge;
00357         edge.src = <a class="code" href="class_t_e_d.html#d0">assignIndex</a>(vertices, topology[i].advrouter);
00358         edge.dest = <a class="code" href="class_t_e_d.html#d0">assignIndex</a>(vertices, topology[i].linkid);
00359         edge.metric = topology[i].metric;
00360         edges.push_back(edge);
00361     }
00362 
00363     <a class="code" href="class_i_p_address.html">IPAddress</a> srcAddr = <a class="code" href="class_t_e_d.html#r2">routerId</a>;
00364 
00365     <span class="keywordtype">int</span> srcIndex = <a class="code" href="class_t_e_d.html#d0">assignIndex</a>(vertices, srcAddr);
00366     vertices[srcIndex].dist = 0.0;
00367 
00368     <span class="comment">// FIXME comment: Dijkstra? just guessing...</span>
00369     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; vertices.size(); i++)
00370     {
00371         <span class="keywordtype">bool</span> mod = <span class="keyword">false</span>;
00372 
00373         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; edges.size(); j++)
00374         {
00375             <span class="keywordtype">int</span> src = edges[j].src;
00376             <span class="keywordtype">int</span> dest = edges[j].dest;
00377 
00378             ASSERT(src &gt;= 0);
00379             ASSERT(dest &gt;= 0);
00380             ASSERT(src &lt; vertices.size());
00381             ASSERT(dest &lt; vertices.size());
00382             ASSERT(src != dest);
00383 
00384             <span class="keywordflow">if</span>(vertices[src].dist + edges[j].metric &gt;= vertices[dest].dist)
00385                 <span class="keywordflow">continue</span>;
00386 
00387             vertices[dest].dist = vertices[src].dist + edges[j].metric;
00388             vertices[dest].parent = src;
00389 
00390             mod = <span class="keyword">true</span>;
00391         }
00392 
00393         <span class="keywordflow">if</span>(!mod)
00394             <span class="keywordflow">break</span>;
00395     }
00396 
00397     <span class="keywordflow">return</span> vertices;
00398 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="TED::checkLinkValidity"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TED::checkLinkValidity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>link</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> *&amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>match</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00401 {
00402     std::vector&lt;TELinkStateInfo&gt;::iterator it;
00403 
00404     match = NULL;
00405 
00406     <span class="keywordflow">for</span>(it = <a class="code" href="class_t_e_d.html#o0">ted</a>.begin(); it != <a class="code" href="class_t_e_d.html#o0">ted</a>.end(); it++)
00407     {
00408         <span class="keywordflow">if</span>(it-&gt;sourceId == link.<a class="code" href="struct_t_e_link_state_info.html#o8">sourceId</a> &amp;&amp; it-&gt;<a class="code" href="struct_t_e_link_state_info.html#o9">messageId</a> == link.<a class="code" href="struct_t_e_link_state_info.html#o9">messageId</a> &amp;&amp; it-&gt;<a class="code" href="struct_t_e_link_state_info.html#o7">timestamp</a> == link.<a class="code" href="struct_t_e_link_state_info.html#o7">timestamp</a>)
00409         {
00410             <span class="comment">// we've already seen this message, ignore it</span>
00411             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00412         }
00413 
00414         <span class="keywordflow">if</span>(it-&gt;advrouter == link.<a class="code" href="struct_t_e_link_state_info.html#o0">advrouter</a> &amp;&amp; it-&gt;linkid == link.<a class="code" href="struct_t_e_link_state_info.html#o1">linkid</a>)
00415         {
00416             <span class="comment">// we've have info about this link</span>
00417 
00418             <span class="keywordflow">if</span>(it-&gt;timestamp &lt; link.<a class="code" href="struct_t_e_link_state_info.html#o7">timestamp</a> || (it-&gt;timestamp == link.<a class="code" href="struct_t_e_link_state_info.html#o7">timestamp</a> &amp;&amp; it-&gt;<a class="code" href="struct_t_e_link_state_info.html#o9">messageId</a> &lt; link.<a class="code" href="struct_t_e_link_state_info.html#o9">messageId</a>))
00419             {
00420                 <span class="comment">// but it's older, use this new</span>
00421                 match = &amp;(*it);
00422                 <span class="keywordflow">break</span>;
00423             }
00424             <span class="keywordflow">else</span>
00425             {
00426                 <span class="comment">// and it's newer, forget this message</span>
00427                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00428             }
00429         }
00430     }
00431 
00432     <span class="comment">// no or not up2date info, link is interesting</span>
00433     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00434 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_8" doxytag="TED::getLocalAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a> TED::getLocalAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00469 {
00470     <span class="keywordflow">return</span> <a class="code" href="class_t_e_d.html#r4">interfaceAddrs</a>;
00471 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="TED::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TED::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00135 {
00136     ASSERT(<span class="keyword">false</span>);
00137 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="TED::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TED::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stage</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00039 {
00040     <span class="comment">// we have to wait for stage 2 until interfaces get registered (stage 0)</span>
00041     <span class="comment">// and get their auto-assigned IP addresses (stage 2); routerId gets</span>
00042     <span class="comment">// assigned in stage 3</span>
00043     <span class="keywordflow">if</span> (stage!=4)
00044         return;
00045 
00046     rt = <a class="code" href="class_routing_table_access.html">RoutingTableAccess</a>().get();
00047     ift = <a class="code" href="class_interface_table_access.html">InterfaceTableAccess</a>().get();
00048     routerId = rt-&gt;routerId();
00049     nb = <a class="code" href="class_notification_board_access.html">NotificationBoardAccess</a>().get();
00050 
00051     maxMessageId = 0;
00052 
00053     ASSERT(!routerId.isUnspecified());
00054 
00055     <span class="comment">//</span>
00056     <span class="comment">// Extract initial TED contents from the routing table.</span>
00057     <span class="comment">//</span>
00058     <span class="comment">// We need to create one TED entry (TELinkStateInfo) for each link,</span>
00059     <span class="comment">// i.e. for each physical interface.</span>
00060     <span class="comment">//</span>
00061     for (<span class="keywordtype">int</span> i = 0; i &lt; ift-&gt;numInterfaces(); i++)
00062     {
00063         <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_t_e_d.html#r1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(i);
00064 
00065         <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a7">nodeOutputGateId</a>() == -1)  <span class="comment">// ignore if it's not a physical interface</span>
00066             <span class="keywordflow">continue</span>;
00067 
00068         <span class="comment">//</span>
00069         <span class="comment">// We'll need to fill in "linkid" and "remote" (ie. peer addr).</span>
00070         <span class="comment">//</span>
00071         <span class="comment">// Real link state protocols find the peer address by exchanging HELLO messages;</span>
00072         <span class="comment">// in this model we haven't implemented HELLO but provide peer addresses via</span>
00073         <span class="comment">// preconfigured static host routes in routing table.</span>
00074         <span class="comment">//</span>
00075         <a class="code" href="class_routing_entry.html">RoutingEntry</a> *rentry = NULL;
00076         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; rt-&gt;numRoutingEntries(); j++)
00077         {
00078             rentry = <a class="code" href="class_t_e_d.html#r0">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_1">routingEntry</a>(j);
00079             <span class="keywordflow">if</span> (rentry-&gt;<a class="code" href="class_routing_entry.html#o4">interfacePtr</a> == ie &amp;&amp; rentry-&gt;<a class="code" href="class_routing_entry.html#o5">type</a> == RoutingEntry::DIRECT)
00080                 break;
00081         }
00082         ASSERT(rentry);
00083         <a class="code" href="class_i_p_address.html">IPAddress</a> linkid = rentry-&gt;host;
00084         <a class="code" href="class_i_p_address.html">IPAddress</a> remote = rentry-&gt;gateway;
00085         ASSERT(!remote.isUnspecified());
00086 
00087         <span class="comment">// find bandwidth of the link</span>
00088         cGate *g = parentModule()-&gt;gate(ie-&gt;nodeOutputGateId());
00089         ASSERT(g);
00090         <span class="keywordtype">double</span> linkBandwidth = g-&gt;datarate()-&gt;doubleValue();
00091 
00092         <span class="comment">//</span>
00093         <span class="comment">// fill in and insert TED entry</span>
00094         <span class="comment">//</span>
00095         <a class="code" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> entry;
00096         entry.advrouter = routerId;
00097         entry.local = ie-&gt;ipv4()-&gt;inetAddress();
00098         entry.linkid = linkid;
00099         entry.remote = remote;
00100         entry.MaxBandwidth = linkBandwidth;
00101         for(<span class="keywordtype">int</span> j = 0; j &lt; 8; j++)
00102             entry.UnResvBandwidth[j] = entry.MaxBandwidth;
00103         entry.state = true;
00104 
00105         <span class="comment">// use g-&gt;delay()-&gt;doubleValue() for shortest delay calculation</span>
00106         entry.metric = rentry-&gt;interfacePtr-&gt;ipv4()-&gt;metric();
00107 
00108         EV &lt;&lt; "metric set to=" &lt;&lt; entry.metric &lt;&lt; endl;
00109 
00110         entry.sourceId = routerId.getInt();
00111         entry.messageId = ++maxMessageId;
00112         entry.timestamp = simTime();
00113 
00114         ted.push_back(entry);
00115     }
00116 
00117     <span class="comment">// extract list of local interface addresses into interfaceAddrs[]</span>
00118     for (<span class="keywordtype">int</span> i = 0; i &lt; ift-&gt;numInterfaces(); i++)
00119     {
00120         <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_t_e_d.html#r1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(i);
00121         <span class="keywordflow">if</span> (<a class="code" href="class_t_e_d.html#r0">rt</a>-&gt;<a class="code" href="class_routing_table.html#z40_1">interfaceByAddress</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a4">inetAddress</a>()) != ie)
00122             error(<span class="stringliteral">"MPLS models assume interfaces to have unique addresses, "</span>
00123                   <span class="stringliteral">"but address of '%s' (%s) is not unique"</span>,
00124                   ie-&gt;<a class="code" href="class_interface_entry.html#a5">name</a>(), ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a4">inetAddress</a>().<a class="code" href="class_i_p_address.html#a4">str</a>().c_str());
00125         <span class="keywordflow">if</span> (!ie-&gt;<a class="code" href="class_interface_entry.html#a15">isLoopback</a>())
00126             <a class="code" href="class_t_e_d.html#r4">interfaceAddrs</a>.push_back(ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a4">inetAddress</a>());
00127     }
00128 
00129     <a class="code" href="class_t_e_d.html#z61_9">rebuildRoutingTable</a>();
00130 
00131     WATCH_VECTOR(ted);
00132 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_0" doxytag="TED::interfaceAddrByPeerAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a> TED::interfaceAddrByPeerAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>peerIP</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00311 {
00312     std::vector&lt;TELinkStateInfo&gt;::iterator it;
00313     <span class="keywordflow">for</span> (it = <a class="code" href="class_t_e_d.html#o0">ted</a>.begin(); it != <a class="code" href="class_t_e_d.html#o0">ted</a>.end(); it++)
00314         <span class="keywordflow">if</span> (it-&gt;linkid == peerIP &amp;&amp; it-&gt;advrouter == routerId)
00315             return it-&gt;local;
00316     error("not a local peer: %s", peerIP.str().c_str());
00317     return <a class="code" href="class_i_p_address.html">IPAddress</a>(); <span class="comment">// prevent warning</span>
00318 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_5" doxytag="TED::isLocalAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TED::isLocalAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>addr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00453 {
00454     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_t_e_d.html#r4">interfaceAddrs</a>.size(); i++)
00455         <span class="keywordflow">if</span>(<a class="code" href="class_t_e_d.html#r4">interfaceAddrs</a>[i] == addr)
00456             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00457     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00458 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_4" doxytag="TED::isLocalPeer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TED::isLocalPeer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>inetAddr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00332 {
00333     std::vector&lt;TELinkStateInfo&gt;::iterator it;
00334     <span class="keywordflow">for</span> (it = <a class="code" href="class_t_e_d.html#o0">ted</a>.begin(); it != <a class="code" href="class_t_e_d.html#o0">ted</a>.end(); it++)
00335         <span class="keywordflow">if</span> (it-&gt;linkid == inetAddr &amp;&amp; it-&gt;advrouter == routerId)
00336             break;
00337     return it != ted.end();
00338 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_7" doxytag="TED::linkIndex"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">unsigned int TED::linkIndex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>advrouter</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>linkid</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00445 {
00446     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_t_e_d.html#o0">ted</a>.size(); i++)
00447         <span class="keywordflow">if</span>(<a class="code" href="class_t_e_d.html#o0">ted</a>[i].advrouter == advrouter &amp;&amp; <a class="code" href="class_t_e_d.html#o0">ted</a>[i].linkid == linkid)
00448             <span class="keywordflow">return</span> i;
00449     ASSERT(<span class="keyword">false</span>);
00450 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_6" doxytag="TED::linkIndex"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">unsigned int TED::linkIndex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>localInf</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00437 {
00438     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_t_e_d.html#o0">ted</a>.size(); i++)
00439         <span class="keywordflow">if</span> (ted[i].advrouter == routerId &amp;&amp; ted[i].local == localInf)
00440             return i;
00441     ASSERT(false);
00442 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="TED::numInitStages"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual int TED::numInitStages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00070 {<span class="keywordflow">return</span> 5;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_2" doxytag="TED::peerByLocalAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a> TED::peerByLocalAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>localInf</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00487 {
00488     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = <a class="code" href="class_t_e_d.html#z61_6">linkIndex</a>(localInf);
00489     <span class="keywordflow">return</span> <a class="code" href="class_t_e_d.html#o0">ted</a>[index].linkid;
00490 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_1" doxytag="TED::peerRemoteInterface"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a> TED::peerRemoteInterface           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>peerIP</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00321 {
00322     ASSERT(<a class="code" href="class_t_e_d.html#z61_4">isLocalPeer</a>(peerIP));
00323     std::vector&lt;TELinkStateInfo&gt;::iterator it;
00324     <span class="keywordflow">for</span> (it = <a class="code" href="class_t_e_d.html#o0">ted</a>.begin(); it != <a class="code" href="class_t_e_d.html#o0">ted</a>.end(); it++)
00325         <span class="keywordflow">if</span> (it-&gt;linkid == peerIP &amp;&amp; it-&gt;advrouter == routerId)
00326             return it-&gt;remote;
00327     error("not a local peer: %s", peerIP.str().c_str());
00328     return <a class="code" href="class_i_p_address.html">IPAddress</a>(); <span class="comment">// prevent warning</span>
00329 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_3" doxytag="TED::primaryAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a> TED::primaryAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>localInf</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00474 {
00475     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_t_e_d.html#o0">ted</a>.size(); i++)
00476     {
00477         <span class="keywordflow">if</span>(<a class="code" href="class_t_e_d.html#o0">ted</a>[i].local == localInf)
00478             <span class="keywordflow">return</span> <a class="code" href="class_t_e_d.html#o0">ted</a>[i].advrouter;
00479 
00480         <span class="keywordflow">if</span>(<a class="code" href="class_t_e_d.html#o0">ted</a>[i].remote == localInf)
00481             <span class="keywordflow">return</span> <a class="code" href="class_t_e_d.html#o0">ted</a>[i].linkid;
00482     }
00483     ASSERT(<span class="keyword">false</span>);
00484 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z61_9" doxytag="TED::rebuildRoutingTable"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TED::rebuildRoutingTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00210 {
00211     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"rebuilding routing table at "</span> &lt;&lt; <a class="code" href="class_t_e_d.html#r2">routerId</a> &lt;&lt; endl;
00212 
00213     std::vector&lt;vertex_t&gt; V = <a class="code" href="class_t_e_d.html#d1">calculateShortestPaths</a>(ted, 0.0, 7);
00214 
00215     <span class="comment">// remove all routing entries, except multicast ones (we don't care about them)</span>
00216     <span class="keywordtype">int</span> n = <a class="code" href="class_t_e_d.html#r0">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_0">numRoutingEntries</a>();
00217     <span class="keywordtype">int</span> j = 0;
00218     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)
00219     {
00220         <a class="code" href="class_routing_entry.html">RoutingEntry</a> *entry = <a class="code" href="class_t_e_d.html#r0">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_1">routingEntry</a>(j);
00221         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="class_routing_entry.html#o0">host</a>.<a class="code" href="class_i_p_address.html#a8">isMulticast</a>())
00222         {
00223             ++j;
00224         }
00225         <span class="keywordflow">else</span>
00226         {
00227             <a class="code" href="class_t_e_d.html#r0">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_4">deleteRoutingEntry</a>(entry);
00228         }
00229     }
00230 
00231 <span class="comment">//  for (unsigned int i = 0; i &lt; V.size(); i++)</span>
00232 <span class="comment">//  {</span>
00233 <span class="comment">//      EV &lt;&lt; "V[" &lt;&lt; i &lt;&lt; "].node=" &lt;&lt; V[i].node &lt;&lt; endl;</span>
00234 <span class="comment">//      EV &lt;&lt; "V[" &lt;&lt; i &lt;&lt; "].parent=" &lt;&lt; V[i].parent &lt;&lt; endl;</span>
00235 <span class="comment">//      EV &lt;&lt; "V[" &lt;&lt; i &lt;&lt; "].dist=" &lt;&lt; V[i].dist &lt;&lt; endl;</span>
00236 <span class="comment">//  }</span>
00237 
00238     <span class="comment">// insert remote destinations</span>
00239 
00240     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; V.size(); i++)
00241     {
00242         <span class="keywordflow">if</span>(V[i].node == <a class="code" href="class_t_e_d.html#r2">routerId</a>) <span class="comment">// us</span>
00243             <span class="keywordflow">continue</span>;
00244 
00245         <span class="keywordflow">if</span> (V[i].parent == -1) <span class="comment">// unreachable</span>
00246             continue;
00247 
00248         if (isLocalPeer(V[i].node)) <span class="comment">// local peer</span>
00249             continue;
00250 
00251         <span class="keywordtype">int</span> nHop = i;
00252 
00253         while (!isLocalPeer(V[nHop].node))
00254         {
00255             nHop = V[nHop].parent;
00256         }
00257 
00258         ASSERT(<a class="code" href="class_t_e_d.html#z61_4">isLocalPeer</a>(V[nHop].node));
00259 
00260         <a class="code" href="class_routing_entry.html">RoutingEntry</a> *entry = <span class="keyword">new</span> <a class="code" href="class_routing_entry.html">RoutingEntry</a>;
00261         entry-&gt;<a class="code" href="class_routing_entry.html#o0">host</a> = V[i].node;
00262 
00263         <span class="keywordflow">if</span> (V[i].node == V[nHop].node)
00264         {
00265             entry-&gt;<a class="code" href="class_routing_entry.html#o2">gateway</a> = <a class="code" href="class_i_p_address.html">IPAddress</a>();
00266             entry-&gt;<a class="code" href="class_routing_entry.html#o5">type</a> = entry-&gt;<a class="code" href="class_routing_entry.html#w8w0">DIRECT</a>;
00267         }
00268         <span class="keywordflow">else</span>
00269         {
00270             entry-&gt;<a class="code" href="class_routing_entry.html#o2">gateway</a> = V[nHop].node;
00271             entry-&gt;<a class="code" href="class_routing_entry.html#o5">type</a> = entry-&gt;<a class="code" href="class_routing_entry.html#w8w1">REMOTE</a>;
00272         }
00273         entry-&gt;<a class="code" href="class_routing_entry.html#o4">interfacePtr</a> = <a class="code" href="class_t_e_d.html#r0">rt</a>-&gt;<a class="code" href="class_routing_table.html#z40_1">interfaceByAddress</a>(<a class="code" href="class_t_e_d.html#z61_0">interfaceAddrByPeerAddress</a>(V[nHop].node));
00274         entry-&gt;<a class="code" href="class_routing_entry.html#o3">interfaceName</a> = opp_string(entry-&gt;<a class="code" href="class_routing_entry.html#o4">interfacePtr</a>-&gt;<a class="code" href="class_interface_entry.html#a5">name</a>());
00275         entry-&gt;<a class="code" href="class_routing_entry.html#o6">source</a> = <a class="code" href="class_routing_entry.html#w9w5">RoutingEntry::OSPF</a>;
00276 
00277         entry-&gt;<a class="code" href="class_routing_entry.html#o1">netmask</a> = 0xffffffff;
00278         entry-&gt;<a class="code" href="class_routing_entry.html#o7">metric</a> = 0;
00279 
00280         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"  inserting route: host="</span> &lt;&lt; entry-&gt;<a class="code" href="class_routing_entry.html#o0">host</a> &lt;&lt; <span class="stringliteral">" interface="</span> &lt;&lt; entry-&gt;<a class="code" href="class_routing_entry.html#o3">interfaceName</a> &lt;&lt; <span class="stringliteral">" nexthop="</span> &lt;&lt; entry-&gt;<a class="code" href="class_routing_entry.html#o2">gateway</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00281 
00282         <a class="code" href="class_t_e_d.html#r0">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_3">addRoutingEntry</a>(entry);
00283     }
00284 
00285     <span class="comment">// insert local peers</span>
00286 
00287     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="class_t_e_d.html#r4">interfaceAddrs</a>.size(); i++)
00288     {
00289         <a class="code" href="class_routing_entry.html">RoutingEntry</a> *entry = <span class="keyword">new</span> <a class="code" href="class_routing_entry.html">RoutingEntry</a>;
00290 
00291         entry-&gt;<a class="code" href="class_routing_entry.html#o0">host</a> = <a class="code" href="class_t_e_d.html#z61_2">peerByLocalAddress</a>(interfaceAddrs[i]);
00292         entry-&gt;<a class="code" href="class_routing_entry.html#o2">gateway</a> = <a class="code" href="class_i_p_address.html">IPAddress</a>();
00293         entry-&gt;<a class="code" href="class_routing_entry.html#o5">type</a> = entry-&gt;<a class="code" href="class_routing_entry.html#w8w0">DIRECT</a>;
00294         entry-&gt;<a class="code" href="class_routing_entry.html#o4">interfacePtr</a> = <a class="code" href="class_t_e_d.html#r0">rt</a>-&gt;<a class="code" href="class_routing_table.html#z40_1">interfaceByAddress</a>(interfaceAddrs[i]);
00295         entry-&gt;<a class="code" href="class_routing_entry.html#o3">interfaceName</a> = opp_string(entry-&gt;<a class="code" href="class_routing_entry.html#o4">interfacePtr</a>-&gt;<a class="code" href="class_interface_entry.html#a5">name</a>());
00296         entry-&gt;<a class="code" href="class_routing_entry.html#o6">source</a> = <a class="code" href="class_routing_entry.html#w9w5">RoutingEntry::OSPF</a>;
00297 
00298         entry-&gt;<a class="code" href="class_routing_entry.html#o1">netmask</a> = 0xffffffff;
00299         entry-&gt;<a class="code" href="class_routing_entry.html#o7">metric</a> = 0; <span class="comment">// XXX FIXME what's that?</span>
00300 
00301         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"  inserting route: local="</span> &lt;&lt; <a class="code" href="class_t_e_d.html#r4">interfaceAddrs</a>[i] &lt;&lt; <span class="stringliteral">" peer="</span> &lt;&lt; entry-&gt;<a class="code" href="class_routing_entry.html#o0">host</a> &lt;&lt; <span class="stringliteral">" interface="</span> &lt;&lt; entry-&gt;<a class="code" href="class_routing_entry.html#o3">interfaceName</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00302 
00303         <a class="code" href="class_t_e_d.html#r0">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_3">addRoutingEntry</a>(entry);
00304     }
00305 
00306     <a class="code" href="class_t_e_d.html#r3">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_IPv4_ROUTINGTABLE_CHANGED);
00307 
00308 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="TED::updateTimestamp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TED::updateTimestamp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>link</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00461 {
00462     ASSERT(link-&gt;<a class="code" href="struct_t_e_link_state_info.html#o0">advrouter</a> == routerId);
00463 
00464     link-&gt;<a class="code" href="struct_t_e_link_state_info.html#o7">timestamp</a> = simTime();
00465     link-&gt;<a class="code" href="struct_t_e_link_state_info.html#o9">messageId</a> = ++<a class="code" href="class_t_e_d.html#r5">maxMessageId</a>;
00466 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="r1" doxytag="TED::ift"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a>* <a class="el" href="class_t_e_d.html#r1">TED::ift</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r4" doxytag="TED::interfaceAddrs"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a> <a class="el" href="class_t_e_d.html#r4">TED::interfaceAddrs</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r5" doxytag="TED::maxMessageId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_t_e_d.html#r5">TED::maxMessageId</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r3" doxytag="TED::nb"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_notification_board.html">NotificationBoard</a>* <a class="el" href="class_t_e_d.html#r3">TED::nb</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r2" doxytag="TED::routerId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a> <a class="el" href="class_t_e_d.html#r2">TED::routerId</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r0" doxytag="TED::rt"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_routing_table.html">RoutingTable</a>* <a class="el" href="class_t_e_d.html#r0">TED::rt</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="o0" doxytag="TED::ted"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_t_e_d__m_8h.html#a2">TELinkStateInfoVector</a> <a class="el" href="class_t_e_d.html#o0">TED::ted</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The link state database. (TELinkStateInfoVector is defined in TED.msg)     </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_t_e_d_8h.html">TED.h</a><li><a class="el" href="_t_e_d_8cc.html">TED.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:32 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
