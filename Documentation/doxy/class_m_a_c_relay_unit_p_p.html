<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: MACRelayUnitPP Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>MACRelayUnitPP Class Reference</h1><code>#include &lt;MACRelayUnitPP.h&gt;</code>
<p>
<p>Inheritance diagram for MACRelayUnitPP:
<p><center><img src="class_m_a_c_relay_unit_p_p.png" usemap="#MACRelayUnitPP_map" border="0" alt=""></center>
<map name="MACRelayUnitPP_map">
<area href="class_m_a_c_relay_unit_base.html" alt="MACRelayUnitBase" shape="rect" coords="0,0,122,24">
</map>
<a href="class_m_a_c_relay_unit_p_p-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
An implementation of the MAC Relay Unit that assumes one processor assigned to each incoming port, with separate queues. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#a0">MACRelayUnitPP</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#a1">~MACRelayUnitPP</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#b0">handleIncomingFrame</a> (<a class="el" href="class_ether_frame.html">EtherFrame</a> *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#b1">processFrame</a> (cMessage *msg)</td></tr>

<tr><td colspan="2"><div class="groupHeader">Redefined cSimpleModule member functions.</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#z65_0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#z65_1">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#z65_2">finish</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p0">processingTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p1">bufferSize</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p2">highWatermark</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p3">pauseUnits</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p4">pauseInterval</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p5">bufferUsed</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct_m_a_c_relay_unit_p_p_1_1_port_buffer.html">PortBuffer</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p7">pauseLastSent</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p8">numProcessedFrames</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p9">numDroppedFrames</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_p_p.html#p10">bufferLevel</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_m_a_c_relay_unit_p_p_1_1_port_buffer.html">PortBuffer</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="MACRelayUnitPP::MACRelayUnitPP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">MACRelayUnitPP::MACRelayUnitPP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00044 {
00045     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a> = NULL;
00046 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="MACRelayUnitPP::~MACRelayUnitPP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">MACRelayUnitPP::~<a class="el" href="class_m_a_c_relay_unit_p_p.html">MACRelayUnitPP</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00049 {
00050     <span class="keyword">delete</span> [] <a class="code" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a>;
00051 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="z65_2" doxytag="MACRelayUnitPP::finish"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitPP::finish           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Writes statistics. <div class="fragment"><pre class="fragment">00193 {
00194     <span class="keywordflow">if</span> (par(<span class="stringliteral">"writeScalars"</span>).boolValue())
00195     {
00196         recordScalar(<span class="stringliteral">"processed frames"</span>, numProcessedFrames);
00197         recordScalar(<span class="stringliteral">"dropped frames"</span>, numDroppedFrames);
00198     }
00199 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="MACRelayUnitPP::handleIncomingFrame"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitPP::handleIncomingFrame           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_ether_frame.html">EtherFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle incoming Ethernet frame: if buffer full discard it, otherwise, insert it into buffer and start processing if processor is free. <div class="fragment"><pre class="fragment">00115 {
00116     <span class="comment">// If buffer not full, insert payload frame into buffer and process the frame in parallel.</span>
00117 
00118     <span class="keywordtype">long</span> length = frame-&gt;byteLength();
00119     <span class="keywordflow">if</span> (length + bufferUsed &lt; bufferSize)
00120     {
00121         <span class="keywordtype">int</span> inputport = frame-&gt;arrivalGate()-&gt;index();
00122         <a class="code" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a>[inputport].<a class="code" href="struct_m_a_c_relay_unit_p_p_1_1_port_buffer.html#o2">queue</a>.insert(frame);
00123         <a class="code" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a>[inputport].<a class="code" href="struct_m_a_c_relay_unit_p_p_1_1_port_buffer.html#o0">port</a> = inputport;
00124         <a class="code" href="class_m_a_c_relay_unit_p_p.html#p5">bufferUsed</a> += length;
00125 
00126         <span class="comment">// send PAUSE if above watermark</span>
00127         <span class="keywordflow">if</span> (pauseUnits&gt;0 &amp;&amp; highWatermark&gt;0 &amp;&amp; bufferUsed&gt;=highWatermark &amp;&amp; simTime()-pauseLastSent&gt;pauseInterval)
00128         {
00129             <span class="comment">// send PAUSE on all ports</span>
00130             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numPorts; i++)
00131                 sendPauseFrame(i, pauseUnits);
00132             pauseLastSent = simTime();
00133         }
00134 
00135         if (buffer[inputport].cpuBusy)
00136         {
00137             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Port CPU "</span> &lt;&lt; inputport &lt;&lt; <span class="stringliteral">" busy, incoming frame "</span> &lt;&lt; frame &lt;&lt; <span class="stringliteral">" enqueued for later processing\n"</span>;
00138         }
00139         <span class="keywordflow">else</span>
00140         {
00141             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Port CPU "</span> &lt;&lt; inputport &lt;&lt; <span class="stringliteral">" free, begin processing of incoming frame "</span> &lt;&lt; frame &lt;&lt; endl;
00142             <a class="code" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a>[inputport].<a class="code" href="struct_m_a_c_relay_unit_p_p_1_1_port_buffer.html#o1">cpuBusy</a> = <span class="keyword">true</span>;
00143             cMessage *msg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"endProcessing"</span>);
00144             msg-&gt;setContextPointer(&amp;buffer[inputport]);
00145             scheduleAt(simTime() + processingTime, msg);
00146         }
00147     }
00148     <span class="comment">// Drop the frame and record the number of dropped frames</span>
00149     <span class="keywordflow">else</span>
00150     {
00151         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Buffer full, dropping frame "</span> &lt;&lt; frame &lt;&lt; endl;
00152         <span class="keyword">delete</span> frame;
00153         ++<a class="code" href="class_m_a_c_relay_unit_p_p.html#p9">numDroppedFrames</a>;
00154     }
00155 
00156     <span class="comment">// Record statistics of buffer usage levels</span>
00157     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p10">bufferLevel</a>.record(bufferUsed);
00158 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z65_1" doxytag="MACRelayUnitPP::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitPP::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Calls <a class="el" href="class_m_a_c_relay_unit_p_p.html#b0">handleIncomingFrame()</a> for frames arrived from outside, and <a class="el" href="class_m_a_c_relay_unit_p_p.html#b1">processFrame()</a> for self messages. <div class="fragment"><pre class="fragment">00101 {
00102     <span class="keywordflow">if</span> (!msg-&gt;isSelfMessage())
00103     {
00104         <span class="comment">// Frame received from MAC unit</span>
00105         <a class="code" href="class_m_a_c_relay_unit_p_p.html#b0">handleIncomingFrame</a>(check_and_cast&lt;EtherFrame *&gt;(msg));
00106     }
00107     <span class="keywordflow">else</span>
00108     {
00109         <span class="comment">// Self message signal used to indicate a frame has been finished processing</span>
00110         <a class="code" href="class_m_a_c_relay_unit_p_p.html#b1">processFrame</a>(msg);
00111     }
00112 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z65_0" doxytag="MACRelayUnitPP::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitPP::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read parameters parameters. 
<p>
Reimplemented from <a class="el" href="class_m_a_c_relay_unit_base.html#b0">MACRelayUnitBase</a>.<div class="fragment"><pre class="fragment">00054 {
00055     <a class="code" href="class_m_a_c_relay_unit_base.html#b0">MACRelayUnitBase::initialize</a>();
00056 
00057     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p10">bufferLevel</a>.setName(<span class="stringliteral">"buffer level"</span>);
00058 
00059     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p8">numProcessedFrames</a> = <a class="code" href="class_m_a_c_relay_unit_p_p.html#p9">numDroppedFrames</a> = 0;
00060     WATCH(numProcessedFrames);
00061     WATCH(numDroppedFrames);
00062 
00063     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p0">processingTime</a> = par(<span class="stringliteral">"processingTime"</span>);
00064     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p1">bufferSize</a> = par(<span class="stringliteral">"bufferSize"</span>);
00065     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p2">highWatermark</a> = par(<span class="stringliteral">"highWatermark"</span>);
00066     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p3">pauseUnits</a> = par(<span class="stringliteral">"pauseUnits"</span>);
00067 
00068     <span class="comment">// 1 pause unit is 512 bit times; we assume 100Mb MACs here.</span>
00069     <span class="comment">// We send a pause again when previous one is about to expire.</span>
00070     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p4">pauseInterval</a> = <a class="code" href="class_m_a_c_relay_unit_p_p.html#p3">pauseUnits</a>*512.0/100000.0;
00071 
00072     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p7">pauseLastSent</a> = 0;
00073     WATCH(pauseLastSent);
00074 
00075     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p5">bufferUsed</a> = 0;
00076     WATCH(bufferUsed);
00077 
00078     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a> = <span class="keyword">new</span> PortBuffer[<a class="code" href="class_m_a_c_relay_unit_base.html#p0">numPorts</a>];
00079     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numPorts; ++i)
00080     {
00081         <a class="code" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a>[i].<a class="code" href="struct_m_a_c_relay_unit_p_p_1_1_port_buffer.html#o0">port</a> = i;
00082         <a class="code" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a>[i].<a class="code" href="struct_m_a_c_relay_unit_p_p_1_1_port_buffer.html#o1">cpuBusy</a> = <span class="keyword">false</span>;
00083 
00084         <span class="keywordtype">char</span> qname[20];
00085         sprintf(qname,<span class="stringliteral">"portQueue%d"</span>,i);
00086         <a class="code" href="class_m_a_c_relay_unit_p_p.html#p6">buffer</a>[i].<a class="code" href="struct_m_a_c_relay_unit_p_p_1_1_port_buffer.html#o2">queue</a>.setName(qname);
00087     }
00088 
00089     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Parameters of ("</span> &lt;&lt; className() &lt;&lt; <span class="stringliteral">") "</span> &lt;&lt; fullPath() &lt;&lt; <span class="stringliteral">"\n"</span>;
00090     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"processing time: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_p_p.html#p0">processingTime</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00091     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ports: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_base.html#p0">numPorts</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00092     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"buffer size: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_p_p.html#p1">bufferSize</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00093     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"address table size: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_base.html#p1">addressTableSize</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00094     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"aging time: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_base.html#p2">agingTime</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00095     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"high watermark: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_p_p.html#p2">highWatermark</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00096     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"pause time: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_p_p.html#p3">pauseUnits</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00097     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00098 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="MACRelayUnitPP::processFrame"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitPP::processFrame           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Triggered when a frame has completed processing, it routes the frame to the appropriate port, and starts processing the next frame. <div class="fragment"><pre class="fragment">00161 {
00162     <span class="comment">// Extract frame from the appropriate buffer;</span>
00163     PortBuffer *pBuff = (PortBuffer*)msg-&gt;contextPointer();
00164     <a class="code" href="class_ether_frame.html">EtherFrame</a> *frame = (<a class="code" href="class_ether_frame.html">EtherFrame</a>*)pBuff-&gt;queue.pop();
00165     <span class="keywordtype">long</span> length = frame-&gt;byteLength();
00166     <span class="keywordtype">int</span> inputport = pBuff-&gt;port;
00167 
00168     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Port CPU "</span> &lt;&lt; inputport &lt;&lt; <span class="stringliteral">" completed processing of frame "</span> &lt;&lt; frame &lt;&lt; endl;
00169 
00170     <a class="code" href="class_m_a_c_relay_unit_base.html#b1">handleAndDispatchFrame</a>(frame, inputport);
00171     <a class="code" href="class_m_a_c_relay_unit_base.html#b6">printAddressTable</a>();
00172 
00173     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p5">bufferUsed</a> -= length;
00174     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p10">bufferLevel</a>.record(bufferUsed);
00175 
00176     <a class="code" href="class_m_a_c_relay_unit_p_p.html#p8">numProcessedFrames</a>++;
00177 
00178     <span class="comment">// Process next frame in queue if they are pending</span>
00179     <span class="keywordflow">if</span> (!pBuff-&gt;queue.empty())
00180     {
00181         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Begin processing of next frame\n"</span>;
00182         scheduleAt(simTime()+processingTime, msg);
00183     }
00184     <span class="keywordflow">else</span>
00185     {
00186         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Port CPU idle\n"</span>;
00187         pBuff-&gt;cpuBusy = <span class="keyword">false</span>;
00188         <span class="keyword">delete</span> msg;
00189     }
00190 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p6" doxytag="MACRelayUnitPP::buffer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="struct_m_a_c_relay_unit_p_p_1_1_port_buffer.html">PortBuffer</a>* <a class="el" href="class_m_a_c_relay_unit_p_p.html#p6">MACRelayUnitPP::buffer</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p10" doxytag="MACRelayUnitPP::bufferLevel"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector <a class="el" href="class_m_a_c_relay_unit_p_p.html#p10">MACRelayUnitPP::bufferLevel</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="MACRelayUnitPP::bufferSize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_p_p.html#p1">MACRelayUnitPP::bufferSize</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="MACRelayUnitPP::bufferUsed"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_p_p.html#p5">MACRelayUnitPP::bufferUsed</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="MACRelayUnitPP::highWatermark"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_m_a_c_relay_unit_p_p.html#p2">MACRelayUnitPP::highWatermark</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p9" doxytag="MACRelayUnitPP::numDroppedFrames"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_m_a_c_relay_unit_p_p.html#p9">MACRelayUnitPP::numDroppedFrames</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p8" doxytag="MACRelayUnitPP::numProcessedFrames"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_m_a_c_relay_unit_p_p.html#p8">MACRelayUnitPP::numProcessedFrames</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="MACRelayUnitPP::pauseInterval"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_m_a_c_relay_unit_p_p.html#p4">MACRelayUnitPP::pauseInterval</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p7" doxytag="MACRelayUnitPP::pauseLastSent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_m_a_c_relay_unit_p_p.html#p7">MACRelayUnitPP::pauseLastSent</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="MACRelayUnitPP::pauseUnits"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_p_p.html#p3">MACRelayUnitPP::pauseUnits</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="MACRelayUnitPP::processingTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_m_a_c_relay_unit_p_p.html#p0">MACRelayUnitPP::processingTime</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_m_a_c_relay_unit_p_p_8h.html">MACRelayUnitPP.h</a><li><a class="el" href="_m_a_c_relay_unit_p_p_8cc.html">MACRelayUnitPP.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:27 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
