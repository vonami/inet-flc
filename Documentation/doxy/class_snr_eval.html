<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: SnrEval Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>SnrEval Class Reference</h1><code>#include &lt;SnrEval.h&gt;</code>
<p>
<p>Inheritance diagram for SnrEval:
<p><center><img src="class_snr_eval.png" usemap="#SnrEval_map" border="0" alt=""></center>
<map name="SnrEval_map">
<area href="class_basic_snr_eval.html" alt="BasicSnrEval" shape="rect" coords="55,168,156,192">
<area href="class_channel_access.html" alt="ChannelAccess" shape="rect" coords="55,112,156,136">
<area href="class_basic_module.html" alt="BasicModule" shape="rect" coords="55,56,156,80">
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="55,0,156,24">
<area href="class_gilbert_elliot_snr.html" alt="GilbertElliotSnr" shape="rect" coords="0,280,101,304">
<area href="class_snr_eval80211.html" alt="SnrEval80211" shape="rect" coords="111,280,212,304">
</map>
<a href="class_snr_eval-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Keeps track of the different snir levels when receiving a packet. 
<p>
This module keeps track of the noise level of the channel.<p>
When receiving a packet this module updates the noise level of the channel. Based on the receive power of the packet it is processed and handed to upper layers or just treated as noise.<p>
After the packet is completely received the snir information is attached and it is handed to the decider module.<p>
The snir information is a SnrList that lists all different snr levels together with the point of time (simTime()) when they started.<p>
On top of that this module manages the <a class="el" href="class_radio_state.html">RadioState</a>, and posts notifications on <a class="el" href="class_notification_board.html">NotificationBoard</a> whenever it changes. The radio state gives information about whether this module is sending a packet, receiving a packet or idle. This information can be accessed via the <a class="el" href="class_notification_board.html">NotificationBoard</a> by other modules, e.g. a <a class="el" href="class_c_s_m_a_mac_layer.html">CSMAMacLayer</a>.<p>
<dl compact><dt><b>Author:</b></dt><dd>Marc Loebbers </dd></dl>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a0">SnrEval</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a1">changeChannel</a> (int channel)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">change transmitter and receiver to a new channel. This method throws an error if the radio state is transmit. Messages that are already sent to the new channel and would reach us in the future - thus they are on the air - will be received correctly.  <a href="#a1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#a2">setBitrate</a> (double <a class="el" href="class_basic_snr_eval.html#p0">bitrate</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">change the bitrate to the given value. This method throws an error if the radio state is transmit.  <a href="#a2"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::map&lt; <a class="el" href="class_air_frame.html">AirFrame</a> *,<br>
 double &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#x0">RecvBuff</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Typedef used to store received messages together with receive power.  <a href="#x0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="class_snr_eval.html#x2x1">TRANSM_OVER</a>
 }</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enum to store self message kind()s.  <a href="#x2">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b0">initialize</a> (int)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize variables and publish the radio status.  <a href="#b0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b1">finish</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b2">~SnrEval</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b3">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called every time a message arrives.  <a href="#b3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b4">handleUpperMsg</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b5">handleSelfMsg</a> (cMessage *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b6">handleCommand</a> (int msgkind, cPolymorphic *ctrl)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b7">handleLowerMsgStart</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Buffer the frame and update noise levels and snr information.  <a href="#b7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b8">handleLowerMsgEnd</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unbuffer the frame and update noise levels and snr information.  <a href="#b8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b9">calcRcvdPower</a> (double pSend, double distance)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculates the power with which a packet is received.  <a href="#b9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b10">channelNumber</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#b11">addNewSnr</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">updates the snr information of the relevant AirFrames  <a href="#b11"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct_snr_eval_1_1_snr_struct.html">SnrStruct</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p0">snrInfo</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State: SnrInfo stores the snrList and the the recvdPower for the message currently being received, together with a pointer to the message.  <a href="#p0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_snr_eval.html#x0">RecvBuff</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p1">recvBuff</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State: A buffer to store a pointer to a message and the related receive power.  <a href="#p1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_radio_state.html">RadioState</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p2">rs</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State: the current <a class="el" href="class_radio_state.html">RadioState</a> of the NIC; includes channel number.  <a href="#p2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p3">newChannel</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State: if not -1, we have to switch to that channel once we finished transmitting.  <a href="#p3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p4">newBitrate</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State: if not -1, we have to switch to that bitrate once we finished transmitting.  <a href="#p4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p5">noiseLevel</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State: the current noise level of the channel.  <a href="#p5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p6">carrierFrequency</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Configuration: The carrier frequency used. It is read from the <a class="el" href="class_channel_control.html">ChannelControl</a> module.  <a href="#p6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p7">thermalNoise</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Configuration: Thermal noise on the channel. Can be specified in omnetpp.ini. Default: -100 dBm.  <a href="#p7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p8">sensitivity</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default: -85 dBm.  <a href="#p8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_snr_eval.html#p9">pathLossAlpha</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Configuration: Path loss coefficient. Can be specified in omnetpp.ini. If not it is read from the <a class="el" href="class_channel_control.html">ChannelControl</a> module. This value CANNOT be smaller than the one specified in the <a class="el" href="class_channel_control.html">ChannelControl</a> module, or the simulation will exit with an error!  <a href="#p9"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_snr_eval_1_1_snr_struct.html">SnrStruct</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Struct to store a pointer to the message, rcvdPower AND a SnrList, needed in <a class="el" href="class_snr_eval.html#b11">SnrEval::addNewSnr</a>.  <a href="struct_snr_eval_1_1_snr_struct.html#_details">More...</a><br></td></tr>
</table>
<hr><h2>Member Typedef Documentation</h2>
<a class="anchor" name="x0" doxytag="SnrEval::RecvBuff"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::map&lt;<a class="el" href="class_air_frame.html">AirFrame</a>*,double&gt; <a class="el" href="class_snr_eval.html#x0">SnrEval::RecvBuff</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Typedef used to store received messages together with receive power. 
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Enumeration Documentation</h2>
<a class="anchor" name="x2" doxytag="SnrEval::@2"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">anonymous enum<code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Enum to store self message kind()s. 
<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="x2x1" doxytag="TRANSM_OVER"></a>TRANSM_OVER</em>&nbsp;</td><td>
timer to indicate that a message is completely sent now </td></tr>
</table>
</dl>
<div class="fragment"><pre class="fragment">00107       {
00109         <a class="code" href="class_snr_eval.html#x2x1">TRANSM_OVER</a>
00110       };
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="SnrEval::SnrEval"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">SnrEval::SnrEval           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00029                  : <a class="code" href="class_snr_eval.html#p2">rs</a>(this-&gt;id())
00030 {
00031 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="SnrEval::~SnrEval"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">SnrEval::~<a class="el" href="class_snr_eval.html">SnrEval</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00092 {
00093     <span class="comment">// delete messages being received</span>
00094     <span class="keywordflow">for</span> (RecvBuff::iterator it = <a class="code" href="class_snr_eval.html#p1">recvBuff</a>.begin(); it!=<a class="code" href="class_snr_eval.html#p1">recvBuff</a>.end(); ++it)
00095         <span class="keyword">delete</span> it-&gt;first;
00096 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b11" doxytag="SnrEval::addNewSnr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::addNewSnr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
updates the snr information of the relevant AirFrames 
<p>
The Snr information of the buffered message is updated. <div class="fragment"><pre class="fragment">00407 {
00408     <a class="code" href="struct_snr_list_entry.html">SnrListEntry</a> listEntry;     <span class="comment">// create a new entry</span>
00409     listEntry.<a class="code" href="struct_snr_list_entry.html#o0">time</a> = simTime();
00410     listEntry.<a class="code" href="struct_snr_list_entry.html#o1">snr</a> = <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o1">rcvdPower</a> / <a class="code" href="class_snr_eval.html#p5">noiseLevel</a>;
00411     <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o2">sList</a>.push_back(listEntry);
00412 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="SnrEval::calcRcvdPower"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double SnrEval::calcRcvdPower           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">double&nbsp;</td>
          <td class="mdname" nowrap> <em>pSend</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>distance</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Calculates the power with which a packet is received. 
<p>
This function simply calculates with how much power the signal arrives "here". If a different way of computing the path loss is required this function can be redefined. <div class="fragment"><pre class="fragment">00421 {
00422     <span class="keywordtype">double</span> speedOfLight = 300000000.0;
00423     <span class="keywordtype">double</span> waveLength = speedOfLight / <a class="code" href="class_snr_eval.html#p6">carrierFrequency</a>;
00424     <span class="keywordflow">return</span> (pSend * waveLength * waveLength / (16 * M_PI * M_PI * pow(distance, pathLossAlpha)));
00425 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="SnrEval::changeChannel"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::changeChannel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>channel</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
change transmitter and receiver to a new channel. This method throws an error if the radio state is transmit. Messages that are already sent to the new channel and would reach us in the future - thus they are on the air - will be received correctly. 
<p>
<div class="fragment"><pre class="fragment">00429 {
00430     <span class="keywordflow">if</span> (channel == <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a4">getChannelNumber</a>())
00431         <span class="keywordflow">return</span>;
00432     <span class="keywordflow">if</span> (channel &lt; 0 || channel &gt;= <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;<a class="code" href="class_channel_control.html#a12">getNumChannels</a>())
00433         error(<span class="stringliteral">"changeChannel(): channel number %d is out of range (hint: numChannels is a parameter of ChannelControl)"</span>, channel);
00434     <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() == <a class="code" href="class_radio_state.html#w4w2">RadioState::TRANSMIT</a>)
00435         error(<span class="stringliteral">"changing channel while transmitting is not allowed"</span>);
00436 
00437     <span class="comment">// if we are currently receiving, must clean that up before moving to different channel</span>
00438     <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() == <a class="code" href="class_radio_state.html#w4w1">RadioState::RECV</a>)
00439     {
00440         <span class="comment">// delete messages being received, and cancel associated self-messages</span>
00441         <span class="keywordflow">for</span> (RecvBuff::iterator it = <a class="code" href="class_snr_eval.html#p1">recvBuff</a>.begin(); it!=<a class="code" href="class_snr_eval.html#p1">recvBuff</a>.end(); ++it)
00442         {
00443             <a class="code" href="class_air_frame.html">AirFrame</a> *frame = it-&gt;first;
00444             cMessage *endRxTimer = (cMessage *)frame-&gt;contextPointer();
00445             <span class="keyword">delete</span> frame;
00446             <span class="keyword">delete</span> cancelEvent(endRxTimer);
00447         }
00448         <a class="code" href="class_snr_eval.html#p1">recvBuff</a>.clear();
00449     }
00450 
00451     <span class="comment">// clear snr info</span>
00452     <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> = NULL;
00453     <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o2">sList</a>.clear();
00454 
00455     <span class="comment">// do channel switch</span>
00456     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Changing channel to "</span> &lt;&lt; channel &lt;&lt; <span class="stringliteral">"\n"</span>;
00457 
00458     <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a5">setChannelNumber</a>(channel);
00459     <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;<a class="code" href="class_channel_control.html#a5">updateHostChannel</a>(myHostRef, channel);
00460     <a class="code" href="class_channel_control.html#w2">ChannelControl::TransmissionList</a> tl = <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;<a class="code" href="class_channel_control.html#a6">getOngoingTransmissions</a>(channel);
00461 
00462     <span class="comment">// pick up ongoing transmissions on the new channel</span>
00463     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Picking up ongoing transmissions on new channel:\n"</span>;
00464     <span class="keywordflow">for</span> (ChannelControl::TransmissionList::const_iterator it = tl.begin(); it != tl.end(); ++it)
00465     {
00466         <a class="code" href="class_air_frame.html">AirFrame</a> *frame = *it;
00467         <span class="comment">// time for the message to reach us</span>
00468         <span class="keywordtype">double</span> distance = <a class="code" href="class_channel_access.html#p1">myHostRef</a>-&gt;<a class="code" href="struct_channel_control_1_1_host_entry.html#o1">pos</a>.<a class="code" href="class_coord.html#a7">distance</a>(frame-&gt;<a class="code" href="class_air_frame.html#a15">getSenderPos</a>());
00469         <span class="keywordtype">double</span> propagationDelay = distance / <a class="code" href="_channel_control_8h.html#a0">LIGHT_SPEED</a>;
00470 
00471         <span class="comment">// if this transmission is on our new channel and it would reach us in the future, then schedule it</span>
00472         <span class="keywordflow">if</span> (channel == frame-&gt;<a class="code" href="class_air_frame.html#a9">getChannelNumber</a>())
00473         {
00474             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">" - ("</span> &lt;&lt; frame-&gt;className() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; frame-&gt;name() &lt;&lt; <span class="stringliteral">": "</span>;
00475 
00476             <span class="comment">// if there is a message on the air which will reach us in the future</span>
00477             <span class="keywordflow">if</span> (frame-&gt;timestamp() + propagationDelay &gt;= simTime())
00478             {
00479                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"will arrive in the future, scheduling it\n"</span>;
00480 
00481                 <span class="comment">// we need to send to each radioIn[] gate</span>
00482                 cGate *radioGate = gate(<span class="stringliteral">"radioIn"</span>);
00483                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; radioGate-&gt;size(); i++)
00484                     sendDirect((cMessage*)frame-&gt;dup(), frame-&gt;timestamp() + propagationDelay - simTime(), this, radioGate-&gt;<span class="keywordtype">id</span>() + i);
00485             }
00486             <span class="comment">// if we hear some part of the message</span>
00487             else if (frame-&gt;timestamp() + frame-&gt;getDuration() + propagationDelay &gt; simTime())
00488             {
00489                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"missed beginning of frame, processing it as noise\n"</span>;
00490 
00491                 <a class="code" href="class_air_frame.html">AirFrame</a> *frameDup = (<a class="code" href="class_air_frame.html">AirFrame</a>*)frame-&gt;<a class="code" href="class_air_frame.html#a4">dup</a>();
00492                 frameDup-&gt;setArrivalTime(frame-&gt;timestamp() + propagationDelay);
00493                 <a class="code" href="class_snr_eval.html#b7">handleLowerMsgStart</a>(frameDup);
00494                 <a class="code" href="class_basic_snr_eval.html#z116_0">bufferMsg</a>(frameDup);
00495             }
00496             <span class="keywordflow">else</span>
00497             {
00498                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"in the past\n"</span>;
00499             }
00500         }
00501     }
00502 
00503     <span class="comment">// notify other modules about the channel switch; and actually, radio state has changed too</span>
00504     <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIO_CHANNEL_CHANGED, &amp;rs);
00505     <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00506 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b10" doxytag="SnrEval::channelNumber"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual int SnrEval::channelNumber           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Redefined from <a class="el" href="class_basic_snr_eval.html">BasicSnrEval</a> 
<p>
Reimplemented from <a class="el" href="class_basic_snr_eval.html#b3">BasicSnrEval</a>.<div class="fragment"><pre class="fragment">00099 {<span class="keywordflow">return</span> <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a4">getChannelNumber</a>();}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="SnrEval::finish"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::finish           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00087 {
00088     BasicSnrEval::finish();
00089 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="SnrEval::handleCommand"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::handleCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>msgkind</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cPolymorphic *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrl</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00162 {
00163     <span class="keywordflow">if</span> (msgkind==PHY_C_CONFIGURERADIO)
00164     {
00165         <span class="comment">// extract new channel number</span>
00166         <a class="code" href="class_phy_control_info.html">PhyControlInfo</a> *phyCtrl = check_and_cast&lt;PhyControlInfo *&gt;(ctrl);
00167         <span class="keywordtype">int</span> <a class="code" href="class_snr_eval.html#p3">newChannel</a> = phyCtrl-&gt;<a class="code" href="class_phy_control_info.html#a6">channelNumber</a>();
00168         <span class="keywordtype">double</span> <a class="code" href="class_snr_eval.html#p4">newBitrate</a> = phyCtrl-&gt;<a class="code" href="class_phy_control_info.html#a8">bitrate</a>();
00169         <span class="keyword">delete</span> ctrl;
00170 
00171         <span class="keywordflow">if</span> (newChannel!=-1)
00172         {
00173             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Command received: change to channel "</span> &lt;&lt; newChannel &lt;&lt; <span class="stringliteral">"\n"</span>;
00174 
00175             <span class="comment">// do it</span>
00176             <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a4">getChannelNumber</a>()==newChannel)
00177                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Right on that channel, nothing to do\n"</span>; <span class="comment">// fine, nothing to do</span>
00178             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>()==<a class="code" href="class_radio_state.html#w4w2">RadioState::TRANSMIT</a>) {
00179                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"We're transmitting right now, remembering to change after it's completed\n"</span>;
00180                 this-&gt;newChannel = newChannel;
00181             } <span class="keywordflow">else</span>
00182                 <a class="code" href="class_snr_eval.html#a1">changeChannel</a>(newChannel); <span class="comment">// change channel right now</span>
00183         }
00184         <span class="keywordflow">if</span> (newBitrate!=-1)
00185         {
00186             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Command received: change bitrate to "</span> &lt;&lt; (newBitrate/1e6) &lt;&lt; <span class="stringliteral">"Mbps\n"</span>;
00187 
00188             <span class="comment">// do it</span>
00189             <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a6">getBitrate</a>()==newBitrate)
00190                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Right at that bitrate, nothing to do\n"</span>; <span class="comment">// fine, nothing to do</span>
00191             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>()==<a class="code" href="class_radio_state.html#w4w2">RadioState::TRANSMIT</a>) {
00192                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"We're transmitting right now, remembering to change after it's completed\n"</span>;
00193                 this-&gt;newBitrate = newBitrate;
00194             } <span class="keywordflow">else</span>
00195                 <a class="code" href="class_snr_eval.html#a2">setBitrate</a>(newBitrate); <span class="comment">// change bitrate right now</span>
00196         }
00197     }
00198     <span class="keywordflow">else</span>
00199         error(<span class="stringliteral">"unknown command (msgkind=%d)"</span>, msgkind);
00200 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b8" doxytag="SnrEval::handleLowerMsgEnd"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::handleLowerMsgEnd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Unbuffer the frame and update noise levels and snr information. 
<p>
This function is called right after the transmission is over, i.e. right after unbuffering. The noise level of the channel and the snr information of the buffered messages have to be updated.<p>
Additionally the <a class="el" href="class_radio_state.html">RadioState</a> has to be updated.<p>
If the corresponding <a class="el" href="class_air_frame.html">AirFrame</a> was not only noise the corresponding SnrList and the <a class="el" href="class_air_frame.html">AirFrame</a> are sent to the decider. 
<p>
Reimplemented from <a class="el" href="class_basic_snr_eval.html#z114_3">BasicSnrEval</a>.
<p>
Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#b3">GilbertElliotSnr</a>.<div class="fragment"><pre class="fragment">00347 {
00348     <span class="comment">// check if message has to be send to the decider</span>
00349     <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> == frame)
00350     {
00351         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"reception of frame over, preparing to send packet to upper layer\n"</span>;
00352         <span class="comment">// get Packet and list out of the receive buffer:</span>
00353         <a class="code" href="_snr_list_8h.html#a0">SnrList</a> list;
00354         list = <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o2">sList</a>;
00355 
00356         <span class="comment">// delete the pointer to indicate that no message is currently</span>
00357         <span class="comment">// being received and clear the list</span>
00358         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> = NULL;
00359         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o2">sList</a>.clear();
00360 
00361         <span class="comment">// delete the frame from the recvBuff</span>
00362         <a class="code" href="class_snr_eval.html#p1">recvBuff</a>.erase(frame);
00363 
00364         <span class="comment">//Don't forget to send:</span>
00365         <a class="code" href="class_basic_snr_eval.html#z116_2">sendUp</a>(frame, list);
00366         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"packet sent to the decider\n"</span>;
00367     }
00368     <span class="comment">// all other messages are noise</span>
00369     <span class="keywordflow">else</span>
00370     {
00371         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"reception of noise message over, removing recvdPower from noiseLevel....\n"</span>;
00372         <span class="comment">// get the rcvdPower and subtract it from the noiseLevel</span>
00373         <a class="code" href="class_snr_eval.html#p5">noiseLevel</a> -= <a class="code" href="class_snr_eval.html#p1">recvBuff</a>[frame];
00374 
00375         <span class="comment">// delete message from the recvBuff</span>
00376         <a class="code" href="class_snr_eval.html#p1">recvBuff</a>.erase(frame);
00377 
00378         <span class="comment">// update snr info for message currently being received if any</span>
00379         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> != NULL)
00380         {
00381             <a class="code" href="class_snr_eval.html#b11">addNewSnr</a>();
00382         }
00383 
00384         <span class="comment">// message should be deleted</span>
00385         <span class="keyword">delete</span> frame;
00386         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"message deleted\n"</span>;
00387     }
00388 
00389     <span class="comment">// check the RadioState and update if necessary</span>
00390     <span class="comment">// change to idle if noiseLevel smaller than threshold and state was</span>
00391     <span class="comment">// not idle before</span>
00392     <span class="comment">// do not change state if currently sending or receiving a message!!!</span>
00393     <span class="keywordflow">if</span> (noiseLevel &lt; sensitivity &amp;&amp; <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() == <a class="code" href="class_radio_state.html#w4w1">RadioState::RECV</a> &amp;&amp; <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> == NULL)
00394     {
00395         <span class="comment">// publish the new RadioState:</span>
00396         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"new RadioState is IDLE\n"</span>;
00397         <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::IDLE);
00398         <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00399     }
00400 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="SnrEval::handleLowerMsgStart"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::handleLowerMsgStart           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Buffer the frame and update noise levels and snr information. 
<p>
This function is called right after a packet arrived, i.e. right before it is buffered for 'transmission time'.<p>
First the receive power of the packet has to be calculated and is stored in the recvBuff. Afterwards it has to be decided whether the packet is just noise or a "real" packet that needs to be received.<p>
The message is not treated as noise if all of the following conditions apply:<p>
<ol type=1>
<li>the power of the received signal is higher than the sensitivity.</li><li>the host is currently not sending a message</li><li>no other packet is already being received</li></ol>
<p>
If all conditions apply a new SnrList is created and the <a class="el" href="class_radio_state.html">RadioState</a> is changed to RECV.<p>
If the packet is just noise the receive power is added to the noise Level of the channel. Additionally the snr information of the currently being received message (if any) has to be updated as well as the <a class="el" href="class_radio_state.html">RadioState</a>. 
<p>
Reimplemented from <a class="el" href="class_basic_snr_eval.html#z114_2">BasicSnrEval</a>.
<p>
Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#b2">GilbertElliotSnr</a>.<div class="fragment"><pre class="fragment">00268 {
00269     <span class="comment">// Calculate the receive power of the message</span>
00270 
00271     <span class="comment">// calculate distance</span>
00272     <span class="keyword">const</span> <a class="code" href="class_coord.html">Coord</a>&amp; myPos = <a class="code" href="class_channel_access.html#b1">myPosition</a>();
00273     <span class="keyword">const</span> <a class="code" href="class_coord.html">Coord</a>&amp; framePos = frame-&gt;<a class="code" href="class_air_frame.html#a15">getSenderPos</a>();
00274     <span class="keywordtype">double</span> distance = myPos.<a class="code" href="class_coord.html#a7">distance</a>(framePos);
00275 
00276     <span class="comment">// calculate receive power</span>
00277     <span class="keywordtype">double</span> rcvdPower = <a class="code" href="class_snr_eval.html#b9">calcRcvdPower</a>(frame-&gt;<a class="code" href="class_air_frame.html#a7">getPSend</a>(), distance);
00278 
00279     <span class="comment">// store the receive power in the recvBuff</span>
00280     <a class="code" href="class_snr_eval.html#p1">recvBuff</a>[frame] = rcvdPower;
00281 
00282     <span class="comment">// if receive power is bigger than sensitivity and if not sending</span>
00283     <span class="comment">// and currently not receiving another message and the message has</span>
00284     <span class="comment">// arrived in time</span>
00285     <span class="comment">// NOTE: a message may have arrival time in the past here when we are</span>
00286     <span class="comment">// processing ongoing transmissions during a channel change</span>
00287     <span class="keywordflow">if</span> (frame-&gt;arrivalTime() == simTime() &amp;&amp; rcvdPower &gt;= <a class="code" href="class_snr_eval.html#p8">sensitivity</a> &amp;&amp; <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() != <a class="code" href="class_radio_state.html#w4w2">RadioState::TRANSMIT</a> &amp;&amp; <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> == NULL)
00288     {
00289         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"receiving frame "</span> &lt;&lt; frame-&gt;name() &lt;&lt; endl;
00290 
00291         <span class="comment">// Put frame and related SnrList in receive buffer</span>
00292         <a class="code" href="_snr_list_8h.html#a0">SnrList</a> snrList;        <span class="comment">//defined in SnrList.h!!</span>
00293         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> = frame;
00294         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o1">rcvdPower</a> = rcvdPower;
00295         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o2">sList</a> = snrList;
00296 
00297         <span class="comment">// add initial snr value</span>
00298         <a class="code" href="class_snr_eval.html#b11">addNewSnr</a>();
00299 
00300         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() != <a class="code" href="class_radio_state.html#w4w1">RadioState::RECV</a>)
00301         {
00302             <span class="comment">// publish new RadioState</span>
00303             <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::RECV);
00304             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"publish new RadioState:RECV\n"</span>;
00305             <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00306         }
00307     }
00308     <span class="comment">// receive power is too low or another message is being sent or received</span>
00309     <span class="keywordflow">else</span>
00310     {
00311         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"frame "</span> &lt;&lt; frame-&gt;name() &lt;&lt; <span class="stringliteral">" is just noise\n"</span>;
00312         <span class="comment">//add receive power to the noise level</span>
00313         <a class="code" href="class_snr_eval.html#p5">noiseLevel</a> += rcvdPower;
00314 
00315         <span class="comment">// if a message is being received add a new snr value</span>
00316         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> != NULL)
00317         {
00318             <span class="comment">// update snr info for currently being received message</span>
00319             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"add new snr value to snr list of message being received\n"</span>;
00320             <a class="code" href="class_snr_eval.html#b11">addNewSnr</a>();
00321         }
00322 
00323         <span class="comment">// update the RadioState if the noiseLevel exceeded the threshold</span>
00324         <span class="comment">// and the radio is currently not in receive or in send mode</span>
00325         <span class="keywordflow">if</span> (noiseLevel &gt;= sensitivity &amp;&amp; <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() == <a class="code" href="class_radio_state.html#w4w0">RadioState::IDLE</a>)
00326         {
00327             <span class="comment">// publish new RadioState</span>
00328             <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::RECV);
00329             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"publish new RadioState:RECV\n"</span>;
00330             <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00331         }
00332     }
00333 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="SnrEval::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Called every time a message arrives. 
<p>
The basic handle message function.<p>
Depending on the gate a message arrives handleMessage just calls different handle*Msg functions to further process the message.<p>
Messages from the channel are also buffered here in order to simulate a transmission delay<p>
You should not make any changes in this function but implement all your functionality into the handle*Msg functions called from here.<p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="class_snr_eval.html#b4">handleUpperMsg</a>, <a class="el" href="class_snr_eval.html#b7">handleLowerMsgStart</a>, <a class="el" href="class_snr_eval.html#b8">handleLowerMsgEnd</a>, <a class="el" href="class_snr_eval.html#b5">handleSelfMsg</a> </dd></dl>

<p>
Reimplemented from <a class="el" href="class_basic_snr_eval.html#b1">BasicSnrEval</a>.<div class="fragment"><pre class="fragment">00099 {
00100     <span class="keywordflow">if</span> (msg-&gt;arrivalGateId()==<a class="code" href="class_basic_snr_eval.html#z112_1">uppergateIn</a> &amp;&amp; msg-&gt;length()==0)
00101     {
00102         cPolymorphic *ctrl = msg-&gt;removeControlInfo();
00103         <a class="code" href="class_snr_eval.html#b6">handleCommand</a>(msg-&gt;kind(), ctrl);
00104         <span class="keyword">delete</span> msg;
00105     }
00106     <span class="keywordflow">else</span>
00107     {
00108         <a class="code" href="class_basic_snr_eval.html#b1">BasicSnrEval::handleMessage</a>(msg); <span class="comment">// let base class do it</span>
00109     }
00110 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="SnrEval::handleSelfMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::handleSelfMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The only self message that can arrive is a timer to indicate that sending of a message is completed.<p>
The <a class="el" href="class_radio_state.html">RadioState</a> has to be changed based on the noise level on the channel. If the noise level is bigger than the sensitivity switch to receive mode odtherwise to idle mode. 
<p>
Reimplemented from <a class="el" href="class_basic_snr_eval.html#z114_1">BasicSnrEval</a>.
<p>
Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#b1">GilbertElliotSnr</a>.<div class="fragment"><pre class="fragment">00211 {
00212     <span class="keywordflow">if</span> (msg-&gt;kind() == <a class="code" href="class_snr_eval.html#x2x1">TRANSM_OVER</a>)
00213     {
00214         <span class="keywordflow">if</span> (noiseLevel &lt; sensitivity)
00215         {
00216             <span class="comment">// set the RadioState to IDLE</span>
00217             <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::IDLE);
00218             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"transmission over, switch to idle mode (state:IDLE)\n"</span>;
00219             <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00220         }
00221         <span class="keywordflow">else</span>
00222         {
00223             <span class="comment">// set the RadioState to RECV</span>
00224             <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::RECV);
00225             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"transmission over but noise level too high, switch to recv mode (state:RECV)\n"</span>;
00226             <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00227         }
00228 
00229         <span class="comment">// delete the timer</span>
00230         <span class="keyword">delete</span> msg;
00231 
00232         <span class="comment">// switch channel if it needs be</span>
00233         <span class="keywordflow">if</span> (newChannel!=-1)
00234         {
00235             <a class="code" href="class_snr_eval.html#a1">changeChannel</a>(newChannel);
00236             <a class="code" href="class_snr_eval.html#p3">newChannel</a> = -1;
00237         }
00238     }
00239     <span class="keywordflow">else</span>
00240         error(<span class="stringliteral">"Internal error: unknown self-message `%s'"</span>, msg-&gt;name());
00241 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="SnrEval::handleUpperMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::handleUpperMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
If a message is already being transmitted, an error is raised.<p>
Otherwise the <a class="el" href="class_radio_state.html">RadioState</a> is set to TRANSMIT and a timer is started. When this timer expires the <a class="el" href="class_radio_state.html">RadioState</a> will be set back to RECV (or IDLE respectively) again.<p>
If the host is receiving a packet this packet is from now on only considered as noise. 
<p>
Reimplemented from <a class="el" href="class_basic_snr_eval.html#z114_0">BasicSnrEval</a>.<div class="fragment"><pre class="fragment">00123 {
00124     <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() == <a class="code" href="class_radio_state.html#w4w2">RadioState::TRANSMIT</a>)
00125         error(<span class="stringliteral">"Trying to send a message while already transmitting -- MAC should "</span>
00126               <span class="stringliteral">"take care this does not happen"</span>);
00127 
00128     <span class="keywordflow">if</span> (frame-&gt;controlInfo()!=NULL)
00129         error(<span class="stringliteral">"Setting control info (here: %s) on frames is not supported"</span>, frame-&gt;controlInfo()-&gt;className());
00130 
00131     <span class="comment">// if a packet was being received, it is corrupted now as should be treated as noise</span>
00132     <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> != NULL)
00133     {
00134         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending a message while receiving another. The received one is now corrupted.\n"</span>;
00135 
00136         <span class="comment">// remove the snr information stored for the message currently being</span>
00137         <span class="comment">// received. This message is treated as noise now and the</span>
00138         <span class="comment">// receive power has to be added to the noiseLevel</span>
00139 
00140         <span class="comment">// delete the pointer to indicate that no message is being received</span>
00141         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> = NULL;
00142         <span class="comment">// clear the snr list</span>
00143         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o2">sList</a>.clear();
00144         <span class="comment">// add the receive power to the noise level</span>
00145         <a class="code" href="class_snr_eval.html#p5">noiseLevel</a> += <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o1">rcvdPower</a>;
00146     }
00147 
00148     <span class="comment">// now we are done with all the exception handling and can take care</span>
00149     <span class="comment">// about the "real" stuff</span>
00150 
00151     <span class="comment">// change radio status</span>
00152     <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::TRANSMIT);
00153     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"sending, changing RadioState to TRANSMIT\n"</span>;
00154     <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00155 
00156     cMessage *timer = <span class="keyword">new</span> cMessage(NULL, TRANSM_OVER);
00157     scheduleAt(simTime() + frame-&gt;<a class="code" href="class_air_frame.html#a11">getDuration</a>(), timer);
00158     <a class="code" href="class_basic_snr_eval.html#z116_3">sendDown</a>(frame);
00159 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="SnrEval::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize variables and publish the radio status. 
<p>

<p>
Reimplemented from <a class="el" href="class_basic_snr_eval.html#b0">BasicSnrEval</a>.
<p>
Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#b0">GilbertElliotSnr</a>, and <a class="el" href="class_snr_eval80211.html#b0">SnrEval80211</a>.<div class="fragment"><pre class="fragment">00034 {
00035     <a class="code" href="class_basic_snr_eval.html#b0">BasicSnrEval::initialize</a>(stage);
00036 
00037     <span class="keywordflow">if</span> (stage == 0)
00038     {
00039         <span class="comment">// read parameters</span>
00040         <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a5">setChannelNumber</a>(par(<span class="stringliteral">"channelNumber"</span>));
00041         <a class="code" href="class_snr_eval.html#p7">thermalNoise</a> = <a class="code" href="class_f_w_math.html#e7">FWMath::dBm2mW</a>(par(<span class="stringliteral">"thermalNoise"</span>));
00042         <a class="code" href="class_snr_eval.html#p6">carrierFrequency</a> = <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;par(<span class="stringliteral">"carrierFrequency"</span>);  <span class="comment">// taken from ChannelControl</span>
00043         <a class="code" href="class_snr_eval.html#p8">sensitivity</a> = <a class="code" href="class_f_w_math.html#e7">FWMath::dBm2mW</a>(par(<span class="stringliteral">"sensitivity"</span>));
00044         <a class="code" href="class_snr_eval.html#p9">pathLossAlpha</a> = par(<span class="stringliteral">"pathLossAlpha"</span>);
00045         <span class="keywordflow">if</span> (pathLossAlpha &lt; (double) (cc-&gt;par(<span class="stringliteral">"alpha"</span>)))
00046             error(<span class="stringliteral">"SnrEval::initialize(): pathLossAlpha can't be smaller than in "</span>
00047                   <span class="stringliteral">"ChannelControl. Please adjust your omnetpp.ini file accordingly"</span>);
00048 
00049         <span class="comment">// initialize noiseLevel</span>
00050         <a class="code" href="class_snr_eval.html#p5">noiseLevel</a> = <a class="code" href="class_snr_eval.html#p7">thermalNoise</a>;
00051 
00052         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Initialized channel with noise: "</span> &lt;&lt; <a class="code" href="class_snr_eval.html#p5">noiseLevel</a> &lt;&lt; <span class="stringliteral">" sensitivity: "</span> &lt;&lt; <a class="code" href="class_snr_eval.html#p8">sensitivity</a> &lt;&lt;
00053             endl;
00054 
00055         <span class="comment">// initialize the pointer of the snrInfo with NULL to indicate</span>
00056         <span class="comment">// that currently no message is received</span>
00057         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.<a class="code" href="struct_snr_eval_1_1_snr_struct.html#o0">ptr</a> = NULL;
00058 
00059         <span class="comment">// no channel switch pending</span>
00060         <a class="code" href="class_snr_eval.html#p3">newChannel</a> = -1;
00061 
00062         <span class="comment">// Initialize radio state. If thermal noise is already to high, radio</span>
00063         <span class="comment">// state has to be initialized as RECV</span>
00064         <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::IDLE);
00065         <span class="keywordflow">if</span> (noiseLevel &gt;= sensitivity)
00066             rs.setState(<a class="code" href="class_radio_state.html">RadioState</a>::RECV);
00067 
00068         WATCH(noiseLevel);
00069         WATCH(rs);
00070     }
00071     else if (stage == 1)
00072     {
00073         <span class="comment">// tell initial value to MAC; must be done in stage 1, because they</span>
00074         <span class="comment">// subscribe in stage 0</span>
00075         <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00076         <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIO_CHANNEL_CHANGED, &amp;rs);
00077     }
00078     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stage == 2)
00079     {
00080         <span class="comment">// tell initial channel number to ChannelControl; should be done in</span>
00081         <span class="comment">// stage==2 or later, because base class initializes myHostRef in that stage</span>
00082         <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;<a class="code" href="class_channel_control.html#a5">updateHostChannel</a>(myHostRef, <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a4">getChannelNumber</a>());
00083     }
00084 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="SnrEval::setBitrate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SnrEval::setBitrate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">double&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>bitrate</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
change the bitrate to the given value. This method throws an error if the radio state is transmit. 
<p>
<div class="fragment"><pre class="fragment">00509 {
00510     <span class="keywordflow">if</span> (this-&gt;bitrate == bitrate)
00511         return;
00512     if (bitrate &lt; 0)
00513         error("setBitrate(): bitrate cannot be negative (%g)", bitrate);
00514     if (rs.getState() == <a class="code" href="class_radio_state.html">RadioState</a>::TRANSMIT)
00515         error("changing the bitrate while transmitting is not allowed");
00516 
00517     EV &lt;&lt; "Setting bitrate to " &lt;&lt; (bitrate/1e6) &lt;&lt; "Mbps\n";
00518     this-&gt;bitrate = bitrate;
00519 
00520     <span class="comment">//XXX fire some notification?</span>
00521 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p6" doxytag="SnrEval::carrierFrequency"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_snr_eval.html#p6">SnrEval::carrierFrequency</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Configuration: The carrier frequency used. It is read from the <a class="el" href="class_channel_control.html">ChannelControl</a> module. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="SnrEval::newBitrate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_snr_eval.html#p4">SnrEval::newBitrate</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
State: if not -1, we have to switch to that bitrate once we finished transmitting. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="SnrEval::newChannel"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_snr_eval.html#p3">SnrEval::newChannel</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
State: if not -1, we have to switch to that channel once we finished transmitting. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="SnrEval::noiseLevel"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_snr_eval.html#p5">SnrEval::noiseLevel</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
State: the current noise level of the channel. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p9" doxytag="SnrEval::pathLossAlpha"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_snr_eval.html#p9">SnrEval::pathLossAlpha</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Configuration: Path loss coefficient. Can be specified in omnetpp.ini. If not it is read from the <a class="el" href="class_channel_control.html">ChannelControl</a> module. This value CANNOT be smaller than the one specified in the <a class="el" href="class_channel_control.html">ChannelControl</a> module, or the simulation will exit with an error! 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="SnrEval::recvBuff"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_snr_eval.html#x0">RecvBuff</a> <a class="el" href="class_snr_eval.html#p1">SnrEval::recvBuff</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
State: A buffer to store a pointer to a message and the related receive power. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="SnrEval::rs"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_radio_state.html">RadioState</a> <a class="el" href="class_snr_eval.html#p2">SnrEval::rs</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
State: the current <a class="el" href="class_radio_state.html">RadioState</a> of the NIC; includes channel number. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p8" doxytag="SnrEval::sensitivity"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_snr_eval.html#p8">SnrEval::sensitivity</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Configuration: Defines up to what Power level (in dBm) a message can be understood. If the level of a received packet is lower, it is only treated as noise. Can be specified in omnetpp.ini. Default: -85 dBm. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="SnrEval::snrInfo"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="struct_snr_eval_1_1_snr_struct.html">SnrStruct</a> <a class="el" href="class_snr_eval.html#p0">SnrEval::snrInfo</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
State: SnrInfo stores the snrList and the the recvdPower for the message currently being received, together with a pointer to the message. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p7" doxytag="SnrEval::thermalNoise"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_snr_eval.html#p7">SnrEval::thermalNoise</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Configuration: Thermal noise on the channel. Can be specified in omnetpp.ini. Default: -100 dBm. 
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_snr_eval_8h.html">SnrEval.h</a><li><a class="el" href="_snr_eval_8cc.html">SnrEval.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:30 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
