<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: OSPF::LinkStateUpdateHandler Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="namespace_o_s_p_f.html">OSPF</a>::<a class="el" href="class_o_s_p_f_1_1_link_state_update_handler.html">LinkStateUpdateHandler</a></div>
<h1>OSPF::LinkStateUpdateHandler Class Reference</h1><code>#include &lt;LinkStateUpdateHandler.h&gt;</code>
<p>
<p>Inheritance diagram for OSPF::LinkStateUpdateHandler:
<p><center><img src="class_o_s_p_f_1_1_link_state_update_handler.png" usemap="#OSPF::LinkStateUpdateHandler_map" border="0" alt=""></center>
<map name="OSPF::LinkStateUpdateHandler_map">
<area href="class_o_s_p_f_1_1_i_message_handler.html" alt="OSPF::IMessageHandler" shape="rect" coords="0,0,187,24">
</map>
<a href="class_o_s_p_f_1_1_link_state_update_handler-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_link_state_update_handler.html#a0">LinkStateUpdateHandler</a> (<a class="el" href="class_o_s_p_f_1_1_router.html">Router</a> *containingRouter)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_link_state_update_handler.html#a1">ProcessPacket</a> (<a class="el" href="class_o_s_p_f_packet.html">OSPFPacket</a> *packet, <a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf, <a class="el" href="class_o_s_p_f_1_1_neighbor.html">Neighbor</a> *neighbor)</td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_link_state_update_handler.html#d0">ValidateLSChecksum</a> (<a class="el" href="class_o_s_p_f_l_s_a.html">OSPFLSA</a> *lsa)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_link_state_update_handler.html#d1">AcknowledgeLSA</a> (<a class="el" href="class_o_s_p_f_l_s_a_header.html">OSPFLSAHeader</a> &amp;lsaHeader, <a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf, <a class="el" href="struct_o_s_p_f_1_1_link_state_update_handler_1_1_acknowledgement_flags.html">AcknowledgementFlags</a> acknowledgementFlags, <a class="el" href="namespace_o_s_p_f.html#a1">RouterID</a> lsaSource)</td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_o_s_p_f_1_1_link_state_update_handler_1_1_acknowledgement_flags.html">AcknowledgementFlags</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="OSPF::LinkStateUpdateHandler::LinkStateUpdateHandler"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">OSPF::LinkStateUpdateHandler::LinkStateUpdateHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_1_1_router.html">Router</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>containingRouter</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00018                                                                                 :
00019     <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html">OSPF::IMessageHandler</a> (containingRouter)
00020 {
00021 }

</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="d1" doxytag="OSPF::LinkStateUpdateHandler::AcknowledgeLSA"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void OSPF::LinkStateUpdateHandler::AcknowledgeLSA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_l_s_a_header.html">OSPFLSAHeader</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>lsaHeader</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>intf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct_o_s_p_f_1_1_link_state_update_handler_1_1_acknowledgement_flags.html">AcknowledgementFlags</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>acknowledgementFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="namespace_o_s_p_f.html#a1">RouterID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lsaSource</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00247 {
00248     <span class="keywordtype">bool</span> sendDirectAcknowledgment = <span class="keyword">false</span>;
00249 
00250     <span class="keywordflow">if</span> (!acknowledgementFlags.floodedBackOut) {
00251         <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a9">GetState</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w24w20">OSPF::Interface::BackupState</a>) {
00252             <span class="keywordflow">if</span> ((acknowledgementFlags.lsaIsNewer &amp;&amp; (lsaSource == intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a53">GetDesignatedRouter</a> ().routerID)) ||
00253                 (acknowledgementFlags.lsaIsDuplicate &amp;&amp; acknowledgementFlags.impliedAcknowledgement))
00254             {
00255                 intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a14">AddDelayedAcknowledgement</a> (lsaHeader);
00256             } <span class="keywordflow">else</span> {
00257                 <span class="keywordflow">if</span> ((acknowledgementFlags.lsaIsDuplicate &amp;&amp; !acknowledgementFlags.impliedAcknowledgement) ||
00258                     (acknowledgementFlags.lsaReachedMaxAge &amp;&amp;
00259                      acknowledgementFlags.noLSAInstanceInDatabase &amp;&amp;
00260                      acknowledgementFlags.anyNeighborInExchangeOrLoadingState))
00261                 {
00262                     sendDirectAcknowledgment = <span class="keyword">true</span>;
00263                 }
00264             }
00265         } <span class="keywordflow">else</span> {
00266             <span class="keywordflow">if</span> (acknowledgementFlags.lsaIsNewer) {
00267                 intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a14">AddDelayedAcknowledgement</a> (lsaHeader);
00268             } <span class="keywordflow">else</span> {
00269                 <span class="keywordflow">if</span> ((acknowledgementFlags.lsaIsDuplicate &amp;&amp; !acknowledgementFlags.impliedAcknowledgement) ||
00270                     (acknowledgementFlags.lsaReachedMaxAge &amp;&amp;
00271                      acknowledgementFlags.noLSAInstanceInDatabase &amp;&amp;
00272                      acknowledgementFlags.anyNeighborInExchangeOrLoadingState))
00273                 {
00274                     sendDirectAcknowledgment = <span class="keyword">true</span>;
00275                 }
00276             }
00277         }
00278     }
00279 
00280     <span class="keywordflow">if</span> (sendDirectAcknowledgment) {
00281         <a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html">OSPFLinkStateAcknowledgementPacket</a>* ackPacket = <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html">OSPFLinkStateAcknowledgementPacket</a>;
00282 
00283         ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a10">setType</a> (LinkStateAcknowledgementPacket);
00284         ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a15">setRouterID</a> (<a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetRouterID ());
00285         ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a18">setAreaID</a> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a25">GetAreaID</a> ());
00286         ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a22">setAuthenticationType</a> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a45">GetAuthenticationType</a> ());
00287         <a class="code" href="struct_o_s_p_f_1_1_authentication_key_type.html">OSPF::AuthenticationKeyType</a> authKey = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a47">GetAuthenticationKey</a> ();
00288         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++) {
00289             ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a25">setAuthentication</a> (i, authKey.<a class="code" href="struct_o_s_p_f_1_1_authentication_key_type.html#o0">bytes</a>[i]);
00290         }
00291 
00292         ackPacket-&gt;<a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html#a7">setLsaHeadersArraySize</a> (1);
00293         ackPacket-&gt;<a class="code" href="class_o_s_p_f_link_state_acknowledgement_packet.html#a11">setLsaHeaders</a> (0, lsaHeader);
00294 
00295         ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a12">setPacketLength</a> (0); <span class="comment">// TODO: Calculate correct length</span>
00296         ackPacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a20">setChecksum</a> (0); <span class="comment">// TODO: Calculate correct cheksum (16-bit one's complement of the entire packet)</span>
00297 
00298         <span class="keywordtype">int</span> ttl = (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a19">GetType</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w23w14">OSPF::Interface::Virtual</a>) ? <a class="code" href="_o_s_p_fcommon_8h.html#a11">VIRTUAL_LINK_TTL</a> : 1;
00299 
00300         <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a19">GetType</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w23w11">OSPF::Interface::Broadcast</a>) {
00301             <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a9">GetState</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w24w21">OSPF::Interface::DesignatedRouterState</a>) ||
00302                 (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a9">GetState</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w24w20">OSPF::Interface::BackupState</a>) ||
00303                 (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a53">GetDesignatedRouter</a> () == OSPF::NullDesignatedRouterID))
00304             {
00305                 <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;SendPacket (ackPacket, OSPF::AllSPFRouters, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a21">GetIfIndex</a> (), ttl);
00306             } <span class="keywordflow">else</span> {
00307                 <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;SendPacket (ackPacket, OSPF::AllDRouters, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a21">GetIfIndex</a> (), ttl);
00308             }
00309         } <span class="keywordflow">else</span> {
00310             <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a19">GetType</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w23w10">OSPF::Interface::PointToPoint</a>) {
00311                 <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;SendPacket (ackPacket, OSPF::AllSPFRouters, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a21">GetIfIndex</a> (), ttl);
00312             } <span class="keywordflow">else</span> {
00313                 <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;SendPacket (ackPacket, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a6">GetNeighborByID</a> (lsaSource)-&gt;GetAddress (), intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a21">GetIfIndex</a> (), ttl);
00314             }
00315         }
00316     }
00317 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="OSPF::LinkStateUpdateHandler::ProcessPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void OSPF::LinkStateUpdateHandler::ProcessPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_packet.html">OSPFPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_interface.html">OSPF::Interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>intf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>neighbor</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>See also:</b></dt><dd>RFC2328 Section 13. </dd></dl>
<div class="fragment"><pre class="fragment">00027 {
00028     <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;PrintEvent (<span class="stringliteral">"Link State Update packet received"</span>, intf, neighbor);
00029 
00030     <a class="code" href="class_o_s_p_f_link_state_update_packet.html">OSPFLinkStateUpdatePacket</a>* lsUpdatePacket      = check_and_cast&lt;OSPFLinkStateUpdatePacket*&gt; (packet);
00031     <span class="keywordtype">bool</span>                       rebuildRoutingTable = <span class="keyword">false</span>;
00032 
00033     <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a5">GetState</a> () &gt;= <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w22">OSPF::Neighbor::ExchangeState</a>) {
00034         OSPF::AreaID areaID          = lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a16">getAreaID</a> ().<a class="code" href="class_i_p_address.html#a5">getInt</a> ();
00035         <a class="code" href="class_o_s_p_f_1_1_area.html">OSPF::Area</a>*  area            = <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetArea (areaID);
00036         <a class="code" href="_o_s_p_f_packet__m_8h.html#a54">LSAType</a>      currentType     = <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a6">RouterLSAType</a>;
00037         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> currentLSAIndex = 0;
00038 
00039         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"  Processing packet contents:\n"</span>;
00040 
00041         <span class="keywordflow">while</span> (currentType &lt;= ASExternalLSAType) {
00042             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lsaCount = 0;
00043 
00044             <span class="keywordflow">switch</span> (currentType) {
00045                 <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a6">RouterLSAType</a>:
00046                     lsaCount = lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a10">getRouterLSAsArraySize</a> ();
00047                     <span class="keywordflow">break</span>;
00048                 <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a7">NetworkLSAType</a>:
00049                     lsaCount = lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a15">getNetworkLSAsArraySize</a> ();
00050                     <span class="keywordflow">break</span>;
00051                 <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a8">SummaryLSA_NetworksType</a>:
00052                 <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a9">SummaryLSA_ASBoundaryRoutersType</a>:
00053                     lsaCount = lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a20">getSummaryLSAsArraySize</a> ();
00054                     <span class="keywordflow">break</span>;
00055                 <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a10">ASExternalLSAType</a>:
00056                     lsaCount = lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a25">getAsExternalLSAsArraySize</a> ();
00057                     <span class="keywordflow">break</span>;
00058                 <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;
00059             }
00060 
00061             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; lsaCount; i++) {
00062                 <a class="code" href="class_o_s_p_f_l_s_a.html">OSPFLSA</a>* currentLSA;
00063 
00064                 <span class="keywordflow">switch</span> (currentType) {
00065                     <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a6">RouterLSAType</a>:
00066                         currentLSA = (&amp;(lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a11">getRouterLSAs</a> (i)));
00067                         <span class="keywordflow">break</span>;
00068                     <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a7">NetworkLSAType</a>:
00069                         currentLSA = (&amp;(lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a16">getNetworkLSAs</a> (i)));
00070                         <span class="keywordflow">break</span>;
00071                     <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a8">SummaryLSA_NetworksType</a>:
00072                     <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a9">SummaryLSA_ASBoundaryRoutersType</a>:
00073                         currentLSA = (&amp;(lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a21">getSummaryLSAs</a> (i)));
00074                         <span class="keywordflow">break</span>;
00075                     <span class="keywordflow">case</span> <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a10">ASExternalLSAType</a>:
00076                         currentLSA = (&amp;(lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_link_state_update_packet.html#a26">getAsExternalLSAs</a> (i)));
00077                         <span class="keywordflow">break</span>;
00078                     <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;
00079                 }
00080 
00081                 <span class="keywordflow">if</span> (!ValidateLSChecksum (currentLSA)) {
00082                     <span class="keywordflow">continue</span>;
00083                 }
00084 
00085                 <a class="code" href="_o_s_p_f_packet__m_8h.html#a54">LSAType</a> lsaType = static_cast&lt;LSAType&gt; (currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a11">getLsType</a> ());
00086                 <span class="keywordflow">if</span> ((lsaType != RouterLSAType) &amp;&amp;
00087                     (lsaType != NetworkLSAType) &amp;&amp;
00088                     (lsaType != SummaryLSA_NetworksType) &amp;&amp;
00089                     (lsaType != SummaryLSA_ASBoundaryRoutersType) &amp;&amp;
00090                     (lsaType != ASExternalLSAType))
00091                 {
00092                     <span class="keywordflow">continue</span>;
00093                 }
00094 
00095                 <a class="code" href="class_l_s_a_processing_marker.html">LSAProcessingMarker</a> marker (currentLSAIndex++);
00096                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"    "</span>;
00097                 <a class="code" href="_l_s_a_8h.html#a10">PrintLSAHeader</a> (currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ());
00098                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00099 
00100                 <span class="keywordflow">if</span> ((lsaType == ASExternalLSAType) &amp;&amp; (!area-&gt;<a class="code" href="class_o_s_p_f_1_1_area.html#a11">GetExternalRoutingCapability</a> ())) {
00101                     <span class="keywordflow">continue</span>;
00102                 }
00103                 <a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html">OSPF::LSAKeyType</a> lsaKey;
00104 
00105                 lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#o0">linkStateID</a> = currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a13">getLinkStateID</a> ();
00106                 lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#o1">advertisingRouter</a> = currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a15">getAdvertisingRouter</a> ().<a class="code" href="class_i_p_address.html#a5">getInt</a> ();
00107 
00108                 <a class="code" href="class_o_s_p_f_l_s_a.html">OSPFLSA</a>*                lsaInDatabase = <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;FindLSA (lsaType, lsaKey, areaID);
00109                 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>          lsAge         = currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a6">getLsAge</a> ();
00110                 AcknowledgementFlags    ackFlags;
00111 
00112                 ackFlags.floodedBackOut = <span class="keyword">false</span>;
00113                 ackFlags.lsaIsNewer = <span class="keyword">false</span>;
00114                 ackFlags.lsaIsDuplicate = <span class="keyword">false</span>;
00115                 ackFlags.impliedAcknowledgement = <span class="keyword">false</span>;
00116                 ackFlags.lsaReachedMaxAge = (lsAge == <a class="code" href="_o_s_p_fcommon_8h.html#a3">MAX_AGE</a>);
00117                 ackFlags.noLSAInstanceInDatabase = (lsaInDatabase == NULL);
00118                 ackFlags.anyNeighborInExchangeOrLoadingState = <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;AnyNeighborInStates (OSPF::Neighbor::ExchangeState | OSPF::Neighbor::LoadingState);
00119 
00120                 <span class="keywordflow">if</span> ((ackFlags.lsaReachedMaxAge) &amp;&amp; (ackFlags.noLSAInstanceInDatabase) &amp;&amp; (!ackFlags.anyNeighborInExchangeOrLoadingState)) {
00121                     <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a19">GetType</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w23w11">OSPF::Interface::Broadcast</a>) {
00122                         <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a9">GetState</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w24w21">OSPF::Interface::DesignatedRouterState</a>) ||
00123                             (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a9">GetState</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w24w20">OSPF::Interface::BackupState</a>) ||
00124                             (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a53">GetDesignatedRouter</a> () == OSPF::NullDesignatedRouterID))
00125                         {
00126                             intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a5">SendLSAcknowledgement</a> (&amp;(currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ()), OSPF::AllSPFRouters);
00127                         } <span class="keywordflow">else</span> {
00128                             intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a5">SendLSAcknowledgement</a> (&amp;(currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ()), OSPF::AllDRouters);
00129                         }
00130                     } <span class="keywordflow">else</span> {
00131                         <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a19">GetType</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w23w10">OSPF::Interface::PointToPoint</a>) {
00132                             intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a5">SendLSAcknowledgement</a> (&amp;(currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ()), OSPF::AllSPFRouters);
00133                         } <span class="keywordflow">else</span> {
00134                             intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a5">SendLSAcknowledgement</a> (&amp;(currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ()), neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a34">GetAddress</a> ());
00135                         }
00136                     }
00137                     <span class="keywordflow">continue</span>;
00138                 }
00139 
00140                 <span class="keywordflow">if</span> (!ackFlags.noLSAInstanceInDatabase) {
00141                     <span class="comment">// operator&lt; and operator== on OSPFLSAHeaders determines which one is newer (less means older)</span>
00142                     ackFlags.lsaIsNewer = (lsaInDatabase-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> () &lt; currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ());
00143                     ackFlags.lsaIsDuplicate = (<a class="code" href="_l_d_p_8cc.html#a6">operator== </a>(lsaInDatabase-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> (), currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ()));
00144                 }
00145                 <span class="keywordflow">if</span> ((ackFlags.noLSAInstanceInDatabase) || (ackFlags.lsaIsNewer)) {
00146                     LSATrackingInfo* info = (!ackFlags.noLSAInstanceInDatabase) ? dynamic_cast&lt;LSATrackingInfo*&gt; (lsaInDatabase) : NULL;
00147                     <span class="keywordflow">if</span> ((!ackFlags.noLSAInstanceInDatabase) &amp;&amp;
00148                         (info != NULL) &amp;&amp;
00149                         (info-&gt;GetSource () == LSATrackingInfo::Flooded) &amp;&amp;
00150                         (info-&gt;GetInstallTime () &lt; <a class="code" href="_o_s_p_fcommon_8h.html#a2">MIN_LS_ARRIVAL</a>))
00151                     {
00152                         <span class="keywordflow">continue</span>;
00153                     }
00154                     ackFlags.floodedBackOut = <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a13">FloodLSA</a> (currentLSA, areaID, intf, neighbor);
00155                     <span class="keywordflow">if</span> (!ackFlags.noLSAInstanceInDatabase) {
00156                         <a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html">OSPF::LSAKeyType</a> lsaKey;
00157 
00158                         lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#o0">linkStateID</a> = lsaInDatabase-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a13">getLinkStateID</a> ();
00159                         lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#o1">advertisingRouter</a> = lsaInDatabase-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a15">getAdvertisingRouter</a> ().<a class="code" href="class_i_p_address.html#a5">getInt</a> ();
00160 
00161                         <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;RemoveFromAllRetransmissionLists (lsaKey);
00162                     }
00163                     rebuildRoutingTable |= <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;InstallLSA (currentLSA, areaID);
00164 
00165                     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"    (update installed)\n"</span>;
00166 
00167                     <a class="code" href="class_o_s_p_f_1_1_link_state_update_handler.html#d1">AcknowledgeLSA</a> (currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> (), intf, ackFlags, lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a13">getRouterID</a> ().<a class="code" href="class_i_p_address.html#a5">getInt</a> ());
00168                     <span class="keywordflow">if</span> ((currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a15">getAdvertisingRouter</a> ().<a class="code" href="class_i_p_address.html#a5">getInt</a> () == <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetRouterID ()) ||
00169                         ((lsaType == <a class="code" href="_o_s_p_f_packet__m_8h.html#a54a7">NetworkLSAType</a>) &amp;&amp;
00170                          (<a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;IsLocalAddress (IPv4AddressFromULong (currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a13">getLinkStateID</a> ())))))
00171                     {
00172                         <span class="keywordflow">if</span> (ackFlags.noLSAInstanceInDatabase) {
00173                             currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a7">setLsAge</a> (MAX_AGE);
00174                             <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;FloodLSA (currentLSA, areaID);
00175                         } <span class="keywordflow">else</span> {
00176                             <span class="keywordflow">if</span> (ackFlags.lsaIsNewer) {
00177                                 <span class="keywordtype">long</span> sequenceNumber = currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a18">getLsSequenceNumber</a> ();
00178                                 <span class="keywordflow">if</span> (sequenceNumber == MAX_SEQUENCE_NUMBER) {
00179                                     lsaInDatabase-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a7">setLsAge</a> (MAX_AGE);
00180                                     <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;FloodLSA (lsaInDatabase, areaID);
00181                                 } <span class="keywordflow">else</span> {
00182                                     lsaInDatabase-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a19">setLsSequenceNumber</a> (sequenceNumber + 1);
00183                                     <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;FloodLSA (lsaInDatabase, areaID);
00184                                 }
00185                             }
00186                         }
00187                     }
00188                     <span class="keywordflow">continue</span>;
00189                 }
00190                 <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a20">IsLSAOnRequestList</a> (lsaKey)) {
00191                     neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::BadLinkStateRequest);
00192                     <span class="keywordflow">break</span>;
00193                 }
00194                 <span class="keywordflow">if</span> (ackFlags.lsaIsDuplicate) {
00195                     <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a14">IsLSAOnRetransmissionList</a> (lsaKey)) {
00196                         neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a13">RemoveFromRetransmissionList</a> (lsaKey);
00197                         ackFlags.impliedAcknowledgement = <span class="keyword">true</span>;
00198                     }
00199                     <a class="code" href="class_o_s_p_f_1_1_link_state_update_handler.html#d1">AcknowledgeLSA</a> (currentLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> (), intf, ackFlags, lsUpdatePacket-&gt;<a class="code" href="class_o_s_p_f_packet.html#a13">getRouterID</a> ().<a class="code" href="class_i_p_address.html#a5">getInt</a> ());
00200                     <span class="keywordflow">continue</span>;
00201                 }
00202                 <span class="keywordflow">if</span> ((lsaInDatabase-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a6">getLsAge</a> () == <a class="code" href="_o_s_p_fcommon_8h.html#a3">MAX_AGE</a>) &amp;&amp;
00203                     (lsaInDatabase-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a18">getLsSequenceNumber</a> () == <a class="code" href="_o_s_p_fcommon_8h.html#a10">MAX_SEQUENCE_NUMBER</a>))
00204                 {
00205                     <span class="keywordflow">continue</span>;
00206                 }
00207                 <span class="keywordflow">if</span> (!neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a25">IsOnTransmittedLSAList</a> (lsaKey)) {
00208                     <a class="code" href="class_o_s_p_f_link_state_update_packet.html">OSPFLinkStateUpdatePacket</a>* updatePacket = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a17">CreateUpdatePacket</a> (lsaInDatabase);
00209                     <span class="keywordflow">if</span> (updatePacket != NULL) {
00210                         <span class="keywordtype">int</span> ttl = (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a19">GetType</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w23w14">OSPF::Interface::Virtual</a>) ? <a class="code" href="_o_s_p_fcommon_8h.html#a11">VIRTUAL_LINK_TTL</a> : 1;
00211 
00212                         <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a19">GetType</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w23w11">OSPF::Interface::Broadcast</a>) {
00213                             <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a9">GetState</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w24w21">OSPF::Interface::DesignatedRouterState</a>) ||
00214                                 (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a9">GetState</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w24w20">OSPF::Interface::BackupState</a>) ||
00215                                 (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a53">GetDesignatedRouter</a> () == OSPF::NullDesignatedRouterID))
00216                             {
00217                                 <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;SendPacket (updatePacket, OSPF::AllSPFRouters, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a21">GetIfIndex</a> (), ttl);
00218                             } <span class="keywordflow">else</span> {
00219                                 <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;SendPacket (updatePacket, OSPF::AllDRouters, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a21">GetIfIndex</a> (), ttl);
00220                             }
00221                         } <span class="keywordflow">else</span> {
00222                             <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a19">GetType</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w23w10">OSPF::Interface::PointToPoint</a>) {
00223                                 <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;SendPacket (updatePacket, OSPF::AllSPFRouters, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a21">GetIfIndex</a> (), ttl);
00224                             } <span class="keywordflow">else</span> {
00225                                 <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;SendPacket (updatePacket, neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a34">GetAddress</a> (), intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a21">GetIfIndex</a> (), ttl);
00226                             }
00227                         }
00228                     }
00229                 }
00230             }
00231             currentType = static_cast&lt;LSAType&gt; (currentType + 1);
00232             <span class="keywordflow">if</span> (currentType == SummaryLSA_NetworksType) {
00233                 currentType = static_cast&lt;LSAType&gt; (currentType + 1);
00234             }
00235         }
00236     }
00237 
00238     <span class="keywordflow">if</span> (rebuildRoutingTable) {
00239         <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;RebuildRoutingTable ();
00240     }
00241 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d0" doxytag="OSPF::LinkStateUpdateHandler::ValidateLSChecksum"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool OSPF::LinkStateUpdateHandler::ValidateLSChecksum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_l_s_a.html">OSPFLSA</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lsa</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00023 { <span class="keywordflow">return</span> <span class="keyword">true</span>; }   <span class="comment">// not implemented</span>
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_link_state_update_handler_8h.html">LinkStateUpdateHandler.h</a><li><a class="el" href="_link_state_update_handler_8cc.html">LinkStateUpdateHandler.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:32 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
