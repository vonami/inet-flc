<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: PingApp Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>PingApp Class Reference</h1><code>#include &lt;PingApp.h&gt;</code>
<p>
<a href="class_ping_app-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Generates ping requests and calculates the packet loss and round trip parameters of the replies.<p>
See NED file for detailed description of operation. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#b0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#b1">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#b2">finish</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#b3">sendPing</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#b4">scheduleNextPing</a> (cMessage *timer)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#b5">sendToICMP</a> (cMessage *payload, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;<a class="el" href="class_ping_app.html#p0">destAddr</a>, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;<a class="el" href="class_ping_app.html#p1">srcAddr</a>, int <a class="el" href="class_ping_app.html#p4">hopLimit</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#b6">processPingResponse</a> (<a class="el" href="class_ping_payload.html">PingPayload</a> *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#b7">countPingResponse</a> (int bytes, long seqNo, simtime_t rtt)</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p0">destAddr</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p1">srcAddr</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p2">packetSize</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cPar *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p3">intervalp</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p4">hopLimit</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p5">count</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p6">startTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p7">stopTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p8">printPing</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p9">sendSeqNo</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p10">expectedReplySeqNo</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cStdDev&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p11">delayStat</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p12">delayVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p13">dropVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p14">dropCount</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ping_app.html#p15">outOfOrderArrivalCount</a></td></tr>

</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b7" doxytag="PingApp::countPingResponse"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void PingApp::countPingResponse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>seqNo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>simtime_t&nbsp;</td>
          <td class="mdname" nowrap> <em>rtt</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00181 {
00182     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Ping reply #"</span> &lt;&lt; seqNo &lt;&lt; <span class="stringliteral">" arrived, rtt="</span> &lt;&lt; rtt &lt;&lt; <span class="stringliteral">"\n"</span>;
00183 
00184     <a class="code" href="class_ping_app.html#p11">delayStat</a>.collect(rtt);
00185     <a class="code" href="class_ping_app.html#p12">delayVector</a>.record(rtt);
00186 
00187     <span class="keywordflow">if</span> (seqNo == expectedReplySeqNo)
00188     {
00189         <span class="comment">// expected ping reply arrived; expect next sequence number</span>
00190         <a class="code" href="class_ping_app.html#p10">expectedReplySeqNo</a>++;
00191     }
00192     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (seqNo &gt; expectedReplySeqNo)
00193     {
00194         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Jump in seq numbers, assuming pings since #"</span> &lt;&lt; <a class="code" href="class_ping_app.html#p10">expectedReplySeqNo</a> &lt;&lt; <span class="stringliteral">" got lost\n"</span>;
00195 
00196         <span class="comment">// jump in the sequence: count pings in gap as lost</span>
00197         <span class="keywordtype">long</span> jump = seqNo - expectedReplySeqNo;
00198         <a class="code" href="class_ping_app.html#p14">dropCount</a> += jump;
00199         <a class="code" href="class_ping_app.html#p13">dropVector</a>.record(dropCount);
00200 
00201         <span class="comment">// expect sequence numbers to continue from here</span>
00202         expectedReplySeqNo = seqNo+1;
00203     }
00204     <span class="keywordflow">else</span> <span class="comment">// seqNo &lt; expectedReplySeqNo</span>
00205     {
00206         <span class="comment">// ping arrived too late: count as out of order arrival</span>
00207         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Arrived out of order (too late)\n"</span>;
00208         <a class="code" href="class_ping_app.html#p15">outOfOrderArrivalCount</a>++;
00209     }
00210 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="PingApp::finish"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void PingApp::finish           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00213 {
00214     <span class="keywordflow">if</span> (sendSeqNo==0)
00215     {
00216         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; fullPath() &lt;&lt; <span class="stringliteral">": No pings sent, skipping recording statistics and printing results.\n"</span>;
00217         recordScalar(<span class="stringliteral">"Pings sent"</span>, sendSeqNo);
00218         <span class="keywordflow">return</span>;
00219     }
00220 
00221     <span class="comment">// record statistics</span>
00222     recordScalar(<span class="stringliteral">"Pings sent"</span>, sendSeqNo);
00223     recordScalar(<span class="stringliteral">"Pings dropped"</span>, dropCount);
00224     recordScalar(<span class="stringliteral">"Out-of-order ping arrivals"</span>, outOfOrderArrivalCount);
00225     recordScalar(<span class="stringliteral">"Pings outstanding at end"</span>, sendSeqNo-expectedReplySeqNo);
00226 
00227     recordScalar(<span class="stringliteral">"Ping drop rate (%)"</span>, 100 * dropCount / (<span class="keywordtype">double</span>)sendSeqNo);
00228     recordScalar(<span class="stringliteral">"Ping out-of-order rate (%)"</span>, 100 * outOfOrderArrivalCount / (<span class="keywordtype">double</span>)sendSeqNo);
00229 
00230     <a class="code" href="class_ping_app.html#p11">delayStat</a>.recordScalar(<span class="stringliteral">"Ping roundtrip delays"</span>);
00231 
00232     <span class="comment">// print it to stdout as well</span>
00233     cout &lt;&lt; <span class="stringliteral">"--------------------------------------------------------"</span> &lt;&lt; endl;
00234     cout &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; fullPath() &lt;&lt; endl;
00235     cout &lt;&lt; <span class="stringliteral">"--------------------------------------------------------"</span> &lt;&lt; endl;
00236 
00237     cout &lt;&lt; <span class="stringliteral">"sent: "</span> &lt;&lt; <a class="code" href="class_ping_app.html#p9">sendSeqNo</a>
00238          &lt;&lt; <span class="stringliteral">"   drop rate (%): "</span> &lt;&lt; (100 * <a class="code" href="class_ping_app.html#p14">dropCount</a> / (double)<a class="code" href="class_ping_app.html#p9">sendSeqNo</a>) &lt;&lt; endl;
00239     cout &lt;&lt; <span class="stringliteral">"round-trip min/avg/max (ms): "</span>
00240          &lt;&lt; (<a class="code" href="class_ping_app.html#p11">delayStat</a>.min()*1000.0) &lt;&lt; <span class="stringliteral">"/"</span>
00241          &lt;&lt; (<a class="code" href="class_ping_app.html#p11">delayStat</a>.mean()*1000.0) &lt;&lt; <span class="stringliteral">"/"</span>
00242          &lt;&lt; (<a class="code" href="class_ping_app.html#p11">delayStat</a>.max()*1000.0) &lt;&lt; endl;
00243     cout &lt;&lt; <span class="stringliteral">"stddev (ms): "</span>&lt;&lt; (<a class="code" href="class_ping_app.html#p11">delayStat</a>.stddev()*1000.0)
00244          &lt;&lt; <span class="stringliteral">"   variance:"</span> &lt;&lt; <a class="code" href="class_ping_app.html#p11">delayStat</a>.variance() &lt;&lt; endl;
00245     cout &lt;&lt;<span class="stringliteral">"--------------------------------------------------------"</span> &lt;&lt; endl;
00246 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="PingApp::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void PingApp::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00070 {
00071     <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
00072     {
00073         <span class="comment">// on first call we need to initialize</span>
00074         <span class="keywordflow">if</span> (<a class="code" href="class_ping_app.html#p0">destAddr</a>.<a class="code" href="class_i_pv_x_address.html#z36_0">isUnspecified</a>())
00075         {
00076             <a class="code" href="class_ping_app.html#p0">destAddr</a> = <a class="code" href="class_i_p_address_resolver.html">IPAddressResolver</a>().resolve(par(<span class="stringliteral">"destAddr"</span>));
00077             ASSERT(!<a class="code" href="class_ping_app.html#p0">destAddr</a>.<a class="code" href="class_i_pv_x_address.html#z36_0">isUnspecified</a>());
00078             <a class="code" href="class_ping_app.html#p1">srcAddr</a> = <a class="code" href="class_i_p_address_resolver.html">IPAddressResolver</a>().resolve(par(<span class="stringliteral">"srcAddr"</span>));
00079             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Starting up: dest="</span> &lt;&lt; <a class="code" href="class_ping_app.html#p0">destAddr</a> &lt;&lt; <span class="stringliteral">"  src="</span> &lt;&lt; <a class="code" href="class_ping_app.html#p1">srcAddr</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00080         }
00081 
00082         <span class="comment">// send a ping</span>
00083         <a class="code" href="class_ping_app.html#b3">sendPing</a>();
00084 
00085         <span class="comment">// then schedule next one if needed</span>
00086         <a class="code" href="class_ping_app.html#b4">scheduleNextPing</a>(msg);
00087     }
00088     <span class="keywordflow">else</span>
00089     {
00090         <span class="comment">// process ping response</span>
00091         <a class="code" href="class_ping_app.html#b6">processPingResponse</a>(check_and_cast&lt;PingPayload *&gt;(msg));
00092     }
00093 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="PingApp::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void PingApp::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00035 {
00036     <span class="comment">// read params</span>
00037     <span class="comment">// (defer reading srcAddr/destAddr to when ping starts, maybe</span>
00038     <span class="comment">// addresses will be assigned later by some protocol)</span>
00039     <a class="code" href="class_ping_app.html#p2">packetSize</a> = par(<span class="stringliteral">"packetSize"</span>);
00040     <a class="code" href="class_ping_app.html#p3">intervalp</a> = &amp; par(<span class="stringliteral">"interval"</span>);
00041     <a class="code" href="class_ping_app.html#p4">hopLimit</a> = par(<span class="stringliteral">"hopLimit"</span>);
00042     <a class="code" href="class_ping_app.html#p5">count</a> = par(<span class="stringliteral">"count"</span>);
00043     <a class="code" href="class_ping_app.html#p6">startTime</a> = par(<span class="stringliteral">"startTime"</span>);
00044     <a class="code" href="class_ping_app.html#p7">stopTime</a> = par(<span class="stringliteral">"stopTime"</span>);
00045     <a class="code" href="class_ping_app.html#p8">printPing</a> = (bool)par(<span class="stringliteral">"printPing"</span>);
00046 
00047     <span class="comment">// state</span>
00048     <a class="code" href="class_ping_app.html#p9">sendSeqNo</a> = <a class="code" href="class_ping_app.html#p10">expectedReplySeqNo</a> = 0;
00049     WATCH(sendSeqNo);
00050     WATCH(expectedReplySeqNo);
00051 
00052     <span class="comment">// statistics</span>
00053     <a class="code" href="class_ping_app.html#p11">delayStat</a>.setName(<span class="stringliteral">"pingRTT"</span>);
00054     <a class="code" href="class_ping_app.html#p12">delayVector</a>.setName(<span class="stringliteral">"pingRTT"</span>);
00055     <a class="code" href="class_ping_app.html#p13">dropVector</a>.setName(<span class="stringliteral">"pingDrop"</span>);
00056 
00057     <a class="code" href="class_ping_app.html#p14">dropCount</a> = <a class="code" href="class_ping_app.html#p15">outOfOrderArrivalCount</a> = 0;
00058     WATCH(dropCount);
00059     WATCH(outOfOrderArrivalCount);
00060 
00061     <span class="comment">// schedule first ping (use empty destAddr or stopTime&lt;=startTime to disable)</span>
00062     <span class="keywordflow">if</span> (par(<span class="stringliteral">"destAddr"</span>).stringValue()[0] &amp;&amp; (stopTime==0 || stopTime&gt;=startTime))
00063     {
00064         cMessage *msg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"sendPing"</span>);
00065         scheduleAt(startTime, msg);
00066     }
00067 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="PingApp::processPingResponse"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void PingApp::processPingResponse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_ping_payload.html">PingPayload</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00145 {
00146     <span class="comment">// get src, hopCount etc from packet, and print them</span>
00147     <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> src, dest;
00148     <span class="keywordtype">int</span> msgHopCount = -1;
00149     <span class="keywordflow">if</span> (dynamic_cast&lt;IPControlInfo *&gt;(msg-&gt;controlInfo())!=NULL)
00150     {
00151         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl = (<a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *)msg-&gt;controlInfo();
00152         src = ctrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a6">srcAddr</a>();
00153         dest = ctrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a3">destAddr</a>();
00154         msgHopCount = ctrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a15">timeToLive</a>();
00155     }
00156     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6ControlInfo *&gt;(msg-&gt;controlInfo())!=NULL)
00157     {
00158         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl = (<a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *)msg-&gt;controlInfo();
00159         src = ctrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>();
00160         dest = ctrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a5">destAddr</a>();
00161         msgHopCount = ctrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a11">hopLimit</a>();
00162     }
00163 
00164     simtime_t rtt = simTime() - msg-&gt;creationTime();
00165 
00166     <span class="keywordflow">if</span> (printPing)
00167     {
00168         cout &lt;&lt; fullPath() &lt;&lt; <span class="stringliteral">": reply of "</span> &lt;&lt; std::dec &lt;&lt; msg-&gt;byteLength()
00169              &lt;&lt; <span class="stringliteral">" bytes from "</span> &lt;&lt; src
00170              &lt;&lt; <span class="stringliteral">" icmp_seq="</span> &lt;&lt; msg-&gt;<a class="code" href="class_ping_payload.html#a9">seqNo</a>() &lt;&lt; <span class="stringliteral">" ttl="</span> &lt;&lt; msgHopCount
00171              &lt;&lt; <span class="stringliteral">" time="</span> &lt;&lt; (rtt * 1000) &lt;&lt; <span class="stringliteral">" msec"</span>
00172              &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; msg-&gt;name() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
00173     }
00174 
00175     <span class="comment">// update statistics</span>
00176     <a class="code" href="class_ping_app.html#b7">countPingResponse</a>(msg-&gt;byteLength(), msg-&gt;<a class="code" href="class_ping_payload.html#a9">seqNo</a>(), rtt);
00177     <span class="keyword">delete</span> msg;
00178 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="PingApp::scheduleNextPing"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void PingApp::scheduleNextPing           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>timer</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00111 {
00112     simtime_t nextPing = simTime() + <a class="code" href="class_ping_app.html#p3">intervalp</a>-&gt;doubleValue();
00113     <a class="code" href="class_ping_app.html#p9">sendSeqNo</a>++;
00114     <span class="keywordflow">if</span> ((count==0 || sendSeqNo&lt;count) &amp;&amp; (stopTime==0 || nextPing&lt;stopTime))
00115         scheduleAt(nextPing, timer);
00116     else
00117         delete timer;
00118 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="PingApp::sendPing"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void PingApp::sendPing           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00096 {
00097     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending ping #"</span> &lt;&lt; <a class="code" href="class_ping_app.html#p9">sendSeqNo</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00098 
00099     <span class="keywordtype">char</span> name[32];
00100     sprintf(name,<span class="stringliteral">"ping%ld"</span>, sendSeqNo);
00101 
00102     <a class="code" href="class_ping_payload.html">PingPayload</a> *msg = <span class="keyword">new</span> <a class="code" href="class_ping_payload.html">PingPayload</a>(name);
00103     msg-&gt;<a class="code" href="class_ping_payload.html#a8">setOriginatorId</a>(<span class="keywordtype">id</span>());
00104     msg-&gt;<a class="code" href="class_ping_payload.html#a10">setSeqNo</a>(sendSeqNo);
00105     msg-&gt;setByteLength(packetSize);
00106 
00107     <a class="code" href="class_ping_app.html#b5">sendToICMP</a>(msg, destAddr, srcAddr, hopLimit);
00108 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="PingApp::sendToICMP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void PingApp::sendToICMP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>payload</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>destAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>srcAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>hopLimit</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00121 {
00122     <span class="keywordflow">if</span> (!destAddr.<a class="code" href="class_i_pv_x_address.html#z35_0">isIPv6</a>())
00123     {
00124         <span class="comment">// send to IPv4</span>
00125         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
00126         ctrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a8">setSrcAddr</a>(srcAddr.<a class="code" href="class_i_pv_x_address.html#z35_1">get4</a>());
00127         ctrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a5">setDestAddr</a>(destAddr.<a class="code" href="class_i_pv_x_address.html#z35_1">get4</a>());
00128         ctrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a16">setTimeToLive</a>(hopLimit);
00129         msg-&gt;setControlInfo(ctrl);
00130         send(msg, <span class="stringliteral">"pingOut"</span>);
00131     }
00132     <span class="keywordflow">else</span>
00133     {
00134         <span class="comment">// send to IPv6</span>
00135         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
00136         ctrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a10">setSrcAddr</a>(srcAddr.<a class="code" href="class_i_pv_x_address.html#z35_2">get6</a>());
00137         ctrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a7">setDestAddr</a>(destAddr.<a class="code" href="class_i_pv_x_address.html#z35_2">get6</a>());
00138         ctrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a12">setHopLimit</a>(hopLimit);
00139         msg-&gt;setControlInfo(ctrl);
00140         send(msg, <span class="stringliteral">"pingv6Out"</span>);
00141     }
00142 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p5" doxytag="PingApp::count"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_ping_app.html#p5">PingApp::count</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p11" doxytag="PingApp::delayStat"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cStdDev <a class="el" href="class_ping_app.html#p11">PingApp::delayStat</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p12" doxytag="PingApp::delayVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector <a class="el" href="class_ping_app.html#p12">PingApp::delayVector</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="PingApp::destAddr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="class_ping_app.html#p0">PingApp::destAddr</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p14" doxytag="PingApp::dropCount"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ping_app.html#p14">PingApp::dropCount</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p13" doxytag="PingApp::dropVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector <a class="el" href="class_ping_app.html#p13">PingApp::dropVector</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p10" doxytag="PingApp::expectedReplySeqNo"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ping_app.html#p10">PingApp::expectedReplySeqNo</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="PingApp::hopLimit"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_ping_app.html#p4">PingApp::hopLimit</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="PingApp::intervalp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cPar* <a class="el" href="class_ping_app.html#p3">PingApp::intervalp</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p15" doxytag="PingApp::outOfOrderArrivalCount"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ping_app.html#p15">PingApp::outOfOrderArrivalCount</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="PingApp::packetSize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_ping_app.html#p2">PingApp::packetSize</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p8" doxytag="PingApp::printPing"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool <a class="el" href="class_ping_app.html#p8">PingApp::printPing</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p9" doxytag="PingApp::sendSeqNo"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ping_app.html#p9">PingApp::sendSeqNo</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="PingApp::srcAddr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="class_ping_app.html#p1">PingApp::srcAddr</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p6" doxytag="PingApp::startTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_ping_app.html#p6">PingApp::startTime</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p7" doxytag="PingApp::stopTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_ping_app.html#p7">PingApp::stopTime</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_ping_app_8h.html">PingApp.h</a><li><a class="el" href="_ping_app_8cc.html">PingApp.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:27 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
