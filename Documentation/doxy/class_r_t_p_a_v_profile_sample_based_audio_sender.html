<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: RTPAVProfileSampleBasedAudioSender Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>RTPAVProfileSampleBasedAudioSender Class Reference</h1><code>#include &lt;RTPAVProfileSampleBasedAudioSender.h&gt;</code>
<p>
<p>Inheritance diagram for RTPAVProfileSampleBasedAudioSender:
<p><center><img src="class_r_t_p_a_v_profile_sample_based_audio_sender.png" usemap="#RTPAVProfileSampleBasedAudioSender_map" border="0" alt=""></center>
<map name="RTPAVProfileSampleBasedAudioSender_map">
<area href="class_r_t_p_payload_sender.html" alt="RTPPayloadSender" shape="rect" coords="0,0,240,24">
<area href="class_r_t_p_a_v_profile_payload10_sender.html" alt="RTPAVProfilePayload10Sender" shape="rect" coords="0,112,240,136">
</map>
<a href="class_r_t_p_a_v_profile_sample_based_audio_sender-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
The class RTPAVProfileSampleBasedAudioSender is a base class for modules sending sample based audio as defined in the RTP audio/video profile. For reading audio files it used libaudiofile. Subclasses must provide a method <a class="el" href="class_r_t_p_payload_sender.html#a2">initialize()</a> to set parameters like sampling rate, sample width and number of channels. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#b0">initializeSenderModule</a> (<a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#b1">openSourceFile</a> (const char *fileName)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#b2">closeSourceFile</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#b3">play</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#b4">stop</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#b5">seekTime</a> (simtime_t moment)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#b6">seekByte</a> (int position)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#b7">sendPacket</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">AFfilehandle&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p0">_audioFile</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p1">_startTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p2">_samplingRate</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p3">_sampleWidth</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p4">_numberOfChannels</a></td></tr>

</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b2" doxytag="RTPAVProfileSampleBasedAudioSender::closeSourceFile"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTPAVProfileSampleBasedAudioSender::closeSourceFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This method is called by the destructor and closes the data file. 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_sender.html#b2">RTPPayloadSender</a>.<div class="fragment"><pre class="fragment">00060                                                          {
00061     <span class="keywordtype">int</span> closeReturnValue = afCloseFile(_audioFile);
00062     <span class="keywordflow">if</span> (closeReturnValue) {
00063         opp_error(<span class="stringliteral">"sender module: error closing audio file"</span>);
00064     }
00065 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="RTPAVProfileSampleBasedAudioSender::initializeSenderModule"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTPAVProfileSampleBasedAudioSender::initializeSenderModule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Called when this sender module receives a message initializeSenderModule. 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_sender.html#b0">RTPPayloadSender</a>.<div class="fragment"><pre class="fragment">00029                                                                                     {
00030     <a class="code" href="class_r_t_p_payload_sender.html#b0">RTPPayloadSender::initializeSenderModule</a>(rinp);
00031     <a class="code" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p1">_startTime</a> = simTime();
00032 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="RTPAVProfileSampleBasedAudioSender::openSourceFile"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTPAVProfileSampleBasedAudioSender::openSourceFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fileName</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This method is called by initializeSenderModule and opens the source data file as an inputFileStream stored in member variable _inputFileStream. Most data formats can use this method directly, but when using a library for a certain data format which offers an own open routine this method must be overwritten. 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_sender.html#b1">RTPPayloadSender</a>.<div class="fragment"><pre class="fragment">00035                                                                             {
00036     <a class="code" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p0">_audioFile</a> = afOpenFile(fileName, <span class="stringliteral">"r"</span>, 0);
00037     <span class="keywordflow">if</span> (_audioFile == AF_NULL_FILEHANDLE) {
00038         opp_error(<span class="stringliteral">"sender module: error opening audio file"</span>);
00039     }
00040     <span class="keywordflow">else</span> {
00041         <span class="keywordflow">if</span> (_samplingRate != afGetRate(_audioFile, AF_DEFAULT_TRACK)) {
00042             opp_error(<span class="stringliteral">"sender module: audio file has wrong sampling rate"</span>);
00043         }
00044         <span class="keywordflow">else</span> {
00045             <span class="keywordtype">int</span> sampleFormat, sampleWidth;
00046             afGetSampleFormat(_audioFile, AF_DEFAULT_TRACK, &amp;sampleFormat, &amp;sampleWidth);
00047             <span class="keywordflow">if</span> (_sampleWidth != sampleWidth) {
00048                 opp_error(<span class="stringliteral">"sender module: audio file has wrong sample width"</span>);
00049             }
00050             <span class="keywordflow">else</span> {
00051                 <span class="keywordflow">if</span> (_numberOfChannels != afGetChannels(_audioFile, AF_DEFAULT_TRACK)) {
00052                     opp_error(<span class="stringliteral">"sender module: audio file has wrong number of channels"</span>);
00053                 }
00054             }
00055         }
00056     }
00057 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="RTPAVProfileSampleBasedAudioSender::play"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTPAVProfileSampleBasedAudioSender::play           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Starts data transmission. Every sender module must implement this method. 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_sender.html#b3">RTPPayloadSender</a>.<div class="fragment"><pre class="fragment">00068                                               {
00069     <span class="keywordflow">if</span> (_status == STOPPED) {
00070         <a class="code" href="class_r_t_p_payload_sender.html#p9">_status</a> = <a class="code" href="class_r_t_p_payload_sender.html#w2w1">PLAYING</a>;
00071         <a class="code" href="class_r_t_p_sender_status_message.html">RTPSenderStatusMessage</a> *rssm = <span class="keyword">new</span> <a class="code" href="class_r_t_p_sender_status_message.html">RTPSenderStatusMessage</a>(<span class="stringliteral">"PLAYING"</span>);
00072         rssm-&gt;<a class="code" href="class_r_t_p_sender_status_message.html#a7">setStatus</a>(<span class="stringliteral">"PLAYING"</span>);
00073         <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp = <span class="keyword">new</span> <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a>(<span class="stringliteral">"senderStatus(PLAYING)"</span>);
00074         rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a19">senderModuleStatus</a>(_ssrc, rssm);
00075         send(rinp, <span class="stringliteral">"toProfile"</span>);
00076         <a class="code" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#b7">sendPacket</a>();
00077     }
00078     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_status == PLAYING) {
00079         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"sender module: already playing"</span> &lt;&lt; endl;
00080     }
00081 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="RTPAVProfileSampleBasedAudioSender::seekByte"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTPAVProfileSampleBasedAudioSender::seekByte           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>position</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
When the data transmission is paused the current position is changed to this byte position (excluding file header). Implementation in sender modules is optional. 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_sender.html#b8">RTPPayloadSender</a>.<div class="fragment"><pre class="fragment">00106                                                               {
00107     <span class="keywordflow">if</span> (_status = STOPPED) {
00108         <span class="keywordtype">int</span> frameNumber = (int)(((float)position) / afGetFrameSize(_audioFile, AF_DEFAULT_TRACK, 0));
00109         afSeekFrame(_audioFile, AF_DEFAULT_TRACK, frameNumber);
00110         <a class="code" href="class_r_t_p_sender_status_message.html">RTPSenderStatusMessage</a> *rssm = <span class="keyword">new</span> <a class="code" href="class_r_t_p_sender_status_message.html">RTPSenderStatusMessage</a>(<span class="stringliteral">"SEEKED"</span>);
00111         rssm-&gt;<a class="code" href="class_r_t_p_sender_status_message.html#a7">setStatus</a>(<span class="stringliteral">"SEEKED"</span>);
00112         <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp = <span class="keyword">new</span> <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a>(<span class="stringliteral">"senderModuleStatus(SEEKED)"</span>);
00113         rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a19">senderModuleStatus</a>(_ssrc, rssm);
00114         send(rinp, <span class="stringliteral">"toProfile"</span>);
00115     }
00116     <span class="keywordflow">else</span> {
00117         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"sender module: seeking not allowed while playing"</span> &lt;&lt; endl;
00118     };
00119 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="RTPAVProfileSampleBasedAudioSender::seekTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTPAVProfileSampleBasedAudioSender::seekTime           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">simtime_t&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>moment</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
When the data transmission is paused the current position is changed to this time (relative to start of file). Implementation in sender modules is optional. 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_sender.html#b7">RTPPayloadSender</a>.<div class="fragment"><pre class="fragment">00090                                                                   {
00091     <span class="keywordflow">if</span> (_status = STOPPED) {
00092         <span class="keywordtype">int</span> frameNumber = (int)(moment * (float)<a class="code" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p2">_samplingRate</a>);
00093         afSeekFrame(_audioFile, AF_DEFAULT_TRACK, frameNumber);
00094         <a class="code" href="class_r_t_p_sender_status_message.html">RTPSenderStatusMessage</a> *rssm = <span class="keyword">new</span> <a class="code" href="class_r_t_p_sender_status_message.html">RTPSenderStatusMessage</a>(<span class="stringliteral">"SEEKED"</span>);
00095         rssm-&gt;<a class="code" href="class_r_t_p_sender_status_message.html#a7">setStatus</a>(<span class="stringliteral">"SEEKED"</span>);
00096         <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp = <span class="keyword">new</span> <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a>(<span class="stringliteral">"senderModuleStatus(SEEKED)"</span>);
00097         rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a19">senderModuleStatus</a>(_ssrc, rssm);
00098         send(rinp, <span class="stringliteral">"toProfile"</span>);
00099     }
00100     <span class="keywordflow">else</span> {
00101         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"sender module: seeking not allowed while playing"</span> &lt;&lt; endl;
00102     };
00103 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="RTPAVProfileSampleBasedAudioSender::sendPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool RTPAVProfileSampleBasedAudioSender::sendPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This method gets called when one (or more) rtp data packets have to be sent. Subclasses must overwrite this method to do something useful. This implementation doesn't send packets it just returns 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_sender.html#b11">RTPPayloadSender</a>.<div class="fragment"><pre class="fragment">00122                                                     {
00123     <a class="code" href="class_r_t_p_packet.html">RTPPacket</a> *packet = <span class="keyword">new</span> <a class="code" href="class_r_t_p_packet.html">RTPPacket</a>();
00124     <span class="keywordtype">int</span> bytesPerSample = (int)afGetFrameSize(_audioFile, AF_DEFAULT_TRACK, 0);
00125     <span class="keywordtype">int</span> maxDataSize = <a class="code" href="class_r_t_p_payload_sender.html#p1">_mtu</a> - packet-&gt;<a class="code" href="class_r_t_p_packet.html#a18">headerLength</a>();
00126     maxDataSize = maxDataSize - (maxDataSize % bytesPerSample);
00127 
00128     <span class="comment">// AV profile: packetization interval for audio is 20 ms</span>
00129     simtime_t packetizationInterval = 0.020;
00130 
00131     <span class="keywordtype">int</span> samplesPerPacketNeeded = (int)(((float)<a class="code" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p2">_samplingRate</a>) * packetizationInterval);
00132     <span class="keywordtype">int</span> samplesPerPacketPossible = maxDataSize / bytesPerSample;
00133 
00134     <span class="keywordtype">int</span> samplesInPacket;
00135 
00136     <span class="comment">// do samples for packetization interval fit into one packet?</span>
00137     <span class="comment">// if not put less samples in a packet</span>
00138     <span class="keywordflow">if</span> (samplesPerPacketPossible &lt; samplesPerPacketNeeded) {
00139         packetizationInterval = ((float)samplesPerPacketPossible) / ((float)<a class="code" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p2">_samplingRate</a>);
00140         samplesInPacket = samplesPerPacketPossible;
00141     }
00142     <span class="keywordflow">else</span> {
00143         samplesInPacket = samplesPerPacketNeeded;
00144     }
00145 
00146     <span class="keywordtype">int</span> dataSize = samplesInPacket * bytesPerSample;
00147 
00148     packet-&gt;<a class="code" href="class_r_t_p_packet.html#a11">setPayloadType</a>(_payloadType);
00149     packet-&gt;<a class="code" href="class_r_t_p_packet.html#a13">setSequenceNumber</a>(_sequenceNumber++);
00150     packet-&gt;<a class="code" href="class_r_t_p_packet.html#a15">setTimeStamp</a>(_timeStampBase + (simTime() - _startTime) * (<span class="keywordtype">float</span>)_samplingRate);
00151     packet-&gt;<a class="code" href="class_r_t_p_packet.html#a17">setSSRC</a>(_ssrc);
00152     <span class="keywordtype">void</span> *sampleData = malloc(dataSize);
00153     <span class="keywordtype">int</span> samplesRead = afReadFrames(_audioFile, AF_DEFAULT_TRACK, sampleData, samplesInPacket);
00154     packet-&gt;addPar(<span class="stringliteral">"data"</span>) = sampleData;
00155     packet-&gt;addLength(dataSize);
00156     <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp = <span class="keyword">new</span> <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a>(<span class="stringliteral">"data()"</span>);
00157     rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a22">dataOut</a>(packet);
00158     send(rinp, <span class="stringliteral">"toProfile"</span>);
00159     <span class="keywordflow">if</span> (afTellFrame(_audioFile, AF_DEFAULT_TRACK) &gt;= afGetFrameCount(_audioFile, AF_DEFAULT_TRACK)) {
00160         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00161     }
00162     <span class="keywordflow">else</span> {
00163         <a class="code" href="class_r_t_p_payload_sender.html#p10">_reminderMessage</a> = <span class="keyword">new</span> cMessage();
00164         scheduleAt(simTime() + packetizationInterval, _reminderMessage);
00165         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00166     };
00167 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="RTPAVProfileSampleBasedAudioSender::stop"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTPAVProfileSampleBasedAudioSender::stop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This method stop data transmission and resets the sender module so that a following PLAY command would start the transmission at the beginning again. 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_sender.html#b9">RTPPayloadSender</a>.<div class="fragment"><pre class="fragment">00084                                               {
00085     <a class="code" href="class_r_t_p_payload_sender.html#b9">RTPPayloadSender::stop</a>();
00086     afSeekFrame(_audioFile, AF_DEFAULT_TRACK, 0);
00087 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p0" doxytag="RTPAVProfileSampleBasedAudioSender::_audioFile"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">AFfilehandle <a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p0">RTPAVProfileSampleBasedAudioSender::_audioFile</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
File handle for the audio file.     </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="RTPAVProfileSampleBasedAudioSender::_numberOfChannels"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p4">RTPAVProfileSampleBasedAudioSender::_numberOfChannels</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The number of different audio channels. Must be set by subclasses in <a class="el" href="class_r_t_p_payload_sender.html#a2">initialize()</a>.     </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="RTPAVProfileSampleBasedAudioSender::_sampleWidth"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p3">RTPAVProfileSampleBasedAudioSender::_sampleWidth</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The width of a sample of one channel in bits. Possibly values are 8, 16 and 24. Must be set by subclasses in <a class="el" href="class_r_t_p_payload_sender.html#a2">initialize()</a>.     </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="RTPAVProfileSampleBasedAudioSender::_samplingRate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p2">RTPAVProfileSampleBasedAudioSender::_samplingRate</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The sampling rate of the audio. Must be set by subclasses in <a class="el" href="class_r_t_p_payload_sender.html#a2">initialize()</a>.     </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="RTPAVProfileSampleBasedAudioSender::_startTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_r_t_p_a_v_profile_sample_based_audio_sender.html#p1">RTPAVProfileSampleBasedAudioSender::_startTime</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The time this sender module got initialized. Used to calculate time stamps.     </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_r_t_p_a_v_profile_sample_based_audio_sender_8h.html">RTPAVProfileSampleBasedAudioSender.h</a><li><a class="el" href="_r_t_p_a_v_profile_sample_based_audio_sender_8cc.html">RTPAVProfileSampleBasedAudioSender.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:29 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
