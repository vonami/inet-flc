<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: UDPSerializer Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>UDPSerializer Class Reference</h1><code>#include &lt;UDPSerializer.h&gt;</code>
<p>
<a href="class_u_d_p_serializer-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Converts between <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> and binary (network byte order) <a class="el" href="class_u_d_p.html">UDP</a> header. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p_serializer.html#a0">UDPSerializer</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p_serializer.html#a1">serialize</a> (<a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *pkt, unsigned char *buf, unsigned int bufsize)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p_serializer.html#a2">parse</a> (unsigned char *buf, unsigned int bufsize, <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *pkt)</td></tr>

<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static unsigned short&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p_serializer.html#e0">checksum</a> (unsigned char *addr, unsigned int count)</td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="UDPSerializer::UDPSerializer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">UDPSerializer::UDPSerializer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00032 {}
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="e0" doxytag="UDPSerializer::checksum"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">unsigned short UDPSerializer::checksum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>count</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Helper: calculate checksum <div class="fragment"><pre class="fragment">00066 {
00067     <span class="keywordtype">long</span> sum = 0;
00068 
00069     <span class="keywordflow">while</span> (count &gt; 1)  {
00070         sum += *((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *&amp;)addr)++;
00071         <span class="keywordflow">if</span> (sum &amp; 0x80000000)
00072             sum = (sum &amp; 0xFFFF) + (sum &gt;&gt; 16);
00073         count -= 2;
00074     }
00075 
00076     if (count)
00077         sum += *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)addr;
00078 
00079     while (sum &gt;&gt; 16)
00080         sum = (sum &amp; 0xffff) + (sum &gt;&gt; 16);
00081 
00082     return ~sum;
00083 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="UDPSerializer::parse"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDPSerializer::parse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>bufsize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>pkt</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Puts a packet sniffed from the wire into an <a class="el" href="class_u_d_p_packet.html">UDPPacket</a>. <div class="fragment"><pre class="fragment">00052 {
00053  
00054         <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html">udphdr</a> *<a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html">udphdr</a> = (<span class="keyword">struct </span>udphdr*) buf;
00055 
00056         dest-&gt;<a class="code" href="class_u_d_p_packet.html#a8">setSourcePort</a>(ntohs(udphdr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html#o0">uh_sport</a>));
00057         dest-&gt;<a class="code" href="class_u_d_p_packet.html#a10">setDestinationPort</a>(ntohs(udphdr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html#o1">uh_dport</a>));
00058         dest-&gt;setByteLength(8);
00059         cMessage *encapPacket = <span class="keyword">new</span> cMessage(<span class="stringliteral">"Payload-from-wire"</span>);
00060         encapPacket-&gt;setByteLength(ntohs(udphdr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html#o2">uh_ulen</a>) - <span class="keyword">sizeof</span>(<span class="keyword">struct</span> udphdr));
00061     dest-&gt;encapsulate(encapPacket);
00062     dest-&gt;setName(encapPacket-&gt;name());
00063 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="UDPSerializer::serialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int UDPSerializer::serialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>bufsize</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Serializes an <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> for transmission on the wire. Returns the length of data written into buffer. <div class="fragment"><pre class="fragment">00039 {
00040     <span class="keyword">struct </span><a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html">udphdr</a> *<a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html">udphdr</a> = (<span class="keyword">struct </span>udphdr *) (buf);
00041     <span class="keywordtype">int</span> packetLength;
00042 
00043         packetLength = pkt-&gt;byteLength();
00044         udphdr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html#o0">uh_sport</a> = htons(pkt-&gt;<a class="code" href="class_u_d_p_packet.html#a7">sourcePort</a>());
00045         udphdr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html#o1">uh_dport</a> = htons(pkt-&gt;<a class="code" href="class_u_d_p_packet.html#a9">destinationPort</a>());
00046         udphdr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html#o2">uh_ulen</a>  = htons(packetLength);
00047     udphdr-&gt;<a class="code" href="struct_i_n_e_t_fw_1_1udphdr.html#o3">uh_sum</a>   = <a class="code" href="class_u_d_p_serializer.html#e0">checksum</a>(buf, packetLength);
00048     <span class="keywordflow">return</span> packetLength;
00049 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_u_d_p_serializer_8h.html">UDPSerializer.h</a><li><a class="el" href="_u_d_p_serializer_8cc.html">UDPSerializer.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:32 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
