<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: RTPAVProfilePayload32Receiver Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>RTPAVProfilePayload32Receiver Class Reference</h1><code>#include &lt;RTPAVProfilePayload32Receiver.h&gt;</code>
<p>
<p>Inheritance diagram for RTPAVProfilePayload32Receiver:
<p><center><img src="class_r_t_p_a_v_profile_payload32_receiver.png" usemap="#RTPAVProfilePayload32Receiver_map" border="0" alt=""></center>
<map name="RTPAVProfilePayload32Receiver_map">
<area href="class_r_t_p_payload_receiver.html" alt="RTPPayloadReceiver" shape="rect" coords="0,0,201,24">
</map>
<a href="class_r_t_p_a_v_profile_payload32_receiver-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
This module is used to receive data (mpeg video) of payload 32 for rtp endsystems working under the rtp av profile. It expects data in the format defined in rfc 2250. Its corresponding sender module is <a class="el" href="class_r_t_p_a_v_profile_payload32_sender.html">RTPAVProfilePayload32Sender</a>. This implementation doesn't work with real mpeg data, so it doesn't write an mpeg file but a sim file, which can be played with a modified mpeg player. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_payload32_receiver.html#b0">~RTPAVProfilePayload32Receiver</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_payload32_receiver.html#b1">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_payload32_receiver.html#b2">processPacket</a> (<a class="el" href="class_r_t_p_packet.html">RTPPacket</a> *packet)</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">cQueue *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">_queue</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#a3">u_int32</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_p_a_v_profile_payload32_receiver.html#p1">_lowestAllowedTimeStamp</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="b0" doxytag="RTPAVProfilePayload32Receiver::~RTPAVProfilePayload32Receiver"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">RTPAVProfilePayload32Receiver::~<a class="el" href="class_r_t_p_a_v_profile_payload32_receiver.html">RTPAVProfilePayload32Receiver</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Destructor. <div class="fragment"><pre class="fragment">00034                                                               {
00035     <span class="keyword">delete</span> <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">_queue</a>;
00036 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b1" doxytag="RTPAVProfilePayload32Receiver::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTPAVProfilePayload32Receiver::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Calls the method of the superclass <a class="el" href="class_r_t_p_payload_receiver.html">RTPPayloadReceiver</a> and sets the payload type to 32. 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_receiver.html#b1">RTPPayloadReceiver</a>.<div class="fragment"><pre class="fragment">00039                                                {
00040     <a class="code" href="class_r_t_p_payload_receiver.html#b1">RTPPayloadReceiver::initialize</a>();
00041     <a class="code" href="class_r_t_p_payload_receiver.html#p1">_payloadType</a> = 32;
00042     <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">_queue</a> = <span class="keyword">new</span> cQueue(<span class="stringliteral">"IncomingQueue"</span>, &amp;(RTPPacket::compareFunction));
00043     <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p1">_lowestAllowedTimeStamp</a> = 0;
00044 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="RTPAVProfilePayload32Receiver::processPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTPAVProfilePayload32Receiver::processPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_packet.html">RTPPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>packet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Writes information about received frames into the output file. The only error correction provided is reordering packets of one frame if needed. 
<p>
Reimplemented from <a class="el" href="class_r_t_p_payload_receiver.html#b3">RTPPayloadReceiver</a>.<div class="fragment"><pre class="fragment">00047                                                                       {
00048     <span class="comment">// the first packet sets the lowest allowed time stamp</span>
00049     <span class="keywordflow">if</span> (_lowestAllowedTimeStamp == 0) {
00050         <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p1">_lowestAllowedTimeStamp</a> = rtpPacket-&gt;<a class="code" href="class_r_t_p_packet.html#a14">timeStamp</a>();
00051     };
00052 
00053     <span class="keywordflow">if</span> (rtpPacket-&gt;<a class="code" href="class_r_t_p_packet.html#a14">timeStamp</a>() &lt; <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p1">_lowestAllowedTimeStamp</a>) {
00054         <span class="keyword">delete</span> rtpPacket;
00055     }
00056     <span class="keywordflow">else</span> {
00057         <span class="comment">// is this packet from the next frame ?</span>
00058         <span class="comment">// this can happen when the marked packet has been</span>
00059         <span class="comment">// lost or arrives late</span>
00060         <span class="keywordtype">bool</span> nextTimeStamp = rtpPacket-&gt;<a class="code" href="class_r_t_p_packet.html#a14">timeStamp</a>() &gt; <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p1">_lowestAllowedTimeStamp</a>;
00061 
00062         <span class="comment">// is this packet marked, which means that it's</span>
00063         <span class="comment">// the last packet of this frame</span>
00064         <span class="keywordtype">bool</span> marked = rtpPacket-&gt;<a class="code" href="class_r_t_p_packet.html#a8">marker</a>();
00065 
00066         <span class="comment">// test if end of frame reached</span>
00067 
00068         <span class="comment">// check if we received the last (= marked)</span>
00069         <span class="comment">// packet of the frame or</span>
00070         <span class="comment">// we received a packet of the next frame</span>
00071 
00072         <span class="keywordflow">if</span> (nextTimeStamp || marked) {
00073 
00074             <span class="comment">// a marked packet belongs to this frame</span>
00075             <span class="keywordflow">if</span> (marked &amp;&amp; !nextTimeStamp) {
00076                 <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">_queue</a>-&gt;insert(rtpPacket);
00077             }
00078 
00079             <span class="keywordtype">int</span> pictureType = 0;
00080             <span class="keywordtype">int</span> frameSize = 0;
00081 
00082             <span class="comment">// the queue contains all packets for this frame</span>
00083             <span class="comment">// we have received</span>
00084             <span class="keywordflow">while</span> (!<a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">_queue</a>-&gt;empty()) {
00085                 <a class="code" href="class_r_t_p_packet.html">RTPPacket</a> *readPacket = (<a class="code" href="class_r_t_p_packet.html">RTPPacket</a> *)(<a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">_queue</a>-&gt;head());
00086                 <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">_queue</a>-&gt;remove(readPacket);
00087                 <a class="code" href="class_r_t_p_mpeg_packet.html">RTPMpegPacket</a> *mpegPacket = (<a class="code" href="class_r_t_p_mpeg_packet.html">RTPMpegPacket</a> *)(readPacket-&gt;decapsulate());
00088                 <span class="keywordflow">if</span> (pictureType == 0)
00089                     pictureType = mpegPacket-&gt;pictureType();
00090                 frameSize = frameSize + mpegPacket-&gt;payloadLength();
00091 
00092                 delete mpegPacket;
00093                 delete readPacket;
00094             };
00095 
00096             <span class="comment">// we start the next frame</span>
00097             <span class="comment">// set the allowed time stamp</span>
00098             if (nextTimeStamp) {
00099                 <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p1">_lowestAllowedTimeStamp</a> = rtpPacket-&gt;<a class="code" href="class_r_t_p_packet.html#a14">timeStamp</a>();
00100                 <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">_queue</a>-&gt;insert(rtpPacket);
00101             };
00102 
00103             <span class="comment">// we have calculated a frame</span>
00104             <span class="keywordflow">if</span> (frameSize &gt; 0) {
00105                 <span class="keywordtype">char</span> line[100];
00106                 <span class="comment">// what picture type is it</span>
00107                 <span class="keywordtype">char</span> picture = <span class="charliteral">' '</span>;
00108                 <span class="keywordflow">if</span> (pictureType == 1)
00109                     picture = 'I';
00110                 else if (pictureType == 2)
00111                     picture = 'P';
00112                 else if (pictureType == 3)
00113                     picture = 'B';
00114                 else if (pictureType == 4)
00115                     picture = 'D';
00116 
00117                 <span class="comment">// create sim line</span>
00118                 sprintf(line, "%f %i %c-Frame", simTime(), frameSize * 8, picture);
00119                 <span class="comment">// and write it to the file</span>
00120                 _outputFileStream &lt;&lt; line &lt;&lt; endl;
00121             }
00122         }
00123         <span class="comment">// we are not at the end of the frame</span>
00124         <span class="comment">// so just insert this packet</span>
00125         else {
00126             <a class="code" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">_queue</a>-&gt;insert(rtpPacket);
00127         }
00128     }
00129 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p1" doxytag="RTPAVProfilePayload32Receiver::_lowestAllowedTimeStamp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="types_8h.html#a3">u_int32</a> <a class="el" href="class_r_t_p_a_v_profile_payload32_receiver.html#p1">RTPAVProfilePayload32Receiver::_lowestAllowedTimeStamp</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Stores the lowest allowed time stamp of rtp data packets. The value is used to throw away packets from mpeg frames already stored in the data file.     </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="RTPAVProfilePayload32Receiver::_queue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cQueue* <a class="el" href="class_r_t_p_a_v_profile_payload32_receiver.html#p0">RTPAVProfilePayload32Receiver::_queue</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
A reordering queue for incoming packets.     </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_r_t_p_a_v_profile_payload32_receiver_8h.html">RTPAVProfilePayload32Receiver.h</a><li><a class="el" href="_r_t_p_a_v_profile_payload32_receiver_8cc.html">RTPAVProfilePayload32Receiver.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:29 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
