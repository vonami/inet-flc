<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: ChannelAccess Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>ChannelAccess Class Reference</h1><code>#include &lt;ChannelAccess.h&gt;</code>
<p>
<p>Inheritance diagram for ChannelAccess:
<p><center><img src="class_channel_access.png" usemap="#ChannelAccess_map" border="0" alt=""></center>
<map name="ChannelAccess_map">
<area href="class_basic_module.html" alt="BasicModule" shape="rect" coords="141,56,244,80">
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="141,0,244,24">
<area href="class_abstract_radio.html" alt="AbstractRadio" shape="rect" coords="56,168,159,192">
<area href="class_basic_snr_eval.html" alt="BasicSnrEval" shape="rect" coords="226,168,329,192">
<area href="class_generic_radio.html" alt="GenericRadio" shape="rect" coords="0,224,103,248">
<area href="class_ieee80211_radio.html" alt="Ieee80211Radio" shape="rect" coords="113,224,216,248">
<area href="class_snr_eval.html" alt="SnrEval" shape="rect" coords="226,224,329,248">
<area href="class_gilbert_elliot_snr.html" alt="GilbertElliotSnr" shape="rect" coords="169,280,272,304">
<area href="class_snr_eval80211.html" alt="SnrEval80211" shape="rect" coords="282,280,385,304">
</map>
<a href="class_channel_access-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Basic class for all physical layers, please don't touch!! 
<p>
This class is not supposed to work on its own, but it contains functions and lists that cooperate with <a class="el" href="class_channel_control.html">ChannelControl</a> to handle the dynamically created gates. This means EVERY <a class="el" href="class_snr_eval.html">SnrEval</a> (the lowest layer in a host) has to be derived from this class!!!! And please follow the instructions on how to declare a physical layer in a .ned file in "The Design of a Mobility Framework in OMNeT++" paper.<p>
Please don't touch this class.<p>
<dl compact><dt><b>Author:</b></dt><dd>Marc Löbbers </dd></dl>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_channel_access.html#b0">sendToChannel</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends a message to all hosts in range.  <a href="#b0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const <a class="el" href="class_coord.html">Coord</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_channel_access.html#b1">myPosition</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the host's position.  <a href="#b1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_channel_access.html#b2">initialize</a> (int stage)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register with <a class="el" href="class_channel_control.html">ChannelControl</a> and subscribe to hostPos.  <a href="#b2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_channel_access.html#b3">numInitStages</a> () const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Divide initialization into two stages.  <a href="#b3"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_channel_control.html">ChannelControl</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_channel_access.html#p0">cc</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pointer to the <a class="el" href="class_channel_control.html">ChannelControl</a> module.  <a href="#p0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct_channel_control_1_1_host_entry.html">ChannelControl::HostRef</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_channel_access.html#p1">myHostRef</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Identifies this host in the <a class="el" href="class_channel_control.html">ChannelControl</a> module.  <a href="#p1"></a><br></td></tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b2" doxytag="ChannelAccess::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ChannelAccess::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stage</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Register with <a class="el" href="class_channel_control.html">ChannelControl</a> and subscribe to hostPos. 
<p>
Upon initialization ChannelAccess registers the nic parent module to have all its connections handled by <a class="el" href="class_channel_control.html">ChannelControl</a> 
<p>
Reimplemented from <a class="el" href="class_basic_module.html#b2">BasicModule</a>.
<p>
Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#b0">GilbertElliotSnr</a>, <a class="el" href="class_snr_eval.html#b0">SnrEval</a>, <a class="el" href="class_snr_eval80211.html#b0">SnrEval80211</a>, <a class="el" href="class_basic_snr_eval.html#b0">BasicSnrEval</a>, and <a class="el" href="class_abstract_radio.html#b0">AbstractRadio</a>.<div class="fragment"><pre class="fragment">00031 {
00032     <a class="code" href="class_basic_module.html#b2">BasicModule::initialize</a>(stage);
00033 
00034     <span class="keywordflow">if</span> (stage == 0)
00035     {
00036         <a class="code" href="class_channel_access.html#p0">cc</a> = dynamic_cast&lt;ChannelControl *&gt;(simulation.moduleByPath(<span class="stringliteral">"channelcontrol"</span>));
00037         <span class="keywordflow">if</span> (cc == 0)
00038             error("Could not find channelcontrol module");
00039 
00040         <span class="comment">// register to get a notification when position changes</span>
00041         nb-&gt;subscribe(this, NF_HOSTPOSITION_UPDATED);
00042     }
00043     else if (stage == 2)
00044     {
00045         cModule *hostModule = <a class="code" href="class_basic_module.html#b0">findHost</a>();
00046         <a class="code" href="class_channel_access.html#p1">myHostRef</a> = <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;<a class="code" href="class_channel_control.html#a3">lookupHost</a>(hostModule);
00047         <span class="keywordflow">if</span> (myHostRef==0)
00048             error("host not registered yet in <a class="code" href="class_channel_control.html">ChannelControl</a> (this should be done by "
00049                   "the Mobility module -- maybe this host doesn't have one?)");
00050     }
00051 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="ChannelAccess::myPosition"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const <a class="el" href="class_coord.html">Coord</a>&amp; ChannelAccess::myPosition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the host's position. 
<p>
<div class="fragment"><pre class="fragment">00062 {<span class="keywordflow">return</span> <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;<a class="code" href="class_channel_control.html#a8">getHostPosition</a>(myHostRef);}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="ChannelAccess::numInitStages"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual int ChannelAccess::numInitStages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Divide initialization into two stages. 
<p>
In the first stage (stage==0), modules subscribe to notification categories at <a class="el" href="class_notification_board.html">NotificationBoard</a>. The first notifications (e.g. about the initial values of some variables such as <a class="el" href="class_radio_state.html">RadioState</a>) should take place earliest in the second stage (stage==1), when everyone interested in them has already subscribed. 
<p>
Reimplemented from <a class="el" href="class_basic_module.html#b3">BasicModule</a>.<div class="fragment"><pre class="fragment">00068 {<span class="keywordflow">return</span> 3;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="ChannelAccess::sendToChannel"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ChannelAccess::sendToChannel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sends a message to all hosts in range. 
<p>
This function has to be called whenever a packet is supposed to be sent to the channel.<p>
This function really sends the message away, so if you still want to work with it you should send a duplicate! <div class="fragment"><pre class="fragment">00062 {
00063     <span class="keyword">const</span> <a class="code" href="class_channel_control.html#w1">ChannelControl::ModuleList</a>&amp; neighbors = <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;<a class="code" href="class_channel_control.html#a9">getNeighbors</a>(myHostRef);
00064     <a class="code" href="_basic_module_8cc.html#a0">coreEV</a> &lt;&lt; <span class="stringliteral">"sendToChannel: sending to gates\n"</span>;
00065 
00066     <span class="comment">// loop through all hosts in range</span>
00067     ChannelControl::ModuleList::const_iterator it;
00068     <span class="keywordflow">for</span> (it = neighbors.begin(); it != neighbors.end(); ++it)
00069     {
00070         cModule *mod = *it;
00071 
00072         <span class="comment">// we need to send to each radioIn[] gate</span>
00073         cGate *radioGate = mod-&gt;gate(<span class="stringliteral">"radioIn"</span>);
00074 
00075         <span class="keywordflow">if</span> (radioGate == NULL)
00076             error("module %s must have a gate called radioIn", mod-&gt;fullPath().c_str());
00077 
00078         for (<span class="keywordtype">int</span> i = 0; i &lt; radioGate-&gt;size(); i++)
00079         {
00080             <a class="code" href="struct_channel_control_1_1_host_entry.html">ChannelControl::HostRef</a> h = <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;<a class="code" href="class_channel_control.html#a3">lookupHost</a>(mod);
00081 
00082             <span class="keywordflow">if</span> (h == NULL)
00083                 error("cannot find module in channel control");
00084 
00085             if (h-&gt;channel == msg-&gt;getChannelNumber())
00086             {
00087                 <a class="code" href="_basic_module_8cc.html#a0">coreEV</a> &lt;&lt; <span class="stringliteral">"sending message to host listening on the same channel\n"</span>;
00088                 <span class="comment">// account for propagation delay, based on distance in meters</span>
00089                 <span class="comment">// Over 300m, dt=1us=10 bit times @ 10Mbps</span>
00090                 sendDirect((cMessage *)msg-&gt;<a class="code" href="class_air_frame.html#a4">dup</a>(), <a class="code" href="class_channel_access.html#p1">myHostRef</a>-&gt;<a class="code" href="struct_channel_control_1_1_host_entry.html#o1">pos</a>.<a class="code" href="class_coord.html#a7">distance</a>(h-&gt;<a class="code" href="struct_channel_control_1_1_host_entry.html#o1">pos</a>) / <a class="code" href="_channel_control_8h.html#a0">LIGHT_SPEED</a>, mod, radioGate-&gt;id() + i);
00091             }
00092             <span class="keywordflow">else</span>
00093                 <a class="code" href="_basic_module_8cc.html#a0">coreEV</a> &lt;&lt; <span class="stringliteral">"skipping host listening on a different channel\n"</span>;
00094         }
00095     }
00096 
00097     <span class="comment">// register transmission in ChannelControl</span>
00098     <a class="code" href="class_channel_access.html#p0">cc</a>-&gt;<a class="code" href="class_channel_control.html#a7">addOngoingTransmission</a>(myHostRef, msg);
00099 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p0" doxytag="ChannelAccess::cc"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_channel_control.html">ChannelControl</a>* <a class="el" href="class_channel_access.html#p0">ChannelAccess::cc</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Pointer to the <a class="el" href="class_channel_control.html">ChannelControl</a> module. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="ChannelAccess::myHostRef"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="struct_channel_control_1_1_host_entry.html">ChannelControl::HostRef</a> <a class="el" href="class_channel_access.html#p1">ChannelAccess::myHostRef</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Identifies this host in the <a class="el" href="class_channel_control.html">ChannelControl</a> module. 
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_channel_access_8h.html">ChannelAccess.h</a><li><a class="el" href="_channel_access_8cc.html">ChannelAccess.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:21 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
