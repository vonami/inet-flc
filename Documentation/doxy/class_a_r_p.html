<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: ARP Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>ARP Class Reference</h1><code>#include &lt;ARP.h&gt;</code>
<p>
<a href="class_a_r_p-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
ARP implementation. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::map&lt; <a class="el" href="class_i_p_address.html">IPAddress</a>,<br>
 <a class="el" href="struct_a_r_p_1_1_a_r_p_cache_entry.html">ARPCacheEntry</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#w0">ARPCache</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::vector&lt; cMessage * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#w1">MsgPtrVector</a></td></tr>

<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#a0">ARP</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#a1">~ARP</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b1">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b2">finish</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b3">processOutboundPacket</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b4">sendPacketToNIC</a> (cMessage *msg, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie, const <a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp;macAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b5">initiateARPResolution</a> (<a class="el" href="struct_a_r_p_1_1_a_r_p_cache_entry.html">ARPCacheEntry</a> *entry)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b6">sendARPRequest</a> (<a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie, <a class="el" href="class_i_p_address.html">IPAddress</a> ipAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b7">requestTimedOut</a> (cMessage *selfmsg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b8">addressRecognized</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> destAddr, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b9">processARPPacket</a> (<a class="el" href="class_a_r_p_packet.html">ARPPacket</a> *arp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b10">updateARPCache</a> (<a class="el" href="struct_a_r_p_1_1_a_r_p_cache_entry.html">ARPCacheEntry</a> *entry, const <a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp;macAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b11">dumpARPPacket</a> (<a class="el" href="class_a_r_p_packet.html">ARPPacket</a> *arp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#b12">updateDisplayString</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p0">retryTimeout</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p1">retryCount</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p2">cacheTimeout</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p3">doProxyARP</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p4">numResolutions</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p5">numFailedResolutions</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p6">numRequestsSent</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p7">numRepliesSent</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_a_r_p.html#w0">ARPCache</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p8">arpCache</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cQueue&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p9">pendingQueue</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p10">ift</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_routing_table.html">RoutingTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_r_p.html#p11">rt</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_a_r_p_1_1_a_r_p_cache_entry.html">ARPCacheEntry</a></td></tr>

</table>
<hr><h2>Member Typedef Documentation</h2>
<a class="anchor" name="w0" doxytag="ARP::ARPCache"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::map&lt;<a class="el" href="class_i_p_address.html">IPAddress</a>, <a class="el" href="struct_a_r_p_1_1_a_r_p_cache_entry.html">ARPCacheEntry</a>*&gt; <a class="el" href="class_a_r_p.html#w0">ARP::ARPCache</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w1" doxytag="ARP::MsgPtrVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::vector&lt;cMessage*&gt; <a class="el" href="class_a_r_p.html#w1">ARP::MsgPtrVector</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="ARP::ARP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">ARP::ARP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00086 {}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ARP::~ARP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">ARP::~<a class="el" href="class_a_r_p.html">ARP</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00075 {
00076     <span class="keywordflow">while</span> (!<a class="code" href="class_a_r_p.html#p8">arpCache</a>.empty())
00077     {
00078         ARPCache::iterator i = <a class="code" href="class_a_r_p.html#p8">arpCache</a>.begin();
00079         <span class="keyword">delete</span> (*i).second;
00080         <a class="code" href="class_a_r_p.html#p8">arpCache</a>.erase(i);
00081     }
00082 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b8" doxytag="ARP::addressRecognized"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool ARP::addressRecognized           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>destAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00307 {
00308     <span class="keywordflow">if</span> (<a class="code" href="class_a_r_p.html#p11">rt</a>-&gt;<a class="code" href="class_routing_table.html#z42_0">localDeliver</a>(destAddr))
00309         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00310 
00311     <span class="comment">// respond to Proxy ARP request: if we can route this packet (and the</span>
00312     <span class="comment">// output port is different from this one), say yes</span>
00313     <span class="keywordflow">if</span> (!doProxyARP)
00314         return false;
00315     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *rtie = rt-&gt;interfaceForDestAddr(destAddr);
00316     return rtie!=NULL &amp;&amp; rtie!=ie;
00317 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b11" doxytag="ARP::dumpARPPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::dumpARPPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_a_r_p_packet.html">ARPPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>arp</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00320 {
00321     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; (arp-&gt;<a class="code" href="class_a_r_p_packet.html#a7">getOpcode</a>()==<a class="code" href="_a_r_p_packet__m_8h.html#a8a2">ARP_REQUEST</a> ? <span class="stringliteral">"ARP_REQ"</span> : arp-&gt;<a class="code" href="class_a_r_p_packet.html#a7">getOpcode</a>()==<a class="code" href="_a_r_p_packet__m_8h.html#a8a3">ARP_REPLY</a> ? <span class="stringliteral">"ARP_REPLY"</span> : <span class="stringliteral">"unknown type"</span>)
00322        &lt;&lt; <span class="stringliteral">"  src="</span> &lt;&lt; arp-&gt;<a class="code" href="class_a_r_p_packet.html#a15">getSrcIPAddress</a>() &lt;&lt; <span class="stringliteral">" / "</span> &lt;&lt; arp-&gt;<a class="code" href="class_a_r_p_packet.html#a9">getSrcMACAddress</a>()
00323        &lt;&lt; <span class="stringliteral">"  dest="</span> &lt;&lt; arp-&gt;<a class="code" href="class_a_r_p_packet.html#a18">getDestIPAddress</a>() &lt;&lt; <span class="stringliteral">" / "</span> &lt;&lt; arp-&gt;<a class="code" href="class_a_r_p_packet.html#a12">getDestMACAddress</a>() &lt;&lt; <span class="stringliteral">"\n"</span>;
00324 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="ARP::finish"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::finish           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00067 {
00068     recordScalar(<span class="stringliteral">"ARP requests sent"</span>, numRequestsSent);
00069     recordScalar(<span class="stringliteral">"ARP replies sent"</span>, numRepliesSent);
00070     recordScalar(<span class="stringliteral">"ARP resolutions"</span>, numResolutions);
00071     recordScalar(<span class="stringliteral">"failed ARP resolutions"</span>, numFailedResolutions);
00072 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="ARP::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00085 {
00086     <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
00087     {
00088         <a class="code" href="class_a_r_p.html#b7">requestTimedOut</a>(msg);
00089     }
00090     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;ARPPacket *&gt;(msg))
00091     {
00092         <a class="code" href="class_a_r_p_packet.html">ARPPacket</a> *arp = (<a class="code" href="class_a_r_p_packet.html">ARPPacket</a> *)msg;
00093         <a class="code" href="class_a_r_p.html#b9">processARPPacket</a>(arp);
00094     }
00095     <span class="keywordflow">else</span> <span class="comment">// not ARP</span>
00096     {
00097         <a class="code" href="class_a_r_p.html#b3">processOutboundPacket</a>(msg);
00098     }
00099     <span class="keywordflow">if</span> (ev.isGUI())
00100         <a class="code" href="class_a_r_p.html#b12">updateDisplayString</a>();
00101 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="ARP::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00044 {
00045     <a class="code" href="class_a_r_p.html#p10">ift</a> = <a class="code" href="class_interface_table_access.html">InterfaceTableAccess</a>().get();
00046     <a class="code" href="class_a_r_p.html#p11">rt</a> = <a class="code" href="class_routing_table_access.html">RoutingTableAccess</a>().get();
00047 
00048     <a class="code" href="class_a_r_p.html#p0">retryTimeout</a> = par(<span class="stringliteral">"retryTimeout"</span>);
00049     <a class="code" href="class_a_r_p.html#p1">retryCount</a> = par(<span class="stringliteral">"retryCount"</span>);
00050     <a class="code" href="class_a_r_p.html#p2">cacheTimeout</a> = par(<span class="stringliteral">"cacheTimeout"</span>);
00051     <a class="code" href="class_a_r_p.html#p3">doProxyARP</a> = par(<span class="stringliteral">"proxyARP"</span>);
00052 
00053     <a class="code" href="class_a_r_p.html#p9">pendingQueue</a>.setName(<span class="stringliteral">"pendingQueue"</span>);
00054 
00055     <span class="comment">// init statistics</span>
00056     <a class="code" href="class_a_r_p.html#p6">numRequestsSent</a> = <a class="code" href="class_a_r_p.html#p7">numRepliesSent</a> = 0;
00057     <a class="code" href="class_a_r_p.html#p4">numResolutions</a> = <a class="code" href="class_a_r_p.html#p5">numFailedResolutions</a> = 0;
00058     WATCH(numRequestsSent);
00059     WATCH(numRepliesSent);
00060     WATCH(numResolutions);
00061     WATCH(numFailedResolutions);
00062 
00063     WATCH_PTRMAP(arpCache);
00064 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="ARP::initiateARPResolution"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::initiateARPResolution           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_a_r_p_1_1_a_r_p_cache_entry.html">ARPCacheEntry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>entry</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00222 {
00223     <a class="code" href="class_i_p_address.html">IPAddress</a> nextHopAddr = entry-&gt;myIter-&gt;first;
00224     entry-&gt;pending = <span class="keyword">true</span>;
00225     entry-&gt;numRetries = 0;
00226     entry-&gt;lastUpdate = 0;
00227     <a class="code" href="class_a_r_p.html#b6">sendARPRequest</a>(entry-&gt;ie, nextHopAddr);
00228 
00229     <span class="comment">// start timer</span>
00230     cMessage *msg = entry-&gt;timer = <span class="keyword">new</span> cMessage(<span class="stringliteral">"ARP timeout"</span>);
00231     msg-&gt;setContextPointer(entry);
00232     scheduleAt(simTime()+retryTimeout, msg);
00233 
00234     <a class="code" href="class_a_r_p.html#p4">numResolutions</a>++;
00235 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="ARP::processARPPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::processARPPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_a_r_p_packet.html">ARPPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>arp</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00328 {
00329     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ARP packet "</span> &lt;&lt; arp &lt;&lt; <span class="stringliteral">" arrived:\n"</span>;
00330     <a class="code" href="class_a_r_p.html#b11">dumpARPPacket</a>(arp);
00331 
00332     <span class="comment">// extract input port</span>
00333     <a class="code" href="class_i_p_routing_decision.html">IPRoutingDecision</a> *controlInfo = check_and_cast&lt;IPRoutingDecision*&gt;(arp-&gt;removeControlInfo());
00334     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_a_r_p.html#p10">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(controlInfo-&gt;<a class="code" href="class_i_p_routing_decision.html#a6">interfaceId</a>());
00335     <span class="keyword">delete</span> controlInfo;
00336 
00337     <span class="comment">//</span>
00338     <span class="comment">// Recipe a'la RFC 826:</span>
00339     <span class="comment">//</span>
00340     <span class="comment">// ?Do I have the hardware type in ar$hrd?</span>
00341     <span class="comment">// Yes: (almost definitely)</span>
00342     <span class="comment">//   [optionally check the hardware length ar$hln]</span>
00343     <span class="comment">//   ?Do I speak the protocol in ar$pro?</span>
00344     <span class="comment">//   Yes:</span>
00345     <span class="comment">//     [optionally check the protocol length ar$pln]</span>
00346     <span class="comment">//     Merge_flag := false</span>
00347     <span class="comment">//     If the pair &lt;protocol type, sender protocol address&gt; is</span>
00348     <span class="comment">//         already in my translation table, update the sender</span>
00349     <span class="comment">//         hardware address field of the entry with the new</span>
00350     <span class="comment">//         information in the packet and set Merge_flag to true.</span>
00351     <span class="comment">//     ?Am I the target protocol address?</span>
00352     <span class="comment">//     Yes:</span>
00353     <span class="comment">//       If Merge_flag is false, add the triplet &lt;protocol type,</span>
00354     <span class="comment">//           sender protocol address, sender hardware address&gt; to</span>
00355     <span class="comment">//           the translation table.</span>
00356     <span class="comment">//       ?Is the opcode ares_op$REQUEST?  (NOW look at the opcode!!)</span>
00357     <span class="comment">//       Yes:</span>
00358     <span class="comment">//         Swap hardware and protocol fields, putting the local</span>
00359     <span class="comment">//             hardware and protocol addresses in the sender fields.</span>
00360     <span class="comment">//         Set the ar$op field to ares_op$REPLY</span>
00361     <span class="comment">//         Send the packet to the (new) target hardware address on</span>
00362     <span class="comment">//             the same hardware on which the request was received.</span>
00363     <span class="comment">//</span>
00364 
00365     <a class="code" href="class_m_a_c_address.html">MACAddress</a> srcMACAddress = arp-&gt;getSrcMACAddress();
00366     <a class="code" href="class_i_p_address.html">IPAddress</a> srcIPAddress = arp-&gt;getSrcIPAddress();
00367 
00368     <span class="keywordflow">if</span> (srcMACAddress.<a class="code" href="class_m_a_c_address.html#a13">isUnspecified</a>())
00369         error(<span class="stringliteral">"wrong ARP packet: source MAC address is empty"</span>);
00370     <span class="keywordflow">if</span> (srcIPAddress.<a class="code" href="class_i_p_address.html#a1">isUnspecified</a>())
00371         error(<span class="stringliteral">"wrong ARP packet: source IP address is empty"</span>);
00372 
00373     <span class="keywordtype">bool</span> mergeFlag = <span class="keyword">false</span>;
00374     <span class="comment">// "If ... sender protocol address is already in my translation table"</span>
00375     ARPCache::iterator it = <a class="code" href="class_a_r_p.html#p8">arpCache</a>.find(srcIPAddress);
00376     <span class="keywordflow">if</span> (it!=<a class="code" href="class_a_r_p.html#p8">arpCache</a>.end())
00377     {
00378         <span class="comment">// "update the sender hardware address field"</span>
00379         ARPCacheEntry *entry = (*it).second;
00380         <a class="code" href="class_a_r_p.html#b10">updateARPCache</a>(entry, srcMACAddress);
00381         mergeFlag = <span class="keyword">true</span>;
00382     }
00383 
00384     <span class="comment">// "?Am I the target protocol address?"</span>
00385     <span class="comment">// if Proxy ARP is enabled, we also have to reply if we're a router to the dest IP address</span>
00386     <span class="keywordflow">if</span> (<a class="code" href="class_a_r_p.html#b8">addressRecognized</a>(arp-&gt;getDestIPAddress(), ie))
00387     {
00388         <span class="comment">// "If Merge_flag is false, add the triplet protocol type, sender</span>
00389         <span class="comment">// protocol address, sender hardware address to the translation table"</span>
00390         <span class="keywordflow">if</span> (!mergeFlag)
00391         {
00392             ARPCacheEntry *entry;
00393             <span class="keywordflow">if</span> (it!=<a class="code" href="class_a_r_p.html#p8">arpCache</a>.end())
00394             {
00395                 entry = (*it).second;
00396             }
00397             <span class="keywordflow">else</span>
00398             {
00399                 entry = <span class="keyword">new</span> ARPCacheEntry();
00400                 ARPCache::iterator where = <a class="code" href="class_a_r_p.html#p8">arpCache</a>.insert(<a class="code" href="class_a_r_p.html#p8">arpCache</a>.begin(), std::make_pair(srcIPAddress,entry));
00401                 entry-&gt;myIter = where;
00402                 entry-&gt;ie = ie;
00403 
00404                 entry-&gt;pending = <span class="keyword">false</span>;
00405                 entry-&gt;timer = NULL;
00406                 entry-&gt;numRetries = 0;
00407             }
00408             <a class="code" href="class_a_r_p.html#b10">updateARPCache</a>(entry, srcMACAddress);
00409         }
00410 
00411         <span class="comment">// "?Is the opcode ares_op$REQUEST?  (NOW look at the opcode!!)"</span>
00412         <span class="keywordflow">switch</span> (arp-&gt;getOpcode())
00413         {
00414             <span class="keywordflow">case</span> <a class="code" href="_a_r_p_packet__m_8h.html#a8a2">ARP_REQUEST</a>:
00415             {
00416                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Packet was ARP REQUEST, sending REPLY\n"</span>;
00417 
00418                 <span class="comment">// find our own IP address and MAC address on the given interface</span>
00419                 <a class="code" href="class_m_a_c_address.html">MACAddress</a> myMACAddress = ie-&gt;<a class="code" href="class_interface_entry.html#a17">macAddress</a>();
00420                 <a class="code" href="class_i_p_address.html">IPAddress</a> myIPAddress = ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a4">inetAddress</a>();
00421 
00422                 <span class="comment">// "Swap hardware and protocol fields", etc.</span>
00423                 arp-&gt;setName(<span class="stringliteral">"arpREPLY"</span>);
00424                 <a class="code" href="class_i_p_address.html">IPAddress</a> origDestAddress = arp-&gt;getDestIPAddress();
00425                 arp-&gt;setDestIPAddress(srcIPAddress);
00426                 arp-&gt;setDestMACAddress(srcMACAddress);
00427                 arp-&gt;setSrcIPAddress(origDestAddress);
00428                 arp-&gt;setSrcMACAddress(myMACAddress);
00429                 arp-&gt;setOpcode(ARP_REPLY);
00430                 <span class="keyword">delete</span> arp-&gt;removeControlInfo();
00431                 <a class="code" href="class_a_r_p.html#b4">sendPacketToNIC</a>(arp, ie, srcMACAddress);
00432                 <a class="code" href="class_a_r_p.html#p7">numRepliesSent</a>++;
00433                 <span class="keywordflow">break</span>;
00434             }
00435             <span class="keywordflow">case</span> <a class="code" href="_a_r_p_packet__m_8h.html#a8a3">ARP_REPLY</a>:
00436             {
00437                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Discarding packet\n"</span>;
00438                 <span class="keyword">delete</span> arp;
00439                 <span class="keywordflow">break</span>;
00440             }
00441             <span class="keywordflow">case</span> <a class="code" href="_a_r_p_packet__m_8h.html#a8a4">ARP_RARP_REQUEST</a>: error(<span class="stringliteral">"RARP request received: RARP is not supported"</span>);
00442             <span class="keywordflow">case</span> <a class="code" href="_a_r_p_packet__m_8h.html#a8a5">ARP_RARP_REPLY</a>: error(<span class="stringliteral">"RARP reply received: RARP is not supported"</span>);
00443             <span class="keywordflow">default</span>: error(<span class="stringliteral">"Unsupported opcode %d in received ARP packet"</span>,arp-&gt;getOpcode());
00444         }
00445     }
00446     <span class="keywordflow">else</span>
00447     {
00448         <span class="comment">// address not recognized</span>
00449         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"IP address "</span> &lt;&lt; arp-&gt;getDestIPAddress() &lt;&lt; <span class="stringliteral">" not recognized, dropping ARP packet\n"</span>;
00450         <span class="keyword">delete</span> arp;
00451     }
00452 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="ARP::processOutboundPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::processOutboundPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00112 {
00113     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Packet "</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">" arrived from higher layer, "</span>;
00114 
00115     <span class="comment">// get next hop address from control info in packet</span>
00116     <a class="code" href="class_i_p_routing_decision.html">IPRoutingDecision</a> *controlInfo = check_and_cast&lt;IPRoutingDecision*&gt;(msg-&gt;removeControlInfo());
00117     <a class="code" href="class_i_p_address.html">IPAddress</a> nextHopAddr = controlInfo-&gt;<a class="code" href="class_i_p_routing_decision.html#a8">nextHopAddr</a>();
00118     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_a_r_p.html#p10">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(controlInfo-&gt;<a class="code" href="class_i_p_routing_decision.html#a6">interfaceId</a>());
00119     <span class="keyword">delete</span> controlInfo;
00120 
00121     <span class="comment">// if output interface is not broadcast, don't bother with ARP</span>
00122     <span class="keywordflow">if</span> (!ie-&gt;<a class="code" href="class_interface_entry.html#a12">isBroadcast</a>())
00123     {
00124         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"output interface "</span> &lt;&lt; ie-&gt;<a class="code" href="class_interface_entry.html#a5">name</a>() &lt;&lt; <span class="stringliteral">" is not broadcast, skipping ARP\n"</span>;
00125         send(msg, <span class="stringliteral">"nicOut"</span>, ie-&gt;<a class="code" href="class_interface_entry.html#a6">networkLayerGateIndex</a>());
00126         <span class="keywordflow">return</span>;
00127     }
00128 
00129     <span class="comment">// determine what address to look up in ARP cache</span>
00130     <span class="keywordflow">if</span> (!nextHopAddr.<a class="code" href="class_i_p_address.html#a1">isUnspecified</a>())
00131     {
00132         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"using next-hop address "</span> &lt;&lt; nextHopAddr &lt;&lt; <span class="stringliteral">"\n"</span>;
00133     }
00134     <span class="keywordflow">else</span>
00135     {
00136         <span class="comment">// try proxy ARP</span>
00137         <a class="code" href="class_i_p_datagram.html">IPDatagram</a> *datagram = check_and_cast&lt;IPDatagram *&gt;(msg);
00138         nextHopAddr = datagram-&gt;<a class="code" href="class_i_p_datagram.html#a14">destAddress</a>();
00139         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"no next-hop address, using destination address "</span> &lt;&lt; nextHopAddr &lt;&lt; <span class="stringliteral">" (proxy ARP)\n"</span>;
00140     }
00141 
00142     <span class="comment">//</span>
00143     <span class="comment">// Handle multicast IP addresses. RFC 1112, section 6.4 says:</span>
00144     <span class="comment">// "An IP host group address is mapped to an Ethernet multicast address</span>
00145     <span class="comment">// by placing the low-order 23 bits of the IP address into the low-order</span>
00146     <span class="comment">// 23 bits of the Ethernet multicast address 01-00-5E-00-00-00 (hex).</span>
00147     <span class="comment">// Because there are 28 significant bits in an IP host group address,</span>
00148     <span class="comment">// more than one host group address may map to the same Ethernet multicast</span>
00149     <span class="comment">// address."</span>
00150     <span class="comment">//</span>
00151     <span class="keywordflow">if</span> (nextHopAddr.<a class="code" href="class_i_p_address.html#a8">isMulticast</a>())
00152     {
00153         <span class="comment">// FIXME: we do a simpler solution right now: send to the Broadcast MAC address</span>
00154         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"destination address is multicast, sending packet to broadcast MAC address\n"</span>;
00155         <span class="keyword">static</span> <a class="code" href="class_m_a_c_address.html">MACAddress</a> broadcastAddr(<span class="stringliteral">"FF:FF:FF:FF:FF:FF"</span>);
00156         <a class="code" href="class_a_r_p.html#b4">sendPacketToNIC</a>(msg, ie, broadcastAddr);
00157         <span class="keywordflow">return</span>;
00158 <span class="preprocessor">#if 0</span>
00159 <span class="preprocessor"></span>        <span class="comment">// experimental RFC 1112 code</span>
00160         <span class="comment">// TBD needs counterpart to be implemented in EtherMAC processReceivedDataFrame().</span>
00161         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> macBytes[6];
00162         macBytes[0] = 0x01;
00163         macBytes[1] = 0x00;
00164         macBytes[2] = 0x5e;
00165         macBytes[3] = nextHopAddr.<a class="code" href="class_i_p_address.html#a6">getDByte</a>(1) &amp; 0x7f;
00166         macBytes[4] = nextHopAddr.<a class="code" href="class_i_p_address.html#a6">getDByte</a>(2);
00167         macBytes[5] = nextHopAddr.<a class="code" href="class_i_p_address.html#a6">getDByte</a>(3);
00168         <a class="code" href="class_m_a_c_address.html">MACAddress</a> multicastMacAddr;
00169         multicastMacAddr.<a class="code" href="class_m_a_c_address.html#a9">setAddressBytes</a>(bytes);
00170         <a class="code" href="class_a_r_p.html#b4">sendPacketToNIC</a>(msg, ie, multicastMacAddr);
00171         <span class="keywordflow">return</span>;
00172 <span class="preprocessor">#endif</span>
00173 <span class="preprocessor"></span>    }
00174 
00175     <span class="comment">// try look up</span>
00176     ARPCache::iterator it = <a class="code" href="class_a_r_p.html#p8">arpCache</a>.find(nextHopAddr);
00177     <span class="comment">//ASSERT(it==arpCache.end() || ie==(*it).second-&gt;ie); // verify: if arpCache gets keyed on InterfaceEntry* too, this becomes unnecessary</span>
00178     <span class="keywordflow">if</span> (it==<a class="code" href="class_a_r_p.html#p8">arpCache</a>.end())
00179     {
00180         <span class="comment">// no cache entry: launch ARP request</span>
00181         ARPCacheEntry *entry = <span class="keyword">new</span> ARPCacheEntry();
00182         ARPCache::iterator where = <a class="code" href="class_a_r_p.html#p8">arpCache</a>.insert(<a class="code" href="class_a_r_p.html#p8">arpCache</a>.begin(), std::make_pair(nextHopAddr,entry));
00183         entry-&gt;myIter = where; <span class="comment">// note: "inserting a new element into a map does not invalidate iterators that point to existing elements"</span>
00184         entry-&gt;ie = ie;
00185 
00186         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Starting ARP resolution for "</span> &lt;&lt; nextHopAddr &lt;&lt; <span class="stringliteral">"\n"</span>;
00187         <a class="code" href="class_a_r_p.html#b5">initiateARPResolution</a>(entry);
00188 
00189         <span class="comment">// and queue up packet</span>
00190         entry-&gt;pendingPackets.push_back(msg);
00191         <a class="code" href="class_a_r_p.html#p9">pendingQueue</a>.insert(msg);
00192     }
00193     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*it).second-&gt;pending)
00194     {
00195         <span class="comment">// an ARP request is already pending for this address -- just queue up packet</span>
00196         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ARP resolution for "</span> &lt;&lt; nextHopAddr &lt;&lt; <span class="stringliteral">" is pending, queueing up packet\n"</span>;
00197         (*it).second-&gt;pendingPackets.push_back(msg);
00198         <a class="code" href="class_a_r_p.html#p9">pendingQueue</a>.insert(msg);
00199     }
00200     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*it).second-&gt;lastUpdate+cacheTimeout&lt;simTime())
00201     {
00202         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ARP cache entry for "</span> &lt;&lt; nextHopAddr &lt;&lt; <span class="stringliteral">" expired, starting new ARP resolution\n"</span>;
00203 
00204         <span class="comment">// cache entry stale, send new ARP request</span>
00205         ARPCacheEntry *entry = (*it).second;
00206         entry-&gt;ie = ie; <span class="comment">// routing table may have changed</span>
00207         <a class="code" href="class_a_r_p.html#b5">initiateARPResolution</a>(entry);
00208 
00209         <span class="comment">// and queue up packet</span>
00210         entry-&gt;pendingPackets.push_back(msg);
00211         <a class="code" href="class_a_r_p.html#p9">pendingQueue</a>.insert(msg);
00212     }
00213     <span class="keywordflow">else</span>
00214     {
00215         <span class="comment">// valid ARP cache entry found, flag msg with MAC address and send it out</span>
00216         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ARP cache hit, MAC address for "</span> &lt;&lt; nextHopAddr &lt;&lt; <span class="stringliteral">" is "</span> &lt;&lt; (*it).second-&gt;macAddress &lt;&lt; <span class="stringliteral">", sending packet down\n"</span>;
00217         <a class="code" href="class_a_r_p.html#b4">sendPacketToNIC</a>(msg, ie, (*it).second-&gt;<a class="code" href="class_interface_entry.html#a17">macAddress</a>);
00218     }
00219 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="ARP::requestTimedOut"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::requestTimedOut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>selfmsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00272 {
00273     ARPCacheEntry *entry = (ARPCacheEntry *)selfmsg-&gt;contextPointer();
00274     entry-&gt;numRetries++;
00275     <span class="keywordflow">if</span> (entry-&gt;numRetries &lt; retryCount)
00276     {
00277         <span class="comment">// retry</span>
00278         <a class="code" href="class_i_p_address.html">IPAddress</a> nextHopAddr = entry-&gt;myIter-&gt;first;
00279         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ARP request for "</span> &lt;&lt; nextHopAddr &lt;&lt; <span class="stringliteral">" timed out, resending\n"</span>;
00280         <a class="code" href="class_a_r_p.html#b6">sendARPRequest</a>(entry-&gt;ie, nextHopAddr);
00281         scheduleAt(simTime()+retryTimeout, selfmsg);
00282         <span class="keywordflow">return</span>;
00283     }
00284 
00285     <span class="comment">// max retry count reached: ARP failure.</span>
00286     <span class="comment">// throw out entry from cache, delete pending messages</span>
00287     <a class="code" href="class_a_r_p.html#w1">MsgPtrVector</a>&amp; pendingPackets = entry-&gt;pendingPackets;
00288     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ARP timeout, max retry count "</span> &lt;&lt; <a class="code" href="class_a_r_p.html#p1">retryCount</a> &lt;&lt; <span class="stringliteral">" for "</span>
00289        &lt;&lt; entry-&gt;myIter-&gt;first &lt;&lt; <span class="stringliteral">" reached. Dropping "</span> &lt;&lt; pendingPackets.size()
00290        &lt;&lt; <span class="stringliteral">" waiting packets from the queue\n"</span>;
00291     <span class="keywordflow">while</span> (!pendingPackets.empty())
00292     {
00293         MsgPtrVector::iterator i = pendingPackets.begin();
00294         cMessage *msg = (*i);
00295         pendingPackets.erase(i);
00296         <a class="code" href="class_a_r_p.html#p9">pendingQueue</a>.remove(msg);
00297         <span class="keyword">delete</span> msg;
00298     }
00299     <span class="keyword">delete</span> selfmsg;
00300     <a class="code" href="class_a_r_p.html#p8">arpCache</a>.erase(entry-&gt;myIter);
00301     <span class="keyword">delete</span> entry;
00302     <a class="code" href="class_a_r_p.html#p5">numFailedResolutions</a>++;
00303 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="ARP::sendARPRequest"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::sendARPRequest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ipAddress</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00249 {
00250     <span class="comment">// find our own IP address and MAC address on the given interface</span>
00251     <a class="code" href="class_m_a_c_address.html">MACAddress</a> myMACAddress = ie-&gt;<a class="code" href="class_interface_entry.html#a17">macAddress</a>();
00252     <a class="code" href="class_i_p_address.html">IPAddress</a> myIPAddress = ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a4">inetAddress</a>();
00253 
00254     <span class="comment">// both must be set</span>
00255     ASSERT(!myMACAddress.<a class="code" href="class_m_a_c_address.html#a13">isUnspecified</a>());
00256     ASSERT(!myIPAddress.<a class="code" href="class_i_p_address.html#a1">isUnspecified</a>());
00257 
00258     <span class="comment">// fill out everything in ARP Request packet except dest MAC address</span>
00259     <a class="code" href="class_a_r_p_packet.html">ARPPacket</a> *arp = <span class="keyword">new</span> <a class="code" href="class_a_r_p_packet.html">ARPPacket</a>(<span class="stringliteral">"arpREQ"</span>);
00260     arp-&gt;setByteLength(ARP_HEADER_BYTES);
00261     arp-&gt;<a class="code" href="class_a_r_p_packet.html#a8">setOpcode</a>(ARP_REQUEST);
00262     arp-&gt;<a class="code" href="class_a_r_p_packet.html#a11">setSrcMACAddress</a>(myMACAddress);
00263     arp-&gt;<a class="code" href="class_a_r_p_packet.html#a17">setSrcIPAddress</a>(myIPAddress);
00264     arp-&gt;<a class="code" href="class_a_r_p_packet.html#a20">setDestIPAddress</a>(ipAddress);
00265 
00266     <span class="keyword">static</span> <a class="code" href="class_m_a_c_address.html">MACAddress</a> broadcastAddress(<span class="stringliteral">"ff:ff:ff:ff:ff:ff"</span>);
00267     <a class="code" href="class_a_r_p.html#b4">sendPacketToNIC</a>(arp, ie, broadcastAddress);
00268     <a class="code" href="class_a_r_p.html#p6">numRequestsSent</a>++;
00269 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="ARP::sendPacketToNIC"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::sendPacketToNIC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>macAddress</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00238 {
00239     <span class="comment">// add control info with MAC address</span>
00240     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a>();
00241     controlInfo-&gt;<a class="code" href="class_ieee802_ctrl.html#a11">setDest</a>(macAddress);
00242     msg-&gt;setControlInfo(controlInfo);
00243 
00244     <span class="comment">// send out</span>
00245     send(msg, <span class="stringliteral">"nicOut"</span>, ie-&gt;<a class="code" href="class_interface_entry.html#a6">networkLayerGateIndex</a>());
00246 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b10" doxytag="ARP::updateARPCache"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::updateARPCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_a_r_p_1_1_a_r_p_cache_entry.html">ARPCacheEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>entry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>macAddress</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00455 {
00456     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Updating ARP cache entry: "</span> &lt;&lt; entry-&gt;myIter-&gt;first &lt;&lt; <span class="stringliteral">" &lt;--&gt; "</span> &lt;&lt; macAddress &lt;&lt; <span class="stringliteral">"\n"</span>;
00457 
00458     <span class="comment">// update entry</span>
00459     <span class="keywordflow">if</span> (entry-&gt;pending)
00460     {
00461         entry-&gt;pending = <span class="keyword">false</span>;
00462         <span class="keyword">delete</span> cancelEvent(entry-&gt;timer);
00463         entry-&gt;timer = NULL;
00464         entry-&gt;numRetries = 0;
00465     }
00466     entry-&gt;macAddress = macAddress;
00467     entry-&gt;lastUpdate = simTime();
00468 
00469     <span class="comment">// process queued packets</span>
00470     <a class="code" href="class_a_r_p.html#w1">MsgPtrVector</a>&amp; pendingPackets = entry-&gt;pendingPackets;
00471     <span class="keywordflow">while</span> (!pendingPackets.empty())
00472     {
00473         MsgPtrVector::iterator i = pendingPackets.begin();
00474         cMessage *msg = (*i);
00475         pendingPackets.erase(i);
00476         <a class="code" href="class_a_r_p.html#p9">pendingQueue</a>.remove(msg);
00477         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending out queued packet "</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">"\n"</span>;
00478         <a class="code" href="class_a_r_p.html#b4">sendPacketToNIC</a>(msg, entry-&gt;ie, macAddress);
00479     }
00480 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b12" doxytag="ARP::updateDisplayString"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ARP::updateDisplayString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00104 {
00105     <span class="keywordtype">char</span> buf[80];
00106     sprintf(buf, <span class="stringliteral">"%d cache entries\nsent req:%ld repl:%ld fail:%ld"</span>,
00107                  <a class="code" href="class_a_r_p.html#p8">arpCache</a>.size(), <a class="code" href="class_a_r_p.html#p6">numRequestsSent</a>, <a class="code" href="class_a_r_p.html#p7">numRepliesSent</a>, <a class="code" href="class_a_r_p.html#p5">numFailedResolutions</a>);
00108     displayString().setTagArg(<span class="stringliteral">"t"</span>,0,buf);
00109 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p8" doxytag="ARP::arpCache"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_a_r_p.html#w0">ARPCache</a> <a class="el" href="class_a_r_p.html#p8">ARP::arpCache</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="ARP::cacheTimeout"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_a_r_p.html#p2">ARP::cacheTimeout</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="ARP::doProxyARP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool <a class="el" href="class_a_r_p.html#p3">ARP::doProxyARP</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p10" doxytag="ARP::ift"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a>* <a class="el" href="class_a_r_p.html#p10">ARP::ift</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="ARP::numFailedResolutions"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_a_r_p.html#p5">ARP::numFailedResolutions</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p7" doxytag="ARP::numRepliesSent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_a_r_p.html#p7">ARP::numRepliesSent</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p6" doxytag="ARP::numRequestsSent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_a_r_p.html#p6">ARP::numRequestsSent</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="ARP::numResolutions"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_a_r_p.html#p4">ARP::numResolutions</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p9" doxytag="ARP::pendingQueue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cQueue <a class="el" href="class_a_r_p.html#p9">ARP::pendingQueue</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="ARP::retryCount"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_a_r_p.html#p1">ARP::retryCount</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="ARP::retryTimeout"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_a_r_p.html#p0">ARP::retryTimeout</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p11" doxytag="ARP::rt"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_routing_table.html">RoutingTable</a>* <a class="el" href="class_a_r_p.html#p11">ARP::rt</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_a_r_p_8h.html">ARP.h</a><li><a class="el" href="_a_r_p_8cc.html">ARP.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:21 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
