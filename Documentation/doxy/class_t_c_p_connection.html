<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: TCPConnection Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TCPConnection Class Reference</h1><code>#include &lt;TCPConnection.h&gt;</code>
<p>
<a href="class_t_c_p_connection-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Manages a <a class="el" href="class_t_c_p.html">TCP</a> connection. This class itself implements the <a class="el" href="class_t_c_p.html">TCP</a> state machine as well as handling control PDUs (SYN, SYN+ACK, RST, FIN, etc.), timers (2MSL, CONN-ESTAB, FIN-WAIT-2) and events (OPEN, SEND, etc) associated with <a class="el" href="class_t_c_p.html">TCP</a> state changes.<p>
The implementation largely follows the functional specification at the end of RFC 793. Code comments extensively quote RFC 793 to make it easier to understand.<p>
TCPConnection objects are not used alone -- they are instantiated and managed by a <a class="el" href="class_t_c_p.html">TCP</a> module.<p>
TCPConnection "outsources" several tasks to objects subclassed from <a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a>, <a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> and <a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a>; see overview of this with <a class="el" href="class_t_c_p.html">TCP</a> documentation.<p>
Connection variables (TCB) are kept in <a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a>. <a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> implementations can extend <a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a> to add their own stuff (see <a class="el" href="class_t_c_p_algorithm.html#b0">TCPAlgorithm::createStateVariables()</a> factory method.)<p>
The "entry points" of TCPConnnection from <a class="el" href="class_t_c_p.html">TCP</a> are:<ul>
<li><a class="el" href="class_t_c_p_connection.html#a15">processTimer(cMessage *msg)</a>: handle self-messages which belong to the connection</li><li><a class="el" href="class_t_c_p_connection.html#a16">processTCPSegment(TCPSegment *tcpSeg, IPvXAddress srcAddr, IPvXAddress destAddr)</a>: handle segment arrivals</li><li><a class="el" href="class_t_c_p_connection.html#a17">processAppCommand(cMessage *msg)</a>: process commands which arrive from the application (TCP_C_xxx)</li></ul>
<p>
All three methods follow a common structure:<p>
<ol type=1>
<li>dispatch to specific methods. For example, <a class="el" href="class_t_c_p_connection.html#a17">processAppCommand()</a> invokes one of <a class="el" href="class_t_c_p_connection.html#z148_0">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#z148_1">process_OPEN_PASSIVE()</a> or <a class="el" href="class_t_c_p_connection.html#z148_2">process_SEND()</a>, etc., and <a class="el" href="class_t_c_p_connection.html#a16">processTCPSegment()</a> dispatches to <a class="el" href="class_t_c_p_connection.html#z150_2">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#z150_3">processSegmentInSynSent()</a> or <a class="el" href="class_t_c_p_connection.html#z150_4">processSegment1stThru8th()</a>. Those methods will do the REAL JOB.</li><li>after they return, we'll know the state machine event (TCPEventCode, TCP_E_xxx) for sure, so we can:</li><li>invoke <a class="el" href="class_t_c_p_connection.html#z146_1">performStateTransition()</a> which executes the necessary state transition (for example, TCP_E_RCV_SYN will take the state machine from TCP_S_LISTEN to TCP_S_SYN_RCVD). No other actions are taken in this step.</li><li>if there was a state change (for example, we entered the TCP_S_ESTABLISHED state), <a class="el" href="class_t_c_p_connection.html#z146_1">performStateTransition()</a> invokes <a class="el" href="class_t_c_p_connection.html#z146_2">stateEntered()</a>, which performs some necessary housekeeping (cancel the CONN-ESTAB timer).</li></ol>
<p>
When the CLOSED state is reached, <a class="el" href="class_t_c_p.html">TCP</a> will delete the TCPConnection object. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a0">sendAck</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1">sendData</a> (bool fullSegmentsOnly, int congestionWindow=-1)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a2">sendProbe</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a3">retransmitOneSegment</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a4">retransmitData</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a5">sendRst</a> (<a class="el" href="_i_n_e_t_defs_8h.html#a6">uint32</a> seqNo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6">sendFin</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7">sendSegment</a> (int bytes)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a8">sendToIP</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a9">startSynRexmitTimer</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a10">signalConnectionTimeout</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a11">scheduleTimeout</a> (cMessage *msg, simtime_t timeout)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a12">printConnBrief</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a13">TCPConnection</a> (<a class="el" href="class_t_c_p.html">TCP</a> *mod, int <a class="el" href="class_t_c_p_connection.html#o0">appGateIndex</a>, int <a class="el" href="class_t_c_p_connection.html#o1">connId</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a14">~TCPConnection</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a15">processTimer</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a16">processTCPSegment</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpSeg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> srcAddr, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> destAddr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a17">processAppCommand</a> (cMessage *msg)</td></tr>

<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z153_0">getFsmState</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z153_1">getState</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z153_2">getSendQueue</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z153_3">getReceiveQueue</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z153_4">getTcpAlgorithm</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p.html">TCP</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z153_5">getTcpMain</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#e0">sendRst</a> (<a class="el" href="_i_n_e_t_defs_8h.html#a6">uint32</a> seq, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest, int srcPort, int destPort)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#e1">sendRstAck</a> (<a class="el" href="_i_n_e_t_defs_8h.html#a6">uint32</a> seq, <a class="el" href="_i_n_e_t_defs_8h.html#a6">uint32</a> ack, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest, int srcPort, int destPort)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#e2">printSegmentBrief</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#e3">stateName</a> (int <a class="el" href="class_t_c_p_connection.html#p2">state</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#e4">eventName</a> (int event)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#e5">indicationName</a> (int code)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#e6">segmentArrivalWhileClosed</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>

<tr><td colspan="2"><br><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#o0">appGateIndex</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#o1">connId</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#o2">localAddr</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#o3">remoteAddr</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#o4">localPort</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#o5">remotePort</a></td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_connection.html">TCPConnection</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b0">cloneListeningConnection</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b1">initConnection</a> (<a class="el" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *openCmd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b2">configureStateVariables</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b3">selectInitialSeqNum</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b4">isSegmentAcceptable</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b5">sendSyn</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b6">sendSynAck</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b7">cancelEvent</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b8">sendToApp</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a> (int code)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#b10">sendEstabIndicationToApp</a> ()</td></tr>

<tr><td colspan="2"><div class="groupHeader">FSM transitions: analysing events and executing state transitions</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z146_0">preanalyseAppCommandEvent</a> (int commandCode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z146_1">performStateTransition</a> (const <a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;event)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z146_2">stateEntered</a> (int <a class="el" href="class_t_c_p_connection.html#p2">state</a>)</td></tr>

<tr><td colspan="2"><div class="groupHeader">Processing app commands. Invoked from processAppCommand().</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z148_0">process_OPEN_ACTIVE</a> (<a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z148_1">process_OPEN_PASSIVE</a> (<a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z148_2">process_SEND</a> (<a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z148_3">process_CLOSE</a> (<a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z148_4">process_ABORT</a> (<a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z148_5">process_STATUS</a> (<a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;event, <a class="el" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand, cMessage *msg)</td></tr>

<tr><td colspan="2"><div class="groupHeader">Processing TCP segment arrivals. Invoked from processTCPSegment().</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z150_0">tryFastRoute</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z150_1">process_RCV_SEGMENT</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z150_2">processSegmentInListen</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z150_3">processSegmentInSynSent</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z150_4">processSegment1stThru8th</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z150_5">processRstInSynReceived</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z150_6">processAckInEstabEtc</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>

<tr><td colspan="2"><div class="groupHeader">Processing timeouts. Invoked from processTimer().</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z152_0">process_TIMEOUT_2MSL</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z152_1">process_TIMEOUT_CONN_ESTAB</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z152_2">process_TIMEOUT_FIN_WAIT_2</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#z152_3">process_TIMEOUT_SYN_REXMIT</a> (<a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;event)</td></tr>

<tr><td colspan="2"><br><h2>Static Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#f0">sendToIP</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p.html">TCP</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p0">tcpMain</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cFSM&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p1">fsm</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p2">state</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p3">sendQueue</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p4">receiveQueue</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p6">the2MSLTimer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p7">connEstabTimer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p8">finWait2Timer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p9">synRexmitTimer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p10">sndWndVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p11">sndNxtVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p12">sndAckVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p13">rcvSeqVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p14">rcvAckVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#p15">unackedVector</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a13" doxytag="TCPConnection::TCPConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">TCPConnection::TCPConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p.html">TCP</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>mod</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>appGateIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>connId</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Constructor. <div class="fragment"><pre class="fragment">00102 {
00103     <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a> = _mod;
00104     <a class="code" href="class_t_c_p_connection.html#o0">appGateIndex</a> = _appGateIndex;
00105     <a class="code" href="class_t_c_p_connection.html#o1">connId</a> = _connId;
00106 
00107     <a class="code" href="class_t_c_p_connection.html#o4">localPort</a> = <a class="code" href="class_t_c_p_connection.html#o5">remotePort</a> = -1;
00108 
00109     <span class="keywordtype">char</span> fsmname[24];
00110     sprintf(fsmname, <span class="stringliteral">"fsm-%d"</span>, connId);
00111     <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.setName(fsmname);
00112     <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.setState(TCP_S_INIT);
00113 
00114 
00115     <span class="comment">// queues and algorithm will be created on active or passive open</span>
00116     <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a> = NULL;
00117     <a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a> = NULL;
00118     <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a> = NULL;
00119     <a class="code" href="class_t_c_p_connection.html#p2">state</a> = NULL;
00120 
00121     <a class="code" href="class_t_c_p_connection.html#p6">the2MSLTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">"2MSL"</span>);
00122     <a class="code" href="class_t_c_p_connection.html#p7">connEstabTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">"CONN-ESTAB"</span>);
00123     <a class="code" href="class_t_c_p_connection.html#p8">finWait2Timer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">"FIN-WAIT-2"</span>);
00124     <a class="code" href="class_t_c_p_connection.html#p9">synRexmitTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">"SYN-REXMIT"</span>);
00125 
00126     <a class="code" href="class_t_c_p_connection.html#p6">the2MSLTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
00127     <a class="code" href="class_t_c_p_connection.html#p7">connEstabTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
00128     <a class="code" href="class_t_c_p_connection.html#p8">finWait2Timer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
00129     <a class="code" href="class_t_c_p_connection.html#p9">synRexmitTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
00130 
00131     <span class="comment">// statistics</span>
00132     <a class="code" href="class_t_c_p_connection.html#p10">sndWndVector</a> = NULL;
00133     <a class="code" href="class_t_c_p_connection.html#p11">sndNxtVector</a> = NULL;
00134     <a class="code" href="class_t_c_p_connection.html#p12">sndAckVector</a> = NULL;
00135     <a class="code" href="class_t_c_p_connection.html#p13">rcvSeqVector</a> = NULL;
00136     <a class="code" href="class_t_c_p_connection.html#p14">rcvAckVector</a> = NULL;
00137     <a class="code" href="class_t_c_p_connection.html#p15">unackedVector</a> = NULL;
00138 
00139     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#z153_5">getTcpMain</a>()-&gt;recordStatistics)
00140     {
00141         <a class="code" href="class_t_c_p_connection.html#p10">sndWndVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">"send window"</span>);
00142         <a class="code" href="class_t_c_p_connection.html#p11">sndNxtVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">"send seq"</span>);
00143         <a class="code" href="class_t_c_p_connection.html#p12">sndAckVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">"sent ack"</span>);
00144         <a class="code" href="class_t_c_p_connection.html#p13">rcvSeqVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">"rcvd seq"</span>);
00145         <a class="code" href="class_t_c_p_connection.html#p14">rcvAckVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">"rcvd ack"</span>);
00146         <a class="code" href="class_t_c_p_connection.html#p15">unackedVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">"unacked bytes"</span>);
00147     }
00148 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="TCPConnection::~TCPConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">TCPConnection::~<a class="el" href="class_t_c_p_connection.html">TCPConnection</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Destructor. <div class="fragment"><pre class="fragment">00151 {
00152     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>;
00153     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a>;
00154     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>;
00155     <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#p2">state</a>;
00156 
00157     <span class="keywordflow">if</span> (the2MSLTimer)   delete cancelEvent(the2MSLTimer);
00158     if (connEstabTimer) delete cancelEvent(connEstabTimer);
00159     if (finWait2Timer)  delete cancelEvent(finWait2Timer);
00160     if (synRexmitTimer) delete cancelEvent(synRexmitTimer);
00161 
00162     <span class="comment">// statistics</span>
00163     delete sndWndVector;
00164     delete sndNxtVector;
00165     delete sndAckVector;
00166     delete rcvSeqVector;
00167     delete rcvAckVector;
00168     delete unackedVector;
00169 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b7" doxytag="TCPConnection::cancelEvent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage* TCPConnection::cancelEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: cancel a timer <div class="fragment"><pre class="fragment">00412 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;cancelEvent(msg);}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="TCPConnection::cloneListeningConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_connection.html">TCPConnection</a> * TCPConnection::cloneListeningConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: clone a listening connection. Used for forking. <div class="fragment"><pre class="fragment">00138 {
00139     <a class="code" href="class_t_c_p_connection.html">TCPConnection</a> *conn = <span class="keyword">new</span> <a class="code" href="class_t_c_p_connection.html#a13">TCPConnection</a>(tcpMain,appGateIndex,connId);
00140 
00141     <span class="comment">// following code to be kept consistent with initConnection()</span>
00142     <span class="keyword">const</span> <span class="keywordtype">char</span> *sendQueueClass = <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;className();
00143     conn-&gt;<a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a> = check_and_cast&lt;TCPSendQueue *&gt;(createOne(sendQueueClass));
00144 
00145     <span class="keyword">const</span> <span class="keywordtype">char</span> *receiveQueueClass = <a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a>-&gt;className();
00146     conn-&gt;<a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a> = check_and_cast&lt;TCPReceiveQueue *&gt;(createOne(receiveQueueClass));
00147 
00148     <span class="keyword">const</span> <span class="keywordtype">char</span> *tcpAlgorithmClass = <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;className();
00149     conn-&gt;<a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a> = check_and_cast&lt;TCPAlgorithm *&gt;(createOne(tcpAlgorithmClass));
00150     conn-&gt;<a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a2">setConnection</a>(conn);
00151 
00152     conn-&gt;<a class="code" href="class_t_c_p_connection.html#p2">state</a> = conn-&gt;<a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a3">stateVariables</a>();
00153     <a class="code" href="class_t_c_p_connection.html#b2">configureStateVariables</a>();
00154     conn-&gt;<a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a4">initialize</a>();
00155 
00156     <span class="comment">// put it into LISTEN, with our localAddr/localPort</span>
00157     conn-&gt;<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o0">active</a> = <span class="keyword">false</span>;
00158     conn-&gt;<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o1">fork</a> = <span class="keyword">true</span>;
00159     conn-&gt;<a class="code" href="class_t_c_p_connection.html#o2">localAddr</a> = <a class="code" href="class_t_c_p_connection.html#o2">localAddr</a>;
00160     conn-&gt;<a class="code" href="class_t_c_p_connection.html#o4">localPort</a> = <a class="code" href="class_t_c_p_connection.html#o4">localPort</a>;
00161     FSM_Goto(conn-&gt;<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>, TCP_S_LISTEN);
00162 
00163     <span class="keywordflow">return</span> conn;
00164 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="TCPConnection::configureStateVariables"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::configureStateVariables           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: set snd_mss and rcv_wnd in newly created state variables block <div class="fragment"><pre class="fragment">00302 {
00303     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o2">snd_mss</a> = <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;par(<span class="stringliteral">"mss"</span>).longValue(); <span class="comment">// TODO: mss=-1 should mean autodetect</span>
00304     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o12">rcv_wnd</a> = <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;par(<span class="stringliteral">"advertisedWindow"</span>).longValue();
00305 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e4" doxytag="TCPConnection::eventName"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char * TCPConnection::eventName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: returns name of TCP_E_xxx constants <div class="fragment"><pre class="fragment">00060 {
00061 <span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
00062 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">"unknown"</span>;
00063     <span class="keywordflow">switch</span> (event)
00064     {
00065         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_IGNORE);
00066         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_OPEN_ACTIVE);
00067         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_OPEN_PASSIVE);
00068         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_SEND);
00069         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_CLOSE);
00070         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_ABORT);
00071         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_STATUS);
00072         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_RCV_DATA);
00073         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_RCV_ACK);
00074         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_RCV_SYN);
00075         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_RCV_SYN_ACK);
00076         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_RCV_FIN);
00077         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_RCV_FIN_ACK);
00078         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_RCV_RST);
00079         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_RCV_UNEXP_SYN);
00080         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_TIMEOUT_2MSL);
00081         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_TIMEOUT_CONN_ESTAB);
00082         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_E_TIMEOUT_FIN_WAIT_2);
00083     }
00084     <span class="keywordflow">return</span> s;
00085 <span class="preprocessor">#undef CASE</span>
00086 <span class="preprocessor"></span>}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z153_0" doxytag="TCPConnection::getFsmState"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int TCPConnection::getFsmState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00457 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state();}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z153_3" doxytag="TCPConnection::getReceiveQueue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a>* TCPConnection::getReceiveQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00460 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a>;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z153_2" doxytag="TCPConnection::getSendQueue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a>* TCPConnection::getSendQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00459 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z153_1" doxytag="TCPConnection::getState"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a>* TCPConnection::getState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00458 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#p2">state</a>;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z153_4" doxytag="TCPConnection::getTcpAlgorithm"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a>* TCPConnection::getTcpAlgorithm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00461 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z153_5" doxytag="TCPConnection::getTcpMain"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p.html">TCP</a>* TCPConnection::getTcpMain           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00462 {<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e5" doxytag="TCPConnection::indicationName"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char * TCPConnection::indicationName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>code</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: returns name of TCP_I_xxx constants <div class="fragment"><pre class="fragment">00089 {
00090 <span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
00091 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">"unknown"</span>;
00092     <span class="keywordflow">switch</span> (code)
00093     {
00094         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_I_DATA);
00095         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_I_URGENT_DATA);
00096         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_I_ESTABLISHED);
00097         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_I_PEER_CLOSED);
00098         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_I_CLOSED);
00099         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_I_CONNECTION_REFUSED);
00100         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_I_CONNECTION_RESET);
00101         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_I_TIMED_OUT);
00102         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_I_STATUS);
00103     }
00104     <span class="keywordflow">return</span> s;
00105 <span class="preprocessor">#undef CASE</span>
00106 <span class="preprocessor"></span>}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="TCPConnection::initConnection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::initConnection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>openCmd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: creates send/receive queues and tcpAlgorithm <div class="fragment"><pre class="fragment">00276 {
00277     <span class="comment">// create send/receive queues</span>
00278     <span class="keyword">const</span> <span class="keywordtype">char</span> *sendQueueClass = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a18">sendQueueClass</a>();
00279     <span class="keywordflow">if</span> (!sendQueueClass || !sendQueueClass[0])
00280         sendQueueClass = tcpMain-&gt;par("sendQueueClass");
00281     sendQueue = check_and_cast&lt;<a class="code" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&gt;(createOne(sendQueueClass));
00282 
00283     const <span class="keywordtype">char</span> *receiveQueueClass = openCmd-&gt;receiveQueueClass();
00284     if (!receiveQueueClass || !receiveQueueClass[0])
00285         receiveQueueClass = tcpMain-&gt;par("receiveQueueClass");
00286     receiveQueue = check_and_cast&lt;<a class="code" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&gt;(createOne(receiveQueueClass));
00287 
00288     <span class="comment">// create algorithm</span>
00289     const <span class="keywordtype">char</span> *tcpAlgorithmClass = openCmd-&gt;tcpAlgorithmClass();
00290     if (!tcpAlgorithmClass || !tcpAlgorithmClass[0])
00291         tcpAlgorithmClass = tcpMain-&gt;par("tcpAlgorithmClass");
00292     tcpAlgorithm = check_and_cast&lt;<a class="code" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&gt;(createOne(tcpAlgorithmClass));
00293     tcpAlgorithm-&gt;setConnection(this);
00294 
00295     <span class="comment">// create state block</span>
00296     state = tcpAlgorithm-&gt;stateVariables();
00297     configureStateVariables();
00298     tcpAlgorithm-&gt;initialize();
00299 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="TCPConnection::isSegmentAcceptable"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TCPConnection::isSegmentAcceptable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tcpseg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: check if segment is acceptable (all bytes are in receive window) <div class="fragment"><pre class="fragment">00318 {
00319     <span class="comment">// segment entirely falls in receive window</span>
00320     <span class="comment">//FIXME probably not this simple, see old code segAccept() below...</span>
00321     <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a39">seqGE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>(),<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>) &amp;&amp;
00322            <a class="code" href="_t_c_p_connection_8h.html#a37">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>()+tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>(),<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>+<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o12">rcv_wnd</a>);
00323 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z146_1" doxytag="TCPConnection::performStateTransition"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TCPConnection::performStateTransition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Implemements the pure <a class="el" href="class_t_c_p.html">TCP</a> state machine <div class="fragment"><pre class="fragment">00272 {
00273     ASSERT(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()!=<a class="code" href="_t_c_p_connection_8h.html#a40a7">TCP_S_CLOSED</a>); <span class="comment">// closed connections should be deleted immediately</span>
00274 
00275     <span class="keywordflow">if</span> (event==TCP_E_IGNORE)  <span class="comment">// e.g. discarded segment</span>
00276     {
00277         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Staying in state: "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()) &lt;&lt; <span class="stringliteral">" (no FSM event)\n"</span>;
00278         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00279     }
00280 
00281     <span class="comment">// state machine</span>
00282     <span class="comment">// TBD add handling of connection timeout event (keepalive), with transition to CLOSED</span>
00283     <span class="comment">// Note: empty "default:" lines are for gcc's benefit which would otherwise spit warnings</span>
00284     <span class="keywordtype">int</span> oldState = <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state();
00285     <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
00286     {
00287         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a6">TCP_S_INIT</a>:
00288             <span class="keywordflow">switch</span> (event)
00289             {
00290                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a20">TCP_E_OPEN_PASSIVE</a>:FSM_Goto(fsm, TCP_S_LISTEN); <span class="keywordflow">break</span>;
00291                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a19">TCP_E_OPEN_ACTIVE</a>: FSM_Goto(fsm, TCP_S_SYN_SENT); <span class="keywordflow">break</span>;
00292                 <span class="keywordflow">default</span>:;
00293             }
00294             <span class="keywordflow">break</span>;
00295 
00296         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a8">TCP_S_LISTEN</a>:
00297             <span class="keywordflow">switch</span> (event)
00298             {
00299                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a19">TCP_E_OPEN_ACTIVE</a>: FSM_Goto(fsm, TCP_S_SYN_SENT); <span class="keywordflow">break</span>;
00300                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a21">TCP_E_SEND</a>:        FSM_Goto(fsm, TCP_S_SYN_SENT); <span class="keywordflow">break</span>;
00301                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a22">TCP_E_CLOSE</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00302                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00303                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a27">TCP_E_RCV_SYN</a>:     FSM_Goto(fsm, TCP_S_SYN_RCVD);<span class="keywordflow">break</span>;
00304                 <span class="keywordflow">default</span>:;
00305             }
00306             <span class="keywordflow">break</span>;
00307 
00308         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>:
00309             <span class="keywordflow">switch</span> (event)
00310             {
00311                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a22">TCP_E_CLOSE</a>:       FSM_Goto(fsm, TCP_S_FIN_WAIT_1); <span class="keywordflow">break</span>;
00312                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00313                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a34">TCP_E_TIMEOUT_CONN_ESTAB</a>: FSM_Goto(fsm, <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o0">active</a> ? TCP_S_CLOSED : TCP_S_LISTEN); <span class="keywordflow">break</span>;
00314                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>:     FSM_Goto(fsm, <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o0">active</a> ? TCP_S_CLOSED : TCP_S_LISTEN); <span class="keywordflow">break</span>;
00315                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a26">TCP_E_RCV_ACK</a>:     FSM_Goto(fsm, TCP_S_ESTABLISHED); <span class="keywordflow">break</span>;
00316                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a29">TCP_E_RCV_FIN</a>:     FSM_Goto(fsm, TCP_S_CLOSE_WAIT); <span class="keywordflow">break</span>;
00317                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a32">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00318                 <span class="keywordflow">default</span>:;
00319             }
00320             <span class="keywordflow">break</span>;
00321 
00322         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a9">TCP_S_SYN_SENT</a>:
00323             <span class="keywordflow">switch</span> (event)
00324             {
00325                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a22">TCP_E_CLOSE</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00326                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00327                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a34">TCP_E_TIMEOUT_CONN_ESTAB</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00328                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>:     FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00329                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a28">TCP_E_RCV_SYN_ACK</a>: FSM_Goto(fsm, TCP_S_ESTABLISHED); <span class="keywordflow">break</span>;
00330                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a27">TCP_E_RCV_SYN</a>:     FSM_Goto(fsm, TCP_S_SYN_RCVD); <span class="keywordflow">break</span>;
00331                 <span class="keywordflow">default</span>:;
00332             }
00333             <span class="keywordflow">break</span>;
00334 
00335         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a>:
00336             <span class="keywordflow">switch</span> (event)
00337             {
00338                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a22">TCP_E_CLOSE</a>:       FSM_Goto(fsm, TCP_S_FIN_WAIT_1); <span class="keywordflow">break</span>;
00339                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00340                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a29">TCP_E_RCV_FIN</a>:     FSM_Goto(fsm, TCP_S_CLOSE_WAIT); <span class="keywordflow">break</span>;
00341                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>:     FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00342                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a32">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00343                 <span class="keywordflow">default</span>:;
00344             }
00345             <span class="keywordflow">break</span>;
00346 
00347         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a12">TCP_S_CLOSE_WAIT</a>:
00348             <span class="keywordflow">switch</span> (event)
00349             {
00350                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a22">TCP_E_CLOSE</a>:       FSM_Goto(fsm, TCP_S_LAST_ACK); <span class="keywordflow">break</span>;
00351                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00352                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>:     FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00353                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a32">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00354                 <span class="keywordflow">default</span>:;
00355             }
00356             <span class="keywordflow">break</span>;
00357 
00358         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a13">TCP_S_LAST_ACK</a>:
00359             <span class="keywordflow">switch</span> (event)
00360             {
00361                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00362                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a26">TCP_E_RCV_ACK</a>:     FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00363                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>:     FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00364                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a32">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00365                 <span class="keywordflow">default</span>:;
00366             }
00367             <span class="keywordflow">break</span>;
00368 
00369         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a>:
00370             <span class="keywordflow">switch</span> (event)
00371             {
00372                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00373                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a29">TCP_E_RCV_FIN</a>:     FSM_Goto(fsm, TCP_S_CLOSING); <span class="keywordflow">break</span>;
00374                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a26">TCP_E_RCV_ACK</a>:     FSM_Goto(fsm, TCP_S_FIN_WAIT_2); <span class="keywordflow">break</span>;
00375                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a30">TCP_E_RCV_FIN_ACK</a>: FSM_Goto(fsm, TCP_S_TIME_WAIT); <span class="keywordflow">break</span>;
00376                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>:     FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00377                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a32">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00378                 <span class="keywordflow">default</span>:;
00379             }
00380             <span class="keywordflow">break</span>;
00381 
00382         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>:
00383             <span class="keywordflow">switch</span> (event)
00384             {
00385                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00386                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a29">TCP_E_RCV_FIN</a>:     FSM_Goto(fsm, TCP_S_TIME_WAIT); <span class="keywordflow">break</span>;
00387                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a35">TCP_E_TIMEOUT_FIN_WAIT_2</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00388                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>:     FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00389                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a32">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00390                 <span class="keywordflow">default</span>:;
00391             }
00392             <span class="keywordflow">break</span>;
00393 
00394         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a16">TCP_S_CLOSING</a>:
00395             <span class="keywordflow">switch</span> (event)
00396             {
00397                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00398                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a26">TCP_E_RCV_ACK</a>:     FSM_Goto(fsm, TCP_S_TIME_WAIT); <span class="keywordflow">break</span>;
00399                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>:     FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00400                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a32">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00401                 <span class="keywordflow">default</span>:;
00402             }
00403             <span class="keywordflow">break</span>;
00404 
00405         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a17">TCP_S_TIME_WAIT</a>:
00406             <span class="keywordflow">switch</span> (event)
00407             {
00408                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>:       FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00409                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a33">TCP_E_TIMEOUT_2MSL</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00410                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>:     FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00411                 <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a32">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(fsm, TCP_S_CLOSED); <span class="keywordflow">break</span>;
00412                 <span class="keywordflow">default</span>:;
00413             }
00414             <span class="keywordflow">break</span>;
00415 
00416         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a7">TCP_S_CLOSED</a>:
00417             <span class="keywordflow">break</span>;
00418     }
00419 
00420     <span class="keywordflow">if</span> (oldState!=<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
00421     {
00422         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Transition: "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(oldState) &lt;&lt; <span class="stringliteral">" --&gt; "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()) &lt;&lt; <span class="stringliteral">"  (event was: "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e4">eventName</a>(event) &lt;&lt; <span class="stringliteral">")\n"</span>;
00423         <a class="code" href="_t_c_p_8h.html#a2">testingEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;name() &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(oldState) &lt;&lt; <span class="stringliteral">" --&gt; "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()) &lt;&lt; <span class="stringliteral">"  (on "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e4">eventName</a>(event) &lt;&lt; <span class="stringliteral">")\n"</span>;
00424 
00425         <span class="comment">// cancel timers, etc.</span>
00426         <a class="code" href="class_t_c_p_connection.html#z146_2">stateEntered</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state());
00427     }
00428     <span class="keywordflow">else</span>
00429     {
00430         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Staying in state: "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()) &lt;&lt; <span class="stringliteral">" (event was: "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e4">eventName</a>(event) &lt;&lt; <span class="stringliteral">")\n"</span>;
00431     }
00432 
00433     <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()!=<a class="code" href="_t_c_p_connection_8h.html#a40a7">TCP_S_CLOSED</a>;
00434 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z146_0" doxytag="TCPConnection::preanalyseAppCommandEvent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> TCPConnection::preanalyseAppCommandEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>commandCode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Maps app command codes (msg kind of app command msgs) to TCP_E_xxx event codes <div class="fragment"><pre class="fragment">00257 {
00258     <span class="keywordflow">switch</span> (commandCode)
00259     {
00260         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a28a1">TCP_C_OPEN_ACTIVE</a>:  <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a19">TCP_E_OPEN_ACTIVE</a>;
00261         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a28a2">TCP_C_OPEN_PASSIVE</a>: <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a20">TCP_E_OPEN_PASSIVE</a>;
00262         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a28a3">TCP_C_SEND</a>:         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a21">TCP_E_SEND</a>;
00263         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a28a4">TCP_C_CLOSE</a>:        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a22">TCP_E_CLOSE</a>;
00264         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a28a5">TCP_C_ABORT</a>:        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>;
00265         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_command__m_8h.html#a28a6">TCP_C_STATUS</a>:       <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a24">TCP_E_STATUS</a>;
00266         <span class="keywordflow">default</span>: opp_error(<span class="stringliteral">"Unknown message kind in app command"</span>);
00267                  <span class="keywordflow">return</span> (TCPEventCode)0; <span class="comment">// to satisfy compiler</span>
00268     }
00269 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="TCPConnection::printConnBrief"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::printConnBrief           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: prints local/remote addr/port and app gate index/connId <div class="fragment"><pre class="fragment">00109 {
00110     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Connection "</span>;
00111     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#o2">localAddr</a> &lt;&lt; <span class="stringliteral">":"</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#o4">localPort</a> &lt;&lt; <span class="stringliteral">" to "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#o3">remoteAddr</a> &lt;&lt; <span class="stringliteral">":"</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#o5">remotePort</a>;
00112     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"  on app["</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#o0">appGateIndex</a> &lt;&lt; <span class="stringliteral">"],connId="</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#o1">connId</a>;
00113     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"  in "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state());
00114     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"  (ptr=0x"</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">")\n"</span>;
00115 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e2" doxytag="TCPConnection::printSegmentBrief"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::printSegmentBrief           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tcpseg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: prints important header fields <div class="fragment"><pre class="fragment">00118 {
00119     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"."</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4">srcPort</a>() &lt;&lt; <span class="stringliteral">" &gt; "</span>;
00120     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"."</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6">destPort</a>() &lt;&lt; <span class="stringliteral">": "</span>;
00121 
00122     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a20">synBit</a>())  <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a14">ackBit</a>() ? <span class="stringliteral">"SYN+ACK "</span> : <span class="stringliteral">"SYN "</span>);
00123     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22">finBit</a>())  <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"FIN(+ACK) "</span>;
00124     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a18">rstBit</a>())  <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a14">ackBit</a>() ? <span class="stringliteral">"RST+ACK "</span> : <span class="stringliteral">"RST "</span>);
00125     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a16">pshBit</a>())  <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"PSH "</span>;
00126 
00127     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>()&gt;0 || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a20">synBit</a>())
00128     {
00129         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>() &lt;&lt; <span class="stringliteral">":"</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>()+tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>();
00130         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"("</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>() &lt;&lt; <span class="stringliteral">") "</span>;
00131     }
00132     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a14">ackBit</a>())  <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"ack "</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>() &lt;&lt; <span class="stringliteral">" "</span>;
00133     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"win "</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a24">window</a>() &lt;&lt; <span class="stringliteral">"\n"</span>;
00134     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a12">urgBit</a>())  <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"urg "</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a26">urgentPointer</a>() &lt;&lt; <span class="stringliteral">" "</span>;
00135 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z148_4" doxytag="TCPConnection::process_ABORT"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_ABORT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00222 {
00223     <span class="keyword">delete</span> tcpCommand;
00224     <span class="keyword">delete</span> msg;
00225 
00226     <span class="comment">//</span>
00227     <span class="comment">// The ABORT event will automatically take the connection to the CLOSED</span>
00228     <span class="comment">// state, flush queues etc -- no need to do it here. Also, we don't need to</span>
00229     <span class="comment">// send notification to the user, they know what's going on.</span>
00230     <span class="comment">//</span>
00231     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
00232     {
00233         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a6">TCP_S_INIT</a>:
00234             opp_error(<span class="stringliteral">"Error processing command ABORT: connection not open"</span>);
00235 
00236         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>:
00237         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a>:
00238         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a>:
00239         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>:
00240         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a12">TCP_S_CLOSE_WAIT</a>:
00241             <span class="comment">//"</span>
00242             <span class="comment">// Send a reset segment:</span>
00243             <span class="comment">//</span>
00244             <span class="comment">//   &lt;SEQ=SND.NXT&gt;&lt;CTL=RST&gt;</span>
00245             <span class="comment">//"</span>
00246             <a class="code" href="class_t_c_p_connection.html#a5">sendRst</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>);
00247             <span class="keywordflow">break</span>;
00248     }
00249 
00250 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z148_3" doxytag="TCPConnection::process_CLOSE"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_CLOSE           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00162 {
00163     <span class="keyword">delete</span> tcpCommand;
00164     <span class="keyword">delete</span> msg;
00165 
00166     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
00167     {
00168         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a6">TCP_S_INIT</a>:
00169             opp_error(<span class="stringliteral">"Error processing command CLOSE: connection not open"</span>);
00170 
00171         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a8">TCP_S_LISTEN</a>:
00172             <span class="comment">// Nothing to do here</span>
00173             <span class="keywordflow">break</span>;
00174 
00175         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a9">TCP_S_SYN_SENT</a>:
00176             <span class="comment">// Delete the TCB and return "error:  closing" responses to any</span>
00177             <span class="comment">// queued SENDs, or RECEIVEs.</span>
00178             <span class="keywordflow">break</span>;
00179 
00180         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>:
00181         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a>:
00182         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a12">TCP_S_CLOSE_WAIT</a>:
00183             <span class="comment">//</span>
00184             <span class="comment">// SYN_RCVD processing (ESTABLISHED and CLOSE_WAIT are similar):</span>
00185             <span class="comment">//"</span>
00186             <span class="comment">// If no SENDs have been issued and there is no pending data to send,</span>
00187             <span class="comment">// then form a FIN segment and send it, and enter FIN-WAIT-1 state;</span>
00188             <span class="comment">// otherwise queue for processing after entering ESTABLISHED state.</span>
00189             <span class="comment">//"</span>
00190             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>==<a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4">bufferEndSeq</a>())
00191             {
00192                 <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"No outstanding SENDs, sending FIN right away, advancing snd_nxt over the FIN\n"</span>;
00193                 <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>;
00194                 <a class="code" href="class_t_c_p_connection.html#a6">sendFin</a>();
00195                 <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a> = ++<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>;
00196                 <span class="keywordflow">if</span> (unackedVector) unackedVector-&gt;record(state-&gt;snd_max - state-&gt;snd_una);
00197 
00198                 <span class="comment">// state transition will automatically take us to FIN_WAIT_1 (or LAST_ACK)</span>
00199             }
00200             else
00201             {
00202                 <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"SEND of "</span> &lt;&lt; (<a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4">bufferEndSeq</a>()-<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>) &lt;&lt;
00203                       <span class="stringliteral">" bytes pending, deferring sending of FIN\n"</span>;
00204                 event = <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00205             }
00206             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o19">send_fin</a> = <span class="keyword">true</span>;
00207             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o20">snd_fin_seq</a> = <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4">bufferEndSeq</a>();
00208             <span class="keywordflow">break</span>;
00209 
00210         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a>:
00211         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>:
00212         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a16">TCP_S_CLOSING</a>:
00213         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a13">TCP_S_LAST_ACK</a>:
00214         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a17">TCP_S_TIME_WAIT</a>:
00215             <span class="comment">// RFC 793 is not entirely clear on how to handle a duplicate close request.</span>
00216             <span class="comment">// Here we treat it as an error.</span>
00217             opp_error(<span class="stringliteral">"Duplicate CLOSE command: connection already closing"</span>);
00218     }
00219 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z148_0" doxytag="TCPConnection::process_OPEN_ACTIVE"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_OPEN_ACTIVE           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00035 {
00036     <a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *openCmd = check_and_cast&lt;TCPOpenCommand *&gt;(tcpCommand);
00037     <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="code" href="class_t_c_p_connection.html#o2">localAddr</a>, <a class="code" href="class_t_c_p_connection.html#o3">remoteAddr</a>;
00038     <span class="keywordtype">short</span> <a class="code" href="class_t_c_p_connection.html#o4">localPort</a>, <a class="code" href="class_t_c_p_connection.html#o5">remotePort</a>;
00039 
00040     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
00041     {
00042         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a6">TCP_S_INIT</a>:
00043             <a class="code" href="class_t_c_p_connection.html#b1">initConnection</a>(openCmd);
00044 
00045             <span class="comment">// store local/remote socket</span>
00046             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o0">active</a> = <span class="keyword">true</span>;
00047             localAddr = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a6">localAddr</a>();
00048             remoteAddr = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a9">remoteAddr</a>();
00049             localPort = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a12">localPort</a>();
00050             remotePort = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a14">remotePort</a>();
00051 
00052             <span class="keywordflow">if</span> (remoteAddr.<a class="code" href="class_i_pv_x_address.html#z36_0">isUnspecified</a>() || remotePort==-1)
00053                 opp_error(<span class="stringliteral">"Error processing command OPEN_ACTIVE: remote address and port must be specified"</span>);
00054 
00055             <span class="keywordflow">if</span> (localPort==-1)
00056             {
00057                 localPort = <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a5">getEphemeralPort</a>();
00058                 <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Assigned ephemeral port "</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">"\n"</span>;
00059             }
00060 
00061             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"OPEN: "</span> &lt;&lt; localAddr &lt;&lt; <span class="stringliteral">":"</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">" --&gt; "</span> &lt;&lt; remoteAddr &lt;&lt; <span class="stringliteral">":"</span> &lt;&lt; remotePort &lt;&lt; <span class="stringliteral">"\n"</span>;
00062 
00063             <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a2">addSockPair</a>(<span class="keyword">this</span>, localAddr, remoteAddr, localPort, remotePort);
00064 
00065             <span class="comment">// send initial SYN</span>
00066             <a class="code" href="class_t_c_p_connection.html#b3">selectInitialSeqNum</a>();
00067             <a class="code" href="class_t_c_p_connection.html#b5">sendSyn</a>();
00068             <a class="code" href="class_t_c_p_connection.html#a9">startSynRexmitTimer</a>();
00069             <a class="code" href="class_t_c_p_connection.html#a11">scheduleTimeout</a>(connEstabTimer, TCP_TIMEOUT_CONN_ESTAB);
00070             <span class="keywordflow">break</span>;
00071 
00072         <span class="keywordflow">default</span>:
00073             opp_error(<span class="stringliteral">"Error processing command OPEN_ACTIVE: connection already exists"</span>);
00074     }
00075 
00076     <span class="keyword">delete</span> openCmd;
00077     <span class="keyword">delete</span> msg;
00078 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z148_1" doxytag="TCPConnection::process_OPEN_PASSIVE"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_OPEN_PASSIVE           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00081 {
00082     <a class="code" href="class_t_c_p_open_command.html">TCPOpenCommand</a> *openCmd = check_and_cast&lt;TCPOpenCommand *&gt;(tcpCommand);
00083     <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="code" href="class_t_c_p_connection.html#o2">localAddr</a>;
00084     <span class="keywordtype">short</span> <a class="code" href="class_t_c_p_connection.html#o4">localPort</a>;
00085 
00086     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
00087     {
00088         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a6">TCP_S_INIT</a>:
00089             <a class="code" href="class_t_c_p_connection.html#b1">initConnection</a>(openCmd);
00090 
00091             <span class="comment">// store local/remote socket</span>
00092             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o0">active</a> = <span class="keyword">false</span>;
00093             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o1">fork</a> = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a16">fork</a>();
00094             localAddr = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a6">localAddr</a>();
00095             localPort = openCmd-&gt;<a class="code" href="class_t_c_p_open_command.html#a12">localPort</a>();
00096 
00097             <span class="keywordflow">if</span> (localPort==-1)
00098                 opp_error("Error processing command OPEN_PASSIVE: local port must be specified");
00099 
00100             tcpEV &lt;&lt; "Starting to listen on: " &lt;&lt; localAddr &lt;&lt; ":" &lt;&lt; localPort &lt;&lt; "\n";
00101 
00102             tcpMain-&gt;addSockPair(this, localAddr, <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(), localPort, -1);
00103             break;
00104 
00105         default:
00106             opp_error("Error processing command OPEN_PASSIVE: connection already exists");
00107     }
00108 
00109     delete openCmd;
00110     delete msg;
00111 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z150_1" doxytag="TCPConnection::process_RCV_SEGMENT"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> TCPConnection::process_RCV_SEGMENT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Process incoming <a class="el" href="class_t_c_p.html">TCP</a> segment. Returns a specific event code (e.g. TCP_E_RCV_SYN) which will drive the state machine. <div class="fragment"><pre class="fragment">00080 {
00081     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Seg arrived: "</span>;
00082     <a class="code" href="class_t_c_p_connection.html#e2">printSegmentBrief</a>(tcpseg);
00083     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"TCB: "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1">info</a>() &lt;&lt; <span class="stringliteral">"\n"</span>;
00084 
00085     <span class="keywordflow">if</span> (rcvSeqVector) rcvSeqVector-&gt;record(tcpseg-&gt;sequenceNo());
00086     if (rcvAckVector) rcvAckVector-&gt;record(tcpseg-&gt;ackNo());
00087 
00088     <span class="comment">//</span>
00089     <span class="comment">// Note: this code is organized exactly as RFC 793, section "3.9 Event</span>
00090     <span class="comment">// Processing", subsection "SEGMENT ARRIVES".</span>
00091     <span class="comment">//</span>
00092     TCPEventCode event;
00093     if (fsm.state()==TCP_S_LISTEN)
00094     {
00095         event = <a class="code" href="class_t_c_p_connection.html#z150_2">processSegmentInListen</a>(tcpseg, src, dest);
00096     }
00097     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a9">TCP_S_SYN_SENT</a>)
00098     {
00099         event = <a class="code" href="class_t_c_p_connection.html#z150_3">processSegmentInSynSent</a>(tcpseg, src, dest);
00100     }
00101     <span class="keywordflow">else</span>
00102     {
00103         <span class="comment">// RFC 793 steps "first check sequence number", "second check the RST bit", etc</span>
00104         event = <a class="code" href="class_t_c_p_connection.html#z150_4">processSegment1stThru8th</a>(tcpseg);
00105     }
00106     <span class="keyword">delete</span> tcpseg;
00107     <span class="keywordflow">return</span> event;
00108 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z148_2" doxytag="TCPConnection::process_SEND"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_SEND           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00114 {
00115     <a class="code" href="class_t_c_p_send_command.html">TCPSendCommand</a> *sendCommand = check_and_cast&lt;TCPSendCommand *&gt;(tcpCommand);
00116 
00117     <span class="comment">// FIXME how to support PUSH? One option is to treat each SEND as a unit of data,</span>
00118     <span class="comment">// and set PSH at SEND boundaries</span>
00119     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
00120     {
00121         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a6">TCP_S_INIT</a>:
00122             opp_error(<span class="stringliteral">"Error processing command SEND: connection not open"</span>);
00123 
00124         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a8">TCP_S_LISTEN</a>:
00125             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"SEND command turns passive open into active open, sending initial SYN\n"</span>;
00126             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o0">active</a> = <span class="keyword">true</span>;
00127             <a class="code" href="class_t_c_p_connection.html#b3">selectInitialSeqNum</a>();
00128             <a class="code" href="class_t_c_p_connection.html#b5">sendSyn</a>();
00129             <a class="code" href="class_t_c_p_connection.html#a9">startSynRexmitTimer</a>();
00130             <a class="code" href="class_t_c_p_connection.html#a11">scheduleTimeout</a>(connEstabTimer, TCP_TIMEOUT_CONN_ESTAB);
00131             <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3">enqueueAppData</a>(msg);  <span class="comment">// queue up for later</span>
00132             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a5">bytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>) &lt;&lt; <span class="stringliteral">" bytes in queue\n"</span>;
00133             <span class="keywordflow">break</span>;
00134 
00135         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>:
00136         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a9">TCP_S_SYN_SENT</a>:
00137             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Queueing up data for sending later.\n"</span>;
00138             <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3">enqueueAppData</a>(msg); <span class="comment">// queue up for later</span>
00139             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a5">bytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>) &lt;&lt; <span class="stringliteral">" bytes in queue\n"</span>;
00140             <span class="keywordflow">break</span>;
00141 
00142         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a>:
00143         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a12">TCP_S_CLOSE_WAIT</a>:
00144             <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3">enqueueAppData</a>(msg);
00145             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a5">bytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>) &lt;&lt; <span class="stringliteral">" bytes in queue, plus "</span>
00146                   &lt;&lt; (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>-<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>) &lt;&lt; <span class="stringliteral">" bytes unacknowledged\n"</span>;
00147             <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a8">sendCommandInvoked</a>();
00148             <span class="keywordflow">break</span>;
00149 
00150         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a13">TCP_S_LAST_ACK</a>:
00151         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a>:
00152         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>:
00153         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a16">TCP_S_CLOSING</a>:
00154         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a17">TCP_S_TIME_WAIT</a>:
00155             opp_error(<span class="stringliteral">"Error processing command SEND: connection closing"</span>);
00156     }
00157 
00158     <span class="keyword">delete</span> sendCommand; <span class="comment">// msg itself has been taken by the sendQueue</span>
00159 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z148_5" doxytag="TCPConnection::process_STATUS"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_STATUS           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_t_c_p_command.html">TCPCommand</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00253 {
00254     <span class="keyword">delete</span> tcpCommand; <span class="comment">// but reuse msg for reply</span>
00255 
00256     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a6">TCP_S_INIT</a>)
00257         opp_error(<span class="stringliteral">"Error processing command STATUS: connection not open"</span>);
00258 
00259     <a class="code" href="class_t_c_p_status_info.html">TCPStatusInfo</a> *statusInfo = <span class="keyword">new</span> <a class="code" href="class_t_c_p_status_info.html">TCPStatusInfo</a>();
00260 
00261     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a7">setState</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state());
00262     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a9">setStateName</a>(<a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()));
00263 
00264     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a12">setLocalAddr</a>(localAddr);
00265     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a15">setRemoteAddr</a>(remoteAddr);
00266     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a17">setLocalPort</a>(localPort);
00267     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a19">setRemotePort</a>(remotePort);
00268 
00269     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a21">setSnd_mss</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o2">snd_mss</a>);
00270     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a23">setSnd_una</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>);
00271     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a25">setSnd_nxt</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>);
00272     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a27">setSnd_max</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>);
00273     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a29">setSnd_wnd</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o6">snd_wnd</a>);
00274     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a31">setSnd_up</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o7">snd_up</a>);
00275     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a33">setSnd_wl1</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o8">snd_wl1</a>);
00276     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a35">setSnd_wl2</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o9">snd_wl2</a>);
00277     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a37">setIss</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o10">iss</a>);
00278     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a39">setRcv_nxt</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>);
00279     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a41">setRcv_wnd</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o12">rcv_wnd</a>);
00280     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a43">setRcv_up</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o13">rcv_up</a>);
00281     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a45">setIrs</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o14">irs</a>);
00282     statusInfo-&gt;<a class="code" href="class_t_c_p_status_info.html#a47">setFin_ack_rcvd</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o18">fin_ack_rcvd</a>);
00283 
00284     msg-&gt;setControlInfo(statusInfo);
00285     <a class="code" href="class_t_c_p_connection.html#b8">sendToApp</a>(msg);
00286 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z152_0" doxytag="TCPConnection::process_TIMEOUT_2MSL"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_TIMEOUT_2MSL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01024 {
01025     <span class="comment">//"</span>
01026     <span class="comment">// If the time-wait timeout expires on a connection delete the TCB,</span>
01027     <span class="comment">// enter the CLOSED state and return.</span>
01028     <span class="comment">//"</span>
01029     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
01030     {
01031         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a17">TCP_S_TIME_WAIT</a>:
01032             <span class="comment">// Nothing to do here. The TIMEOUT_2MSL event will automatically take</span>
01033             <span class="comment">// the connection to CLOSED. We already notified the user</span>
01034             <span class="comment">// (TCP_I_CLOSED) when we entered the TIME_WAIT state from CLOSING,</span>
01035             <span class="comment">// FIN_WAIT_1 or FIN_WAIT_2.</span>
01036             <span class="keywordflow">break</span>;
01037         <span class="keywordflow">default</span>:
01038             <span class="comment">// We should not receive this timeout in this state.</span>
01039             opp_error(<span class="stringliteral">"Internal error: received time-wait (2MSL) timeout in state %s"</span>, <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()));
01040     }
01041 
01042 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z152_1" doxytag="TCPConnection::process_TIMEOUT_CONN_ESTAB"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_TIMEOUT_CONN_ESTAB           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01004 {
01005     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
01006     {
01007         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>:
01008         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a9">TCP_S_SYN_SENT</a>:
01009             <span class="comment">// Nothing to do here. TIMEOUT_CONN_ESTAB event will automatically</span>
01010             <span class="comment">// take the connection to LISTEN or CLOSED, and cancel SYN-REXMIT timer.</span>
01011             <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o0">active</a>)
01012             {
01013                 <span class="comment">// notify user if we're on the active side</span>
01014                 <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_TIMED_OUT);
01015             }
01016             <span class="keywordflow">break</span>;
01017         <span class="keywordflow">default</span>:
01018             <span class="comment">// We should not receive this timeout in this state.</span>
01019             opp_error(<span class="stringliteral">"Internal error: received CONN_ESTAB timeout in state %s"</span>, <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()));
01020     }
01021 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z152_2" doxytag="TCPConnection::process_TIMEOUT_FIN_WAIT_2"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_TIMEOUT_FIN_WAIT_2           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01045 {
01046     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
01047     {
01048         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>:
01049             <span class="comment">// Nothing to do here. The TIMEOUT_FIN_WAIT_2 event will automatically take</span>
01050             <span class="comment">// the connection to CLOSED.</span>
01051             <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CLOSED);
01052             <span class="keywordflow">break</span>;
01053         <span class="keywordflow">default</span>:
01054             <span class="comment">// We should not receive this timeout in this state.</span>
01055             opp_error(<span class="stringliteral">"Internal error: received FIN_WAIT_2 timeout in state %s"</span>, <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()));
01056     }
01057 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z152_3" doxytag="TCPConnection::process_TIMEOUT_SYN_REXMIT"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::process_TIMEOUT_SYN_REXMIT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01070 {
01071     <span class="keywordflow">if</span> (++<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o16">syn_rexmit_count</a>&gt;MAX_SYN_REXMIT_COUNT)
01072     {
01073         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Retransmission count during connection setup exceeds "</span> &lt;&lt; <a class="code" href="_t_c_p_connection_8h.html#a5">MAX_SYN_REXMIT_COUNT</a> &lt;&lt; <span class="stringliteral">", giving up\n"</span>;
01074         <span class="comment">// Note ABORT will take the connection to closed, and cancel CONN-ESTAB timer as well</span>
01075         event = <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>;
01076         <span class="keywordflow">return</span>;
01077     }
01078 
01079     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Performing retransmission #"</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o16">syn_rexmit_count</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
01080 
01081     <span class="comment">// resend what's needed</span>
01082     <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
01083     {
01084         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a9">TCP_S_SYN_SENT</a>: <a class="code" href="class_t_c_p_connection.html#b5">sendSyn</a>(); <span class="keywordflow">break</span>;
01085         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>: <a class="code" href="class_t_c_p_connection.html#b6">sendSynAck</a>(); <span class="keywordflow">break</span>;
01086         <span class="keywordflow">default</span>:  opp_error(<span class="stringliteral">"Internal error: SYN-REXMIT timer expired while in state %s"</span>, <a class="code" href="class_t_c_p_connection.html#e3">stateName</a>(<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()));
01087     }
01088 
01089     <span class="comment">// reschedule timer</span>
01090     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o17">syn_rexmit_timeout</a> *= 2;
01091 
01092     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o17">syn_rexmit_timeout</a> &gt; TCP_TIMEOUT_SYN_REXMIT_MAX)
01093         state-&gt;syn_rexmit_timeout = TCP_TIMEOUT_SYN_REXMIT_MAX;
01094     scheduleTimeout(synRexmitTimer, state-&gt;syn_rexmit_timeout);
01095 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z150_6" doxytag="TCPConnection::processAckInEstabEtc"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TCPConnection::processAckInEstabEtc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tcpseg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00885 {
00886     <a class="code" href="_t_c_p_8h.html#a1">tcpEV2</a> &lt;&lt; <span class="stringliteral">"Processing ACK in a data transfer state\n"</span>;
00887 
00888     <span class="comment">//</span>
00889     <span class="comment">//"</span>
00890     <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT then, set SND.UNA &lt;- SEG.ACK.</span>
00891     <span class="comment">//  Any segments on the retransmission queue which are thereby</span>
00892     <span class="comment">//  entirely acknowledged are removed.  Users should receive</span>
00893     <span class="comment">//  positive acknowledgments for buffers which have been SENT and</span>
00894     <span class="comment">//  fully acknowledged (i.e., SEND buffer should be returned with</span>
00895     <span class="comment">//  "ok" response).  If the ACK is a duplicate</span>
00896     <span class="comment">//  (SEG.ACK &lt; SND.UNA), it can be ignored.  If the ACK acks</span>
00897     <span class="comment">//  something not yet sent (SEG.ACK &gt; SND.NXT) then send an ACK,</span>
00898     <span class="comment">//  drop the segment, and return.</span>
00899     <span class="comment">//</span>
00900     <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT, the send window should be</span>
00901     <span class="comment">//  updated.  If (SND.WL1 &lt; SEG.SEQ or (SND.WL1 = SEG.SEQ and</span>
00902     <span class="comment">//  SND.WL2 =&lt; SEG.ACK)), set SND.WND &lt;- SEG.WND, set</span>
00903     <span class="comment">//  SND.WL1 &lt;- SEG.SEQ, and set SND.WL2 &lt;- SEG.ACK.</span>
00904     <span class="comment">//</span>
00905     <span class="comment">//  Note that SND.WND is an offset from SND.UNA, that SND.WL1</span>
00906     <span class="comment">//  records the sequence number of the last segment used to update</span>
00907     <span class="comment">//  SND.WND, and that SND.WL2 records the acknowledgment number of</span>
00908     <span class="comment">//  the last segment used to update SND.WND.  The check here</span>
00909     <span class="comment">//  prevents using old segments to update the window.</span>
00910     <span class="comment">//"</span>
00911     <span class="comment">// Note: should use SND.MAX instead of SND.NXT in above checks</span>
00912     <span class="comment">//</span>
00913     <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#a39">seqGE</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>()))
00914     {
00915         <span class="comment">//</span>
00916         <span class="comment">// duplicate ACK? A received TCP segment is a duplicate ACK if all of</span>
00917         <span class="comment">// the following apply:</span>
00918         <span class="comment">//    (1) snd_una==ackNo</span>
00919         <span class="comment">//    (2) segment contains no data</span>
00920         <span class="comment">//    (3) there's unacked data (snd_una!=snd_max)</span>
00921         <span class="comment">//</span>
00922         <span class="comment">// Note: ssfnet uses additional constraint "window is the same as last</span>
00923         <span class="comment">// received (not an update)" -- we don't do that because window updates</span>
00924         <span class="comment">// are ignored anyway if neither seqNo nor ackNo has changed.</span>
00925         <span class="comment">//</span>
00926         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>() &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>()==0 &amp;&amp;
00927             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>!=<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>)
00928         {
00929             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o15">dupacks</a>++;
00930             <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a12">receivedDuplicateAck</a>();
00931         }
00932         <span class="keywordflow">else</span>
00933         {
00934             <span class="comment">// if doesn't qualify as duplicate ACK, just ignore it.</span>
00935             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>()==0)
00936             {
00937                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>!=tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>())
00938                     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Old ACK: ackNo&lt;snd_una\n"</span>;
00939                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>==<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>)
00940                     tcpEV &lt;&lt; "ACK looks duplicate but we have currently no unacked data (snd_una==snd_max)\n";
00941             }
00942 
00943             <span class="comment">// reset counter</span>
00944             state-&gt;dupacks = 0;
00945         }
00946     }
00947     else if (seqLE(tcpseg-&gt;ackNo(), state-&gt;snd_max))
00948     {
00949         <span class="comment">// ack in window.</span>
00950         <a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a> old_snd_una = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>;
00951         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>();
00952         <span class="keywordflow">if</span> (unackedVector) unackedVector-&gt;record(state-&gt;snd_max - state-&gt;snd_una);
00953 
00954         <span class="comment">// after retransmitting a lost segment, we may get an ack well ahead of snd_nxt</span>
00955         if (seqLess(state-&gt;snd_nxt, state-&gt;snd_una))
00956             state-&gt;snd_nxt = state-&gt;snd_una;
00957 
00958         uint32 discardUpToSeq = state-&gt;snd_una;
00959 
00960         <span class="comment">// our FIN acked?</span>
00961         if (state-&gt;send_fin &amp;&amp; tcpseg-&gt;ackNo()==state-&gt;snd_fin_seq+1)
00962         {
00963             <span class="comment">// set flag that our FIN has been acked</span>
00964             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"ACK acks our FIN\n"</span>;
00965             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o18">fin_ack_rcvd</a> = <span class="keyword">true</span>;
00966             discardUpToSeq--; <span class="comment">// the FIN sequence number is not real data</span>
00967         }
00968 
00969         <span class="comment">// acked data no longer needed in send queue</span>
00970         <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a7">discardUpTo</a>(discardUpToSeq);
00971 
00972         <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#a36">seqLess</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o8">snd_wl1</a>, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>()) ||
00973             (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o8">snd_wl1</a>==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>() &amp;&amp; <a class="code" href="_t_c_p_connection_8h.html#a37">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o9">snd_wl2</a>, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>())))
00974         {
00975             <span class="comment">// send window should be updated</span>
00976             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Updating send window from segment: new wnd="</span> &lt;&lt; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a24">window</a>() &lt;&lt; <span class="stringliteral">"\n"</span>;
00977             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o6">snd_wnd</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a24">window</a>();
00978             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o8">snd_wl1</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>();
00979             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o9">snd_wl2</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>();
00980             <span class="keywordflow">if</span> (sndWndVector) sndWndVector-&gt;record(state-&gt;snd_wnd);
00981         }
00982 
00983         <span class="comment">// notify</span>
00984         tcpAlgorithm-&gt;receivedDataAck(old_snd_una);
00985 
00986         <span class="comment">// in the receivedDataAck we need the old value</span>
00987         state-&gt;dupacks = 0;
00988     }
00989     else
00990     {
00991         ASSERT(<a class="code" href="_t_c_p_connection_8h.html#a38">seqGreater</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>(), <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>)); <span class="comment">// from if-ladder</span>
00992 
00993         <span class="comment">// send an ACK, drop the segment, and return.</span>
00994         <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a13">receivedAckForDataNotYetSent</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>());
00995         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o15">dupacks</a> = 0;
00996         <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// means "drop"</span>
00997     }
00998     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00999 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="TCPConnection::processAppCommand"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TCPConnection::processAppCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Process commands from the application. Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="class_t_c_p.html">TCP</a>). <div class="fragment"><pre class="fragment">00233 {
00234     <a class="code" href="class_t_c_p_connection.html#a12">printConnBrief</a>();
00235 
00236     <span class="comment">// first do actions</span>
00237     <a class="code" href="class_t_c_p_command.html">TCPCommand</a> *tcpCommand = (<a class="code" href="class_t_c_p_command.html">TCPCommand</a> *)(msg-&gt;removeControlInfo());
00238     <a class="code" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> event = <a class="code" href="class_t_c_p_connection.html#z146_0">preanalyseAppCommandEvent</a>(msg-&gt;kind());
00239     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"App command: "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e4">eventName</a>(event) &lt;&lt; <span class="stringliteral">"\n"</span>;
00240     <span class="keywordflow">switch</span> (event)
00241     {
00242         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a19">TCP_E_OPEN_ACTIVE</a>: <a class="code" href="class_t_c_p_connection.html#z148_0">process_OPEN_ACTIVE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
00243         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a20">TCP_E_OPEN_PASSIVE</a>: <a class="code" href="class_t_c_p_connection.html#z148_1">process_OPEN_PASSIVE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
00244         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a21">TCP_E_SEND</a>: <a class="code" href="class_t_c_p_connection.html#z148_2">process_SEND</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
00245         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a22">TCP_E_CLOSE</a>: <a class="code" href="class_t_c_p_connection.html#z148_3">process_CLOSE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
00246         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a23">TCP_E_ABORT</a>: <a class="code" href="class_t_c_p_connection.html#z148_4">process_ABORT</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
00247         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a41a24">TCP_E_STATUS</a>: <a class="code" href="class_t_c_p_connection.html#z148_5">process_STATUS</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
00248         <span class="keywordflow">default</span>: opp_error(<span class="stringliteral">"wrong event code"</span>);
00249     }
00250 
00251     <span class="comment">// then state transitions</span>
00252     <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#z146_1">performStateTransition</a>(event);
00253 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z150_5" doxytag="TCPConnection::processRstInSynReceived"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> TCPConnection::processRstInSynReceived           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tcpseg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00857 {
00858     <a class="code" href="_t_c_p_8h.html#a1">tcpEV2</a> &lt;&lt; <span class="stringliteral">"Processing RST in SYN_RCVD\n"</span>;
00859 
00860     <span class="comment">//"</span>
00861     <span class="comment">// If this connection was initiated with a passive OPEN (i.e.,</span>
00862     <span class="comment">// came from the LISTEN state), then return this connection to</span>
00863     <span class="comment">// LISTEN state and return.  The user need not be informed.  If</span>
00864     <span class="comment">// this connection was initiated with an active OPEN (i.e., came</span>
00865     <span class="comment">// from SYN-SENT state) then the connection was refused, signal</span>
00866     <span class="comment">// the user "connection refused".  In either case, all segments</span>
00867     <span class="comment">// on the retransmission queue should be removed.  And in the</span>
00868     <span class="comment">// active OPEN case, enter the CLOSED state and delete the TCB,</span>
00869     <span class="comment">// and return.</span>
00870     <span class="comment">//"</span>
00871 
00872     <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a7">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4">bufferEndSeq</a>()); <span class="comment">// flush send queue</span>
00873 
00874     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o0">active</a>)
00875     {
00876         <span class="comment">// signal "connection refused"</span>
00877         <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CONNECTION_REFUSED);
00878     }
00879 
00880     <span class="comment">// on RCV_RST, FSM will go either to LISTEN or to CLOSED, depending on state-&gt;active</span>
00881     <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>;
00882 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z150_4" doxytag="TCPConnection::processSegment1stThru8th"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> TCPConnection::processSegment1stThru8th           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tcpseg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00111 {
00112     <span class="comment">//</span>
00113     <span class="comment">// RFC 793: first check sequence number</span>
00114     <span class="comment">//</span>
00115     <span class="keywordtype">bool</span> acceptable = <a class="code" href="class_t_c_p_connection.html#b4">isSegmentAcceptable</a>(tcpseg);
00116     <span class="keywordflow">if</span> (!acceptable)
00117     {
00118         <span class="comment">//"</span>
00119         <span class="comment">// If an incoming segment is not acceptable, an acknowledgment</span>
00120         <span class="comment">// should be sent in reply (unless the RST bit is set, if so drop</span>
00121         <span class="comment">// the segment and return):</span>
00122         <span class="comment">//</span>
00123         <span class="comment">//  &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
00124         <span class="comment">//"</span>
00125         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a18">rstBit</a>())
00126         {
00127             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"RST with unacceptable seqNum: dropping\n"</span>;
00128         }
00129         <span class="keywordflow">else</span>
00130         {
00131             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Segment seqNum not acceptable, sending ACK with current receive seq\n"</span>;
00132             <a class="code" href="class_t_c_p_connection.html#a0">sendAck</a>();
00133         }
00134         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00135     }
00136 
00137     <span class="comment">//</span>
00138     <span class="comment">// RFC 793: second check the RST bit,</span>
00139     <span class="comment">//</span>
00140     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a18">rstBit</a>())
00141     {
00142         <span class="comment">// Note: if we come from LISTEN, processSegmentInListen() has already handled RST.</span>
00143         <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
00144         {
00145             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>:
00146                 <span class="comment">//"</span>
00147                 <span class="comment">// If this connection was initiated with a passive OPEN (i.e.,</span>
00148                 <span class="comment">// came from the LISTEN state), then return this connection to</span>
00149                 <span class="comment">// LISTEN state and return.  The user need not be informed.  If</span>
00150                 <span class="comment">// this connection was initiated with an active OPEN (i.e., came</span>
00151                 <span class="comment">// from SYN-SENT state) then the connection was refused, signal</span>
00152                 <span class="comment">// the user "connection refused".  In either case, all segments</span>
00153                 <span class="comment">// on the retransmission queue should be removed.  And in the</span>
00154                 <span class="comment">// active OPEN case, enter the CLOSED state and delete the TCB,</span>
00155                 <span class="comment">// and return.</span>
00156                 <span class="comment">//"</span>
00157                 <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#z150_5">processRstInSynReceived</a>(tcpseg);
00158 
00159             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a>:
00160             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a>:
00161             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>:
00162             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a12">TCP_S_CLOSE_WAIT</a>:
00163                 <span class="comment">//"</span>
00164                 <span class="comment">// If the RST bit is set then, any outstanding RECEIVEs and SEND</span>
00165                 <span class="comment">// should receive "reset" responses.  All segment queues should be</span>
00166                 <span class="comment">// flushed.  Users should also receive an unsolicited general</span>
00167                 <span class="comment">// "connection reset" signal.</span>
00168                 <span class="comment">//</span>
00169                 <span class="comment">// Enter the CLOSED state, delete the TCB, and return.</span>
00170                 <span class="comment">//"</span>
00171                 <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"RST: performing connection reset, closing connection\n"</span>;
00172                 <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CONNECTION_RESET);
00173                 <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>;  <span class="comment">// this will trigger state transition</span>
00174 
00175             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a16">TCP_S_CLOSING</a>:
00176             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a13">TCP_S_LAST_ACK</a>:
00177             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a17">TCP_S_TIME_WAIT</a>:
00178                 <span class="comment">//"</span>
00179                 <span class="comment">// enter the CLOSED state, delete the TCB, and return.</span>
00180                 <span class="comment">//"</span>
00181                 <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"RST: closing connection\n"</span>;
00182                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()!=<a class="code" href="_t_c_p_connection_8h.html#a40a17">TCP_S_TIME_WAIT</a>)
00183                     <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CLOSED); <span class="comment">// in TIME_WAIT, we've already sent it</span>
00184                 <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>; <span class="comment">// this will trigger state transition</span>
00185 
00186             <span class="keywordflow">default</span>: ASSERT(0);
00187         }
00188     }
00189 
00190     <span class="comment">// RFC 793: third check security and precedence</span>
00191     <span class="comment">// This step is ignored.</span>
00192 
00193     <span class="comment">//</span>
00194     <span class="comment">// RFC 793: fourth, check the SYN bit,</span>
00195     <span class="comment">//</span>
00196     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a20">synBit</a>())
00197     {
00198         <span class="comment">//"</span>
00199         <span class="comment">// If the SYN is in the window it is an error, send a reset, any</span>
00200         <span class="comment">// outstanding RECEIVEs and SEND should receive "reset" responses,</span>
00201         <span class="comment">// all segment queues should be flushed, the user should also</span>
00202         <span class="comment">// receive an unsolicited general "connection reset" signal, enter</span>
00203         <span class="comment">// the CLOSED state, delete the TCB, and return.</span>
00204         <span class="comment">//</span>
00205         <span class="comment">// If the SYN is not in the window this step would not be reached</span>
00206         <span class="comment">// and an ack would have been sent in the first step (sequence</span>
00207         <span class="comment">// number check).</span>
00208         <span class="comment">//"</span>
00209 
00210         ASSERT(<a class="code" href="class_t_c_p_connection.html#b4">isSegmentAcceptable</a>(tcpseg));  <span class="comment">// assert SYN is in the window</span>
00211         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"SYN is in the window: performing connection reset, closing connection\n"</span>;
00212         <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CONNECTION_RESET);
00213         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a32">TCP_E_RCV_UNEXP_SYN</a>;
00214     }
00215 
00216     <span class="comment">//</span>
00217     <span class="comment">// RFC 793: fifth check the ACK field,</span>
00218     <span class="comment">//</span>
00219     <span class="keywordflow">if</span> (!tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a14">ackBit</a>())
00220     {
00221         <span class="comment">// if the ACK bit is off drop the segment and return</span>
00222         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"ACK not set, dropping segment\n"</span>;
00223         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00224     }
00225 
00226     <a class="code" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> event = <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00227 
00228     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>)
00229     {
00230         <span class="comment">//"</span>
00231         <span class="comment">// If SND.UNA =&lt; SEG.ACK =&lt; SND.NXT then enter ESTABLISHED state</span>
00232         <span class="comment">// and continue processing.</span>
00233         <span class="comment">//</span>
00234         <span class="comment">// If the segment acknowledgment is not acceptable, form a</span>
00235         <span class="comment">// reset segment,</span>
00236         <span class="comment">//</span>
00237         <span class="comment">//  &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
00238         <span class="comment">//</span>
00239         <span class="comment">// and send it.</span>
00240         <span class="comment">//"</span>
00241         <span class="keywordflow">if</span> (!<a class="code" href="_t_c_p_connection_8h.html#a37">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>()) || !<a class="code" href="_t_c_p_connection_8h.html#a37">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>(),<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>))
00242         {
00243             <a class="code" href="class_t_c_p_connection.html#a5">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>());
00244             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00245         }
00246 
00247         <span class="comment">// notify tcpAlgorithm and app layer</span>
00248         <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a5">established</a>(<span class="keyword">false</span>);
00249         <a class="code" href="class_t_c_p_connection.html#b10">sendEstabIndicationToApp</a>();
00250 
00251         <span class="comment">// This will trigger transition to ESTABLISHED. Timers and notifying</span>
00252         <span class="comment">// app will be taken care of in stateEntered().</span>
00253         event = <a class="code" href="_t_c_p_connection_8h.html#a41a26">TCP_E_RCV_ACK</a>;
00254     }
00255 
00256     <a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a> old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>; <span class="comment">// later we'll need to see if snd_nxt changed</span>
00257     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a> || <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a> ||
00258         <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a> || <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a> ||
00259         <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a12">TCP_S_CLOSE_WAIT</a> || <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a16">TCP_S_CLOSING</a>)
00260     {
00261         <span class="comment">//</span>
00262         <span class="comment">// ESTABLISHED processing:</span>
00263         <span class="comment">//"</span>
00264         <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT then, set SND.UNA &lt;- SEG.ACK.</span>
00265         <span class="comment">//  Any segments on the retransmission queue which are thereby</span>
00266         <span class="comment">//  entirely acknowledged are removed.  Users should receive</span>
00267         <span class="comment">//  positive acknowledgments for buffers which have been SENT and</span>
00268         <span class="comment">//  fully acknowledged (i.e., SEND buffer should be returned with</span>
00269         <span class="comment">//  "ok" response).  If the ACK is a duplicate</span>
00270         <span class="comment">//  (SEG.ACK &lt; SND.UNA), it can be ignored.  If the ACK acks</span>
00271         <span class="comment">//  something not yet sent (SEG.ACK &gt; SND.NXT) then send an ACK,</span>
00272         <span class="comment">//  drop the segment, and return.</span>
00273         <span class="comment">//</span>
00274         <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT, the send window should be</span>
00275         <span class="comment">//  updated.  If (SND.WL1 &lt; SEG.SEQ or (SND.WL1 = SEG.SEQ and</span>
00276         <span class="comment">//  SND.WL2 =&lt; SEG.ACK)), set SND.WND &lt;- SEG.WND, set</span>
00277         <span class="comment">//  SND.WL1 &lt;- SEG.SEQ, and set SND.WL2 &lt;- SEG.ACK.</span>
00278         <span class="comment">//</span>
00279         <span class="comment">//  Note that SND.WND is an offset from SND.UNA, that SND.WL1</span>
00280         <span class="comment">//  records the sequence number of the last segment used to update</span>
00281         <span class="comment">//  SND.WND, and that SND.WL2 records the acknowledgment number of</span>
00282         <span class="comment">//  the last segment used to update SND.WND.  The check here</span>
00283         <span class="comment">//  prevents using old segments to update the window.</span>
00284         <span class="comment">//"</span>
00285         <span class="keywordtype">bool</span> ok = <a class="code" href="class_t_c_p_connection.html#z150_6">processAckInEstabEtc</a>(tcpseg);
00286         <span class="keywordflow">if</span> (!ok)
00287             return TCP_E_IGNORE;  <span class="comment">// if acks something not yet sent, drop it</span>
00288     }
00289 
00290     if ((fsm.state()==TCP_S_FIN_WAIT_1 &amp;&amp; state-&gt;fin_ack_rcvd))
00291     {
00292         <span class="comment">//"</span>
00293         <span class="comment">// FIN-WAIT-1 STATE</span>
00294         <span class="comment">//   In addition to the processing for the ESTABLISHED state, if</span>
00295         <span class="comment">//   our FIN is now acknowledged then enter FIN-WAIT-2 and continue</span>
00296         <span class="comment">//   processing in that state.</span>
00297         <span class="comment">//"</span>
00298         event = <a class="code" href="_t_c_p_connection_8h.html#a41a26">TCP_E_RCV_ACK</a>;  <span class="comment">// will trigger transition to FIN-WAIT-2</span>
00299     }
00300 
00301     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>)
00302     {
00303         <span class="comment">//"</span>
00304         <span class="comment">// FIN-WAIT-2 STATE</span>
00305         <span class="comment">//  In addition to the processing for the ESTABLISHED state, if</span>
00306         <span class="comment">//  the retransmission queue is empty, the user's CLOSE can be</span>
00307         <span class="comment">//  acknowledged ("ok") but do not delete the TCB.</span>
00308         <span class="comment">//"</span>
00309         <span class="comment">// nothing to do here (in our model, used commands don't need to be</span>
00310         <span class="comment">// acknowledged)</span>
00311     }
00312 
00313     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a16">TCP_S_CLOSING</a>)
00314     {
00315         <span class="comment">//"</span>
00316         <span class="comment">// In addition to the processing for the ESTABLISHED state, if</span>
00317         <span class="comment">// the ACK acknowledges our FIN then enter the TIME-WAIT state,</span>
00318         <span class="comment">// otherwise ignore the segment.</span>
00319         <span class="comment">//"</span>
00320         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o18">fin_ack_rcvd</a>)
00321         {
00322             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Our FIN acked -- can go to TIME_WAIT now\n"</span>;
00323             event = <a class="code" href="_t_c_p_connection_8h.html#a41a26">TCP_E_RCV_ACK</a>;  <span class="comment">// will trigger transition to TIME-WAIT</span>
00324             <a class="code" href="class_t_c_p_connection.html#a11">scheduleTimeout</a>(the2MSLTimer, TCP_TIMEOUT_2MSL);  <span class="comment">// start timer</span>
00325 
00326             <span class="comment">// we're entering TIME_WAIT, so we can signal CLOSED the user</span>
00327             <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
00328             <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CLOSED);
00329         }
00330     }
00331 
00332     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a13">TCP_S_LAST_ACK</a>)
00333     {
00334         <span class="comment">//"</span>
00335         <span class="comment">// The only thing that can arrive in this state is an</span>
00336         <span class="comment">// acknowledgment of our FIN.  If our FIN is now acknowledged,</span>
00337         <span class="comment">// delete the TCB, enter the CLOSED state, and return.</span>
00338         <span class="comment">//"</span>
00339         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o19">send_fin</a> &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>()==<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o20">snd_fin_seq</a>+1)
00340         {
00341             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Last ACK arrived\n"</span>;
00342             <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CLOSED);
00343             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a26">TCP_E_RCV_ACK</a>; <span class="comment">// will trigger transition to CLOSED</span>
00344         }
00345     }
00346 
00347     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a17">TCP_S_TIME_WAIT</a>)
00348     {
00349         <span class="comment">//"</span>
00350         <span class="comment">// The only thing that can arrive in this state is a</span>
00351         <span class="comment">// retransmission of the remote FIN.  Acknowledge it, and restart</span>
00352         <span class="comment">// the 2 MSL timeout.</span>
00353         <span class="comment">//"</span>
00354         <span class="comment">// And we are staying in the TIME_WAIT state.</span>
00355         <span class="comment">//</span>
00356         <a class="code" href="class_t_c_p_connection.html#a0">sendAck</a>();
00357         <a class="code" href="class_t_c_p_connection.html#b7">cancelEvent</a>(the2MSLTimer);
00358         <a class="code" href="class_t_c_p_connection.html#a11">scheduleTimeout</a>(the2MSLTimer, TCP_TIMEOUT_2MSL);
00359     }
00360 
00361     <span class="comment">//</span>
00362     <span class="comment">// RFC 793: sixth, check the URG bit,</span>
00363     <span class="comment">//</span>
00364     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a12">urgBit</a>() &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a> || <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a> ||
00365         <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>))
00366     {
00367         <span class="comment">//"</span>
00368         <span class="comment">// If the URG bit is set, RCV.UP &lt;- max(RCV.UP,SEG.UP), and signal</span>
00369         <span class="comment">// the user that the remote side has urgent data if the urgent</span>
00370         <span class="comment">// pointer (RCV.UP) is in advance of the data consumed.  If the</span>
00371         <span class="comment">// user has already been signaled (or is still in the "urgent</span>
00372         <span class="comment">// mode") for this continuous sequence of urgent data, do not</span>
00373         <span class="comment">// signal the user again.</span>
00374         <span class="comment">//"</span>
00375 
00376         <span class="comment">// TBD: URG currently not supported</span>
00377     }
00378 
00379     <span class="comment">//</span>
00380     <span class="comment">// RFC 793: seventh, process the segment text,</span>
00381     <span class="comment">//</span>
00382     <a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a> old_rcv_nxt = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>; <span class="comment">// if rcv_nxt changes, we need to send/schedule an ACK</span>
00383     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a> || <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a> || <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a> || <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>)
00384     {
00385         <span class="comment">//"</span>
00386         <span class="comment">// Once in the ESTABLISHED state, it is possible to deliver segment</span>
00387         <span class="comment">// text to user RECEIVE buffers.  Text from segments can be moved</span>
00388         <span class="comment">// into buffers until either the buffer is full or the segment is</span>
00389         <span class="comment">// empty.  If the segment empties and carries an PUSH flag, then</span>
00390         <span class="comment">// the user is informed, when the buffer is returned, that a PUSH</span>
00391         <span class="comment">// has been received.</span>
00392         <span class="comment">//</span>
00393         <span class="comment">// When the TCP takes responsibility for delivering the data to the</span>
00394         <span class="comment">// user it must also acknowledge the receipt of the data.</span>
00395         <span class="comment">//</span>
00396         <span class="comment">// Once the TCP takes responsibility for the data it advances</span>
00397         <span class="comment">// RCV.NXT over the data accepted, and adjusts RCV.WND as</span>
00398         <span class="comment">// apporopriate to the current buffer availability.  The total of</span>
00399         <span class="comment">// RCV.NXT and RCV.WND should not be reduced.</span>
00400         <span class="comment">//</span>
00401         <span class="comment">// Please note the window management suggestions in section 3.7.</span>
00402         <span class="comment">//</span>
00403         <span class="comment">// Send an acknowledgment of the form:</span>
00404         <span class="comment">//</span>
00405         <span class="comment">//   &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
00406         <span class="comment">//</span>
00407         <span class="comment">// This acknowledgment should be piggybacked on a segment being</span>
00408         <span class="comment">// transmitted if possible without incurring undue delay.</span>
00409         <span class="comment">//"</span>
00410         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>()&gt;0)
00411         {
00412             <a class="code" href="_t_c_p_8h.html#a1">tcpEV2</a> &lt;&lt; <span class="stringliteral">"Processing segment text in a data transfer state\n"</span>;
00413 
00414             <span class="comment">// insert into receive buffers. If this segment is contiguous with</span>
00415             <span class="comment">// previously received ones (seqNo==rcv_nxt), rcv_nxt can be increased;</span>
00416             <span class="comment">// otherwise it stays the same but the data must be cached nevertheless</span>
00417             <span class="comment">// (to avoid "Failure to retain above-sequence data" problem, RFC 2525</span>
00418             <span class="comment">// section 2.5).</span>
00419             <a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a> old_rcv_nxt = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>;
00420             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a3">insertBytesFromSegment</a>(tcpseg);
00421 
00422             <span class="comment">// out-of-order segment?</span>
00423             <span class="keywordflow">if</span> (old_rcv_nxt==<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>)
00424             {
00425                 <span class="comment">// we'll probably want to send an ACK here</span>
00426                 <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a9">receivedOutOfOrderSegment</a>();
00427             }
00428             <span class="keywordflow">else</span>
00429             {
00430                 <span class="comment">// forward data to app</span>
00431                 <span class="comment">//</span>
00432                 <span class="comment">// FIXME observe PSH bit</span>
00433                 <span class="comment">//</span>
00434                 <span class="comment">// FIXME we should implement socket READ command, and pass up only</span>
00435                 <span class="comment">// as many bytes as requested. rcv_wnd should be decreased</span>
00436                 <span class="comment">// accordingly! (right now we *always* advertise win=16384,</span>
00437                 <span class="comment">// that is, there's practically no receiver-imposed flow control!)</span>
00438                 <span class="comment">//</span>
00439                 cMessage *msg;
00440                 <span class="keywordflow">while</span> ((msg=<a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a4">extractBytesUpTo</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>))!=NULL)
00441                 {
00442                     msg-&gt;setKind(TCP_I_DATA);  <span class="comment">// TBD currently we never send TCP_I_URGENT_DATA</span>
00443                     <a class="code" href="class_t_c_p_command.html">TCPCommand</a> *cmd = <span class="keyword">new</span> <a class="code" href="class_t_c_p_command.html">TCPCommand</a>();
00444                     cmd-&gt;<a class="code" href="class_t_c_p_command.html#a7">setConnId</a>(connId);
00445                     msg-&gt;setControlInfo(cmd);
00446                     <a class="code" href="class_t_c_p_connection.html#b8">sendToApp</a>(msg);
00447                 }
00448 
00449                 <span class="comment">// if this segment "filled the gap" until the previously arrived segment</span>
00450                 <span class="comment">// that carried a FIN (i.e.rcv_nxt==rcv_fin_seq), we have to advance</span>
00451                 <span class="comment">// rcv_nxt over the FIN.</span>
00452                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o21">fin_rcvd</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>==<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o22">rcv_fin_seq</a>)
00453                 {
00454                     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"All segments arrived up to the FIN segment, advancing rcv_nxt over the FIN\n"</span>;
00455                     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o22">rcv_fin_seq</a>+1;
00456                     <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_PEER_CLOSED);
00457                 }
00458             }
00459         }
00460     }
00461 
00462     <span class="comment">//</span>
00463     <span class="comment">// RFC 793: eighth, check the FIN bit,</span>
00464     <span class="comment">//</span>
00465     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22">finBit</a>())
00466     {
00467         <span class="comment">//"</span>
00468         <span class="comment">// If the FIN bit is set, signal the user "connection closing" and</span>
00469         <span class="comment">// return any pending RECEIVEs with same message, advance RCV.NXT</span>
00470         <span class="comment">// over the FIN, and send an acknowledgment for the FIN.  Note that</span>
00471         <span class="comment">// FIN implies PUSH for any segment text not yet delivered to the</span>
00472         <span class="comment">// user.</span>
00473         <span class="comment">//"</span>
00474 
00475         <span class="comment">// Note: seems like RFC 793 is not entirely correct here: if the</span>
00476         <span class="comment">// segment is "above sequence" (ie. RCV.NXT &lt; SEG.SEQ), we cannot</span>
00477         <span class="comment">// advance RCV.NXT over the FIN. Instead we remember this sequence</span>
00478         <span class="comment">// number and do it later.</span>
00479         <a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a> fin_seq = (<a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a>)tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>() + (<a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a>)tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>();
00480         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>==fin_seq)
00481         {
00482             <span class="comment">// advance rcv_nxt over FIN now</span>
00483             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"FIN arrived, advancing rcv_nxt over the FIN\n"</span>;
00484             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>++;
00485             <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_PEER_CLOSED);
00486         }
00487         <span class="keywordflow">else</span>
00488         {
00489             <span class="comment">// we'll have to do it later (when an arriving segment "fills the gap")</span>
00490             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"FIN segment above sequence, storing sequence number of FIN\n"</span>;
00491             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o21">fin_rcvd</a> = <span class="keyword">true</span>;
00492             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o22">rcv_fin_seq</a> = fin_seq;
00493         }
00494 
00495         <span class="comment">// TBD do PUSH stuff</span>
00496 
00497         <span class="comment">// state transitions will be done in the state machine, here we just set</span>
00498         <span class="comment">// the proper event code (TCP_E_RCV_FIN or TCP_E_RCV_FIN_ACK)</span>
00499         event = <a class="code" href="_t_c_p_connection_8h.html#a41a29">TCP_E_RCV_FIN</a>;
00500         <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state())
00501         {
00502             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a>:
00503                 <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o18">fin_ack_rcvd</a>)
00504                 {
00505                     event = <a class="code" href="_t_c_p_connection_8h.html#a41a30">TCP_E_RCV_FIN_ACK</a>;
00506                     <span class="comment">// start the time-wait timer, turn off the other timers</span>
00507                     <a class="code" href="class_t_c_p_connection.html#b7">cancelEvent</a>(finWait2Timer);
00508                     <a class="code" href="class_t_c_p_connection.html#a11">scheduleTimeout</a>(the2MSLTimer, TCP_TIMEOUT_2MSL);
00509 
00510                     <span class="comment">// we're entering TIME_WAIT, so we can signal CLOSED the user</span>
00511                     <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
00512                     <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CLOSED);
00513                 }
00514                 <span class="keywordflow">break</span>;
00515             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>:
00516                 <span class="comment">// Start the time-wait timer, turn off the other timers.</span>
00517                 <a class="code" href="class_t_c_p_connection.html#b7">cancelEvent</a>(finWait2Timer);
00518                 <a class="code" href="class_t_c_p_connection.html#a11">scheduleTimeout</a>(the2MSLTimer, TCP_TIMEOUT_2MSL);
00519 
00520                 <span class="comment">// we're entering TIME_WAIT, so we can signal CLOSED the user</span>
00521                 <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
00522                 <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CLOSED);
00523                 <span class="keywordflow">break</span>;
00524             <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a17">TCP_S_TIME_WAIT</a>:
00525                 <span class="comment">// Restart the 2 MSL time-wait timeout.</span>
00526                 <a class="code" href="class_t_c_p_connection.html#b7">cancelEvent</a>(the2MSLTimer);
00527                 <a class="code" href="class_t_c_p_connection.html#a11">scheduleTimeout</a>(the2MSLTimer, TCP_TIMEOUT_2MSL);
00528                 <span class="keywordflow">break</span>;
00529         }
00530     }
00531 
00532     <span class="keywordflow">if</span> (old_rcv_nxt!=<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>)
00533     {
00534         <span class="comment">// if rcv_nxt changed, either because we received segment text or we</span>
00535         <span class="comment">// received a FIN that needs to be acked (or both), we need to send or</span>
00536         <span class="comment">// schedule an ACK.</span>
00537 
00538         <span class="comment">// tcpAlgorithm decides when and how to do ACKs</span>
00539         <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a10">receiveSeqChanged</a>();
00540     }
00541 
00542     <span class="keywordflow">if</span> ((<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a> || <a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>) &amp;&amp;
00543         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o19">send_fin</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o20">snd_fin_seq</a>+1)
00544     {
00545         <span class="comment">// if the user issued the CLOSE command a long time ago and we've just</span>
00546         <span class="comment">// managed to send off FIN, we simulate a CLOSE command now (we had to</span>
00547         <span class="comment">// defer it at that time because we still had data in the send queue.)</span>
00548         <span class="comment">// This CLOSE will take us into the FIN_WAIT_1 state.</span>
00549         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Now we can do the CLOSE which was deferred a while ago\n"</span>;
00550         event = <a class="code" href="_t_c_p_connection_8h.html#a41a22">TCP_E_CLOSE</a>;
00551     }
00552 
00553     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p1">fsm</a>.state()==<a class="code" href="_t_c_p_connection_8h.html#a40a12">TCP_S_CLOSE_WAIT</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o19">send_fin</a> &amp;&amp;
00554         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o20">snd_fin_seq</a>+1 &amp;&amp; old_snd_nxt!=<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>)
00555     {
00556         <span class="comment">// if we're in CLOSE_WAIT and we just got to sent our long-pending FIN,</span>
00557         <span class="comment">// we simulate a CLOSE command now (we had to defer it at that time because</span>
00558         <span class="comment">// we still had data in the send queue.) This CLOSE will take us into the</span>
00559         <span class="comment">// LAST_ACK state.</span>
00560         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Now we can do the CLOSE which was deferred a while ago\n"</span>;
00561         event = <a class="code" href="_t_c_p_connection_8h.html#a41a22">TCP_E_CLOSE</a>;
00562     }
00563 
00564     <span class="keywordflow">return</span> event;
00565 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z150_2" doxytag="TCPConnection::processSegmentInListen"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> TCPConnection::processSegmentInListen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00570 {
00571     <a class="code" href="_t_c_p_8h.html#a1">tcpEV2</a> &lt;&lt; <span class="stringliteral">"Processing segment in LISTEN\n"</span>;
00572 
00573     <span class="comment">//"</span>
00574     <span class="comment">// first check for an RST</span>
00575     <span class="comment">//   An incoming RST should be ignored.  Return.</span>
00576     <span class="comment">//"</span>
00577     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a18">rstBit</a>())
00578     {
00579         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"RST bit set: dropping segment\n"</span>;
00580         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00581     }
00582 
00583     <span class="comment">//"</span>
00584     <span class="comment">// second check for an ACK</span>
00585     <span class="comment">//    Any acknowledgment is bad if it arrives on a connection still in</span>
00586     <span class="comment">//    the LISTEN state.  An acceptable reset segment should be formed</span>
00587     <span class="comment">//    for any arriving ACK-bearing segment.  The RST should be</span>
00588     <span class="comment">//    formatted as follows:</span>
00589     <span class="comment">//</span>
00590     <span class="comment">//      &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
00591     <span class="comment">//</span>
00592     <span class="comment">//    Return.</span>
00593     <span class="comment">//"</span>
00594     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a14">ackBit</a>())
00595     {
00596         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"ACK bit set: dropping segment and sending RST\n"</span>;
00597         <a class="code" href="class_t_c_p_connection.html#a5">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>(),destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6">destPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4">srcPort</a>());
00598         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00599     }
00600 
00601     <span class="comment">//"</span>
00602     <span class="comment">// third check for a SYN</span>
00603     <span class="comment">//"</span>
00604     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a20">synBit</a>())
00605     {
00606         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22">finBit</a>())
00607         {
00608             <span class="comment">// Looks like implementations vary on how to react to SYN+FIN.</span>
00609             <span class="comment">// Some treat it as plain SYN (and reply with SYN+ACK), some send RST+ACK.</span>
00610             <span class="comment">// Let's just do the former here.</span>
00611             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"SYN+FIN received: ignoring FIN\n"</span>;
00612         }
00613 
00614         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"SYN bit set: filling in foreign socket and sending SYN+ACK\n"</span>;
00615 
00616         <span class="comment">//"</span>
00617         <span class="comment">// If the listen was not fully specified (i.e., the foreign socket was not</span>
00618         <span class="comment">// fully specified), then the unspecified fields should be filled in now.</span>
00619         <span class="comment">//"</span>
00620         <span class="comment">//</span>
00621         <span class="comment">// Also, we may need to fork, in order to leave another connection</span>
00622         <span class="comment">// LISTENing on the port. Note: forking will change our connId.</span>
00623         <span class="comment">//</span>
00624         <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o1">fork</a>)
00625         {
00626             <a class="code" href="class_t_c_p_connection.html">TCPConnection</a> *conn = <a class="code" href="class_t_c_p_connection.html#b0">cloneListeningConnection</a>(); <span class="comment">// this will stay LISTENing</span>
00627             <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a4">addForkedConnection</a>(<span class="keyword">this</span>, conn, destAddr, srcAddr, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6">destPort</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4">srcPort</a>());
00628             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Connection forked: this connection got new connId="</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#o1">connId</a> &lt;&lt; <span class="stringliteral">", "</span>
00629                      <span class="stringliteral">"spinoff keeps LISTENing with connId="</span> &lt;&lt; conn-&gt;<a class="code" href="class_t_c_p_connection.html#o1">connId</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00630         }
00631         <span class="keywordflow">else</span>
00632         {
00633             <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a3">updateSockPair</a>(<span class="keyword">this</span>, destAddr, srcAddr, tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6">destPort</a>(), tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4">srcPort</a>());
00634         }
00635 
00636         <span class="comment">//"</span>
00637         <span class="comment">//  Set RCV.NXT to SEG.SEQ+1, IRS is set to SEG.SEQ and any other</span>
00638         <span class="comment">//  control or text should be queued for processing later.  ISS</span>
00639         <span class="comment">//  should be selected and a SYN segment sent of the form:</span>
00640         <span class="comment">//</span>
00641         <span class="comment">//    &lt;SEQ=ISS&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=SYN,ACK&gt;</span>
00642         <span class="comment">//</span>
00643         <span class="comment">//  SND.NXT is set to ISS+1 and SND.UNA to ISS.  The connection</span>
00644         <span class="comment">//  state should be changed to SYN-RECEIVED.</span>
00645         <span class="comment">//"</span>
00646         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>()+1;
00647         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o14">irs</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>();
00648         <a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a2">init</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>);   <span class="comment">// FIXME may init twice...</span>
00649         <a class="code" href="class_t_c_p_connection.html#b3">selectInitialSeqNum</a>();
00650 
00651         <span class="comment">// although not mentioned in RFC 793, seems like we have to pick up</span>
00652         <span class="comment">// initial snd_wnd from the segment here.</span>
00653         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o6">snd_wnd</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a24">window</a>();
00654         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o8">snd_wl1</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>();
00655         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o9">snd_wl2</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o10">iss</a>;
00656         <span class="keywordflow">if</span> (sndWndVector) sndWndVector-&gt;record(state-&gt;snd_wnd);
00657 
00658         sendSynAck();
00659         startSynRexmitTimer();
00660         if (!connEstabTimer-&gt;isScheduled())
00661             scheduleTimeout(connEstabTimer, TCP_TIMEOUT_CONN_ESTAB);
00662 
00663         <span class="comment">//"</span>
00664         <span class="comment">// Note that any other incoming control or data (combined with SYN)</span>
00665         <span class="comment">// will be processed in the SYN-RECEIVED state, but processing of SYN</span>
00666         <span class="comment">// and ACK should not be repeated.</span>
00667         <span class="comment">//"</span>
00668         <span class="comment">// We don't send text in SYN or SYN+ACK, but accept it. Otherwise</span>
00669         <span class="comment">// there isn't much left to do: RST, SYN, ACK, FIN got processed already,</span>
00670         <span class="comment">// so there's only URG and PSH left to handle.</span>
00671         <span class="comment">//</span>
00672         if (tcpseg-&gt;payloadLength()&gt;0)
00673             receiveQueue-&gt;insertBytesFromSegment(tcpseg);
00674         if (tcpseg-&gt;urgBit() || tcpseg-&gt;pshBit())
00675             tcpEV &lt;&lt; "Ignoring URG and PSH bits in SYN\n"; <span class="comment">// TBD</span>
00676 
00677         return TCP_E_RCV_SYN;  <span class="comment">// this will take us to SYN_RCVD</span>
00678     }
00679 
00680     <span class="comment">//"</span>
00681     <span class="comment">//  fourth other text or control</span>
00682     <span class="comment">//   So you are unlikely to get here, but if you do, drop the segment, and return.</span>
00683     <span class="comment">//"</span>
00684     tcpEV &lt;&lt; "Unexpected segment: dropping it\n";
00685     return TCP_E_IGNORE;
00686 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z150_3" doxytag="TCPConnection::processSegmentInSynSent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> TCPConnection::processSegmentInSynSent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00689 {
00690     <a class="code" href="_t_c_p_8h.html#a1">tcpEV2</a> &lt;&lt; <span class="stringliteral">"Processing segment in SYN_SENT\n"</span>;
00691 
00692     <span class="comment">//"</span>
00693     <span class="comment">// first check the ACK bit</span>
00694     <span class="comment">//</span>
00695     <span class="comment">//   If the ACK bit is set</span>
00696     <span class="comment">//</span>
00697     <span class="comment">//     If SEG.ACK =&lt; ISS, or SEG.ACK &gt; SND.NXT, send a reset (unless</span>
00698     <span class="comment">//     the RST bit is set, if so drop the segment and return)</span>
00699     <span class="comment">//</span>
00700     <span class="comment">//       &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
00701     <span class="comment">//</span>
00702     <span class="comment">//     and discard the segment.  Return.</span>
00703     <span class="comment">//</span>
00704     <span class="comment">//     If SND.UNA =&lt; SEG.ACK =&lt; SND.NXT then the ACK is acceptable.</span>
00705     <span class="comment">//"</span>
00706     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a14">ackBit</a>())
00707     {
00708         <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_connection_8h.html#a37">seqLE</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>(),<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o10">iss</a>) || <a class="code" href="_t_c_p_connection_8h.html#a38">seqGreater</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>(),<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>))
00709         {
00710             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"ACK bit set but wrong AckNo, sending RST\n"</span>;
00711             <a class="code" href="class_t_c_p_connection.html#a5">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>(),destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6">destPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4">srcPort</a>());
00712             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00713         }
00714         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"ACK bit set, AckNo acceptable\n"</span>;
00715     }
00716 
00717     <span class="comment">//"</span>
00718     <span class="comment">// second check the RST bit</span>
00719     <span class="comment">//</span>
00720     <span class="comment">//   If the RST bit is set</span>
00721     <span class="comment">//</span>
00722     <span class="comment">//     If the ACK was acceptable then signal the user "error:</span>
00723     <span class="comment">//     connection reset", drop the segment, enter CLOSED state,</span>
00724     <span class="comment">//     delete TCB, and return.  Otherwise (no ACK) drop the segment</span>
00725     <span class="comment">//     and return.</span>
00726     <span class="comment">//"</span>
00727     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a18">rstBit</a>())
00728     {
00729         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a14">ackBit</a>())
00730         {
00731             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"RST+ACK: performing connection reset\n"</span>;
00732             <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_CONNECTION_RESET);
00733             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a31">TCP_E_RCV_RST</a>;
00734         }
00735         <span class="keywordflow">else</span>
00736         {
00737             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"RST without ACK: dropping segment\n"</span>;
00738             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00739         }
00740     }
00741 
00742     <span class="comment">//"</span>
00743     <span class="comment">// third check the security and precedence -- not done</span>
00744     <span class="comment">//</span>
00745     <span class="comment">// fourth check the SYN bit</span>
00746     <span class="comment">//</span>
00747     <span class="comment">//   This step should be reached only if the ACK is ok, or there is</span>
00748     <span class="comment">//   no ACK, and it the segment did not contain a RST.</span>
00749     <span class="comment">//</span>
00750     <span class="comment">//   If the SYN bit is on and the security/compartment and precedence</span>
00751     <span class="comment">//   are acceptable then,</span>
00752     <span class="comment">//"</span>
00753     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a20">synBit</a>())
00754     {
00755         <span class="comment">//</span>
00756         <span class="comment">//   RCV.NXT is set to SEG.SEQ+1, IRS is set to</span>
00757         <span class="comment">//   SEG.SEQ.  SND.UNA should be advanced to equal SEG.ACK (if there</span>
00758         <span class="comment">//   is an ACK), and any segments on the retransmission queue which</span>
00759         <span class="comment">//   are thereby acknowledged should be removed.</span>
00760         <span class="comment">//</span>
00761         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>()+1;
00762         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o14">irs</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>();
00763         <a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a2">init</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>);
00764 
00765         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a14">ackBit</a>())
00766         {
00767             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>();
00768             <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a7">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>);
00769 
00770             <span class="comment">// although not mentioned in RFC 793, seems like we have to pick up</span>
00771             <span class="comment">// initial snd_wnd from the segment here.</span>
00772             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o6">snd_wnd</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a24">window</a>();
00773             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o8">snd_wl1</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>();
00774             <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o9">snd_wl2</a> = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>();
00775             <span class="keywordflow">if</span> (sndWndVector) sndWndVector-&gt;record(state-&gt;snd_wnd);
00776         }
00777 
00778         <span class="comment">// this also seems to be a good time to learn our local IP address</span>
00779         <span class="comment">// (was probably unspecified at connection open)</span>
00780         tcpMain-&gt;updateSockPair(this, destAddr, srcAddr, tcpseg-&gt;destPort(), tcpseg-&gt;srcPort());
00781 
00782         <span class="comment">//"</span>
00783         <span class="comment">//   If SND.UNA &gt; ISS (our SYN has been ACKed), change the connection</span>
00784         <span class="comment">//   state to ESTABLISHED, form an ACK segment</span>
00785         <span class="comment">//</span>
00786         <span class="comment">//     &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
00787         <span class="comment">//</span>
00788         <span class="comment">//   and send it.  Data or controls which were queued for</span>
00789         <span class="comment">//   transmission may be included.  If there are other controls or</span>
00790         <span class="comment">//   text in the segment then continue processing at the sixth step</span>
00791         <span class="comment">//   below where the URG bit is checked, otherwise return.</span>
00792         <span class="comment">//"</span>
00793         if (seqGreater(state-&gt;snd_una, state-&gt;iss))
00794         {
00795             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"SYN+ACK bits set, connection established.\n"</span>;
00796 
00797             <span class="comment">// RFC says "continue processing at the sixth step below where</span>
00798             <span class="comment">// the URG bit is checked". Those steps deal with: URG, segment text</span>
00799             <span class="comment">// (and PSH), and FIN.</span>
00800             <span class="comment">// Now: URG and PSH we don't support yet; in SYN+FIN we ignore FIN;</span>
00801             <span class="comment">// with segment text we just take it easy and put it in the receiveQueue</span>
00802             <span class="comment">// -- we'll forward it to the user when more data arrives.</span>
00803             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22">finBit</a>())
00804                 <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"SYN+ACK+FIN received: ignoring FIN\n"</span>;
00805             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>()&gt;0)
00806                 <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a3">insertBytesFromSegment</a>(tcpseg); <span class="comment">// TBD forward to app, etc.</span>
00807             <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a12">urgBit</a>() || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a16">pshBit</a>())
00808                 <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Ignoring URG and PSH bits in SYN+ACK\n"</span>; <span class="comment">// TBD</span>
00809 
00810             <span class="comment">// notify tcpAlgorithm (it has to send ACK of SYN) and app layer</span>
00811             <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a5">established</a>(<span class="keyword">true</span>);
00812             <a class="code" href="class_t_c_p_connection.html#b10">sendEstabIndicationToApp</a>();
00813 
00814             <span class="comment">// This will trigger transition to ESTABLISHED. Timers and notifying</span>
00815             <span class="comment">// app will be taken care of in stateEntered().</span>
00816             <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a28">TCP_E_RCV_SYN_ACK</a>;
00817         }
00818 
00819         <span class="comment">//"</span>
00820         <span class="comment">//   Otherwise enter SYN-RECEIVED, form a SYN,ACK segment</span>
00821         <span class="comment">//</span>
00822         <span class="comment">//     &lt;SEQ=ISS&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=SYN,ACK&gt;</span>
00823         <span class="comment">//</span>
00824         <span class="comment">//   and send it.  If there are other controls or text in the</span>
00825         <span class="comment">//   segment, queue them for processing after the ESTABLISHED state</span>
00826         <span class="comment">//   has been reached, return.</span>
00827         <span class="comment">//"</span>
00828         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"SYN bit set: sending SYN+ACK\n"</span>;
00829         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o10">iss</a>;
00830         <a class="code" href="class_t_c_p_connection.html#b6">sendSynAck</a>();
00831         <a class="code" href="class_t_c_p_connection.html#a9">startSynRexmitTimer</a>();
00832 
00833         <span class="comment">// Note: code below is similar to processing SYN in LISTEN.</span>
00834 
00835         <span class="comment">// For consistency with that code, we ignore SYN+FIN here</span>
00836         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a22">finBit</a>())
00837             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"SYN+FIN received: ignoring FIN\n"</span>;
00838 
00839         <span class="comment">// We don't send text in SYN or SYN+ACK, but accept it. Otherwise</span>
00840         <span class="comment">// there isn't much left to do: RST, SYN, ACK, FIN got processed already,</span>
00841         <span class="comment">// so there's only URG and PSH left to handle.</span>
00842         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>()&gt;0)
00843             <a class="code" href="class_t_c_p_connection.html#p4">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a3">insertBytesFromSegment</a>(tcpseg);
00844         <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a12">urgBit</a>() || tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a16">pshBit</a>())
00845             <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Ignoring URG and PSH bits in SYN\n"</span>; <span class="comment">// TBD</span>
00846         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a27">TCP_E_RCV_SYN</a>;
00847     }
00848 
00849     <span class="comment">//"</span>
00850     <span class="comment">// fifth, if neither of the SYN or RST bits is set then drop the</span>
00851     <span class="comment">// segment and return.</span>
00852     <span class="comment">//"</span>
00853     <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00854 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="TCPConnection::processTCPSegment"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TCPConnection::processTCPSegment           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpSeg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>srcAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>destAddr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Process incoming <a class="el" href="class_t_c_p.html">TCP</a> segment. Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="class_t_c_p.html">TCP</a>). <div class="fragment"><pre class="fragment">00209 {
00210     <a class="code" href="class_t_c_p_connection.html#a12">printConnBrief</a>();
00211     <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#o2">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#z36_0">isUnspecified</a>())
00212     {
00213         ASSERT(localAddr==segDestAddr);
00214         ASSERT(localPort==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6">destPort</a>());
00215     }
00216     <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#o3">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#z36_0">isUnspecified</a>())
00217     {
00218         ASSERT(remoteAddr==segSrcAddr);
00219         ASSERT(remotePort==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4">srcPort</a>());
00220     }
00221 
00222     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#z150_0">tryFastRoute</a>(tcpseg))
00223         return true;
00224 
00225     <span class="comment">// first do actions</span>
00226     TCPEventCode event = process_RCV_SEGMENT(tcpseg, segSrcAddr, segDestAddr);
00227 
00228     <span class="comment">// then state transitions</span>
00229     return performStateTransition(event);
00230 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="TCPConnection::processTimer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TCPConnection::processTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Process self-messages (timers). Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="class_t_c_p.html">TCP</a>). <div class="fragment"><pre class="fragment">00172 {
00173     <a class="code" href="class_t_c_p_connection.html#a12">printConnBrief</a>();
00174     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; msg-&gt;name() &lt;&lt; <span class="stringliteral">" timer expired\n"</span>;
00175 
00176     <span class="comment">// first do actions</span>
00177     <a class="code" href="_t_c_p_connection_8h.html#a41">TCPEventCode</a> event;
00178     <span class="keywordflow">if</span> (msg==the2MSLTimer)
00179     {
00180         event = <a class="code" href="_t_c_p_connection_8h.html#a41a33">TCP_E_TIMEOUT_2MSL</a>;
00181         <a class="code" href="class_t_c_p_connection.html#z152_0">process_TIMEOUT_2MSL</a>();
00182     }
00183     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==connEstabTimer)
00184     {
00185         event = <a class="code" href="_t_c_p_connection_8h.html#a41a34">TCP_E_TIMEOUT_CONN_ESTAB</a>;
00186         <a class="code" href="class_t_c_p_connection.html#z152_1">process_TIMEOUT_CONN_ESTAB</a>();
00187     }
00188     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==finWait2Timer)
00189     {
00190         event = <a class="code" href="_t_c_p_connection_8h.html#a41a35">TCP_E_TIMEOUT_FIN_WAIT_2</a>;
00191         <a class="code" href="class_t_c_p_connection.html#z152_2">process_TIMEOUT_FIN_WAIT_2</a>();
00192     }
00193     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==synRexmitTimer)
00194     {
00195         event = <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00196         <a class="code" href="class_t_c_p_connection.html#z152_3">process_TIMEOUT_SYN_REXMIT</a>(event);
00197     }
00198     <span class="keywordflow">else</span>
00199     {
00200         event = <a class="code" href="_t_c_p_connection_8h.html#a41a18">TCP_E_IGNORE</a>;
00201         <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a7">processTimer</a>(msg, event);
00202     }
00203 
00204     <span class="comment">// then state transitions</span>
00205     <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#z146_1">performStateTransition</a>(event);
00206 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="TCPConnection::retransmitData"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::retransmitData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: retransmit all from snd_una to snd_max <div class="fragment"><pre class="fragment">00582 {
00583     <span class="comment">// retransmit everything from snd_una</span>
00584     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>;
00585 
00586     <a class="code" href="_i_n_e_t_defs_8h.html#a5">ulong</a> bytesToSend = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>;
00587     ASSERT(bytesToSend!=0);
00588 
00589     <span class="keywordflow">while</span> (bytesToSend&gt;0)
00590     {
00591         <a class="code" href="_i_n_e_t_defs_8h.html#a5">ulong</a> bytes = Min(bytesToSend, <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o2">snd_mss</a>);
00592         <a class="code" href="class_t_c_p_connection.html#a7">sendSegment</a>(bytes);
00593         bytesToSend -= bytes;
00594     }
00595 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="TCPConnection::retransmitOneSegment"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::retransmitOneSegment           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: retransmit one segment from snd_una <div class="fragment"><pre class="fragment">00568 {
00569     <span class="comment">// retransmit one segment at snd_una, and set snd_nxt accordingly</span>
00570     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a>;
00571 
00572     <a class="code" href="_i_n_e_t_defs_8h.html#a5">ulong</a> bytes = Min(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o2">snd_mss</a>, <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>);
00573     ASSERT(bytes!=0);
00574 
00575     <a class="code" href="class_t_c_p_connection.html#a7">sendSegment</a>(bytes);
00576 
00577     <span class="comment">// notify</span>
00578     <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a14">ackSent</a>();
00579 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="TCPConnection::scheduleTimeout"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::scheduleTimeout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>simtime_t&nbsp;</td>
          <td class="mdname" nowrap> <em>timeout</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: start a timer <div class="fragment"><pre class="fragment">00408         {<a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;scheduleAt(<a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;simTime()+timeout, msg);}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e6" doxytag="TCPConnection::segmentArrivalWhileClosed"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::segmentArrivalWhileClosed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Static function, invoked from <a class="el" href="class_t_c_p.html">TCP</a> when a segment arrives which doesn't belong to an existing connection. <div class="fragment"><pre class="fragment">00037 {
00038     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Seg arrived: "</span>;
00039     <a class="code" href="class_t_c_p_connection.html#e2">printSegmentBrief</a>(tcpseg);
00040 
00041     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Segment doesn't belong to any existing connection\n"</span>;
00042 
00043     <span class="comment">// RFC 793:</span>
00044     <span class="comment">//"</span>
00045     <span class="comment">// all data in the incoming segment is discarded.  An incoming</span>
00046     <span class="comment">// segment containing a RST is discarded.  An incoming segment not</span>
00047     <span class="comment">// containing a RST causes a RST to be sent in response.  The</span>
00048     <span class="comment">// acknowledgment and sequence field values are selected to make the</span>
00049     <span class="comment">// reset sequence acceptable to the TCP that sent the offending</span>
00050     <span class="comment">// segment.</span>
00051     <span class="comment">//</span>
00052     <span class="comment">// If the ACK bit is off, sequence number zero is used,</span>
00053     <span class="comment">//</span>
00054     <span class="comment">//    &lt;SEQ=0&gt;&lt;ACK=SEG.SEQ+SEG.LEN&gt;&lt;CTL=RST,ACK&gt;</span>
00055     <span class="comment">//</span>
00056     <span class="comment">// If the ACK bit is on,</span>
00057     <span class="comment">//</span>
00058     <span class="comment">//    &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
00059     <span class="comment">//"</span>
00060     <span class="keywordflow">if</span> (tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a18">rstBit</a>())
00061     {
00062         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"RST bit set: dropping segment\n"</span>;
00063         <span class="keywordflow">return</span>;
00064     }
00065 
00066     <span class="keywordflow">if</span> (!tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a14">ackBit</a>())
00067     {
00068         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"ACK bit not set: sending RST+ACK\n"</span>;
00069         <a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a> ackNo = tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>() + (<a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a>)tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>();
00070         <a class="code" href="class_t_c_p_connection.html#e1">sendRstAck</a>(0,ackNo,destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6">destPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4">srcPort</a>());
00071     }
00072     <span class="keywordflow">else</span>
00073     {
00074         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"ACK bit set: sending RST\n"</span>;
00075         <a class="code" href="class_t_c_p_connection.html#a5">sendRst</a>(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a10">ackNo</a>(),destAddr,srcAddr,tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a6">destPort</a>(),tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a4">srcPort</a>());
00076     }
00077 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="TCPConnection::selectInitialSeqNum"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::selectInitialSeqNum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: generates ISS and initializes corresponding state variables <div class="fragment"><pre class="fragment">00308 {
00309     <span class="comment">// set the initial send sequence number</span>
00310     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o10">iss</a> = (<span class="keywordtype">unsigned</span> long)(fmod(<a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;simTime()*250000.0, 1.0+(double)(unsigned)0xffffffffUL)) &amp; 0xffffffffUL;
00311 
00312     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o3">snd_una</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o10">iss</a>;
00313 
00314     <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a2">init</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o10">iss</a>+1); <span class="comment">// +1 is for SYN</span>
00315 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="TCPConnection::sendAck"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendAck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: send ACK <div class="fragment"><pre class="fragment">00396 {
00397     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <span class="keyword">new</span> <a class="code" href="class_t_c_p_segment.html">TCPSegment</a>(<span class="stringliteral">"ACK"</span>);
00398 
00399     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a15">setAckBit</a>(<span class="keyword">true</span>);
00400     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9">setSequenceNo</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>);
00401     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a11">setAckNo</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>);
00402     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a25">setWindow</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o12">rcv_wnd</a>);
00403 
00404     <span class="comment">// send it</span>
00405     <a class="code" href="class_t_c_p_connection.html#a8">sendToIP</a>(tcpseg);
00406 
00407     <span class="comment">// notify</span>
00408     <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a14">ackSent</a>();
00409 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="TCPConnection::sendData"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TCPConnection::sendData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">bool&nbsp;</td>
          <td class="mdname" nowrap> <em>fullSegmentsOnly</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>congestionWindow</em> = <code>-1</code></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: Send data from sendQueue, at most congestionWindow (-1 means no limit). FIXME adjust comment!!! If fullSegmentsOnly is set, don't send segments smaller than MSS (needed for Nagle). Returns true if some data was actually sent. <div class="fragment"><pre class="fragment">00454 {
00455     <span class="comment">// we'll start sending from snd_max</span>
00456     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>;
00457 
00458     <span class="comment">// check how many bytes we have</span>
00459     <a class="code" href="_i_n_e_t_defs_8h.html#a5">ulong</a> buffered = <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a5">bytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>);
00460     <span class="keywordflow">if</span> (buffered==0)
00461         return false;
00462 
00463     <span class="comment">// maxWindow is smaller of (snd_wnd, congestionWindow)</span>
00464     <span class="keywordtype">long</span> maxWindow = state-&gt;snd_wnd;
00465     if (congestionWindow&gt;=0 &amp;&amp; maxWindow &gt; congestionWindow)
00466         maxWindow = congestionWindow;
00467 
00468     <span class="comment">// effectiveWindow: number of bytes we're allowed to send now</span>
00469     <span class="keywordtype">long</span> effectiveWin = maxWindow - (state-&gt;snd_nxt - state-&gt;snd_una);
00470     if (effectiveWin &lt;= 0)
00471     {
00472         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Effective window is zero (advertised window "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o6">snd_wnd</a> &lt;&lt;
00473                  <span class="stringliteral">", congestion window "</span> &lt;&lt; congestionWindow &lt;&lt; <span class="stringliteral">"), cannot send.\n"</span>;
00474         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00475     }
00476 
00477     <a class="code" href="_i_n_e_t_defs_8h.html#a5">ulong</a> bytesToSend = effectiveWin;
00478 
00479     <span class="keywordflow">if</span> (bytesToSend &gt; buffered)
00480         bytesToSend = buffered;
00481 
00482     if (fullSegmentsOnly &amp;&amp; bytesToSend &lt; state-&gt;snd_mss)
00483     {
00484         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Cannot send, not enough data for a full segment (MSS="</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o2">snd_mss</a>
00485               &lt;&lt; <span class="stringliteral">", in buffer "</span> &lt;&lt; buffered &lt;&lt; <span class="stringliteral">")\n"</span>;
00486         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00487     }
00488 
00489     <span class="comment">// start sending 'bytesToSend' bytes</span>
00490     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Will send "</span> &lt;&lt; bytesToSend &lt;&lt; <span class="stringliteral">" bytes (effectiveWindow "</span> &lt;&lt; effectiveWin
00491           &lt;&lt; <span class="stringliteral">", in buffer "</span> &lt;&lt; buffered &lt;&lt; <span class="stringliteral">" bytes)\n"</span>;
00492 
00493     <a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a> old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>;
00494     ASSERT(bytesToSend&gt;0);
00495 
00496 <span class="preprocessor">#ifdef TCP_SENDFRAGMENTS  </span><span class="comment">/* normally undefined */</span>
00497     <span class="comment">// make agressive use of the window until the last byte</span>
00498     <span class="keywordflow">while</span> (bytesToSend&gt;0)
00499     {
00500         <a class="code" href="_i_n_e_t_defs_8h.html#a5">ulong</a> bytes = Min(bytesToSend, <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o2">snd_mss</a>);
00501         <a class="code" href="class_t_c_p_connection.html#a7">sendSegment</a>(bytes);
00502         bytesToSend -= bytes;
00503     }
00504 <span class="preprocessor">#else</span>
00505 <span class="preprocessor"></span>    <span class="comment">// send &lt;MSS segments only if it's the only segment we can send now</span>
00506     <span class="comment">// FIXME this should probably obey Nagle's alg -- to be checked</span>
00507     <span class="keywordflow">if</span> (bytesToSend &lt;= state-&gt;snd_mss)
00508     {
00509         <a class="code" href="class_t_c_p_connection.html#a7">sendSegment</a>(bytesToSend);
00510     }
00511     <span class="keywordflow">else</span>
00512     {
00513         <span class="comment">// send whole segments only</span>
00514         <span class="keywordflow">while</span> (bytesToSend&gt;=<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o2">snd_mss</a>)
00515         {
00516             <a class="code" href="class_t_c_p_connection.html#a7">sendSegment</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o2">snd_mss</a>);
00517             bytesToSend -= <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o2">snd_mss</a>;
00518         }
00519         <span class="keywordflow">if</span> (bytesToSend&gt;0)
00520            tcpEV &lt;&lt; bytesToSend &lt;&lt; " bytes of space left in effectiveWindow\n";
00521     }
00522 #endif
00523 
00524     <span class="comment">// remember highest seq sent (snd_nxt may be set back on retransmission,</span>
00525     <span class="comment">// but we'll need snd_max to check validity of ACKs -- they must ack</span>
00526     <span class="comment">// something we really sent)</span>
00527     state-&gt;snd_max = state-&gt;snd_nxt;
00528     if (unackedVector) unackedVector-&gt;record(state-&gt;snd_max - state-&gt;snd_una);
00529 
00530     <span class="comment">// notify (once is enough)</span>
00531     tcpAlgorithm-&gt;ackSent();
00532     tcpAlgorithm-&gt;dataSent(old_snd_nxt);
00533 
00534     return true;
00535 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b10" doxytag="TCPConnection::sendEstabIndicationToApp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendEstabIndicationToApp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: sends TCP_I_ESTABLISHED indication with <a class="el" href="class_t_c_p_connect_info.html">TCPConnectInfo</a> to application <div class="fragment"><pre class="fragment">00254 {
00255     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Notifying app: "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e5">indicationName</a>(TCP_I_ESTABLISHED) &lt;&lt; <span class="stringliteral">"\n"</span>;
00256     cMessage *msg = <span class="keyword">new</span> cMessage(<a class="code" href="class_t_c_p_connection.html#e5">indicationName</a>(TCP_I_ESTABLISHED));
00257     msg-&gt;setKind(TCP_I_ESTABLISHED);
00258 
00259     <a class="code" href="class_t_c_p_connect_info.html">TCPConnectInfo</a> *ind = <span class="keyword">new</span> <a class="code" href="class_t_c_p_connect_info.html">TCPConnectInfo</a>();
00260     ind-&gt;<a class="code" href="class_t_c_p_command.html#a7">setConnId</a>(connId);
00261     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#a8">setLocalAddr</a>(localAddr);
00262     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#a11">setRemoteAddr</a>(remoteAddr);
00263     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#a13">setLocalPort</a>(localPort);
00264     ind-&gt;<a class="code" href="class_t_c_p_connect_info.html#a15">setRemotePort</a>(remotePort);
00265 
00266     msg-&gt;setControlInfo(ind);
00267     <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;send(msg, <span class="stringliteral">"to_appl"</span>, appGateIndex);
00268 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="TCPConnection::sendFin"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendFin           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: sends FIN <div class="fragment"><pre class="fragment">00412 {
00413     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <span class="keyword">new</span> <a class="code" href="class_t_c_p_segment.html">TCPSegment</a>(<span class="stringliteral">"FIN"</span>);
00414 
00415     <span class="comment">// Note: ACK bit *must* be set for both FIN and FIN+ACK. What makes</span>
00416     <span class="comment">// the difference for FIN+ACK is that its ackNo acks the remote TCP's FIN.</span>
00417     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a23">setFinBit</a>(<span class="keyword">true</span>);
00418     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a15">setAckBit</a>(<span class="keyword">true</span>);
00419     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a11">setAckNo</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>);
00420     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9">setSequenceNo</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>);
00421     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a25">setWindow</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o12">rcv_wnd</a>);
00422 
00423     <span class="comment">// send it</span>
00424     <a class="code" href="class_t_c_p_connection.html#a8">sendToIP</a>(tcpseg);
00425 
00426     <span class="comment">// notify</span>
00427     <a class="code" href="class_t_c_p_connection.html#p5">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a14">ackSent</a>();
00428 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="TCPConnection::sendIndicationToApp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendIndicationToApp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>code</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: sends status indication (TCP_I_xxx) to application <div class="fragment"><pre class="fragment">00243 {
00244     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Notifying app: "</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#e5">indicationName</a>(code) &lt;&lt; <span class="stringliteral">"\n"</span>;
00245     cMessage *msg = <span class="keyword">new</span> cMessage(<a class="code" href="class_t_c_p_connection.html#e5">indicationName</a>(code));
00246     msg-&gt;setKind(code);
00247     <a class="code" href="class_t_c_p_command.html">TCPCommand</a> *ind = <span class="keyword">new</span> <a class="code" href="class_t_c_p_command.html">TCPCommand</a>();
00248     ind-&gt;<a class="code" href="class_t_c_p_command.html#a7">setConnId</a>(connId);
00249     msg-&gt;setControlInfo(ind);
00250     <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;send(msg, <span class="stringliteral">"to_appl"</span>, appGateIndex);
00251 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="TCPConnection::sendProbe"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TCPConnection::sendProbe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: sends 1 bytes as "probe", called by the "persist" mechanism <div class="fragment"><pre class="fragment">00538 {
00539     <span class="comment">// we'll start sending from snd_max</span>
00540     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a>;
00541 
00542     <span class="comment">// check we have 1 byte to send</span>
00543     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a5">bytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>)==0)
00544     {
00545         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Cannot send probe because send buffer is empty\n"</span>;
00546         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00547     }
00548 
00549     <a class="code" href="_i_n_e_t_defs_8h.html#a6">uint32</a> old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>;
00550 
00551     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Sending 1 byte as probe, with seq="</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00552     <a class="code" href="class_t_c_p_connection.html#a7">sendSegment</a>(1);
00553 
00554     <span class="comment">// remember highest seq sent (snd_nxt may be set back on retransmission,</span>
00555     <span class="comment">// but we'll need snd_max to check validity of ACKs -- they must ack</span>
00556     <span class="comment">// something we really sent)</span>
00557     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>;
00558     <span class="keywordflow">if</span> (unackedVector) unackedVector-&gt;record(state-&gt;snd_max - state-&gt;snd_una);
00559 
00560     <span class="comment">// notify</span>
00561     tcpAlgorithm-&gt;ackSent();
00562     tcpAlgorithm-&gt;dataSent(old_snd_nxt);
00563 
00564     return true;
00565 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e0" doxytag="TCPConnection::sendRst"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendRst           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_i_n_e_t_defs_8h.html#a6">uint32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>seq</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>srcPort</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>destPort</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: sends RST (called from <a class="el" href="class_t_c_p.html">TCP</a>) <div class="fragment"><pre class="fragment">00366 {
00367     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <span class="keyword">new</span> <a class="code" href="class_t_c_p_segment.html">TCPSegment</a>(<span class="stringliteral">"RST"</span>);
00368 
00369     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a5">setSrcPort</a>(srcPort);
00370     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7">setDestPort</a>(destPort);
00371 
00372     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a19">setRstBit</a>(<span class="keyword">true</span>);
00373     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9">setSequenceNo</a>(seq);
00374 
00375     <span class="comment">// send it</span>
00376     <a class="code" href="class_t_c_p_connection.html#a8">sendToIP</a>(tcpseg, src, dest);
00377 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="TCPConnection::sendRst"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendRst           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_i_n_e_t_defs_8h.html#a6">uint32</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>seqNo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: sends RST <div class="fragment"><pre class="fragment">00361 {
00362     <a class="code" href="class_t_c_p_connection.html#a5">sendRst</a>(seqNo, localAddr, remoteAddr, localPort, remotePort);
00363 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e1" doxytag="TCPConnection::sendRstAck"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendRstAck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="_i_n_e_t_defs_8h.html#a6">uint32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>seq</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="_i_n_e_t_defs_8h.html#a6">uint32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ack</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>srcPort</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>destPort</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: sends RST+ACK (called from <a class="el" href="class_t_c_p.html">TCP</a>) <div class="fragment"><pre class="fragment">00380 {
00381     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <span class="keyword">new</span> <a class="code" href="class_t_c_p_segment.html">TCPSegment</a>(<span class="stringliteral">"RST+ACK"</span>);
00382 
00383     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a5">setSrcPort</a>(srcPort);
00384     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a7">setDestPort</a>(destPort);
00385 
00386     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a19">setRstBit</a>(<span class="keyword">true</span>);
00387     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a15">setAckBit</a>(<span class="keyword">true</span>);
00388     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9">setSequenceNo</a>(seq);
00389     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a11">setAckNo</a>(ack);
00390 
00391     <span class="comment">// send it</span>
00392     <a class="code" href="class_t_c_p_connection.html#a8">sendToIP</a>(tcpseg, src, dest);
00393 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="TCPConnection::sendSegment"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendSegment           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>bytes</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: sends one segment of 'bytes' bytes from snd_nxt, and advances snd_nxt. <a class="el" href="class_t_c_p_connection.html#a1">sendData()</a>, <a class="el" href="class_t_c_p_connection.html#a2">sendProbe()</a> and <a class="el" href="class_t_c_p_connection.html#a4">retransmitData()</a> internally all rely on this one. <div class="fragment"><pre class="fragment">00431 {
00432     <span class="comment">// send one segment of 'bytes' bytes from snd_nxt, and advance snd_nxt</span>
00433     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#p3">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a6">createSegmentWithBytes</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>, bytes);
00434     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a11">setAckNo</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>);
00435     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a15">setAckBit</a>(<span class="keyword">true</span>);
00436     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a25">setWindow</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o12">rcv_wnd</a>);
00437     <span class="comment">// TBD when to set PSH bit?</span>
00438     <span class="comment">// TBD set URG bit if needed</span>
00439     ASSERT(bytes==tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>());
00440 
00441     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> += bytes;
00442 
00443     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o19">send_fin</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o20">snd_fin_seq</a>)
00444     {
00445         <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Setting FIN on segment\n"</span>;
00446         tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a23">setFinBit</a>(<span class="keyword">true</span>);
00447         <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o20">snd_fin_seq</a>+1;
00448     }
00449 
00450     <a class="code" href="class_t_c_p_connection.html#a8">sendToIP</a>(tcpseg);
00451 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="TCPConnection::sendSyn"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendSyn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: send SYN <div class="fragment"><pre class="fragment">00326 {
00327     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#o3">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#z36_0">isUnspecified</a>() || <a class="code" href="class_t_c_p_connection.html#o5">remotePort</a>==-1)
00328         opp_error(<span class="stringliteral">"Error processing command OPEN_ACTIVE: foreign socket unspecified"</span>);
00329     <span class="keywordflow">if</span> (localPort==-1)
00330         opp_error("Error processing command OPEN_ACTIVE: local port unspecified");
00331 
00332     <span class="comment">// create segment</span>
00333     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = new <a class="code" href="class_t_c_p_segment.html">TCPSegment</a>("SYN");
00334     tcpseg-&gt;setSequenceNo(state-&gt;iss);
00335     tcpseg-&gt;setSynBit(true);
00336     tcpseg-&gt;setWindow(state-&gt;rcv_wnd);
00337 
00338     state-&gt;snd_max = state-&gt;snd_nxt = state-&gt;iss+1;
00339 
00340     <span class="comment">// send it</span>
00341     sendToIP(tcpseg);
00342 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="TCPConnection::sendSynAck"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendSynAck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: send SYN+ACK <div class="fragment"><pre class="fragment">00345 {
00346     <span class="comment">// create segment</span>
00347     <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <span class="keyword">new</span> <a class="code" href="class_t_c_p_segment.html">TCPSegment</a>(<span class="stringliteral">"SYN+ACK"</span>);
00348     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a9">setSequenceNo</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o10">iss</a>);
00349     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a11">setAckNo</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o11">rcv_nxt</a>);
00350     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a21">setSynBit</a>(<span class="keyword">true</span>);
00351     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a15">setAckBit</a>(<span class="keyword">true</span>);
00352     tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a25">setWindow</a>(<a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o12">rcv_wnd</a>);
00353 
00354     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o5">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o4">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o10">iss</a>+1;
00355 
00356     <span class="comment">// send it</span>
00357     <a class="code" href="class_t_c_p_connection.html#a8">sendToIP</a>(tcpseg);
00358 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b8" doxytag="TCPConnection::sendToApp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendToApp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: sends packet to application <div class="fragment"><pre class="fragment">00271 {
00272     <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;send(msg, <span class="stringliteral">"to_appl"</span>, appGateIndex);
00273 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f0" doxytag="TCPConnection::sendToIP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendToIP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static, protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: send <a class="el" href="class_i_p.html">IP</a> packet <div class="fragment"><pre class="fragment">00209 {
00210     <a class="code" href="_t_c_p_8h.html#a0">tcpEV</a> &lt;&lt; <span class="stringliteral">"Sending: "</span>;
00211     <a class="code" href="class_t_c_p_connection.html#e2">printSegmentBrief</a>(tcpseg);
00212 
00213     <span class="keywordflow">if</span> (!dest.<a class="code" href="class_i_pv_x_address.html#z35_0">isIPv6</a>())
00214     {
00215         <span class="comment">// send over IPv4</span>
00216         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
00217         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a12">setProtocol</a>(IP_PROT_TCP);
00218         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8">setSrcAddr</a>(src.<a class="code" href="class_i_pv_x_address.html#z35_1">get4</a>());
00219         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a5">setDestAddr</a>(dest.<a class="code" href="class_i_pv_x_address.html#z35_1">get4</a>());
00220         tcpseg-&gt;setControlInfo(controlInfo);
00221 
00222         check_and_cast&lt;TCP *&gt;(simulation.contextModule())-&gt;send(tcpseg,<span class="stringliteral">"to_ip"</span>);
00223     }
00224     <span class="keywordflow">else</span>
00225     {
00226         <span class="comment">// send over IPv6</span>
00227         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
00228         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a4">setProtocol</a>(IP_PROT_TCP);
00229         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a10">setSrcAddr</a>(src.<a class="code" href="class_i_pv_x_address.html#z35_2">get6</a>());
00230         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a7">setDestAddr</a>(dest.<a class="code" href="class_i_pv_x_address.html#z35_2">get6</a>());
00231         tcpseg-&gt;setControlInfo(controlInfo);
00232 
00233         check_and_cast&lt;TCP *&gt;(simulation.contextModule())-&gt;send(tcpseg,<span class="stringliteral">"to_ipv6"</span>);
00234     }
00235 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="TCPConnection::sendToIP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::sendToIP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tcpseg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: adds control info to segment and sends it to <a class="el" href="class_i_p.html">IP</a> <div class="fragment"><pre class="fragment">00167 {
00168     <span class="comment">// record seq (only if we do send data) and ackno</span>
00169     <span class="keywordflow">if</span> (sndNxtVector &amp;&amp; tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a28">payloadLength</a>()!=0)
00170         <a class="code" href="class_t_c_p_connection.html#p11">sndNxtVector</a>-&gt;record(tcpseg-&gt;<a class="code" href="class_t_c_p_segment___base.html#a8">sequenceNo</a>());
00171     <span class="keywordflow">if</span> (sndAckVector) sndAckVector-&gt;record(tcpseg-&gt;ackNo());
00172 
00173     <span class="comment">// final touches on the segment before sending</span>
00174     tcpseg-&gt;setSrcPort(localPort);
00175     tcpseg-&gt;setDestPort(remotePort);
00176     tcpseg-&gt;setByteLength(TCP_HEADER_OCTETS+tcpseg-&gt;payloadLength());
00177     <span class="comment">// TBD account for Options (once they get implemented)</span>
00178 
00179     tcpEV &lt;&lt; "Sending: ";
00180     printSegmentBrief(tcpseg);
00181 
00182     <span class="comment">// TBD reuse next function for sending</span>
00183 
00184     if (!remoteAddr.isIPv6())
00185     {
00186         <span class="comment">// send over IPv4</span>
00187         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
00188         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a12">setProtocol</a>(IP_PROT_TCP);
00189         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8">setSrcAddr</a>(<a class="code" href="class_t_c_p_connection.html#o2">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#z35_1">get4</a>());
00190         controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a5">setDestAddr</a>(<a class="code" href="class_t_c_p_connection.html#o3">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#z35_1">get4</a>());
00191         tcpseg-&gt;setControlInfo(controlInfo);
00192 
00193         <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;send(tcpseg,<span class="stringliteral">"to_ip"</span>);
00194     }
00195     <span class="keywordflow">else</span>
00196     {
00197         <span class="comment">// send over IPv6</span>
00198         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
00199         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a4">setProtocol</a>(IP_PROT_TCP);
00200         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a10">setSrcAddr</a>(<a class="code" href="class_t_c_p_connection.html#o2">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#z35_2">get6</a>());
00201         controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a7">setDestAddr</a>(<a class="code" href="class_t_c_p_connection.html#o3">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#z35_2">get6</a>());
00202         tcpseg-&gt;setControlInfo(controlInfo);
00203 
00204         <a class="code" href="class_t_c_p_connection.html#p0">tcpMain</a>-&gt;send(tcpseg,<span class="stringliteral">"to_ipv6"</span>);
00205     }
00206 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="TCPConnection::signalConnectionTimeout"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::signalConnectionTimeout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: signal to user that connection timed out <div class="fragment"><pre class="fragment">00238 {
00239     <a class="code" href="class_t_c_p_connection.html#b9">sendIndicationToApp</a>(TCP_I_TIMED_OUT);
00240 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="TCPConnection::startSynRexmitTimer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::startSynRexmitTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: start SYN-REXMIT timer <div class="fragment"><pre class="fragment">01060 {
01061     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o16">syn_rexmit_count</a> = 0;
01062     <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o17">syn_rexmit_timeout</a> = <a class="code" href="_t_c_p_connection_8h.html#a3">TCP_TIMEOUT_SYN_REXMIT</a>;
01063 
01064     <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#p9">synRexmitTimer</a>-&gt;isScheduled())
01065         <a class="code" href="class_t_c_p_connection.html#b7">cancelEvent</a>(synRexmitTimer);
01066     <a class="code" href="class_t_c_p_connection.html#a11">scheduleTimeout</a>(synRexmitTimer, <a class="code" href="class_t_c_p_connection.html#p2">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#o17">syn_rexmit_timeout</a>);
01067 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z146_2" doxytag="TCPConnection::stateEntered"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TCPConnection::stateEntered           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>state</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Perform cleanup necessary when entering a new state, e.g. cancelling timers <div class="fragment"><pre class="fragment">00437 {
00438     <span class="comment">// cancel timers</span>
00439     <span class="keywordflow">switch</span> (state)
00440     {
00441         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a6">TCP_S_INIT</a>:
00442             <span class="comment">// we'll never get back to INIT</span>
00443             <span class="keywordflow">break</span>;
00444         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a8">TCP_S_LISTEN</a>:
00445             <span class="comment">// we may get back to LISTEN from SYN_RCVD</span>
00446             ASSERT(connEstabTimer &amp;&amp; synRexmitTimer);
00447             <a class="code" href="class_t_c_p_connection.html#b7">cancelEvent</a>(connEstabTimer);
00448             <a class="code" href="class_t_c_p_connection.html#b7">cancelEvent</a>(synRexmitTimer);
00449             <span class="keywordflow">break</span>;
00450         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a10">TCP_S_SYN_RCVD</a>:
00451         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a9">TCP_S_SYN_SENT</a>:
00452             <span class="keywordflow">break</span>;
00453         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a11">TCP_S_ESTABLISHED</a>:
00454             <span class="comment">// we're in ESTABLISHED, these timers are no longer needed</span>
00455             <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#b7">cancelEvent</a>(connEstabTimer);
00456             <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#b7">cancelEvent</a>(synRexmitTimer);
00457             <a class="code" href="class_t_c_p_connection.html#p7">connEstabTimer</a> = <a class="code" href="class_t_c_p_connection.html#p9">synRexmitTimer</a> = NULL;
00458             <span class="comment">// TCP_I_ESTAB notification moved inside event processing</span>
00459             <span class="keywordflow">break</span>;
00460         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a12">TCP_S_CLOSE_WAIT</a>:
00461         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a13">TCP_S_LAST_ACK</a>:
00462         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a14">TCP_S_FIN_WAIT_1</a>:
00463         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a15">TCP_S_FIN_WAIT_2</a>:
00464         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a16">TCP_S_CLOSING</a>:
00465         <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a40a17">TCP_S_TIME_WAIT</a>:
00466             <span class="comment">// whether connection setup succeeded (ESTABLISHED) or not (others),</span>
00467             <span class="comment">// cancel these timers</span>
00468             <span class="keywordflow">if</span> (connEstabTimer) cancelEvent(connEstabTimer);
00469             if (synRexmitTimer) cancelEvent(synRexmitTimer);
00470             break;
00471         case TCP_S_CLOSED:
00472             <span class="comment">// all timers need to be cancelled</span>
00473             if (the2MSLTimer)   cancelEvent(the2MSLTimer);
00474             if (connEstabTimer) cancelEvent(connEstabTimer);
00475             if (finWait2Timer)  cancelEvent(finWait2Timer);
00476             if (synRexmitTimer) cancelEvent(synRexmitTimer);
00477             tcpAlgorithm-&gt;connectionClosed();
00478             break;
00479     }
00480 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e3" doxytag="TCPConnection::stateName"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char * TCPConnection::stateName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>state</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: returns name of TCP_S_xxx constants <div class="fragment"><pre class="fragment">00037 {
00038 <span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
00039 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">"unknown"</span>;
00040     <span class="keywordflow">switch</span> (state)
00041     {
00042         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_INIT);
00043         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_CLOSED);
00044         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_LISTEN);
00045         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_SYN_SENT);
00046         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_SYN_RCVD);
00047         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_ESTABLISHED);
00048         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_CLOSE_WAIT);
00049         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_LAST_ACK);
00050         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_FIN_WAIT_1);
00051         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_FIN_WAIT_2);
00052         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_CLOSING);
00053         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TCP_S_TIME_WAIT);
00054     }
00055     <span class="keywordflow">return</span> s;
00056 <span class="preprocessor">#undef CASE</span>
00057 <span class="preprocessor"></span>}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z150_0" doxytag="TCPConnection::tryFastRoute"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool TCPConnection::tryFastRoute           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tcpseg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Shortcut to process most common case as fast as possible. Returns false if segment requires normal (slow) route. <div class="fragment"><pre class="fragment">00030 {
00031     <span class="comment">// fast route processing not yet implemented</span>
00032     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00033 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="o0" doxytag="TCPConnection::appGateIndex"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_t_c_p_connection.html#o0">TCPConnection::appGateIndex</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p7" doxytag="TCPConnection::connEstabTimer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage* <a class="el" href="class_t_c_p_connection.html#p7">TCPConnection::connEstabTimer</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="o1" doxytag="TCPConnection::connId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_t_c_p_connection.html#o1">TCPConnection::connId</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p8" doxytag="TCPConnection::finWait2Timer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage* <a class="el" href="class_t_c_p_connection.html#p8">TCPConnection::finWait2Timer</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="TCPConnection::fsm"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cFSM <a class="el" href="class_t_c_p_connection.html#p1">TCPConnection::fsm</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="o2" doxytag="TCPConnection::localAddr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="class_t_c_p_connection.html#o2">TCPConnection::localAddr</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="o4" doxytag="TCPConnection::localPort"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_t_c_p_connection.html#o4">TCPConnection::localPort</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p14" doxytag="TCPConnection::rcvAckVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector* <a class="el" href="class_t_c_p_connection.html#p14">TCPConnection::rcvAckVector</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p13" doxytag="TCPConnection::rcvSeqVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector* <a class="el" href="class_t_c_p_connection.html#p13">TCPConnection::rcvSeqVector</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="TCPConnection::receiveQueue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a>* <a class="el" href="class_t_c_p_connection.html#p4">TCPConnection::receiveQueue</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="o3" doxytag="TCPConnection::remoteAddr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="class_t_c_p_connection.html#o3">TCPConnection::remoteAddr</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="o5" doxytag="TCPConnection::remotePort"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_t_c_p_connection.html#o5">TCPConnection::remotePort</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="TCPConnection::sendQueue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a>* <a class="el" href="class_t_c_p_connection.html#p3">TCPConnection::sendQueue</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p12" doxytag="TCPConnection::sndAckVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector* <a class="el" href="class_t_c_p_connection.html#p12">TCPConnection::sndAckVector</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p11" doxytag="TCPConnection::sndNxtVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector* <a class="el" href="class_t_c_p_connection.html#p11">TCPConnection::sndNxtVector</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p10" doxytag="TCPConnection::sndWndVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector* <a class="el" href="class_t_c_p_connection.html#p10">TCPConnection::sndWndVector</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="TCPConnection::state"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a>* <a class="el" href="class_t_c_p_connection.html#p2">TCPConnection::state</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p9" doxytag="TCPConnection::synRexmitTimer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage* <a class="el" href="class_t_c_p_connection.html#p9">TCPConnection::synRexmitTimer</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="TCPConnection::tcpAlgorithm"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a>* <a class="el" href="class_t_c_p_connection.html#p5">TCPConnection::tcpAlgorithm</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="TCPConnection::tcpMain"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p.html">TCP</a>* <a class="el" href="class_t_c_p_connection.html#p0">TCPConnection::tcpMain</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p6" doxytag="TCPConnection::the2MSLTimer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage* <a class="el" href="class_t_c_p_connection.html#p6">TCPConnection::the2MSLTimer</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p15" doxytag="TCPConnection::unackedVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector* <a class="el" href="class_t_c_p_connection.html#p15">TCPConnection::unackedVector</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_t_c_p_connection_8h.html">TCPConnection.h</a><li><a class="el" href="_t_c_p_connection_base_8cc.html">TCPConnectionBase.cc</a><li><a class="el" href="_t_c_p_connection_event_proc_8cc.html">TCPConnectionEventProc.cc</a><li><a class="el" href="_t_c_p_connection_rcv_segment_8cc.html">TCPConnectionRcvSegment.cc</a><li><a class="el" href="_t_c_p_connection_util_8cc.html">TCPConnectionUtil.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:31 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
