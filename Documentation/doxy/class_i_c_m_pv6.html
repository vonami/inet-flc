<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: ICMPv6 Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>ICMPv6 Class Reference</h1><code>#include &lt;ICMPv6.h&gt;</code>
<p>
<a href="class_i_c_m_pv6-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
ICMPv6 implementation. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#a0">sendErrorMessage</a> (<a class="el" href="class_i_pv6_datagram.html">IPv6Datagram</a> *datagram, <a class="el" href="_i_c_m_pv6_message__m_8h.html#a41">ICMPv6Type</a> type, int code)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#a1">sendErrorMessage</a> (cMessage *transportPacket, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl, <a class="el" href="_i_c_m_pv6_message__m_8h.html#a41">ICMPv6Type</a> type, int code)</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b0">sendToIP</a> (<a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *msg, const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;dest)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b1">sendToIP</a> (<a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b2">createDestUnreachableMsg</a> (int code)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b3">createPacketTooBigMsg</a> (int mtu)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b4">createTimeExceededMsg</a> (int code)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b5">createParamProblemMsg</a> (int code)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b6">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b7">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b8">processICMPv6Message</a> (<a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b9">processEchoRequest</a> (<a class="el" href="class_i_c_m_pv6_echo_request_msg.html">ICMPv6EchoRequestMsg</a> *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b10">processEchoReply</a> (<a class="el" href="class_i_c_m_pv6_echo_reply_msg.html">ICMPv6EchoReplyMsg</a> *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b11">sendEchoRequest</a> (cMessage *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b12">validateDatagramPromptingError</a> (<a class="el" href="class_i_pv6_datagram.html">IPv6Datagram</a> *datagram)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_c_m_pv6.html#b13">errorOut</a> (<a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *)</td></tr>

</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b2" doxytag="ICMPv6::createDestUnreachableMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> * ICMPv6::createDestUnreachableMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>code</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00206 {
00207     <a class="code" href="class_i_c_m_pv6_dest_unreachable_msg.html">ICMPv6DestUnreachableMsg</a> *errorMsg = <span class="keyword">new</span> <a class="code" href="class_i_c_m_pv6_dest_unreachable_msg.html">ICMPv6DestUnreachableMsg</a>(<span class="stringliteral">"Dest Unreachable"</span>);
00208     errorMsg-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_DESTINATION_UNREACHABLE);
00209     errorMsg-&gt;<a class="code" href="class_i_c_m_pv6_dest_unreachable_msg.html#a8">setCode</a>(code);
00210     <span class="keywordflow">return</span> errorMsg;
00211 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="ICMPv6::createPacketTooBigMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> * ICMPv6::createPacketTooBigMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>mtu</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00214 {
00215     <a class="code" href="class_i_c_m_pv6_packet_too_big_msg.html">ICMPv6PacketTooBigMsg</a> *errorMsg = <span class="keyword">new</span> <a class="code" href="class_i_c_m_pv6_packet_too_big_msg.html">ICMPv6PacketTooBigMsg</a>(<span class="stringliteral">"Packet Too Big"</span>);
00216     errorMsg-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_PACKET_TOO_BIG);
00217     errorMsg-&gt;<a class="code" href="class_i_c_m_pv6_packet_too_big_msg.html#a8">setCode</a>(0);<span class="comment">//Set to 0 by sender and ignored by receiver.</span>
00218     errorMsg-&gt;<a class="code" href="class_i_c_m_pv6_packet_too_big_msg.html#a10">setMTU</a>(mtu);
00219     <span class="keywordflow">return</span> errorMsg;
00220 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="ICMPv6::createParamProblemMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> * ICMPv6::createParamProblemMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>code</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00231 {
00232     <a class="code" href="class_i_c_m_pv6_param_problem_msg.html">ICMPv6ParamProblemMsg</a> *errorMsg = <span class="keyword">new</span> <a class="code" href="class_i_c_m_pv6_param_problem_msg.html">ICMPv6ParamProblemMsg</a>(<span class="stringliteral">"Parameter Problem"</span>);
00233     errorMsg-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_PARAMETER_PROBLEM);
00234     errorMsg-&gt;<a class="code" href="class_i_c_m_pv6_param_problem_msg.html#a8">setCode</a>(code);
00235     <span class="comment">//TODO: What Pointer? section 3.4</span>
00236     <span class="keywordflow">return</span> errorMsg;
00237 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="ICMPv6::createTimeExceededMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> * ICMPv6::createTimeExceededMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>code</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00223 {
00224     <a class="code" href="class_i_c_m_pv6_time_exceeded_msg.html">ICMPv6TimeExceededMsg</a> *errorMsg = <span class="keyword">new</span> <a class="code" href="class_i_c_m_pv6_time_exceeded_msg.html">ICMPv6TimeExceededMsg</a>(<span class="stringliteral">"Time Exceeded"</span>);
00225     errorMsg-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_TIME_EXCEEDED);
00226     errorMsg-&gt;<a class="code" href="class_i_c_m_pv6_time_exceeded_msg.html#a8">setCode</a>(code);
00227     <span class="keywordflow">return</span> errorMsg;
00228 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b13" doxytag="ICMPv6::errorOut"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::errorOut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00264 {
00265     send(icmpv6msg, <span class="stringliteral">"errorOut"</span>);
00266 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="ICMPv6::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Processing of messages that arrive in this module. Messages arrived here could be for <a class="el" href="class_i_c_m_p.html">ICMP</a> ping requests or ICMPv6 messages that require processing. <div class="fragment"><pre class="fragment">00032 {
00033     ASSERT(!msg-&gt;isSelfMessage()); <span class="comment">// no timers in ICMPv6</span>
00034 
00035     <span class="comment">// process arriving ICMP message</span>
00036     <span class="keywordflow">if</span> (msg-&gt;arrivalGate()-&gt;isName(<span class="stringliteral">"fromIPv6"</span>))
00037     {
00038         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Processing ICMPv6 message.\n"</span>;
00039         <a class="code" href="class_i_c_m_pv6.html#b8">processICMPv6Message</a>(check_and_cast&lt;ICMPv6Message *&gt;(msg));
00040         <span class="keywordflow">return</span>;
00041     }
00042 
00043     <span class="comment">// request from application</span>
00044     <span class="keywordflow">if</span> (msg-&gt;arrivalGate()-&gt;isName(<span class="stringliteral">"pingIn"</span>))
00045     {
00046         <a class="code" href="class_i_c_m_pv6.html#b11">sendEchoRequest</a>(msg);
00047         <span class="keywordflow">return</span>;
00048     }
00049 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="ICMPv6::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialization <div class="fragment"><pre class="fragment">00028 {
00029 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b10" doxytag="ICMPv6::processEchoReply"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::processEchoReply           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_echo_reply_msg.html">ICMPv6EchoReplyMsg</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Forward the ping reply to the "pingOut" of this module. <div class="fragment"><pre class="fragment">00112 {
00113     <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl = check_and_cast&lt;IPv6ControlInfo*&gt;(reply-&gt;removeControlInfo());
00114     cMessage *payload = reply-&gt;decapsulate();
00115     payload-&gt;setControlInfo(ctrl);
00116     <span class="keyword">delete</span> reply;
00117     send(payload, <span class="stringliteral">"pingOut"</span>);
00118 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="ICMPv6::processEchoRequest"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::processEchoRequest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_echo_request_msg.html">ICMPv6EchoRequestMsg</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Respond to the machine that tried to ping us. <div class="fragment"><pre class="fragment">00089 {
00090     <span class="comment">//Create an ICMPv6 Reply Message</span>
00091     <a class="code" href="class_i_c_m_pv6_echo_reply_msg.html">ICMPv6EchoReplyMsg</a> *reply = <span class="keyword">new</span> <a class="code" href="class_i_c_m_pv6_echo_reply_msg.html">ICMPv6EchoReplyMsg</a>(<span class="stringliteral">"Echo Reply"</span>);
00092     reply-&gt;setName((std::string(request-&gt;name())+<span class="stringliteral">"-reply"</span>).c_str());
00093     reply-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_ECHO_REPLY);
00094     reply-&gt;encapsulate(request-&gt;decapsulate());
00095 
00096     <span class="comment">// TBD check what to do if dest was multicast etc?</span>
00097     <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl
00098         = check_and_cast&lt;IPv6ControlInfo *&gt;(request-&gt;controlInfo());
00099     <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *replyCtrl = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
00100     replyCtrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a4">setProtocol</a>(IP_PROT_IPv6_ICMP);
00101     <span class="comment">//set Msg's source addr as the dest addr of request msg.</span>
00102     replyCtrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a10">setSrcAddr</a>(ctrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a5">destAddr</a>());
00103     <span class="comment">//set Msg's dest addr as the source addr of request msg.</span>
00104     replyCtrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a7">setDestAddr</a>(ctrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>());
00105     reply-&gt;setControlInfo(replyCtrl);
00106 
00107     <span class="keyword">delete</span> request;
00108     <a class="code" href="class_i_c_m_pv6.html#b0">sendToIP</a>(reply);
00109 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b8" doxytag="ICMPv6::processICMPv6Message"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::processICMPv6Message           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00052 {
00053     ASSERT(dynamic_cast&lt;ICMPv6Message *&gt;(icmpv6msg));
00054     <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPv6DestUnreachableMsg *&gt;(icmpv6msg))
00055     {
00056         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMPv6 Destination Unreachable Message Received."</span> &lt;&lt; endl;
00057         <a class="code" href="class_i_c_m_pv6.html#b13">errorOut</a>(icmpv6msg);
00058     }
00059     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPv6PacketTooBigMsg *&gt;(icmpv6msg))
00060     {
00061         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMPv6 Packet Too Big Message Received."</span> &lt;&lt; endl;
00062         <a class="code" href="class_i_c_m_pv6.html#b13">errorOut</a>(icmpv6msg);
00063     }
00064     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPv6TimeExceededMsg *&gt;(icmpv6msg))
00065     {
00066         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMPv6 Time Exceeded Message Received."</span> &lt;&lt; endl;
00067         <a class="code" href="class_i_c_m_pv6.html#b13">errorOut</a>(icmpv6msg);
00068     }
00069     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPv6ParamProblemMsg *&gt;(icmpv6msg))
00070     {
00071         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMPv6 Parameter Problem Message Received."</span> &lt;&lt; endl;
00072         <a class="code" href="class_i_c_m_pv6.html#b13">errorOut</a>(icmpv6msg);
00073     }
00074     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPv6EchoRequestMsg *&gt;(icmpv6msg))
00075     {
00076         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMPv6 Echo Request Message Received."</span> &lt;&lt; endl;
00077         <a class="code" href="class_i_c_m_pv6.html#b9">processEchoRequest</a>((<a class="code" href="class_i_c_m_pv6_echo_request_msg.html">ICMPv6EchoRequestMsg</a> *)icmpv6msg);
00078     }
00079     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPv6EchoReplyMsg *&gt;(icmpv6msg))
00080     {
00081         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMPv6 Echo Reply Message Received."</span> &lt;&lt; endl;
00082         <a class="code" href="class_i_c_m_pv6.html#b10">processEchoReply</a>((<a class="code" href="class_i_c_m_pv6_echo_reply_msg.html">ICMPv6EchoReplyMsg</a> *)icmpv6msg);
00083     }
00084     <span class="keywordflow">else</span>
00085         error(<span class="stringliteral">"Unknown message type received.\n"</span>);
00086 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b11" doxytag="ICMPv6::sendEchoRequest"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::sendEchoRequest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Ping a machine. The information needed to do this is in the cMessage parameter. TODO where in cMessage? document!!! <div class="fragment"><pre class="fragment">00121 {
00122     <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl = check_and_cast&lt;IPv6ControlInfo*&gt;(msg-&gt;removeControlInfo());
00123     ctrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a4">setProtocol</a>(IP_PROT_IPv6_ICMP);
00124     <a class="code" href="class_i_c_m_pv6_echo_request_msg.html">ICMPv6EchoRequestMsg</a> *request = <span class="keyword">new</span> <a class="code" href="class_i_c_m_pv6_echo_request_msg.html">ICMPv6EchoRequestMsg</a>(msg-&gt;name());
00125     request-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_ECHO_REQUEST);
00126     request-&gt;encapsulate(msg);
00127     request-&gt;setControlInfo(ctrl);
00128     <a class="code" href="class_i_c_m_pv6.html#b0">sendToIP</a>(request);
00129 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ICMPv6::sendErrorMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::sendErrorMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>transportPacket</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="_i_c_m_pv6_message__m_8h.html#a41">ICMPv6Type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>code</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This method can be called from other modules to send an <a class="el" href="class_i_c_m_p.html">ICMP</a> error packet in response to a received bogus packet from the transport layer (like <a class="el" href="class_u_d_p.html">UDP</a>). The <a class="el" href="class_i_c_m_p.html">ICMP</a> error packet needs to include (part of) the original <a class="el" href="class_i_p.html">IP</a> datagram, so this function will wrap back the transport packet into the <a class="el" href="class_i_p.html">IP</a> datagram based on its <a class="el" href="class_i_p_control_info.html">IPControlInfo</a>. <div class="fragment"><pre class="fragment">00180 {
00181     Enter_Method(<span class="stringliteral">"sendErrorMessage(transportPacket, ctrl, type=%d, code=%d)"</span>, type, code);
00182 
00183     <a class="code" href="class_i_pv6_datagram.html">IPv6Datagram</a> *datagram = ctrl-&gt;<a class="code" href="class_i_pv6_control_info.html#a5">removeOrigDatagram</a>();
00184     datagram-&gt;encapsulate(transportPacket);
00185     <a class="code" href="class_i_c_m_pv6.html#a0">sendErrorMessage</a>(datagram, type, code);
00186 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ICMPv6::sendErrorMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::sendErrorMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_datagram.html">IPv6Datagram</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>datagram</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="_i_c_m_pv6_message__m_8h.html#a41">ICMPv6Type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>code</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This method can be called from other modules to send an ICMPv6 error packet. RFC 2463, Section 3: ICMPv6 Error Messages There are a total of 4 ICMPv6 error messages as described in the RFC. This method will construct and send error messages corresponding to the given type. Error Types:<ul>
<li>Destination Unreachable Message - 1</li><li>Packet Too Big Message - 2</li><li>Time Exceeded Message - 3</li><li>Parameter Problem Message - 4 Code Types have different semantics for each error type. See RFC 2463. </li></ul>
<div class="fragment"><pre class="fragment">00132 {
00133     Enter_Method(<span class="stringliteral">"sendErrorMessage(datagram, type=%d, code=%d)"</span>, type, code);
00134 
00135     <span class="comment">// get ownership</span>
00136     take(origDatagram);
00137 
00138     <span class="keywordflow">if</span> (!<a class="code" href="class_i_c_m_pv6.html#b12">validateDatagramPromptingError</a>(origDatagram))
00139         return;
00140 
00141     <a class="code" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *errorMsg;
00142 
00143     if (type == ICMPv6_DESTINATION_UNREACHABLE) errorMsg = createDestUnreachableMsg(code);
00144     <span class="comment">//TODO: implement MTU support.</span>
00145     else if (type == ICMPv6_PACKET_TOO_BIG) errorMsg = createPacketTooBigMsg(0);
00146     else if (type == ICMPv6_TIME_EXCEEDED) errorMsg = createTimeExceededMsg(code);
00147     else if (type == ICMPv6_PARAMETER_PROBLEM) errorMsg = createParamProblemMsg(code);
00148     else error("Unknown <a class="code" href="class_i_c_m_pv6.html">ICMPv6</a> error type\n");
00149 
00150     errorMsg-&gt;encapsulate(origDatagram);
00151 
00152     <span class="comment">// debugging information</span>
00153     EV &lt;&lt; "sending <a class="code" href="class_i_c_m_p.html">ICMP</a> error: (" &lt;&lt; errorMsg-&gt;className() &lt;&lt; ")" &lt;&lt; errorMsg-&gt;name()
00154        &lt;&lt; " type=" &lt;&lt; type &lt;&lt; " code=" &lt;&lt; code &lt;&lt; endl;
00155 
00156     <span class="comment">// ICMP message length: the internet header plus the first 8 bytes of</span>
00157     <span class="comment">// the original datagram's data is returned to the sender</span>
00158     <span class="comment">//errorMessage-&gt;setByteLength(4 + origDatagram-&gt;headerLength() + 8); FIXME What is this for?</span>
00159 
00160     <span class="comment">// if srcAddr is not filled in, we're still in the src node, so we just</span>
00161     <span class="comment">// process the ICMP message locally, right away</span>
00162     if (origDatagram-&gt;srcAddress().isUnspecified())
00163     {
00164         <span class="comment">// pretend it came from the IP layer</span>
00165         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
00166         ctrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a10">setSrcAddr</a>(IPv6Address::LOOPBACK_ADDRESS); <span class="comment">// FIXME maybe use configured loopback address</span>
00167         ctrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a4">setProtocol</a>(IP_PROT_ICMP);
00168         errorMsg-&gt;setControlInfo(ctrlInfo);
00169 
00170         <span class="comment">// then process it locally</span>
00171         <a class="code" href="class_i_c_m_pv6.html#b8">processICMPv6Message</a>(errorMsg);
00172     }
00173     <span class="keywordflow">else</span>
00174     {
00175         <a class="code" href="class_i_c_m_pv6.html#b0">sendToIP</a>(errorMsg, origDatagram-&gt;<a class="code" href="class_i_pv6_datagram___base.html#a4">srcAddress</a>());
00176     }
00177 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="ICMPv6::sendToIP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::sendToIP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00200 {
00201     <span class="comment">// assumes IPControlInfo is already attached</span>
00202     send(msg,<span class="stringliteral">"toIPv6"</span>);
00203 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="ICMPv6::sendToIP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ICMPv6::sendToIP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00189 {
00190 
00191     <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
00192     ctrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a7">setDestAddr</a>(dest);
00193     ctrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a4">setProtocol</a>(IP_PROT_IPv6_ICMP);
00194     msg-&gt;setControlInfo(ctrlInfo);
00195 
00196     send(msg,<span class="stringliteral">"toIPv6"</span>);
00197 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b12" doxytag="ICMPv6::validateDatagramPromptingError"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool ICMPv6::validateDatagramPromptingError           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_datagram.html">IPv6Datagram</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>datagram</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Validate the received <a class="el" href="class_i_pv6.html">IPv6</a> datagram before responding with error message. <div class="fragment"><pre class="fragment">00240 {
00241     <span class="comment">// don't send ICMP error messages for multicast messages</span>
00242     <span class="keywordflow">if</span> (origDatagram-&gt;<a class="code" href="class_i_pv6_datagram___base.html#a7">destAddress</a>().<a class="code" href="class_i_pv6_address.html#a23">isMulticast</a>())
00243     {
00244         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"won't send ICMP error messages for multicast message "</span> &lt;&lt; origDatagram &lt;&lt; endl;
00245         <span class="keyword">delete</span> origDatagram;
00246         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00247     }
00248 
00249     <span class="comment">// do not reply with error message to error message</span>
00250     <span class="keywordflow">if</span> (origDatagram-&gt;<a class="code" href="class_i_pv6_datagram___base.html#a16">transportProtocol</a>() == <a class="code" href="_i_p_protocol_id__m_8h.html#a23a11">IP_PROT_IPv6_ICMP</a>)
00251     {
00252         <a class="code" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *recICMPMsg = check_and_cast&lt;ICMPv6Message *&gt;(origDatagram-&gt;encapsulatedMsg());
00253         <span class="keywordflow">if</span> (recICMPMsg-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a7">type</a>()&lt;128)
00254         {
00255             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMP error received -- do not reply to it"</span> &lt;&lt; endl;
00256             <span class="keyword">delete</span> origDatagram;
00257             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00258         }
00259     }
00260     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00261 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_i_c_m_pv6_8h.html">ICMPv6.h</a><li><a class="el" href="_i_c_m_pv6_8cc.html">ICMPv6.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:22 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
