<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: RTCPEndsystemModule Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>RTCPEndsystemModule Class Reference</h1><code>#include &lt;RTCPEndsystemModule.h&gt;</code>
<p>
<a href="class_r_t_c_p_endsystem_module-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
The class RTCPEndsystemModule is responsible for creating, receiving and processing of rtcp packets. It also keeps track of this and other rtp end systems. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b1">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b2">handleMessageFromRTP</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b3">handleMessageFromSocketLayer</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b4">handleSelfMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b5">initializeRTCP</a> (<a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b6">senderModuleInitialized</a> (<a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b7">dataOut</a> (<a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *packet)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b8">dataIn</a> (<a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b9">leaveSession</a> (<a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b10">socketRet</a> (<a class="el" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *sifpIn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b11">connectRet</a> (<a class="el" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *sifpIn)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#b12">readRet</a> (<a class="el" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *sifpIn)</td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d0">createServerSocket</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d1">createClientSocket</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d2">chooseSSRC</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d3">scheduleInterval</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d4">createPacket</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d5">processOutgoingRTPPacket</a> (<a class="el" href="class_r_t_p_packet.html">RTPPacket</a> *packet)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d6">processIncomingRTPPacket</a> (<a class="el" href="class_r_t_p_packet.html">RTPPacket</a> *packet, IN_Addr address, IN_Port port)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d7">processIncomingRTCPPacket</a> (<a class="el" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a> *packet, IN_Addr address, IN_Port port)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual <a class="el" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d8">findParticipantInfo</a> (<a class="el" href="types_8h.html#a3">u_int32</a> ssrc)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#d9">calculateAveragePacketSize</a> (int size)</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r0">_mtu</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r1">_bandwidth</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r2">_rtcpPercentage</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">IN_Addr&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r3">_destinationAddress</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">IN_Port&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r4">_port</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r5">_ssrcChosen</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r6">_leaveSession</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_r_t_p_sender_info.html">RTPSenderInfo</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cArray *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_socket.html#w0">Socket::Filedesc</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r9">_socketFdIn</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_socket.html#w0">Socket::Filedesc</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r10">_socketFdOut</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r11">_packetsCalculated</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r12">_averagePacketSize</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_r_t_c_p_endsystem_module.html#r13">_rtcpIntervalOutVector</a></td></tr>

</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="d9" doxytag="RTCPEndsystemModule::calculateAveragePacketSize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::calculateAveragePacketSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>size</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Recalculates the average size of an <a class="el" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a> when one of this size has been sent or received. <div class="fragment"><pre class="fragment">00568                                                              {
00569     <span class="comment">// add size of ip and udp header to given size before calculating</span>
00570     <a class="code" href="class_r_t_c_p_endsystem_module.html#r12">_averagePacketSize</a> = ((double)(<a class="code" href="class_r_t_c_p_endsystem_module.html#r11">_packetsCalculated</a>) * <a class="code" href="class_r_t_c_p_endsystem_module.html#r12">_averagePacketSize</a> + (double)(size + 20 + 8)) / (double)(++<a class="code" href="class_r_t_c_p_endsystem_module.html#r11">_packetsCalculated</a>);
00571 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d2" doxytag="RTCPEndsystemModule::chooseSSRC"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::chooseSSRC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Chooses the ssrc identifier for this end system. <div class="fragment"><pre class="fragment">00283                                      {
00284 
00285     <a class="code" href="types_8h.html#a3">u_int32</a> ssrc = 0;
00286     <span class="keywordtype">bool</span> ssrcConflict = <span class="keyword">false</span>;
00287     <span class="keywordflow">do</span> {
00288         ssrc = intrand(0x7fffffff);
00289         ssrcConflict = <a class="code" href="class_r_t_c_p_endsystem_module.html#d8">findParticipantInfo</a>(ssrc) != NULL;
00290     } <span class="keywordflow">while</span> (ssrcConflict);
00291     <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a18">setSSRC</a>(ssrc);
00292     <a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;add(_senderInfo);
00293     <a class="code" href="class_r_t_c_p_endsystem_module.html#r5">_ssrcChosen</a> = <span class="keyword">true</span>;
00294 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b11" doxytag="RTCPEndsystemModule::connectRet"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::connectRet           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sifpIn</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Called when the socket layer has finished a connect. <div class="fragment"><pre class="fragment">00229                                                                   {
00230     <span class="comment">// schedule first rtcp packet</span>
00231     <span class="keywordtype">double</span> intervalLength = 2.5 * (dblrand() + 0.5);
00232     cMessage *reminderMessage = <span class="keyword">new</span> cMessage(<span class="stringliteral">"Interval"</span>);
00233     scheduleAt(simTime() + intervalLength, reminderMessage);
00234 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d1" doxytag="RTCPEndsystemModule::createClientSocket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::createClientSocket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Requests a client socket from the socket layer. <div class="fragment"><pre class="fragment">00253                                              {
00254     <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *sifp = <span class="keyword">new</span> <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a>(<span class="stringliteral">"socket()"</span>);
00255     sifp-&gt;<a class="code" href="class_socket_interface_packet.html#a8">socket</a>(Socket::IPSuite_AF_INET, Socket::IPSuite_SOCK_DGRAM, Socket::UDP);
00256     send(sifp, <span class="stringliteral">"toSocketLayer"</span>);
00257 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d4" doxytag="RTCPEndsystemModule::createPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::createPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Creates and sends an <a class="el" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a>. <div class="fragment"><pre class="fragment">00297                                        {
00298     <span class="comment">// first packet in an rtcp compound packet must</span>
00299     <span class="comment">// be a sender or receiver report</span>
00300     <a class="code" href="class_r_t_c_p_receiver_report_packet.html">RTCPReceiverReportPacket</a> *reportPacket;
00301 
00302     <span class="comment">// if this rtcp end system is a sender (see SenderInformation::isSender() for</span>
00303     <span class="comment">// details) insert a sender report</span>
00304     <span class="keywordflow">if</span> (<a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a16">isSender</a>()) {
00305         <a class="code" href="class_r_t_c_p_sender_report_packet.html">RTCPSenderReportPacket</a> *senderReportPacket = <span class="keyword">new</span> <a class="code" href="class_r_t_c_p_sender_report_packet.html">RTCPSenderReportPacket</a>(<span class="stringliteral">"SenderReportPacket"</span>);
00306         senderReportPacket-&gt;<a class="code" href="class_r_t_c_p_sender_report_packet.html#a9">setSenderReport</a>(<a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_sender_info.html#a8">senderReport</a>(simTime()));
00307         reportPacket = senderReportPacket;
00308     }
00309     <span class="keywordflow">else</span> {
00310         reportPacket = <span class="keyword">new</span> <a class="code" href="class_r_t_c_p_receiver_report_packet.html">RTCPReceiverReportPacket</a>(<span class="stringliteral">"ReceiverReportPacket"</span>);
00311     }
00312     reportPacket-&gt;<a class="code" href="class_r_t_c_p_receiver_report_packet.html#a9">setSSRC</a>(<a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a17">ssrc</a>());
00313 
00314     <span class="comment">// insert receiver reports for packets from other sources</span>
00315     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _participantInfos-&gt;items(); i++) {
00316 
00317         <span class="keywordflow">if</span> (<a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;exist(i)) {
00318             <a class="code" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> *participantInfo = (<a class="code" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> *)(<a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;get(i));
00319             <span class="keywordflow">if</span> (participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a17">ssrc</a>() != <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a17">ssrc</a>()) {
00320                 <a class="code" href="class_reception_report.html">ReceptionReport</a> *report = ((<a class="code" href="class_r_t_p_receiver_info.html">RTPReceiverInfo</a> *)participantInfo)-&gt;receptionReport(simTime());
00321                 <span class="keywordflow">if</span> (report != NULL) {
00322                     reportPacket-&gt;<a class="code" href="class_r_t_c_p_receiver_report_packet.html#a10">addReceptionReport</a>(report);
00323 
00324                 };
00325             };
00326             participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a14">nextInterval</a>(simTime());
00327 
00328             <span class="keywordflow">if</span> (participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a15">toBeDeleted</a>(simTime())) {
00329 
00330                 <a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;remove(participantInfo);
00331                 <span class="keyword">delete</span> participantInfo;
00332                 <span class="comment">// perhaps inform the profile</span>
00333             };
00334         };
00335     };
00336 
00337 
00338     <span class="comment">// insert source description items (at least common name)</span>
00339     <a class="code" href="class_r_t_c_p_s_d_e_s_packet.html">RTCPSDESPacket</a> *sdesPacket = <span class="keyword">new</span> <a class="code" href="class_r_t_c_p_s_d_e_s_packet.html">RTCPSDESPacket</a>(<span class="stringliteral">"SDESPacket"</span>);
00340 
00341     <a class="code" href="class_s_d_e_s_chunk.html">SDESChunk</a> *chunk = <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a10">sdesChunk</a>();
00342     sdesPacket-&gt;<a class="code" href="class_r_t_c_p_s_d_e_s_packet.html#a9">addSDESChunk</a>(chunk);
00343 
00344     <a class="code" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a> *compoundPacket = <span class="keyword">new</span> <a class="code" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a>(<span class="stringliteral">"RTCPCompoundPacket"</span>);
00345 
00346     compoundPacket-&gt;<a class="code" href="class_r_t_c_p_compound_packet.html#a8">addRTCPPacket</a>(reportPacket);
00347 
00348     compoundPacket-&gt;<a class="code" href="class_r_t_c_p_compound_packet.html#a8">addRTCPPacket</a>(sdesPacket);
00349 
00350     <span class="comment">// create rtcp app/bye packets if needed</span>
00351     <span class="keywordflow">if</span> (_leaveSession) {
00352         <a class="code" href="class_r_t_c_p_bye_packet.html">RTCPByePacket</a> *byePacket = <span class="keyword">new</span> <a class="code" href="class_r_t_c_p_bye_packet.html">RTCPByePacket</a>(<span class="stringliteral">"ByePacket"</span>);
00353         byePacket-&gt;<a class="code" href="class_r_t_c_p_bye_packet.html#a7">setSSRC</a>(<a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a17">ssrc</a>());
00354         compoundPacket-&gt;<a class="code" href="class_r_t_c_p_compound_packet.html#a8">addRTCPPacket</a>(byePacket);
00355     };
00356 
00357     <a class="code" href="class_r_t_c_p_endsystem_module.html#d9">calculateAveragePacketSize</a>(compoundPacket-&gt;length());
00358 
00359     <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *sifp = <span class="keyword">new</span> <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a>(<span class="stringliteral">"write()"</span>);
00360 
00361     sifp-&gt;<a class="code" href="class_socket_interface_packet.html#a13">write</a>(_socketFdOut, compoundPacket);
00362 
00363     send(sifp, <span class="stringliteral">"toSocketLayer"</span>);
00364 
00365     <span class="keywordflow">if</span> (_leaveSession) {
00366         <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp = <span class="keyword">new</span> <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a>(<span class="stringliteral">"sessionLeft()"</span>);
00367         rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a21">sessionLeft</a>();
00368         send(rinp, <span class="stringliteral">"toRTP"</span>);
00369     };
00370 
00371 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d0" doxytag="RTCPEndsystemModule::createServerSocket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::createServerSocket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Request a server socket from the socket layer. <div class="fragment"><pre class="fragment">00247                                              {
00248     <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *sifp = <span class="keyword">new</span> <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a>(<span class="stringliteral">"socket()"</span>);
00249     sifp-&gt;<a class="code" href="class_socket_interface_packet.html#a8">socket</a>(Socket::IPSuite_AF_INET, Socket::IPSuite_SOCK_DGRAM, Socket::UDP);
00250     send(sifp, <span class="stringliteral">"toSocketLayer"</span>);
00251 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b8" doxytag="RTCPEndsystemModule::dataIn"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::dataIn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>rinp</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Stores information about an outgoing rtp data packet. <div class="fragment"><pre class="fragment">00181                                                      {
00182     <a class="code" href="class_r_t_p_packet.html">RTPPacket</a> *rtpPacket = (<a class="code" href="class_r_t_p_packet.html">RTPPacket</a> *)(rinp-&gt;decapsulate());
00183     <a class="code" href="class_r_t_c_p_endsystem_module.html#d6">processIncomingRTPPacket</a>(rtpPacket, rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a29">address</a>(), rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a30">port</a>());
00184 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="RTCPEndsystemModule::dataOut"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::dataOut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>packet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Stores information about an outgoing rtp data packet. <div class="fragment"><pre class="fragment">00175                                                         {
00176     <a class="code" href="class_r_t_p_packet.html">RTPPacket</a> *rtpPacket = (<a class="code" href="class_r_t_p_packet.html">RTPPacket</a> *)(packet-&gt;decapsulate());
00177     <a class="code" href="class_r_t_c_p_endsystem_module.html#d5">processOutgoingRTPPacket</a>(rtpPacket);
00178 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d8" doxytag="RTCPEndsystemModule::findParticipantInfo"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> * RTCPEndsystemModule::findParticipantInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="types_8h.html#a3">u_int32</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ssrc</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the <a class="el" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> object used for storing information about the rtp end system with this ssrc identifier. Returns NULL if this end system is unknown. <div class="fragment"><pre class="fragment">00556                                                                          {
00557     <span class="keywordtype">char</span> *ssrcString = <a class="code" href="class_r_t_p_participant_info.html#e0">RTPParticipantInfo::ssrcToName</a>(ssrc);
00558     <span class="keywordtype">int</span> participantIndex = <a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;find(ssrcString);
00559     <span class="keywordflow">if</span> (participantIndex != -1) {
00560         <span class="keywordflow">return</span> (<a class="code" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> *)(<a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;get(participantIndex));
00561     }
00562     <span class="keywordflow">else</span> {
00563         <span class="keywordflow">return</span> NULL;
00564     };
00565 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="RTCPEndsystemModule::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Message handling. Dispatches messages by arrival gate. <div class="fragment"><pre class="fragment">00058                                                      {
00059 
00060     <span class="comment">// first distinguish incoming messages by arrival gate</span>
00061     <span class="keywordflow">if</span> (msg-&gt;arrivalGateId() == findGate(<span class="stringliteral">"fromRTP"</span>)) {
00062         <a class="code" href="class_r_t_c_p_endsystem_module.html#b2">handleMessageFromRTP</a>(msg);
00063     }
00064     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;arrivalGateId() == findGate(<span class="stringliteral">"fromSocketLayer"</span>)) {
00065         <a class="code" href="class_r_t_c_p_endsystem_module.html#b3">handleMessageFromSocketLayer</a>(msg);
00066     }
00067     <span class="keywordflow">else</span> {
00068         <a class="code" href="class_r_t_c_p_endsystem_module.html#b4">handleSelfMessage</a>(msg);
00069     }
00070 
00071     <span class="keyword">delete</span> msg;
00072 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="RTCPEndsystemModule::handleMessageFromRTP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::handleMessageFromRTP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles messages from the rtp module. <div class="fragment"><pre class="fragment">00079                                                             {
00080 
00081     <span class="comment">// from the rtp module all messages are of type RTPInnerPacket</span>
00082     <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp = (<a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *)msg;
00083 
00084     <span class="comment">// distinguish by type</span>
00085     <span class="keywordflow">if</span> (rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a24">type</a>() == <a class="code" href="class_r_t_p_inner_packet.html#w17w3">RTPInnerPacket::RTP_INP_INITIALIZE_RTCP</a>) {
00086         <a class="code" href="class_r_t_c_p_endsystem_module.html#b5">initializeRTCP</a>(rinp);
00087     }
00088     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a24">type</a>() == <a class="code" href="class_r_t_p_inner_packet.html#w17w10">RTPInnerPacket::RTP_INP_SENDER_MODULE_INITIALIZED</a>) {
00089         <a class="code" href="class_r_t_c_p_endsystem_module.html#b6">senderModuleInitialized</a>(rinp);
00090     }
00091     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a24">type</a>() == <a class="code" href="class_r_t_p_inner_packet.html#w17w15">RTPInnerPacket::RTP_INP_DATA_OUT</a>) {
00092         <a class="code" href="class_r_t_c_p_endsystem_module.html#b7">dataOut</a>(rinp);
00093     }
00094     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a24">type</a>() == <a class="code" href="class_r_t_p_inner_packet.html#w17w16">RTPInnerPacket::RTP_INP_DATA_IN</a>) {
00095         <a class="code" href="class_r_t_c_p_endsystem_module.html#b8">dataIn</a>(rinp);
00096     }
00097     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a24">type</a>() == <a class="code" href="class_r_t_p_inner_packet.html#w17w13">RTPInnerPacket::RTP_INP_LEAVE_SESSION</a>) {
00098         <a class="code" href="class_r_t_c_p_endsystem_module.html#b9">leaveSession</a>(rinp);
00099     }
00100     <span class="keywordflow">else</span> {
00101         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"RTCPEndsystemModule: unknown RTPInnerPacket type !"</span> &lt;&lt; endl;
00102     }
00103 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="RTCPEndsystemModule::handleMessageFromSocketLayer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::handleMessageFromSocketLayer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles messages coming from the socket layer. <div class="fragment"><pre class="fragment">00106                                                                     {
00107     <span class="comment">// from SocketLayer all message are of type SocketInterfacePacket</span>
00108     <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *sifpIn = (<a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *)msg;
00109 
00110     <span class="comment">// distinguish by action (type of SocketInterfacePacket)</span>
00111 
00112     <span class="keywordflow">if</span> (sifpIn-&gt;<a class="code" href="class_socket_interface_packet.html#a23">action</a>() == <a class="code" href="class_socket_interface_packet.html#w15w1">SocketInterfacePacket::SA_SOCKET_RET</a>) {
00113         <a class="code" href="class_r_t_c_p_endsystem_module.html#b10">socketRet</a>(sifpIn);
00114     }
00115     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sifpIn-&gt;<a class="code" href="class_socket_interface_packet.html#a23">action</a>() == <a class="code" href="class_socket_interface_packet.html#w15w7">SocketInterfacePacket::SA_CONNECT_RET</a>) {
00116         <a class="code" href="class_r_t_c_p_endsystem_module.html#b11">connectRet</a>(sifpIn);
00117     }
00118     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sifpIn-&gt;<a class="code" href="class_socket_interface_packet.html#a23">action</a>() == <a class="code" href="class_socket_interface_packet.html#w15w11">SocketInterfacePacket::SA_READ_RET</a>) {
00119         <span class="comment">// we have rtcp data !</span>
00120         <a class="code" href="class_r_t_c_p_endsystem_module.html#b12">readRet</a>(sifpIn);
00121     }
00122     <span class="keywordflow">else</span> {
00123         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"RTCPEndsystemModule: unknown SocketInterfacePacket type !"</span> &lt;&lt; endl;
00124     }
00125 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="RTCPEndsystemModule::handleSelfMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::handleSelfMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles self messages. <div class="fragment"><pre class="fragment">00128                                                          {
00129     <span class="comment">// it's time to create an rtcp packet</span>
00130     <span class="keywordflow">if</span> (!_ssrcChosen) {
00131         <a class="code" href="class_r_t_c_p_endsystem_module.html#d2">chooseSSRC</a>();
00132         <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *rinp1 = <span class="keyword">new</span> <a class="code" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a>(<span class="stringliteral">"rtcpInitialized()"</span>);
00133         rinp1-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a11">rtcpInitialized</a>(<a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a17">ssrc</a>());
00134         send(rinp1, <span class="stringliteral">"toRTP"</span>);
00135     }
00136 
00137     <a class="code" href="class_r_t_c_p_endsystem_module.html#d4">createPacket</a>();
00138 
00139     <span class="keywordflow">if</span> (!_leaveSession) {
00140         <a class="code" href="class_r_t_c_p_endsystem_module.html#d3">scheduleInterval</a>();
00141     }
00142 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="RTCPEndsystemModule::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initializes variables. <div class="fragment"><pre class="fragment">00040                                      {
00041 
00042     <span class="comment">// initialize variables</span>
00043     <a class="code" href="class_r_t_c_p_endsystem_module.html#r5">_ssrcChosen</a> = <span class="keyword">false</span>;
00044     <a class="code" href="class_r_t_c_p_endsystem_module.html#r6">_leaveSession</a> = <span class="keyword">false</span>;
00045     <a class="code" href="class_r_t_c_p_endsystem_module.html#r9">_socketFdIn</a> = <a class="code" href="class_socket.html#s4">Socket::FILEDESC_UNDEF</a>;
00046     <a class="code" href="class_r_t_c_p_endsystem_module.html#r10">_socketFdOut</a> = <a class="code" href="class_socket.html#s4">Socket::FILEDESC_UNDEF</a>;
00047 
00048     <a class="code" href="class_r_t_c_p_endsystem_module.html#r11">_packetsCalculated</a> = 0;
00049 
00050     <a class="code" href="class_r_t_c_p_endsystem_module.html#r12">_averagePacketSize</a> = 0.0;
00051 
00052     <a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a> = <span class="keyword">new</span> cArray(<span class="stringliteral">"ParticipantInfos"</span>);
00053 
00054     <a class="code" href="class_r_t_c_p_endsystem_module.html#r13">_rtcpIntervalOutVector</a> = <span class="keyword">new</span> cOutVector();
00055 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="RTCPEndsystemModule::initializeRTCP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::initializeRTCP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>rinp</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initializes the rtcp module when the session is started. <div class="fragment"><pre class="fragment">00149                                                              {
00150     <a class="code" href="class_r_t_c_p_endsystem_module.html#r0">_mtu</a> = rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a26">mtu</a>();
00151     <a class="code" href="class_r_t_c_p_endsystem_module.html#r1">_bandwidth</a> = rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a27">bandwidth</a>();
00152     <a class="code" href="class_r_t_c_p_endsystem_module.html#r2">_rtcpPercentage</a> = rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a28">rtcpPercentage</a>();
00153     <a class="code" href="class_r_t_c_p_endsystem_module.html#r3">_destinationAddress</a> = rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a29">address</a>();
00154     <a class="code" href="class_r_t_c_p_endsystem_module.html#r4">_port</a> = rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a30">port</a>();
00155 
00156     <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a> = <span class="keyword">new</span> <a class="code" href="class_r_t_p_sender_info.html">RTPSenderInfo</a>();
00157 
00158     <a class="code" href="class_s_d_e_s_item.html">SDESItem</a> *sdesItem = <span class="keyword">new</span> <a class="code" href="class_s_d_e_s_item.html">SDESItem</a>(SDESItem::SDES_CNAME, rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a25">commonName</a>());
00159     <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a11">addSDESItem</a>(sdesItem);
00160 
00161 
00162     <span class="comment">// create server socket for receiving rtcp packets</span>
00163     <a class="code" href="class_r_t_c_p_endsystem_module.html#d0">createServerSocket</a>();
00164 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="RTCPEndsystemModule::leaveSession"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::leaveSession           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>rinp</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Makes the rtcp module send an <a class="el" href="class_r_t_c_p_bye_packet.html">RTCPByePacket</a> in the next <a class="el" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a> to tell other participants in the rtp session that this end system leaves. <div class="fragment"><pre class="fragment">00187                                                            {
00188     <a class="code" href="class_r_t_c_p_endsystem_module.html#r6">_leaveSession</a> = <span class="keyword">true</span>;
00189 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d7" doxytag="RTCPEndsystemModule::processIncomingRTCPPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::processIncomingRTCPPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>IN_Addr&nbsp;</td>
          <td class="mdname" nowrap> <em>address</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>IN_Port&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Extracts information of a received <a class="el" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a>. <div class="fragment"><pre class="fragment">00405                                                                                                              {
00406 
00407     <a class="code" href="class_r_t_c_p_endsystem_module.html#d9">calculateAveragePacketSize</a>(packet-&gt;length());
00408 
00409     cArray *rtcpPackets = packet-&gt;<a class="code" href="class_r_t_c_p_compound_packet.html#a9">rtcpPackets</a>();
00410 
00411     simtime_t arrivalTime = packet-&gt;arrivalTime();
00412     <span class="keyword">delete</span> packet;
00413 
00414     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; rtcpPackets-&gt;items(); i++) {
00415         <span class="keywordflow">if</span> (rtcpPackets-&gt;exist(i)) {
00416             <span class="comment">// remove the rtcp packet from the rtcp compound packet</span>
00417             <a class="code" href="class_r_t_c_p_packet.html">RTCPPacket</a> *rtcpPacket = (<a class="code" href="class_r_t_c_p_packet.html">RTCPPacket</a> *)(rtcpPackets-&gt;remove(i));
00418 
00419             <span class="keywordflow">if</span> (rtcpPacket-&gt;<a class="code" href="class_r_t_c_p_packet.html#a11">packetType</a>() == <a class="code" href="class_r_t_c_p_packet.html#w5w1">RTCPPacket::RTCP_PT_SR</a>) {
00420 
00421                 <a class="code" href="class_r_t_c_p_sender_report_packet.html">RTCPSenderReportPacket</a> *rtcpSenderReportPacket = (<a class="code" href="class_r_t_c_p_sender_report_packet.html">RTCPSenderReportPacket</a> *)rtcpPacket;
00422                 <a class="code" href="types_8h.html#a3">u_int32</a> ssrc = rtcpSenderReportPacket-&gt;<a class="code" href="class_r_t_c_p_receiver_report_packet.html#a8">ssrc</a>();
00423                 <a class="code" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> *participantInfo = <a class="code" href="class_r_t_c_p_endsystem_module.html#d8">findParticipantInfo</a>(ssrc);
00424 
00425                 <span class="keywordflow">if</span> (participantInfo == NULL) {
00426                     participantInfo = <span class="keyword">new</span> <a class="code" href="class_r_t_p_receiver_info.html">RTPReceiverInfo</a>(ssrc);
00427                     participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a20">setAddress</a>(address);
00428                     participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a24">setRTCPPort</a>(port);
00429                     <a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;add(participantInfo);
00430                 }
00431                 <span class="keywordflow">else</span> {
00432                     <span class="keywordflow">if</span> (participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a19">address</a>() == address) {
00433                         <span class="keywordflow">if</span> (participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a23">rtcpPort</a>() == <a class="code" href="_transport_2_r_t_p_2tmp_2defs_8h.html#a2">IPSuite_PORT_UNDEF</a>) {
00434                             participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a24">setRTCPPort</a>(port);
00435                         }
00436                         <span class="keywordflow">else</span> {
00437                             <span class="comment">// check for ssrc conflict</span>
00438                         }
00439                     }
00440                     <span class="keywordflow">else</span> {
00441                         <span class="comment">// check for ssrc conflict</span>
00442                     };
00443                 }
00444                 participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a7">processSenderReport</a>(rtcpSenderReportPacket-&gt;<a class="code" href="class_r_t_c_p_sender_report_packet.html#a8">senderReport</a>(), simTime());
00445 
00446                 cArray *receptionReports = rtcpSenderReportPacket-&gt;<a class="code" href="class_r_t_c_p_receiver_report_packet.html#a11">receptionReports</a>();
00447                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; receptionReports-&gt;items(); j++) {
00448                     <span class="keywordflow">if</span> (receptionReports-&gt;exist(j)) {
00449                         <a class="code" href="class_reception_report.html">ReceptionReport</a> *receptionReport = (<a class="code" href="class_reception_report.html">ReceptionReport</a> *)(receptionReports-&gt;remove(j));
00450                         <span class="keywordflow">if</span> (_senderInfo) {
00451                             <span class="keywordflow">if</span> (receptionReport-&gt;<a class="code" href="class_reception_report.html#a8">ssrc</a>() == <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a17">ssrc</a>()) {
00452                                 <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_sender_info.html#a7">processReceptionReport</a>(receptionReport, simTime());
00453                             }
00454                         }
00455                         <span class="comment">//else</span>
00456                         <span class="comment">//    delete receiverReport;</span>
00457                     }
00458                 };
00459                 <span class="keyword">delete</span> receptionReports;
00460 
00461             }
00462             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtcpPacket-&gt;<a class="code" href="class_r_t_c_p_packet.html#a11">packetType</a>() == <a class="code" href="class_r_t_c_p_packet.html#w5w2">RTCPPacket::RTCP_PT_RR</a>) {
00463 
00464                 <a class="code" href="class_r_t_c_p_receiver_report_packet.html">RTCPReceiverReportPacket</a> *rtcpReceiverReportPacket = (<a class="code" href="class_r_t_c_p_receiver_report_packet.html">RTCPReceiverReportPacket</a> *)rtcpPacket;
00465                 <a class="code" href="types_8h.html#a3">u_int32</a> ssrc = rtcpReceiverReportPacket-&gt;<a class="code" href="class_r_t_c_p_receiver_report_packet.html#a8">ssrc</a>();
00466                 <a class="code" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> *participantInfo = <a class="code" href="class_r_t_c_p_endsystem_module.html#d8">findParticipantInfo</a>(ssrc);
00467                 <span class="keywordflow">if</span> (participantInfo == NULL) {
00468                     participantInfo = <span class="keyword">new</span> <a class="code" href="class_r_t_p_receiver_info.html">RTPReceiverInfo</a>(ssrc);
00469                     participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a20">setAddress</a>(address);
00470                     participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a24">setRTCPPort</a>(port);
00471                     <a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;add(participantInfo);
00472                 }
00473                 <span class="keywordflow">else</span> {
00474                     <span class="keywordflow">if</span> (participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a19">address</a>() == address) {
00475                         <span class="keywordflow">if</span> (participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a23">rtcpPort</a>() == <a class="code" href="_transport_2_r_t_p_2tmp_2defs_8h.html#a2">IPSuite_PORT_UNDEF</a>) {
00476                             participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a24">setRTCPPort</a>(port);
00477                         }
00478                         <span class="keywordflow">else</span> {
00479                             <span class="comment">// check for ssrc conflict</span>
00480                         }
00481                     }
00482                     <span class="keywordflow">else</span> {
00483                         <span class="comment">// check for ssrc conflict</span>
00484                     };
00485                 }
00486 
00487                 cArray *receptionReports = rtcpReceiverReportPacket-&gt;<a class="code" href="class_r_t_c_p_receiver_report_packet.html#a11">receptionReports</a>();
00488                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; receptionReports-&gt;items(); j++) {
00489                     <span class="keywordflow">if</span> (receptionReports-&gt;exist(j)) {
00490                         <a class="code" href="class_reception_report.html">ReceptionReport</a> *receptionReport = (<a class="code" href="class_reception_report.html">ReceptionReport</a> *)(receptionReports-&gt;remove(j));
00491                         <span class="keywordflow">if</span> (_senderInfo) {
00492 
00493                             <span class="keywordflow">if</span> (receptionReport-&gt;<a class="code" href="class_reception_report.html#a8">ssrc</a>() == <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a17">ssrc</a>()) {
00494                                 <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_sender_info.html#a7">processReceptionReport</a>(receptionReport, simTime());
00495                             }
00496                         }
00497 
00498                         <span class="comment">//else</span>
00499                         <span class="comment">//    delete receiverReport;</span>
00500                     }
00501                 };
00502                 <span class="keyword">delete</span> receptionReports;
00503             }
00504             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtcpPacket-&gt;<a class="code" href="class_r_t_c_p_packet.html#a11">packetType</a>() == <a class="code" href="class_r_t_c_p_packet.html#w5w3">RTCPPacket::RTCP_PT_SDES</a>) {
00505 
00506                 <a class="code" href="class_r_t_c_p_s_d_e_s_packet.html">RTCPSDESPacket</a> *rtcpSDESPacket = (<a class="code" href="class_r_t_c_p_s_d_e_s_packet.html">RTCPSDESPacket</a> *)rtcpPacket;
00507                 cArray *sdesChunks = rtcpSDESPacket-&gt;<a class="code" href="class_r_t_c_p_s_d_e_s_packet.html#a8">sdesChunks</a>();
00508 
00509                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; sdesChunks-&gt;items(); j++) {
00510                     <span class="keywordflow">if</span> (sdesChunks-&gt;exist(j)) {
00511                         <span class="comment">// remove the sdes chunk from the cArray of sdes chunks</span>
00512                         <a class="code" href="class_s_d_e_s_chunk.html">SDESChunk</a> *sdesChunk = (<a class="code" href="class_s_d_e_s_chunk.html">SDESChunk</a> *)(sdesChunks-&gt;remove(j));
00513                         <span class="comment">// this is needed to avoid seg faults</span>
00514                         <span class="comment">//sdesChunk-&gt;setOwner(this);</span>
00515                         <a class="code" href="types_8h.html#a3">u_int32</a> ssrc = sdesChunk-&gt;<a class="code" href="class_s_d_e_s_chunk.html#a9">ssrc</a>();
00516                         <a class="code" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> *participantInfo = <a class="code" href="class_r_t_c_p_endsystem_module.html#d8">findParticipantInfo</a>(ssrc);
00517                         <span class="keywordflow">if</span> (participantInfo == NULL) {
00518                             participantInfo = <span class="keyword">new</span> <a class="code" href="class_r_t_p_receiver_info.html">RTPReceiverInfo</a>(ssrc);
00519                             participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a20">setAddress</a>(address);
00520                             participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a24">setRTCPPort</a>(port);
00521                             <a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;add(participantInfo);
00522                         }
00523                         <span class="keywordflow">else</span> {
00524                             <span class="comment">// check for ssrc conflict</span>
00525                         }
00526                         participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a9">processSDESChunk</a>(sdesChunk, arrivalTime);
00527                     }
00528                 }
00529                 <span class="keyword">delete</span> sdesChunks;
00530 
00531             }
00532             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rtcpPacket-&gt;<a class="code" href="class_r_t_c_p_packet.html#a11">packetType</a>() == <a class="code" href="class_r_t_c_p_packet.html#w5w4">RTCPPacket::RTCP_PT_BYE</a>) {
00533                 <a class="code" href="class_r_t_c_p_bye_packet.html">RTCPByePacket</a> *rtcpByePacket = (<a class="code" href="class_r_t_c_p_bye_packet.html">RTCPByePacket</a> *)rtcpPacket;
00534                 <a class="code" href="types_8h.html#a3">u_int32</a> ssrc = rtcpByePacket-&gt;<a class="code" href="class_r_t_c_p_bye_packet.html#a6">ssrc</a>();
00535                 <a class="code" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> *participantInfo = <a class="code" href="class_r_t_c_p_endsystem_module.html#d8">findParticipantInfo</a>(ssrc);
00536 
00537                 <span class="keywordflow">if</span> (participantInfo != NULL &amp;&amp; participantInfo != _senderInfo) {
00538                     <a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;remove(participantInfo);
00539 
00540                     <span class="keyword">delete</span> participantInfo;
00541                     <span class="comment">// perhaps it would be useful to inform</span>
00542                     <span class="comment">// the profile to remove the corresponding</span>
00543                     <span class="comment">// receiver module</span>
00544                 };
00545             }
00546             <span class="keywordflow">else</span> {
00547                 <span class="comment">// app rtcp packets</span>
00548             }
00549         <span class="keyword">delete</span> rtcpPacket;
00550         }
00551     }
00552     <span class="keyword">delete</span> rtcpPackets;
00553 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d6" doxytag="RTCPEndsystemModule::processIncomingRTPPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::processIncomingRTPPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_packet.html">RTPPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>IN_Addr&nbsp;</td>
          <td class="mdname" nowrap> <em>address</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>IN_Port&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Extracts information of a received <a class="el" href="class_r_t_p_packet.html">RTPPacket</a>. <div class="fragment"><pre class="fragment">00379                                                                                                    {
00380 
00381     <a class="code" href="types_8h.html#a3">u_int32</a> ssrc = packet-&gt;<a class="code" href="class_r_t_p_packet.html#a16">ssrc</a>();
00382     <a class="code" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a> *participantInfo = <a class="code" href="class_r_t_c_p_endsystem_module.html#d8">findParticipantInfo</a>(ssrc);
00383     <span class="keywordflow">if</span> (participantInfo == NULL) {
00384         participantInfo = <span class="keyword">new</span> <a class="code" href="class_r_t_p_participant_info.html">RTPParticipantInfo</a>(ssrc);
00385         participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a20">setAddress</a>(address);
00386         participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a22">setRTPPort</a>(port);
00387         <a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;add(participantInfo);
00388     }
00389     <span class="keywordflow">else</span> {
00390         <span class="comment">// check for ssrc conflict</span>
00391         <span class="keywordflow">if</span> (participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a19">address</a>() != address) {
00392             <span class="comment">// we have an address conflict</span>
00393         }
00394         <span class="keywordflow">if</span> (participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a21">rtpPort</a>() == <a class="code" href="_transport_2_r_t_p_2tmp_2defs_8h.html#a2">IPSuite_PORT_UNDEF</a>) {
00395             participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a22">setRTPPort</a>(port);
00396         }
00397         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a21">rtpPort</a>() != port) {
00398             <span class="comment">// we have an rtp port conflict</span>
00399         }
00400     }
00401     participantInfo-&gt;<a class="code" href="class_r_t_p_participant_info.html#a6">processRTPPacket</a>(packet, packet-&gt;arrivalTime());
00402 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d5" doxytag="RTCPEndsystemModule::processOutgoingRTPPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::processOutgoingRTPPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_packet.html">RTPPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>packet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Extracts information of a sent <a class="el" href="class_r_t_p_packet.html">RTPPacket</a>. <div class="fragment"><pre class="fragment">00374                                                                     {
00375     <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_sender_info.html#a6">processRTPPacket</a>(packet, simTime());
00376 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b12" doxytag="RTCPEndsystemModule::readRet"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::readRet           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sifpIn</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Called when this rtcp module receives data from the socket layer. <div class="fragment"><pre class="fragment">00237                                                                {
00238     <a class="code" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a> *packet = (<a class="code" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a> *)(sifpIn-&gt;decapsulate());
00239     <a class="code" href="class_r_t_c_p_endsystem_module.html#d7">processIncomingRTCPPacket</a>(packet, <a class="code" href="_transport_2_r_t_p_2tmp_2defs_8h.html#a0">IN_Addr</a>(sifpIn-&gt;<a class="code" href="class_socket_interface_packet.html#a26">fAddr</a>()), <a class="code" href="_transport_2_r_t_p_2tmp_2defs_8h.html#a1">IN_Port</a>(sifpIn-&gt;<a class="code" href="class_socket_interface_packet.html#a27">fPort</a>()));
00240 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d3" doxytag="RTCPEndsystemModule::scheduleInterval"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::scheduleInterval           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Calculates the length of the next rtcp interval an issues a self message to remind itself. <div class="fragment"><pre class="fragment">00260                                            {
00261 
00262     simtime_t intervalLength = (simtime_t)(<a class="code" href="class_r_t_c_p_endsystem_module.html#r12">_averagePacketSize</a>) * (simtime_t)(<a class="code" href="class_r_t_c_p_endsystem_module.html#r8">_participantInfos</a>-&gt;items()) / (simtime_t)(<a class="code" href="class_r_t_c_p_endsystem_module.html#r1">_bandwidth</a> * <a class="code" href="class_r_t_c_p_endsystem_module.html#r2">_rtcpPercentage</a> * (<a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_participant_info.html#a16">isSender</a>() ? 1.0 : 0.75) / 100.0);
00263 
00264 
00265     <span class="comment">// write the calculated interval into file</span>
00266     <a class="code" href="class_r_t_c_p_endsystem_module.html#r13">_rtcpIntervalOutVector</a>-&gt;record(intervalLength);
00267 
00268     <span class="comment">// interval length must be at least 5 seconds</span>
00269     <span class="keywordflow">if</span> (intervalLength &lt; 5.0)
00270         intervalLength = 5.0;
00271 
00272 
00273     <span class="comment">// to avoid rtcp packet bursts multiply calculated interval length</span>
00274     <span class="comment">// with a random number between 0.5 and 1.5</span>
00275     intervalLength = intervalLength * (0.5 + dblrand());
00276 
00277 
00278     cMessage *reminderMessage = new cMessage("Interval");
00279     scheduleAt(simTime() + intervalLength, reminderMessage);
00280 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="RTCPEndsystemModule::senderModuleInitialized"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::senderModuleInitialized           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_inner_packet.html">RTPInnerPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>rinp</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Stores information about the new transmission. <div class="fragment"><pre class="fragment">00167                                                                       {
00168     <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_sender_info.html#a9">setStartTime</a>(simTime());
00169     <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_sender_info.html#a10">setClockRate</a>(rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a34">clockRate</a>());
00170     <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_sender_info.html#a11">setTimeStampBase</a>(rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a35">timeStampBase</a>());
00171     <a class="code" href="class_r_t_c_p_endsystem_module.html#r7">_senderInfo</a>-&gt;<a class="code" href="class_r_t_p_sender_info.html#a12">setSequenceNumberBase</a>(rinp-&gt;<a class="code" href="class_r_t_p_inner_packet.html#a36">sequenceNumberBase</a>());
00172 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b10" doxytag="RTCPEndsystemModule::socketRet"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RTCPEndsystemModule::socketRet           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sifpIn</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Called when the socket layer has returned a socket. <div class="fragment"><pre class="fragment">00192                                                                  {
00193 
00194     <span class="comment">// first the server socket is created</span>
00195     <span class="keywordflow">if</span> (_socketFdIn == Socket::FILEDESC_UNDEF) {
00196         <a class="code" href="class_r_t_c_p_endsystem_module.html#r9">_socketFdIn</a> = sifpIn-&gt;<a class="code" href="class_socket_interface_packet.html#a31">filedesc</a>();
00197         <span class="comment">// when file descriptor for the server socket is known</span>
00198         <span class="comment">// we can bind it to the port</span>
00199         <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *sifpOut1 = <span class="keyword">new</span> <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a>(<span class="stringliteral">"bind()"</span>);
00200         <a class="code" href="class_i_p_address.html">IPAddress</a> ipaddr(_destinationAddress);
00201         <span class="keywordflow">if</span> (ipaddr.isMulticast()) {
00202             sifpOut1-&gt;<a class="code" href="class_socket_interface_packet.html#a9">bind</a>(_socketFdIn, <a class="code" href="_transport_2_r_t_p_2tmp_2defs_8h.html#a0">IN_Addr</a>(_destinationAddress), <a class="code" href="_transport_2_r_t_p_2tmp_2defs_8h.html#a1">IN_Port</a>(_port));
00203         }
00204         <span class="keywordflow">else</span> {
00205             sifpOut1-&gt;<a class="code" href="class_socket_interface_packet.html#a9">bind</a>(_socketFdIn, IPADDRESS_UNDEF, <a class="code" href="_transport_2_r_t_p_2tmp_2defs_8h.html#a1">IN_Port</a>(_port));
00206         }
00207         send(sifpOut1, <span class="stringliteral">"toSocketLayer"</span>);
00208 
00209         <a class="code" href="class_r_t_c_p_endsystem_module.html#d1">createClientSocket</a>();
00210     }
00211 
00212     <span class="comment">// server socket already exists, client socket is created</span>
00213     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_socketFdOut == Socket::FILEDESC_UNDEF) {
00214 
00215         <a class="code" href="class_r_t_c_p_endsystem_module.html#r10">_socketFdOut</a> = sifpIn-&gt;<a class="code" href="class_socket_interface_packet.html#a31">filedesc</a>();
00216 
00217         <span class="comment">// now connect it, which means set foreign address and port</span>
00218         <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a> *sifpOut = <span class="keyword">new</span> <a class="code" href="class_socket_interface_packet.html">SocketInterfacePacket</a>(<span class="stringliteral">"connect()"</span>);
00219         sifpOut-&gt;<a class="code" href="class_socket_interface_packet.html#a12">connect</a>(_socketFdOut, _destinationAddress, _port);
00220         send(sifpOut, <span class="stringliteral">"toSocketLayer"</span>);
00221 
00222     }
00223     <span class="keywordflow">else</span> {
00224         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"RTCPEndsystemModule: received unrequested socket from socket layer !"</span> &lt;&lt; endl;
00225     }
00226 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="r12" doxytag="RTCPEndsystemModule::_averagePacketSize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_r_t_c_p_endsystem_module.html#r12">RTCPEndsystemModule::_averagePacketSize</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The average size of an <a class="el" href="class_r_t_c_p_compound_packet.html">RTCPCompoundPacket</a>.     </td>
  </tr>
</table>
<a class="anchor" name="r1" doxytag="RTCPEndsystemModule::_bandwidth"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_r_t_c_p_endsystem_module.html#r1">RTCPEndsystemModule::_bandwidth</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The bandwidth for this rtp session.     </td>
  </tr>
</table>
<a class="anchor" name="r3" doxytag="RTCPEndsystemModule::_destinationAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">IN_Addr <a class="el" href="class_r_t_c_p_endsystem_module.html#r3">RTCPEndsystemModule::_destinationAddress</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The destination address.     </td>
  </tr>
</table>
<a class="anchor" name="r6" doxytag="RTCPEndsystemModule::_leaveSession"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool <a class="el" href="class_r_t_c_p_endsystem_module.html#r6">RTCPEndsystemModule::_leaveSession</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
True when this end system is about to leave the session.     </td>
  </tr>
</table>
<a class="anchor" name="r0" doxytag="RTCPEndsystemModule::_mtu"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_r_t_c_p_endsystem_module.html#r0">RTCPEndsystemModule::_mtu</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The maximum size an RTCPCompundPacket can have.     </td>
  </tr>
</table>
<a class="anchor" name="r11" doxytag="RTCPEndsystemModule::_packetsCalculated"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_r_t_c_p_endsystem_module.html#r11">RTCPEndsystemModule::_packetsCalculated</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The number of packets this rtcp module has calculated.     </td>
  </tr>
</table>
<a class="anchor" name="r8" doxytag="RTCPEndsystemModule::_participantInfos"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cArray* <a class="el" href="class_r_t_c_p_endsystem_module.html#r8">RTCPEndsystemModule::_participantInfos</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Information about all known rtp end system participating in this rtp session.     </td>
  </tr>
</table>
<a class="anchor" name="r4" doxytag="RTCPEndsystemModule::_port"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">IN_Port <a class="el" href="class_r_t_c_p_endsystem_module.html#r4">RTCPEndsystemModule::_port</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The rtcp port.     </td>
  </tr>
</table>
<a class="anchor" name="r13" doxytag="RTCPEndsystemModule::_rtcpIntervalOutVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector* <a class="el" href="class_r_t_c_p_endsystem_module.html#r13">RTCPEndsystemModule::_rtcpIntervalOutVector</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The output vector for statistical data about the behaviour of rtcp. Every participant's rtcp module writes its calculated rtcp interval (without variation     </td>
  </tr>
</table>
<a class="anchor" name="r2" doxytag="RTCPEndsystemModule::_rtcpPercentage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_r_t_c_p_endsystem_module.html#r2">RTCPEndsystemModule::_rtcpPercentage</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The percentage of bandwidth for rtcp.     </td>
  </tr>
</table>
<a class="anchor" name="r7" doxytag="RTCPEndsystemModule::_senderInfo"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_r_t_p_sender_info.html">RTPSenderInfo</a>* <a class="el" href="class_r_t_c_p_endsystem_module.html#r7">RTCPEndsystemModule::_senderInfo</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The <a class="el" href="class_r_t_p_sender_info.html">RTPSenderInfo</a> about this end system.     </td>
  </tr>
</table>
<a class="anchor" name="r9" doxytag="RTCPEndsystemModule::_socketFdIn"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_socket.html#w0">Socket::Filedesc</a> <a class="el" href="class_r_t_c_p_endsystem_module.html#r9">RTCPEndsystemModule::_socketFdIn</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The server socket for receiving rtcp packets.     </td>
  </tr>
</table>
<a class="anchor" name="r10" doxytag="RTCPEndsystemModule::_socketFdOut"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_socket.html#w0">Socket::Filedesc</a> <a class="el" href="class_r_t_c_p_endsystem_module.html#r10">RTCPEndsystemModule::_socketFdOut</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The client socket for sending rtcp packets.     </td>
  </tr>
</table>
<a class="anchor" name="r5" doxytag="RTCPEndsystemModule::_ssrcChosen"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool <a class="el" href="class_r_t_c_p_endsystem_module.html#r5">RTCPEndsystemModule::_ssrcChosen</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
True when this end system has chosen its ssrc identifier.     </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_r_t_c_p_endsystem_module_8h.html">RTCPEndsystemModule.h</a><li><a class="el" href="_r_t_c_p_endsystem_module_8cc.html">RTCPEndsystemModule.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:29 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
