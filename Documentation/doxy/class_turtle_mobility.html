<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: TurtleMobility Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TurtleMobility Class Reference</h1><code>#include &lt;TurtleMobility.h&gt;</code>
<p>
<p>Inheritance diagram for TurtleMobility:
<p><center><img src="class_turtle_mobility.png" usemap="#TurtleMobility_map" border="0" alt=""></center>
<map name="TurtleMobility_map">
<area href="class_line_segments_mobility_base.html" alt="LineSegmentsMobilityBase" shape="rect" coords="0,168,162,192">
<area href="class_basic_mobility.html" alt="BasicMobility" shape="rect" coords="0,112,162,136">
<area href="class_basic_module.html" alt="BasicModule" shape="rect" coords="0,56,162,80">
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="0,0,162,24">
</map>
<a href="class_turtle_mobility-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
LOGO-style movement model, with the script coming from XML. See NED file for more info. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Andras Varga </dd></dl>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#b0">initialize</a> (int)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes mobility model parameters.  <a href="#b0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#b1">setTargetPosition</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Overridden from <a class="el" href="class_line_segments_mobility_base.html">LineSegmentsMobilityBase</a>. Invokes <a class="el" href="class_turtle_mobility.html#b3">resumeScript()</a>.  <a href="#b1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#b2">fixIfHostGetsOutside</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Overridden from <a class="el" href="class_line_segments_mobility_base.html">LineSegmentsMobilityBase</a>.  <a href="#b2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#b3">resumeScript</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process next statements from script.  <a href="#b3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#b4">executeStatement</a> (cXMLElement *<a class="el" href="class_turtle_mobility.html#p1">nextStatement</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute the given statement.  <a href="#b4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#b5">getValue</a> (const char *s)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Parse attrs in the script -- accepts things like "uniform(10,50) as well.  <a href="#b5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#b6">gotoNextStatement</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Advance nextStatement pointer.  <a href="#b6"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">cXMLElement *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#p0">turtleScript</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cXMLElement *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#p1">nextStatement</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#p2">speed</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#p3">angle</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_basic_mobility.html#w4">BorderPolicy</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#p4">borderPolicy</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">std::stack&lt; long &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_turtle_mobility.html#p5">loopVars</a></td></tr>

</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b4" doxytag="TurtleMobility::executeStatement"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TurtleMobility::executeStatement           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cXMLElement *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>nextStatement</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Execute the given statement. 
<p>
<div class="fragment"><pre class="fragment">00094 {
00095     <span class="keyword">const</span> <span class="keywordtype">char</span> *tag = stmt-&gt;getTagName();
00096 
00097     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"doing &lt;"</span> &lt;&lt; tag &lt;&lt; <span class="stringliteral">"&gt;\n"</span>;
00098 
00099     <span class="keywordflow">if</span> (!strcmp(tag,<span class="stringliteral">"repeat"</span>))
00100     {
00101         <span class="keyword">const</span> <span class="keywordtype">char</span> *nAttr = stmt-&gt;getAttribute(<span class="stringliteral">"n"</span>);
00102         <span class="keywordtype">long</span> n = -1;  <span class="comment">// infinity -- that's the default</span>
00103         <span class="keywordflow">if</span> (nAttr)
00104         {
00105             n = (long) <a class="code" href="class_turtle_mobility.html#b5">getValue</a>(nAttr);
00106             <span class="keywordflow">if</span> (n&lt;0)
00107                 error("&lt;repeat&gt;: negative repeat count at %s", stmt-&gt;getSourceLocation());
00108         }
00109         loopVars.push(n);
00110     }
00111     else if (!strcmp(tag,"set"))
00112     {
00113         <span class="keyword">const</span> <span class="keywordtype">char</span> *speedAttr = stmt-&gt;getAttribute(<span class="stringliteral">"speed"</span>);
00114         <span class="keyword">const</span> <span class="keywordtype">char</span> *angleAttr = stmt-&gt;getAttribute(<span class="stringliteral">"angle"</span>);
00115         <span class="keyword">const</span> <span class="keywordtype">char</span> *xAttr = stmt-&gt;getAttribute(<span class="stringliteral">"x"</span>);
00116         <span class="keyword">const</span> <span class="keywordtype">char</span> *yAttr = stmt-&gt;getAttribute(<span class="stringliteral">"y"</span>);
00117         <span class="keyword">const</span> <span class="keywordtype">char</span> *bpAttr = stmt-&gt;getAttribute(<span class="stringliteral">"borderPolicy"</span>);
00118         <span class="keywordflow">if</span> (speedAttr)
00119             speed = getValue(speedAttr);
00120         if (angleAttr)
00121             angle = getValue(angleAttr);
00122         if (xAttr)
00123             targetPos.x = pos.x = getValue(xAttr);
00124         if (yAttr)
00125             targetPos.y = pos.y = getValue(yAttr);
00126         if (speed&lt;=0)
00127             error("&lt;set&gt;: speed is negative or zero at %s", stmt-&gt;getSourceLocation());
00128         if (bpAttr)
00129         {
00130             <span class="keywordflow">if</span> (!strcmp(bpAttr,<span class="stringliteral">"reflect"</span>))
00131                 borderPolicy = REFLECT;
00132             else if (!strcmp(bpAttr,"wrap"))
00133                 borderPolicy = WRAP;
00134             else if (!strcmp(bpAttr,"placerandomly"))
00135                 borderPolicy = PLACERANDOMLY;
00136             else if (!strcmp(bpAttr,"error"))
00137                 borderPolicy = RAISEERROR;
00138             else
00139                 error("&lt;set&gt;: value for attribute borderPolicy is invalid, should be "
00140                       "'reflect', 'wrap', 'placerandomly' or 'error' at %s",
00141                       stmt-&gt;getSourceLocation());
00142         }
00143     }
00144     else if (!strcmp(tag,"forward"))
00145     {
00146         <span class="keyword">const</span> <span class="keywordtype">char</span> *dAttr = stmt-&gt;getAttribute(<span class="stringliteral">"d"</span>);
00147         <span class="keyword">const</span> <span class="keywordtype">char</span> *tAttr = stmt-&gt;getAttribute(<span class="stringliteral">"t"</span>);
00148         <span class="keywordflow">if</span> (!dAttr &amp;&amp; !tAttr)
00149             error("&lt;forward&gt;: must have at least attribute 't' or 'd' (or both) at %s", stmt-&gt;getSourceLocation());
00150         <span class="keywordtype">double</span> d, t;
00151         if (tAttr &amp;&amp; dAttr)
00152         {
00153             <span class="comment">// cover distance d in time t (current speed is ignored)</span>
00154             d = <a class="code" href="class_turtle_mobility.html#b5">getValue</a>(dAttr);
00155             t = <a class="code" href="class_turtle_mobility.html#b5">getValue</a>(tAttr);
00156         }
00157         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dAttr)
00158         {
00159             <span class="comment">// travel distance d at current speed</span>
00160             d = <a class="code" href="class_turtle_mobility.html#b5">getValue</a>(dAttr);
00161             t = d / <a class="code" href="class_turtle_mobility.html#p2">speed</a>;
00162         }
00163         <span class="keywordflow">else</span> <span class="comment">// tAttr only</span>
00164         {
00165             <span class="comment">// travel for time t at current speed</span>
00166             t = <a class="code" href="class_turtle_mobility.html#b5">getValue</a>(tAttr);
00167             d = <a class="code" href="class_turtle_mobility.html#p2">speed</a> * t;
00168         }
00169         <span class="keywordflow">if</span> (t&lt;0)
00170             error("&lt;forward&gt;: time (attribute t) is negative at %s", stmt-&gt;getSourceLocation());
00171         if (d&lt;0)
00172             error("&lt;forward&gt;: distance (attribute d) is negative at %s", stmt-&gt;getSourceLocation());
00173         <span class="comment">// FIXME handle zeros properly...</span>
00174         targetPos.x += d * cos(PI * angle / 180);
00175         targetPos.y += d * sin(PI * angle / 180);
00176         targetTime += t;
00177     }
00178     else if (!strcmp(tag,"turn"))
00179     {
00180         <span class="keyword">const</span> <span class="keywordtype">char</span> *angleAttr = stmt-&gt;getAttribute(<span class="stringliteral">"angle"</span>);
00181         <span class="keywordflow">if</span> (!angleAttr)
00182             error("&lt;turn&gt;: required attribute 'angle' missing at %s", stmt-&gt;getSourceLocation());
00183         angle += getValue(angleAttr);
00184     }
00185     else if (!strcmp(tag,"wait"))
00186     {
00187         <span class="keyword">const</span> <span class="keywordtype">char</span> *tAttr = stmt-&gt;getAttribute(<span class="stringliteral">"t"</span>);
00188         <span class="keywordflow">if</span> (!tAttr)
00189             error("&lt;wait&gt;: required attribute 't' missing at %s", stmt-&gt;getSourceLocation());
00190         <span class="keywordtype">double</span> t = getValue(tAttr);
00191         if (t&lt;0)
00192             error("&lt;wait&gt;: time (attribute t) is negative (%g) at %s", t, stmt-&gt;getSourceLocation());
00193         targetTime += t;  <span class="comment">// targetPos is unchanged</span>
00194     }
00195     else if (!strcmp(tag,"moveto"))
00196     {
00197         <span class="keyword">const</span> <span class="keywordtype">char</span> *xAttr = stmt-&gt;getAttribute(<span class="stringliteral">"x"</span>);
00198         <span class="keyword">const</span> <span class="keywordtype">char</span> *yAttr = stmt-&gt;getAttribute(<span class="stringliteral">"y"</span>);
00199         <span class="keyword">const</span> <span class="keywordtype">char</span> *tAttr = stmt-&gt;getAttribute(<span class="stringliteral">"t"</span>);
00200         <span class="keywordflow">if</span> (xAttr)
00201             targetPos.x = getValue(xAttr);
00202         if (yAttr)
00203             targetPos.y = getValue(yAttr);
00204         <span class="comment">// travel to targetPos at current speed, or get there in time t (ignoring current speed then)</span>
00205         <span class="keywordtype">double</span> t = tAttr ? getValue(tAttr) : pos.distance(targetPos)/speed;
00206         if (t&lt;0)
00207             error("&lt;wait&gt;: time (attribute t) is negative at %s", stmt-&gt;getSourceLocation());
00208         targetTime += t;
00209     }
00210     else if (!strcmp(tag,"moveby"))
00211     {
00212         <span class="keyword">const</span> <span class="keywordtype">char</span> *xAttr = stmt-&gt;getAttribute(<span class="stringliteral">"x"</span>);
00213         <span class="keyword">const</span> <span class="keywordtype">char</span> *yAttr = stmt-&gt;getAttribute(<span class="stringliteral">"y"</span>);
00214         <span class="keyword">const</span> <span class="keywordtype">char</span> *tAttr = stmt-&gt;getAttribute(<span class="stringliteral">"t"</span>);
00215         <span class="keywordflow">if</span> (xAttr)
00216             targetPos.x += getValue(xAttr);
00217         if (yAttr)
00218             targetPos.y += getValue(yAttr);
00219         <span class="comment">// travel to targetPos at current speed, or get there in time t (ignoring current speed then)</span>
00220         <span class="keywordtype">double</span> t = tAttr ? getValue(tAttr) : pos.distance(targetPos)/speed;
00221         if (t&lt;0)
00222             error("&lt;wait&gt;: time (attribute t) is negative at %s", stmt-&gt;getSourceLocation());
00223         targetTime += t;
00224     }
00225 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="TurtleMobility::fixIfHostGetsOutside"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TurtleMobility::fixIfHostGetsOutside           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Overridden from <a class="el" href="class_line_segments_mobility_base.html">LineSegmentsMobilityBase</a>. 
<p>

<p>
Implements <a class="el" href="class_line_segments_mobility_base.html#b4">LineSegmentsMobilityBase</a>.<div class="fragment"><pre class="fragment">00068 {
00069     <a class="code" href="class_basic_mobility.html#b12">handleIfOutside</a>(borderPolicy, targetPos, step, angle);
00070 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="TurtleMobility::getValue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double TurtleMobility::getValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>s</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Parse attrs in the script -- accepts things like "uniform(10,50) as well. 
<p>
<div class="fragment"><pre class="fragment">00228 {
00229     <span class="comment">// first, textually replace $MAXX and $MAXY with their actual values</span>
00230     std::string str;
00231     <span class="keywordflow">if</span> (strchr(s,<span class="charliteral">'$'</span>))
00232     {
00233         <span class="keywordtype">char</span> strMaxX[32], strMaxY[32];
00234         sprintf(strMaxX, <span class="stringliteral">"%g"</span>, <a class="code" href="class_basic_mobility.html#b5">playgroundSizeX</a>()-1);
00235         sprintf(strMaxY, <span class="stringliteral">"%g"</span>, <a class="code" href="class_basic_mobility.html#b6">playgroundSizeY</a>()-1);
00236 
00237         str = s;
00238         std::string::size_type <a class="code" href="class_basic_mobility.html#p3">pos</a>;
00239         <span class="keywordflow">while</span> ((pos = str.find(<span class="stringliteral">"$MAXX"</span>)) != std::string::npos)
00240             str.replace(pos, <span class="keyword">sizeof</span>(<span class="stringliteral">"$MAXX"</span>)-1, strMaxX);
00241         <span class="keywordflow">while</span> ((pos = str.find(<span class="stringliteral">"$MAXY"</span>)) != std::string::npos)
00242             str.replace(pos, <span class="keyword">sizeof</span>(<span class="stringliteral">"$MAXY"</span>)-1, strMaxY);
00243         s = str.c_str();
00244     }
00245 
00246     <span class="comment">// then use cPar to evaluate the string</span>
00247     cPar tmp;
00248     <span class="keywordflow">if</span> (!tmp.setFromText(s,<span class="charliteral">'?'</span>))
00249         error(<span class="stringliteral">"wrong value '%s' around %s"</span>, s, <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getSourceLocation());
00250     <span class="keywordflow">return</span> tmp.doubleValue();
00251 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="TurtleMobility::gotoNextStatement"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TurtleMobility::gotoNextStatement           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Advance nextStatement pointer. 
<p>
<div class="fragment"><pre class="fragment">00254 {
00255     <span class="comment">// "statement either doesn't have a child, or it's a &lt;repeat&gt; and loop count is already pushed on the stack"</span>
00256     ASSERT(!<a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getFirstChild() || (!strcmp(<a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getTagName(),<span class="stringliteral">"repeat"</span>) &amp;&amp; !<a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.empty()));
00257 
00258     <span class="keywordflow">if</span> (<a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getFirstChild() &amp;&amp; (<a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.top()!=0 || (<a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.pop(),<span class="keyword">false</span>)))   <span class="comment">// !=0: positive or -1</span>
00259     {
00260         <span class="comment">// statement must be a &lt;repeat&gt; if it has children; repeat count&gt;0 must be</span>
00261         <span class="comment">// on the stack; let's start doing the body.</span>
00262         <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a> = <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getFirstChild();
00263     }
00264     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getNextSibling())
00265     {
00266         <span class="comment">// no sibling -- either end of &lt;repeat&gt; body, or end of script</span>
00267         ASSERT(<a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getParentNode()==<a class="code" href="class_turtle_mobility.html#p0">turtleScript</a> ? <a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.empty() : !<a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.<a class="code" href="namespace_const_type.html#a5">empty</a>());
00268         <span class="keywordflow">if</span> (!<a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.empty())
00269         {
00270             <span class="comment">// decrement and check loop counter</span>
00271             <span class="keywordflow">if</span> (<a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.top()!=-1)  <span class="comment">// -1 means infinity</span>
00272                 <a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.top()--;
00273             <span class="keywordflow">if</span> (<a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.top()!=0)  <span class="comment">// positive or -1</span>
00274             {
00275                 <span class="comment">// go to beginning of &lt;repeat&gt; block again</span>
00276                 <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a> = <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getParentNode()-&gt;getFirstChild();
00277             }
00278             <span class="keywordflow">else</span>
00279             {
00280                 <span class="comment">// end of loop -- locate next statement after the &lt;repeat&gt;</span>
00281                 <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a> = <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getParentNode();
00282                 <a class="code" href="class_turtle_mobility.html#b6">gotoNextStatement</a>();
00283             }
00284         }
00285         <span class="keywordflow">else</span>
00286         {
00287             <span class="comment">// end of script</span>
00288             <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a> = NULL;
00289         }
00290     }
00291     <span class="keywordflow">else</span>
00292     {
00293         <span class="comment">// go to next statement (must exist -- see "if" above)</span>
00294         <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a> = <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a>-&gt;getNextSibling();
00295     }
00296 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="TurtleMobility::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TurtleMobility::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stage</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initializes mobility model parameters. 
<p>
Reads the parameters. If the host is not stationary it calculates a random position and schedules a timer to trigger the first movement 
<p>
Reimplemented from <a class="el" href="class_line_segments_mobility_base.html#b0">LineSegmentsMobilityBase</a>.<div class="fragment"><pre class="fragment">00032 {
00033     <a class="code" href="class_line_segments_mobility_base.html#b0">LineSegmentsMobilityBase::initialize</a>(stage);
00034 
00035     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"initializing TurtleMobility stage "</span> &lt;&lt; stage &lt;&lt; endl;
00036 
00037     <span class="keywordflow">if</span> (stage == 1)
00038     {
00039         <a class="code" href="class_turtle_mobility.html#p0">turtleScript</a> = par(<span class="stringliteral">"turtleScript"</span>);
00040         <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a> = <a class="code" href="class_turtle_mobility.html#p0">turtleScript</a>-&gt;getFirstChild();
00041 
00042         <a class="code" href="class_turtle_mobility.html#p2">speed</a> = 1;
00043         <a class="code" href="class_turtle_mobility.html#p3">angle</a> = 0;
00044         <a class="code" href="class_turtle_mobility.html#p4">borderPolicy</a> = <a class="code" href="class_basic_mobility.html#w4w0">REFLECT</a>;
00045 
00046         <span class="comment">// a dirty trick to extract starting position out of the script</span>
00047         <span class="comment">// (start doing it, but then rewind to the beginning)</span>
00048         <a class="code" href="class_turtle_mobility.html#b3">resumeScript</a>();
00049         <a class="code" href="class_line_segments_mobility_base.html#p2">targetPos</a> = <a class="code" href="class_basic_mobility.html#p3">pos</a>;
00050         <a class="code" href="class_line_segments_mobility_base.html#p1">targetTime</a> = simTime();
00051         <a class="code" href="class_turtle_mobility.html#p1">nextStatement</a> = <a class="code" href="class_turtle_mobility.html#p0">turtleScript</a>-&gt;getFirstChild();
00052         <span class="keywordflow">while</span> (!<a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.empty()) <a class="code" href="class_turtle_mobility.html#p5">loopVars</a>.pop();
00053 
00054         <a class="code" href="class_basic_mobility.html#b4">updatePosition</a>();
00055 
00056         WATCH(speed);
00057         WATCH(angle);
00058         <span class="comment">//WATCH(borderPolicy);</span>
00059     }
00060 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="TurtleMobility::resumeScript"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TurtleMobility::resumeScript           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Process next statements from script. 
<p>
Will set a new targetTime and targetPos <div class="fragment"><pre class="fragment">00076 {
00077     <span class="keywordflow">if</span> (!nextStatement)
00078     {
00079         <a class="code" href="class_line_segments_mobility_base.html#p4">stationary</a> = <span class="keyword">true</span>;
00080         <span class="keywordflow">return</span>;
00081     }
00082 
00083     simtime_t now = <a class="code" href="class_line_segments_mobility_base.html#p1">targetTime</a>;
00084 
00085     <span class="comment">// interpret statement</span>
00086     <span class="keywordflow">while</span> (nextStatement &amp;&amp; targetTime==now)
00087     {
00088         <a class="code" href="class_turtle_mobility.html#b4">executeStatement</a>(nextStatement);
00089         <a class="code" href="class_turtle_mobility.html#b6">gotoNextStatement</a>();
00090     }
00091 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="TurtleMobility::setTargetPosition"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void TurtleMobility::setTargetPosition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Overridden from <a class="el" href="class_line_segments_mobility_base.html">LineSegmentsMobilityBase</a>. Invokes <a class="el" href="class_turtle_mobility.html#b3">resumeScript()</a>. 
<p>

<p>
Implements <a class="el" href="class_line_segments_mobility_base.html#b3">LineSegmentsMobilityBase</a>.<div class="fragment"><pre class="fragment">00063 {
00064     <a class="code" href="class_turtle_mobility.html#b3">resumeScript</a>();
00065 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p3" doxytag="TurtleMobility::angle"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_turtle_mobility.html#p3">TurtleMobility::angle</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="TurtleMobility::borderPolicy"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_basic_mobility.html#w4">BorderPolicy</a> <a class="el" href="class_turtle_mobility.html#p4">TurtleMobility::borderPolicy</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="TurtleMobility::loopVars"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">std::stack&lt;long&gt; <a class="el" href="class_turtle_mobility.html#p5">TurtleMobility::loopVars</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="TurtleMobility::nextStatement"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cXMLElement* <a class="el" href="class_turtle_mobility.html#p1">TurtleMobility::nextStatement</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="TurtleMobility::speed"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_turtle_mobility.html#p2">TurtleMobility::speed</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="TurtleMobility::turtleScript"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cXMLElement* <a class="el" href="class_turtle_mobility.html#p0">TurtleMobility::turtleScript</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_turtle_mobility_8h.html">TurtleMobility.h</a><li><a class="el" href="_turtle_mobility_8cc.html">TurtleMobility.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:32 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
