<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: EtherLLC Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>EtherLLC Class Reference</h1><a href="class_ether_l_l_c-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Implements the LLC sub-layer of the Datalink Layer in Ethernet networks 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b1">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b2">finish</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b3">processPacketFromHigherLayer</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b4">processFrameFromMAC</a> (<a class="el" href="class_ether_frame_with_l_l_c.html">EtherFrameWithLLC</a> *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b5">handleRegisterSAP</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b6">handleDeregisterSAP</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b7">handleSendPause</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b8">findPortForSAP</a> (int sap)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#b9">updateDisplayString</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#p0">seqNum</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">std::map&lt; int, int &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#p1">dsapToPort</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#p2">dsapsRegistered</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#p3">totalFromHigherLayer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#p4">totalFromMAC</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#p5">totalPassedUp</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_l_l_c.html#p6">droppedUnknownDSAP</a></td></tr>

</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b8" doxytag="EtherLLC::findPortForSAP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int EtherLLC::findPortForSAP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sap</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00196 {
00197     <span class="comment">// here we actually do two lookups, but what the hell...</span>
00198     <span class="keywordflow">if</span> (<a class="code" href="class_ether_l_l_c.html#p1">dsapToPort</a>.find(dsap)==<a class="code" href="class_ether_l_l_c.html#p1">dsapToPort</a>.end())
00199         <span class="keywordflow">return</span> -1;
00200     <span class="keywordflow">return</span> <a class="code" href="class_ether_l_l_c.html#p1">dsapToPort</a>[dsap];
00201 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="EtherLLC::finish"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherLLC::finish           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00262 {
00263     <span class="keywordflow">if</span> (par(<span class="stringliteral">"writeScalars"</span>).boolValue())
00264     {
00265         recordScalar(<span class="stringliteral">"dsaps registered"</span>, dsapsRegistered);
00266         recordScalar(<span class="stringliteral">"packets from higher layer"</span>, totalFromHigherLayer);
00267         recordScalar(<span class="stringliteral">"frames from MAC"</span>, totalFromMAC);
00268         recordScalar(<span class="stringliteral">"packets passed up"</span>, totalPassedUp);
00269         recordScalar(<span class="stringliteral">"packets dropped - unknown DSAP"</span>, droppedUnknownDSAP);
00270     }
00271 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="EtherLLC::handleDeregisterSAP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherLLC::handleDeregisterSAP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00222 {
00223     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *etherctrl = dynamic_cast&lt;Ieee802Ctrl *&gt;(msg-&gt;removeControlInfo());
00224     <span class="keywordflow">if</span> (!etherctrl)
00225         error("packet `%s' from higher layer received without <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a>", msg-&gt;name());
00226     <span class="keywordtype">int</span> dsap = etherctrl-&gt;getDsap();
00227 
00228     EV &lt;&lt; "Deregistering higher layer with DSAP=" &lt;&lt; dsap &lt;&lt; "\n";
00229 
00230     <span class="comment">// delete from table (don't care if it's not in there)</span>
00231     dsapToPort.erase(dsapToPort.find(dsap));
00232     dsapsRegistered = dsapToPort.size();
00233     delete msg;
00234 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="EtherLLC::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherLLC::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00080 {
00081     <span class="keywordflow">switch</span> (msg-&gt;kind())
00082     {
00083       <span class="keywordflow">case</span> <a class="code" href="_ieee802_ctrl__m_8h.html#a18a1">IEEE802CTRL_DATA</a>:
00084         <span class="comment">// data received from higher layer</span>
00085         <a class="code" href="class_ether_l_l_c.html#b3">processPacketFromHigherLayer</a>(msg);
00086         <span class="keywordflow">break</span>;
00087 
00088       <span class="keywordflow">case</span> <a class="code" href="_ether_frame__m_8h.html#a2">ETH_FRAME</a>:
00089         <span class="comment">// frame received from lower layer</span>
00090         <a class="code" href="class_ether_l_l_c.html#b4">processFrameFromMAC</a>(check_and_cast&lt;EtherFrameWithLLC *&gt;(msg));
00091         <span class="keywordflow">break</span>;
00092 
00093       <span class="keywordflow">case</span> <a class="code" href="_ieee802_ctrl__m_8h.html#a18a2">IEEE802CTRL_REGISTER_DSAP</a>:
00094         <span class="comment">// higher layer registers itself</span>
00095         <a class="code" href="class_ether_l_l_c.html#b5">handleRegisterSAP</a>(msg);
00096         <span class="keywordflow">break</span>;
00097 
00098       <span class="keywordflow">case</span> <a class="code" href="_ieee802_ctrl__m_8h.html#a18a3">IEEE802CTRL_DEREGISTER_DSAP</a>:
00099         <span class="comment">// higher layer deregisters itself</span>
00100         <a class="code" href="class_ether_l_l_c.html#b6">handleDeregisterSAP</a>(msg);
00101         <span class="keywordflow">break</span>;
00102 
00103       <span class="keywordflow">case</span> <a class="code" href="_ieee802_ctrl__m_8h.html#a18a4">IEEE802CTRL_SENDPAUSE</a>:
00104         <span class="comment">// higher layer want MAC to send PAUSE frame</span>
00105         <a class="code" href="class_ether_l_l_c.html#b7">handleSendPause</a>(msg);
00106         <span class="keywordflow">break</span>;
00107 
00108       <span class="keywordflow">default</span>:
00109         error(<span class="stringliteral">"received message `%s' with unknown message kind %d"</span>,
00110               msg-&gt;name(), msg-&gt;kind());
00111     }
00112 
00113     <span class="keywordflow">if</span> (ev.isGUI())
00114         <a class="code" href="class_ether_l_l_c.html#b9">updateDisplayString</a>();
00115 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="EtherLLC::handleRegisterSAP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherLLC::handleRegisterSAP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00204 {
00205     <span class="keywordtype">int</span> port = msg-&gt;arrivalGate()-&gt;index();
00206     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *etherctrl = dynamic_cast&lt;Ieee802Ctrl *&gt;(msg-&gt;removeControlInfo());
00207     <span class="keywordflow">if</span> (!etherctrl)
00208         error("packet `%s' from higher layer received without <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a>", msg-&gt;name());
00209     <span class="keywordtype">int</span> dsap = etherctrl-&gt;getDsap();
00210 
00211     EV &lt;&lt; "Registering higher layer with DSAP=" &lt;&lt; dsap &lt;&lt; " on port=" &lt;&lt; port &lt;&lt; "\n";
00212 
00213     if (dsapToPort.find(dsap)!=dsapToPort.end())
00214         error("DSAP=%d already registered with port=%d", dsap, dsapToPort[dsap]);
00215 
00216     dsapToPort[dsap] = port;
00217     dsapsRegistered = dsapToPort.size();
00218     delete msg;
00219 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="EtherLLC::handleSendPause"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherLLC::handleSendPause           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00238 {
00239     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *etherctrl = dynamic_cast&lt;Ieee802Ctrl *&gt;(msg-&gt;removeControlInfo());
00240     <span class="keywordflow">if</span> (!etherctrl)
00241         error("PAUSE command `%s' from higher layer received without <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a>", msg-&gt;name());
00242 
00243     <span class="keywordtype">int</span> pauseUnits = etherctrl-&gt;getPauseUnits();
00244     EV &lt;&lt; "Creating and sending PAUSE frame, with duration=" &lt;&lt; pauseUnits &lt;&lt; " units\n";
00245 
00246     <span class="comment">// create Ethernet frame</span>
00247     <span class="keywordtype">char</span> framename[30];
00248     sprintf(framename, "pause-%d-%d", <span class="keywordtype">id</span>(), seqNum++);
00249     <a class="code" href="class_ether_pause_frame.html">EtherPauseFrame</a> *frame = new <a class="code" href="class_ether_pause_frame.html">EtherPauseFrame</a>(framename, ETH_PAUSE);
00250     frame-&gt;setPauseTime(pauseUnits);
00251 
00252     frame-&gt;setByteLength(ETHER_MAC_FRAME_BYTES+ETHER_PAUSE_COMMAND_BYTES);
00253     if (frame-&gt;byteLength() &lt; MIN_ETHERNET_FRAME)
00254         frame-&gt;setByteLength(MIN_ETHERNET_FRAME);
00255 
00256     send(frame, "lowerLayerOut");
00257 
00258     delete msg;
00259 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="EtherLLC::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherLLC::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00067 {
00068     <a class="code" href="class_ether_l_l_c.html#p0">seqNum</a> = 0;
00069     WATCH(seqNum);
00070 
00071     <a class="code" href="class_ether_l_l_c.html#p2">dsapsRegistered</a> = <a class="code" href="class_ether_l_l_c.html#p3">totalFromHigherLayer</a> = <a class="code" href="class_ether_l_l_c.html#p4">totalFromMAC</a> = <a class="code" href="class_ether_l_l_c.html#p5">totalPassedUp</a> = <a class="code" href="class_ether_l_l_c.html#p6">droppedUnknownDSAP</a> = 0;
00072     WATCH(dsapsRegistered);
00073     WATCH(totalFromHigherLayer);
00074     WATCH(totalFromMAC);
00075     WATCH(totalPassedUp);
00076     WATCH(droppedUnknownDSAP);
00077 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="EtherLLC::processFrameFromMAC"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherLLC::processFrameFromMAC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_ether_frame_with_l_l_c.html">EtherFrameWithLLC</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00163 {
00164     <a class="code" href="class_ether_l_l_c.html#p4">totalFromMAC</a>++;
00165 
00166     <span class="comment">// decapsulate it and pass up to higher layers.</span>
00167     <span class="keywordtype">int</span> sap = frame-&gt;<a class="code" href="class_ether_frame_with_l_l_c.html#a9">getDsap</a>();
00168     <span class="keywordtype">int</span> port = <a class="code" href="class_ether_l_l_c.html#b8">findPortForSAP</a>(sap);
00169     <span class="keywordflow">if</span> (port&lt;0)
00170     {
00171         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"No higher layer registered for DSAP="</span>&lt;&lt; sap &lt;&lt;<span class="stringliteral">", discarding frame `"</span> &lt;&lt; frame-&gt;name() &lt;&lt;<span class="stringliteral">"'\n"</span>;
00172         <a class="code" href="class_ether_l_l_c.html#p6">droppedUnknownDSAP</a>++;
00173         <span class="keyword">delete</span> frame;
00174         <span class="keywordflow">return</span>;
00175     }
00176 
00177     cMessage *higherlayermsg = frame-&gt;decapsulate();
00178 
00179     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *etherctrl = <span class="keyword">new</span> <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a>();
00180     etherctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a15">setSsap</a>(frame-&gt;<a class="code" href="class_ether_frame_with_l_l_c.html#a7">getSsap</a>());
00181     etherctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a17">setDsap</a>(frame-&gt;<a class="code" href="class_ether_frame_with_l_l_c.html#a9">getDsap</a>());
00182     etherctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a8">setSrc</a>(frame-&gt;<a class="code" href="class_ether_frame.html#a10">getSrc</a>());
00183     etherctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a11">setDest</a>(frame-&gt;<a class="code" href="class_ether_frame.html#a7">getDest</a>());
00184     higherlayermsg-&gt;setControlInfo(etherctrl);
00185 
00186     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Decapsulating frame `"</span> &lt;&lt; frame-&gt;name() &lt;&lt;<span class="stringliteral">"', "</span>
00187           <span class="stringliteral">"passing up contained packet `"</span> &lt;&lt; higherlayermsg-&gt;name() &lt;&lt; <span class="stringliteral">"' "</span>
00188           <span class="stringliteral">"to higher layer "</span> &lt;&lt; port &lt;&lt; <span class="stringliteral">"\n"</span>;
00189 
00190     send(higherlayermsg, <span class="stringliteral">"upperLayerOut"</span>, port);
00191     <a class="code" href="class_ether_l_l_c.html#p5">totalPassedUp</a>++;
00192     <span class="keyword">delete</span> frame;
00193 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="EtherLLC::processPacketFromHigherLayer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherLLC::processPacketFromHigherLayer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00129 {
00130     <span class="keywordflow">if</span> (msg-&gt;byteLength() &gt; (<a class="code" href="_ethernet_8h.html#a2">MAX_ETHERNET_DATA</a>-<a class="code" href="_ethernet_8h.html#a20">ETHER_LLC_HEADER_LENGTH</a>))
00131         error(<span class="stringliteral">"packet from higher layer (%d bytes) plus LLC header exceed maximum Ethernet payload length (%d)"</span>, msg-&gt;byteLength(), <a class="code" href="_ethernet_8h.html#a2">MAX_ETHERNET_DATA</a>);
00132 
00133     <a class="code" href="class_ether_l_l_c.html#p3">totalFromHigherLayer</a>++;
00134 
00135     <span class="comment">// Creates MAC header information and encapsulates received higher layer data</span>
00136     <span class="comment">// with this information and transmits resultant frame to lower layer</span>
00137 
00138     <span class="comment">// create Ethernet frame, fill it in from Ieee802Ctrl and encapsulate msg in it</span>
00139     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Encapsulating higher layer packet `"</span> &lt;&lt; msg-&gt;name() &lt;&lt;<span class="stringliteral">"' for MAC\n"</span>;
00140     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sent from "</span> &lt;&lt; simulation.module(msg-&gt;senderModuleId())-&gt;fullPath() &lt;&lt; <span class="stringliteral">" at "</span> &lt;&lt; msg-&gt;sendingTime() &lt;&lt; <span class="stringliteral">" and was created "</span> &lt;&lt; msg-&gt;creationTime() &lt;&lt;  <span class="stringliteral">"\n"</span>;
00141 
00142     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *etherctrl = dynamic_cast&lt;Ieee802Ctrl *&gt;(msg-&gt;removeControlInfo());
00143     <span class="keywordflow">if</span> (!etherctrl)
00144         error("packet `%s' from higher layer received without <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a>", msg-&gt;name());
00145 
00146     <a class="code" href="class_ether_frame_with_l_l_c.html">EtherFrameWithLLC</a> *frame = new <a class="code" href="class_ether_frame_with_l_l_c.html">EtherFrameWithLLC</a>(msg-&gt;name(), ETH_FRAME);
00147 
00148     frame-&gt;setControl(0);
00149     frame-&gt;setSsap(etherctrl-&gt;getSsap());
00150     frame-&gt;setDsap(etherctrl-&gt;getDsap());
00151     frame-&gt;setDest(etherctrl-&gt;getDest()); <span class="comment">// src address is filled in by MAC</span>
00152     frame-&gt;setByteLength(ETHER_MAC_FRAME_BYTES+ETHER_LLC_HEADER_LENGTH);
00153     delete etherctrl;
00154 
00155     frame-&gt;encapsulate(msg);
00156     if (frame-&gt;byteLength() &lt; MIN_ETHERNET_FRAME)
00157         frame-&gt;setByteLength(MIN_ETHERNET_FRAME);
00158 
00159     send(frame, "lowerLayerOut");
00160 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="EtherLLC::updateDisplayString"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherLLC::updateDisplayString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00118 {
00119     <span class="keywordtype">char</span> buf[80];
00120     sprintf(buf, <span class="stringliteral">"passed up: %ld\nsent: %ld"</span>, totalPassedUp, totalFromHigherLayer);
00121     <span class="keywordflow">if</span> (droppedUnknownDSAP&gt;0)
00122     {
00123         sprintf(buf+strlen(buf), <span class="stringliteral">"\ndropped (wrong DSAP): %ld"</span>, droppedUnknownDSAP);
00124     }
00125     displayString().setTagArg(<span class="stringliteral">"t"</span>,0,buf);
00126 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p6" doxytag="EtherLLC::droppedUnknownDSAP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ether_l_l_c.html#p6">EtherLLC::droppedUnknownDSAP</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="EtherLLC::dsapsRegistered"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ether_l_l_c.html#p2">EtherLLC::dsapsRegistered</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="EtherLLC::dsapToPort"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">std::map&lt;int,int&gt; <a class="el" href="class_ether_l_l_c.html#p1">EtherLLC::dsapToPort</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="EtherLLC::seqNum"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_ether_l_l_c.html#p0">EtherLLC::seqNum</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="EtherLLC::totalFromHigherLayer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ether_l_l_c.html#p3">EtherLLC::totalFromHigherLayer</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="EtherLLC::totalFromMAC"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ether_l_l_c.html#p4">EtherLLC::totalFromMAC</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="EtherLLC::totalPassedUp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ether_l_l_c.html#p5">EtherLLC::totalPassedUp</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="_ether_l_l_c_8cc.html">EtherLLC.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:22 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
