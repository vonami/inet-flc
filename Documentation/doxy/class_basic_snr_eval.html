<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: BasicSnrEval Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>BasicSnrEval Class Reference</h1><code>#include &lt;BasicSnrEval.h&gt;</code>
<p>
<p>Inheritance diagram for BasicSnrEval:
<p><center><img src="class_basic_snr_eval.png" usemap="#BasicSnrEval_map" border="0" alt=""></center>
<map name="BasicSnrEval_map">
<area href="class_channel_access.html" alt="ChannelAccess" shape="rect" coords="55,112,156,136">
<area href="class_basic_module.html" alt="BasicModule" shape="rect" coords="55,56,156,80">
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="55,0,156,24">
<area href="class_snr_eval.html" alt="SnrEval" shape="rect" coords="55,224,156,248">
<area href="class_gilbert_elliot_snr.html" alt="GilbertElliotSnr" shape="rect" coords="0,280,101,304">
<area href="class_snr_eval80211.html" alt="SnrEval80211" shape="rect" coords="111,280,212,304">
</map>
<a href="class_basic_snr_eval-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
The basic class for all snrEval modules. 
<p>
The BasicSnrEval module provides functionality like en- and decapsulation of messages. If you use the standard message formats everything should work fine. Before a packet is sent some information, e.g. transmission power, can be written to the <a class="el" href="class_air_frame.html">AirFrame</a> header. If you write your own snrEval, just subclass and redefine the handleUpperMsg function (see description of the function). After receiving a message it can be processed in handleLowerMsgStart. Then it is buffered for the time the transmission would last in reality, and then can be handled again. Again you can redefine the 1. handleLowerMsgStart and 2. handleLowerMsgEnd for your own needs (see description). So, the call of these functions represent the following events: 1. received a message (i.e. transmission startet) 2. message will be handed on to the upper layer (i.e. transmission time is over)<p>
This supports a single radio channel only<p>
<dl compact><dt><b>Author:</b></dt><dd>Marc Loebbers </dd></dl>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#b0">initialize</a> (int)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialization of the module and some variables.  <a href="#b0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#b1">handleMessage</a> (cMessage *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called every time a message arrives.  <a href="#b1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#b2">calcDuration</a> (cMessage *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function calculates the duration of the <a class="el" href="class_air_frame.html">AirFrame</a>.  <a href="#b2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#b3">channelNumber</a> () const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the channel we're listening on. This version always returns 0 (single radio channel supported).  <a href="#b3"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Handle Messages</div></td></tr>
<tr><td colspan="2"><div class="groupText">Functions to redefine by the programmer <br><br></div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z114_0">handleUpperMsg</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fill the header fields, redefine for your own needs...  <a href="#z114_0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z114_1">handleSelfMsg</a> (cMessage *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle self messages such as timer...  <a href="#z114_1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z114_2">handleLowerMsgStart</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculate Snr Information before buffering.  <a href="#z114_2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z114_3">handleLowerMsgEnd</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculate SnrInfo after buffering and add the PhySnrList to the message.  <a href="#z114_3"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Convenience Functions</div></td></tr>
<tr><td colspan="2"><div class="groupText">Functions for convenience - NOT to be modified<p>
These are functions taking care of message encapsulation and message sending. Normally you should not need to alter these but should use them to handle message encasulation and sending. They will wirte all necessary information into packet headers and add or strip the appropriate headers for each layer. <br><br></div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z116_0">bufferMsg</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *frame)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Buffers message for 'transmission time'.  <a href="#z116_0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z116_1">unbufferMsg</a> (cMessage *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unbuffers a message after 'transmission time'.  <a href="#z116_1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z116_2">sendUp</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *, <a class="el" href="_snr_list_8h.html#a0">SnrList</a> &amp;)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends a message to the upper layer.  <a href="#z116_2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z116_3">sendDown</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends a message to the channel.  <a href="#z116_3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual <a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z116_4">encapsMsg</a> (cMessage *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Encapsulates a MAC frame into an Air Frame.  <a href="#z116_4"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Abstraction layer</div></td></tr>
<tr><td colspan="2"><div class="groupText">Factory function to create <a class="el" href="class_air_frame.html">AirFrame</a> into which a MAC frame is encapsulated.<p>
<a class="el" href="class_snr_eval.html">SnrEval</a> authors should be able to use their own <a class="el" href="class_snr_eval.html">SnrEval</a> packets. The framework does not need to know about them, but must be able to produce new ones. Both goals can be reached by using a factory method.<p>
Overwrite this function in derived classes to use your own AirFrames <br><br></div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual <a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z118_0">createCapsulePkt</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new <a class="el" href="class_air_frame.html">AirFrame</a>.  <a href="#z118_0"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#p0">bitrate</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">a parameter that has to be read in from omnetpp.ini  <a href="#p0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#p1">headerLength</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">a parameter that has to be read in from omnetpp.ini  <a href="#p1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#p2">transmitterPower</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">power used to transmit messages  <a href="#p2"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z112_0">uppergateOut</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">gate id  <a href="#z112_0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_basic_snr_eval.html#z112_1">uppergateIn</a></td></tr>

</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="z116_0" doxytag="BasicSnrEval::bufferMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void BasicSnrEval::bufferMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Buffers message for 'transmission time'. 
<p>
The packet is put in a buffer for the time the transmission would last in reality. A timer indicates when the transmission is complete. So, look at unbufferMsg to see what happens when the transmission is complete.. <div class="fragment"><pre class="fragment">00118                                                     : add <span class="keyword">explicit</span> simtime_t atTime arg?
00119 {
00120     <span class="comment">// set timer to indicate transmission is complete</span>
00121     <a class="code" href="class_transm_complete.html">TransmComplete</a> *endRxTimer = <span class="keyword">new</span> <a class="code" href="class_transm_complete.html">TransmComplete</a>(NULL);
00122     endRxTimer-&gt;setContextPointer(frame);
00123     frame-&gt;setContextPointer(endRxTimer);
00124     <span class="comment">// NOTE: use arrivalTime instead of simTime, because we might be calling this</span>
00125     <span class="comment">// function during a channel change, when we're picking up ongoing transmissions</span>
00126     <span class="comment">// on the channel -- and then the message's arrival time is in the past!</span>
00127     scheduleAt(frame-&gt;arrivalTime() + frame-&gt;<a class="code" href="class_air_frame.html#a11">getDuration</a>(), endRxTimer);
00128 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="BasicSnrEval::calcDuration"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double BasicSnrEval::calcDuration           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>af</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function calculates the duration of the <a class="el" href="class_air_frame.html">AirFrame</a>. 
<p>
Usually the duration is just the frame length divided by the bitrate. However there may be cases (like 802.11) where the header has a different modulation (and thus a different bitrate) than the rest of the message.<p>
Just redefine this function in such a case! 
<p>
Reimplemented in <a class="el" href="class_snr_eval80211.html#b1">SnrEval80211</a>.<div class="fragment"><pre class="fragment">00158 {
00159     <span class="keywordtype">double</span> duration;
00160     duration = (double) af-&gt;length() / (double) <a class="code" href="class_basic_snr_eval.html#p0">bitrate</a>;
00161     <span class="keywordflow">return</span> duration;
00162 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="BasicSnrEval::channelNumber"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual int BasicSnrEval::channelNumber           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the channel we're listening on. This version always returns 0 (single radio channel supported). 
<p>

<p>
Reimplemented in <a class="el" href="class_snr_eval.html#b10">SnrEval</a>.<div class="fragment"><pre class="fragment">00142 {<span class="keywordflow">return</span> 0;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z118_0" doxytag="BasicSnrEval::createCapsulePkt"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual <a class="el" href="class_air_frame.html">AirFrame</a>* BasicSnrEval::createCapsulePkt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create a new <a class="el" href="class_air_frame.html">AirFrame</a>. 
<p>
<div class="fragment"><pre class="fragment">00159                                          {
00160         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_air_frame.html">AirFrame</a>();
00161     };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z116_4" doxytag="BasicSnrEval::encapsMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> * BasicSnrEval::encapsMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Encapsulates a MAC frame into an Air Frame. 
<p>
This function encapsulates messages from the upper layer into an <a class="el" href="class_air_frame.html">AirFrame</a>, copies the type and channel fields, adds the headerLength, sets the pSend (transmitterPower) and returns the <a class="el" href="class_air_frame.html">AirFrame</a>. <div class="fragment"><pre class="fragment">00137 {
00138     <a class="code" href="class_air_frame.html">AirFrame</a> *frame = <a class="code" href="class_basic_snr_eval.html#z118_0">createCapsulePkt</a>();
00139     frame-&gt;setName(msg-&gt;name());
00140     frame-&gt;<a class="code" href="class_air_frame.html#a8">setPSend</a>(transmitterPower);
00141     frame-&gt;setLength(headerLength);
00142     frame-&gt;<a class="code" href="class_air_frame.html#a10">setChannelNumber</a>(<a class="code" href="class_basic_snr_eval.html#b3">channelNumber</a>());
00143     frame-&gt;encapsulate(msg);
00144     frame-&gt;<a class="code" href="class_air_frame.html#a12">setDuration</a>(<a class="code" href="class_basic_snr_eval.html#b2">calcDuration</a>(frame));
00145     frame-&gt;<a class="code" href="class_air_frame.html#a17">setSenderPos</a>(<a class="code" href="class_channel_access.html#b1">myPosition</a>());
00146     <span class="keywordflow">return</span> frame;
00147 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z114_3" doxytag="BasicSnrEval::handleLowerMsgEnd"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void BasicSnrEval::handleLowerMsgEnd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Calculate SnrInfo after buffering and add the PhySnrList to the message. 
<p>
Redefine this function if you want to process messages from the channel before they are forwarded to upper layers<p>
This function is called right before a packet is handed on to the upper layer, i.e. right after unbufferMsg. Again you can caluculate some more SNR information if you want.<p>
You have to copy / create the SnrList related to the message and pass it to <a class="el" href="class_basic_snr_eval.html#z116_2">sendUp()</a> if you want to pass the message to the decider.<p>
Do not forget to send the message to the upper layer with <a class="el" href="class_basic_snr_eval.html#z116_2">sendUp()</a><p>
For a "real" implementaion take a look at <a class="el" href="class_snr_eval.html">SnrEval</a><p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="_snr_list_8h.html#a0">SnrList</a>, <a class="el" href="class_snr_eval.html">SnrEval</a> </dd></dl>

<p>
Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#b3">GilbertElliotSnr</a>, and <a class="el" href="class_snr_eval.html#b8">SnrEval</a>.<div class="fragment"><pre class="fragment">00242 {
00243     <a class="code" href="_basic_module_8cc.html#a0">coreEV</a> &lt;&lt; <span class="stringliteral">"in handleLowerMsgEnd\n"</span>;
00244 
00245     <span class="comment">// We need to create a "dummy" snr list that we can pass together</span>
00246     <span class="comment">// with the message to the decider module so that also the</span>
00247     <span class="comment">// BasicSnrEval is able to work.</span>
00248     <a class="code" href="_snr_list_8h.html#a0">SnrList</a> snrList;
00249 
00250     <span class="comment">// However you can take this as a reference how to create your own</span>
00251     <span class="comment">// snr entries.</span>
00252 
00253     <span class="comment">// Everytime you want to add something to the snr information list</span>
00254     <span class="comment">// it has to look like this:</span>
00255     <span class="comment">// 1. create a list entry and fill the fields</span>
00256     <a class="code" href="struct_snr_list_entry.html">SnrListEntry</a> listEntry;
00257     listEntry.<a class="code" href="struct_snr_list_entry.html#o0">time</a> = simTime();
00258     listEntry.<a class="code" href="struct_snr_list_entry.html#o1">snr</a> = 3;          <span class="comment">//just a senseless example</span>
00259 
00260     <span class="comment">// 2. add an entry to the SnrList</span>
00261     snrList.push_back(listEntry);
00262 
00263     <span class="comment">// 3. pass the message together with the list to the decider</span>
00264     <a class="code" href="class_basic_snr_eval.html#z116_2">sendUp</a>(frame, snrList);
00265 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z114_2" doxytag="BasicSnrEval::handleLowerMsgStart"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void BasicSnrEval::handleLowerMsgStart           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Calculate Snr Information before buffering. 
<p>
Redefine this function if you want to process messages from the channel before they are forwarded to upper layers<p>
This function is called right after a message is received, i.e. right before it is buffered for 'transmission time'.<p>
Here you should decide whether the message is "really" received or whether it's receive power is so low that it is just treated as noise.<p>
If the energy of the message is high enough to really receive it you should create an snr list (<a class="el" href="_snr_list_8h.html#a0">SnrList</a>) to be able to store sn(i)r information for that message. Every time a new message arrives you can add a new snr value together with a timestamp to that list. Make sure to store a pointer to the mesage together with the snr information to be able to retrieve it later.<p>
In this function also an initial SNR value can be calculated for this message.<p>
Please take a look at <a class="el" href="class_snr_eval.html">SnrEval</a> to see a "real" example.<p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="_snr_list_8h.html#a0">SnrList</a>, <a class="el" href="class_snr_eval.html">SnrEval</a> </dd></dl>

<p>
Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#b2">GilbertElliotSnr</a>, and <a class="el" href="class_snr_eval.html#b7">SnrEval</a>.<div class="fragment"><pre class="fragment">00293 {
00294     <a class="code" href="_basic_module_8cc.html#a0">coreEV</a> &lt;&lt; <span class="stringliteral">"in handleLowerMsgStart, receiving frame "</span> &lt;&lt; frame-&gt;name() &lt;&lt; endl;
00295 
00296     <span class="comment">//calculate the receive power</span>
00297 
00298     <span class="comment">// calculate snr information, like snr=pSend/noise or whatever....</span>
00299 
00300     <span class="comment">// if receive power is actually high enough to be able to read the</span>
00301     <span class="comment">// message and no other message is currently being received, store</span>
00302     <span class="comment">// the snr information for the message someweher where you can find</span>
00303     <span class="comment">// it in handleLowerMsgEnd</span>
00304 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="BasicSnrEval::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void BasicSnrEval::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Called every time a message arrives. 
<p>
The basic handle message function.<p>
Depending on the gate a message arrives handleMessage just calls different handle*Msg functions to further process the message.<p>
Messages from the channel are also buffered here in order to simulate a transmission delay<p>
You should not make any changes in this function but implement all your functionality into the handle*Msg functions called from here.<p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="class_basic_snr_eval.html#z114_0">handleUpperMsg</a>, <a class="el" href="class_basic_snr_eval.html#z114_2">handleLowerMsgStart</a>, <a class="el" href="class_basic_snr_eval.html#z114_3">handleLowerMsgEnd</a>, <a class="el" href="class_basic_snr_eval.html#z114_1">handleSelfMsg</a> </dd></dl>

<p>
Reimplemented in <a class="el" href="class_snr_eval.html#b3">SnrEval</a>.<div class="fragment"><pre class="fragment">00078 {
00079     <span class="keywordflow">if</span> (msg-&gt;arrivalGateId() == <a class="code" href="class_basic_snr_eval.html#z112_1">uppergateIn</a>)
00080     {
00081         <a class="code" href="class_air_frame.html">AirFrame</a> *frame = <a class="code" href="class_basic_snr_eval.html#z116_4">encapsMsg</a>(msg);
00082         <a class="code" href="class_basic_snr_eval.html#z114_0">handleUpperMsg</a>(frame);
00083     }
00084     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
00085     {
00086         <span class="keywordflow">if</span> (dynamic_cast&lt;TransmComplete *&gt;(msg) != 0)
00087         {
00088             <a class="code" href="_basic_module_8cc.html#a0">coreEV</a> &lt;&lt; <span class="stringliteral">"frame is completely received now\n"</span>;
00089 
00090             <span class="comment">// unbuffer the message</span>
00091             <a class="code" href="class_air_frame.html">AirFrame</a> *frame = <a class="code" href="class_basic_snr_eval.html#z116_1">unbufferMsg</a>(msg);
00092 
00093             <a class="code" href="class_basic_snr_eval.html#z114_3">handleLowerMsgEnd</a>(frame);
00094         }
00095         <span class="keywordflow">else</span>
00096             <a class="code" href="class_basic_snr_eval.html#z114_1">handleSelfMsg</a>(msg);
00097     }
00098     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (check_and_cast&lt;AirFrame *&gt;(msg)-&gt;getChannelNumber() == <a class="code" href="class_basic_snr_eval.html#b3">channelNumber</a>())
00099     {
00100         <span class="comment">// must be an AirFrame</span>
00101         <a class="code" href="class_air_frame.html">AirFrame</a> *frame = (<a class="code" href="class_air_frame.html">AirFrame</a> *) msg;
00102         <a class="code" href="class_basic_snr_eval.html#z114_2">handleLowerMsgStart</a>(frame);
00103         <a class="code" href="class_basic_snr_eval.html#z116_0">bufferMsg</a>(frame);
00104     }
00105     <span class="keywordflow">else</span>
00106     {
00107         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"listening to different channel when receiving message -- dropping it\n"</span>;
00108         <span class="keyword">delete</span> msg;
00109     }
00110 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z114_1" doxytag="BasicSnrEval::handleSelfMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual void BasicSnrEval::handleSelfMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle self messages such as timer... 
<p>
Define this function if you want to process timer or other kinds of self messages 
<p>
Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#b1">GilbertElliotSnr</a>, and <a class="el" href="class_snr_eval.html#b5">SnrEval</a>.<div class="fragment"><pre class="fragment">00097 {<span class="keyword">delete</span> msg;};
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z114_0" doxytag="BasicSnrEval::handleUpperMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void BasicSnrEval::handleUpperMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Fill the header fields, redefine for your own needs... 
<p>
Redefine this function if you want to process messages from upper layers before they are send to the channel.<p>
The MAC frame is already encapsulated in an <a class="el" href="class_air_frame.html">AirFrame</a> and all standard header fields are set.<p>
To forward the message to lower layers after processing it please use <a class="el" href="class_basic_snr_eval.html#z116_3">sendDown</a>. It will take care of decapsulation and anything else needed 
<p>
Reimplemented in <a class="el" href="class_snr_eval.html#b4">SnrEval</a>.<div class="fragment"><pre class="fragment">00220 {
00221     <a class="code" href="class_basic_snr_eval.html#z116_3">sendDown</a>(frame);
00222 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="BasicSnrEval::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void BasicSnrEval::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stage</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialization of the module and some variables. 
<p>
First we have to initialize the module from which we derived ours, in this case <a class="el" href="class_channel_access.html">ChannelAccess</a>.<p>
Then we have to intialize the gates and - if necessary - some own variables.<p>
If you want to use your own AirFrames you have to redefine createCapsulePkt function. 
<p>
Reimplemented from <a class="el" href="class_channel_access.html#b2">ChannelAccess</a>.
<p>
Reimplemented in <a class="el" href="class_gilbert_elliot_snr.html#b0">GilbertElliotSnr</a>, <a class="el" href="class_snr_eval.html#b0">SnrEval</a>, and <a class="el" href="class_snr_eval80211.html#b0">SnrEval80211</a>.<div class="fragment"><pre class="fragment">00041 {
00042     <a class="code" href="class_channel_access.html#b2">ChannelAccess::initialize</a>(stage);
00043 
00044     <a class="code" href="_basic_module_8cc.html#a0">coreEV</a> &lt;&lt; <span class="stringliteral">"Initializing BasicSnrEval, stage="</span> &lt;&lt; stage &lt;&lt; endl;
00045 
00046     <span class="keywordflow">if</span> (stage == 0)
00047     {
00048         <a class="code" href="class_basic_snr_eval.html#z112_1">uppergateIn</a> = findGate(<span class="stringliteral">"uppergateIn"</span>);
00049         <a class="code" href="class_basic_snr_eval.html#z112_0">uppergateOut</a> = findGate(<span class="stringliteral">"uppergateOut"</span>);
00050 
00051         <a class="code" href="class_basic_snr_eval.html#p1">headerLength</a> = par(<span class="stringliteral">"headerLength"</span>);
00052         <a class="code" href="class_basic_snr_eval.html#p0">bitrate</a> = par(<span class="stringliteral">"bitrate"</span>);
00053 
00054         <a class="code" href="class_basic_snr_eval.html#p2">transmitterPower</a> = par(<span class="stringliteral">"transmitterPower"</span>);
00055 
00056         <span class="comment">// transmitter power CANNOT be greater than in ChannelControl</span>
00057         <span class="keywordflow">if</span> (transmitterPower &gt; (<span class="keywordtype">double</span>) (<a class="code" href="class_channel_access.html#p0">cc</a>-&gt;par(<span class="stringliteral">"pMax"</span>)))
00058             error(<span class="stringliteral">"transmitterPower cannot be bigger than pMax in ChannelControl!"</span>);
00059     }
00060 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z116_3" doxytag="BasicSnrEval::sendDown"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void BasicSnrEval::sendDown           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sends a message to the channel. 
<p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="class_channel_access.html#b0">sendToChannel</a> </dd></dl>
<div class="fragment"><pre class="fragment">00191 {
00192     <a class="code" href="class_channel_access.html#b0">sendToChannel</a>(msg);
00193 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z116_2" doxytag="BasicSnrEval::sendUp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void BasicSnrEval::sendUp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="_snr_list_8h.html#a0">SnrList</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>list</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sends a message to the upper layer. 
<p>
Attach control info to the message and send message to the upper layer.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td><a class="el" href="class_air_frame.html">AirFrame</a> to pass to the decider </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>list</em>&nbsp;</td><td>Snr list to attach as control info</td></tr>
  </table>
</dl>
to be called within <a class="el" href="class_basic_snr_eval.html#z114_3">handleLowerMsgEnd</a>. <div class="fragment"><pre class="fragment">00174 {
00175     <span class="comment">// create ControlInfo</span>
00176     <a class="code" href="class_snr_control_info.html">SnrControlInfo</a> *cInfo = <span class="keyword">new</span> <a class="code" href="class_snr_control_info.html">SnrControlInfo</a>;
00177     <span class="comment">// attach the list to cInfo</span>
00178     cInfo-&gt;<a class="code" href="class_snr_control_info.html#a8">setSnrList</a>(list);
00179     <span class="comment">// attach the cInfo to the AirFrame</span>
00180     msg-&gt;setControlInfo(cInfo);
00181 
00182     send(msg, uppergateOut);
00183 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z116_1" doxytag="BasicSnrEval::unbufferMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> * BasicSnrEval::unbufferMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Unbuffers a message after 'transmission time'. 
<p>
Get the context pointer to the now completely received <a class="el" href="class_air_frame.html">AirFrame</a> and delete the self message <div class="fragment"><pre class="fragment">00200 {
00201     <a class="code" href="class_air_frame.html">AirFrame</a> *frame = (<a class="code" href="class_air_frame.html">AirFrame</a> *) msg-&gt;contextPointer();
00202     <span class="comment">//delete the self message</span>
00203     <span class="keyword">delete</span> msg;
00204 
00205     <span class="keywordflow">return</span> frame;
00206 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p0" doxytag="BasicSnrEval::bitrate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_basic_snr_eval.html#p0">BasicSnrEval::bitrate</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
a parameter that has to be read in from omnetpp.ini 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="BasicSnrEval::headerLength"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_basic_snr_eval.html#p1">BasicSnrEval::headerLength</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
a parameter that has to be read in from omnetpp.ini 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="BasicSnrEval::transmitterPower"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_basic_snr_eval.html#p2">BasicSnrEval::transmitterPower</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
power used to transmit messages 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z112_1" doxytag="BasicSnrEval::uppergateIn"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_basic_snr_eval.html#z112_1">BasicSnrEval::uppergateIn</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z112_0" doxytag="BasicSnrEval::uppergateOut"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_basic_snr_eval.html#z112_0">BasicSnrEval::uppergateOut</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
gate id 
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_basic_snr_eval_8h.html">BasicSnrEval.h</a><li><a class="el" href="_basic_snr_eval_8cc.html">BasicSnrEval.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:21 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
