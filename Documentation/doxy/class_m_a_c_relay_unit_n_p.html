<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: MACRelayUnitNP Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>MACRelayUnitNP Class Reference</h1><code>#include &lt;MACRelayUnitNP.h&gt;</code>
<p>
<p>Inheritance diagram for MACRelayUnitNP:
<p><center><img src="class_m_a_c_relay_unit_n_p.png" usemap="#MACRelayUnitNP_map" border="0" alt=""></center>
<map name="MACRelayUnitNP_map">
<area href="class_m_a_c_relay_unit_base.html" alt="MACRelayUnitBase" shape="rect" coords="0,0,122,24">
</map>
<a href="class_m_a_c_relay_unit_n_p-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
An implementation of the MAC Relay Unit that assumes a shared memory and N CPUs in the switch. The CPUs process frames from a single shared queue. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#a0">MACRelayUnitNP</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#a1">~MACRelayUnitNP</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#b0">handleIncomingFrame</a> (<a class="el" href="class_ether_frame.html">EtherFrame</a> *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#b1">processFrame</a> (cMessage *msg)</td></tr>

<tr><td colspan="2"><div class="groupHeader">Redefined cSimpleModule member functions.</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#z63_0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#z63_1">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#z63_2">finish</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">cQueue&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p0">queue</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p1">numCPUs</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p2">processingTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p3">bufferSize</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p4">highWatermark</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p5">pauseUnits</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p6">pauseInterval</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p7">bufferUsed</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p8">endProcEvents</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p9">pauseLastSent</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p10">numProcessedFrames</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p11">numDroppedFrames</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_n_p.html#p12">bufferLevel</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="MACRelayUnitNP::MACRelayUnitNP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">MACRelayUnitNP::MACRelayUnitNP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00044 {
00045     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p8">endProcEvents</a> = NULL;
00046     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p1">numCPUs</a> = 0;
00047 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="MACRelayUnitNP::~MACRelayUnitNP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">MACRelayUnitNP::~<a class="el" href="class_m_a_c_relay_unit_n_p.html">MACRelayUnitNP</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00050 {
00051     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numCPUs; i++)
00052         cancelAndDelete(endProcEvents[i]);
00053     delete [] endProcEvents;
00054 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="z63_2" doxytag="MACRelayUnitNP::finish"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitNP::finish           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Writes statistics. <div class="fragment"><pre class="fragment">00198 {
00199     <span class="keywordflow">if</span> (par(<span class="stringliteral">"writeScalars"</span>).boolValue())
00200     {
00201         recordScalar(<span class="stringliteral">"processed frames"</span>, numProcessedFrames);
00202         recordScalar(<span class="stringliteral">"dropped frames"</span>, numDroppedFrames);
00203     }
00204 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="MACRelayUnitNP::handleIncomingFrame"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitNP::handleIncomingFrame           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_ether_frame.html">EtherFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle incoming Ethernet frame: if buffer full discard it, otherwise, insert it into buffer and start processing if a processor is free. <div class="fragment"><pre class="fragment">00119 {
00120     <span class="comment">// If buffer not full, insert payload frame into buffer and process the frame in parallel.</span>
00121 
00122     <span class="keywordtype">long</span> length = frame-&gt;byteLength();
00123     <span class="keywordflow">if</span> (length + bufferUsed &lt; bufferSize)
00124     {
00125         <a class="code" href="class_m_a_c_relay_unit_n_p.html#p7">bufferUsed</a> += length;
00126 
00127         <span class="comment">// send PAUSE if above watermark</span>
00128         <span class="keywordflow">if</span> (pauseUnits&gt;0 &amp;&amp; highWatermark&gt;0 &amp;&amp; bufferUsed&gt;=highWatermark &amp;&amp; simTime()-pauseLastSent&gt;pauseInterval)
00129         {
00130             <span class="comment">// send PAUSE on all ports</span>
00131             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numPorts; i++)
00132                 sendPauseFrame(i, pauseUnits);
00133             pauseLastSent = simTime();
00134         }
00135 
00136         <span class="comment">// assign frame to a free CPU (if there is one)</span>
00137         <span class="keywordtype">int</span> i;
00138         for (i=0; i&lt;numCPUs; i++)
00139             if (!endProcEvents[i]-&gt;isScheduled())
00140                 break;
00141         if (i==numCPUs)
00142         {
00143             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"All CPUs busy, enqueueing incoming frame "</span> &lt;&lt; frame &lt;&lt; <span class="stringliteral">" for later processing\n"</span>;
00144             <a class="code" href="class_m_a_c_relay_unit_n_p.html#p0">queue</a>.insert(frame);
00145         }
00146         <span class="keywordflow">else</span>
00147         {
00148             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Idle CPU-"</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" starting processing of incoming frame "</span> &lt;&lt; frame &lt;&lt; endl;
00149             cMessage *msg = <a class="code" href="class_m_a_c_relay_unit_n_p.html#p8">endProcEvents</a>[i];
00150             msg-&gt;encapsulate(frame);
00151             scheduleAt(simTime() + processingTime, msg);
00152         }
00153     }
00154     <span class="comment">// Drop the frame and record the number of dropped frames</span>
00155     <span class="keywordflow">else</span>
00156     {
00157         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Buffer full, dropping frame "</span> &lt;&lt; frame &lt;&lt; endl;
00158         <span class="keyword">delete</span> frame;
00159         ++<a class="code" href="class_m_a_c_relay_unit_n_p.html#p11">numDroppedFrames</a>;
00160     }
00161 
00162     <span class="comment">// Record statistics of buffer usage levels</span>
00163     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p12">bufferLevel</a>.record(bufferUsed);
00164 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z63_1" doxytag="MACRelayUnitNP::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitNP::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Calls <a class="el" href="class_m_a_c_relay_unit_n_p.html#b0">handleIncomingFrame()</a> for frames arrived from outside, and <a class="el" href="class_m_a_c_relay_unit_n_p.html#b1">processFrame()</a> for self messages. <div class="fragment"><pre class="fragment">00105 {
00106     <span class="keywordflow">if</span> (!msg-&gt;isSelfMessage())
00107     {
00108         <span class="comment">// Frame received from MAC unit</span>
00109         <a class="code" href="class_m_a_c_relay_unit_n_p.html#b0">handleIncomingFrame</a>(check_and_cast&lt;EtherFrame *&gt;(msg));
00110     }
00111     <span class="keywordflow">else</span>
00112     {
00113         <span class="comment">// Self message signal used to indicate a frame has finished processing</span>
00114         <a class="code" href="class_m_a_c_relay_unit_n_p.html#b1">processFrame</a>(msg);
00115     }
00116 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z63_0" doxytag="MACRelayUnitNP::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitNP::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read parameters parameters. 
<p>
Reimplemented from <a class="el" href="class_m_a_c_relay_unit_base.html#b0">MACRelayUnitBase</a>.<div class="fragment"><pre class="fragment">00057 {
00058     <a class="code" href="class_m_a_c_relay_unit_base.html#b0">MACRelayUnitBase::initialize</a>();
00059 
00060     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p12">bufferLevel</a>.setName(<span class="stringliteral">"buffer level"</span>);
00061     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p0">queue</a>.setName(<span class="stringliteral">"queue"</span>);
00062 
00063     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p10">numProcessedFrames</a> = <a class="code" href="class_m_a_c_relay_unit_n_p.html#p11">numDroppedFrames</a> = 0;
00064     WATCH(numProcessedFrames);
00065     WATCH(numDroppedFrames);
00066 
00067     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p1">numCPUs</a> = par(<span class="stringliteral">"numCPUs"</span>);
00068 
00069     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p2">processingTime</a>    = par(<span class="stringliteral">"processingTime"</span>);
00070     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p3">bufferSize</a> = par(<span class="stringliteral">"bufferSize"</span>);
00071     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p4">highWatermark</a> = par(<span class="stringliteral">"highWatermark"</span>);
00072     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p5">pauseUnits</a> = par(<span class="stringliteral">"pauseUnits"</span>);
00073 
00074     <span class="comment">// 1 pause unit is 512 bit times; we assume 100Mb MACs here.</span>
00075     <span class="comment">// We send a pause again when previous one is about to expire.</span>
00076     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p6">pauseInterval</a> = <a class="code" href="class_m_a_c_relay_unit_n_p.html#p5">pauseUnits</a>*512.0/100000.0;
00077 
00078     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p9">pauseLastSent</a> = 0;
00079     WATCH(pauseLastSent);
00080 
00081     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p7">bufferUsed</a> = 0;
00082     WATCH(bufferUsed);
00083 
00084     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p8">endProcEvents</a> = <span class="keyword">new</span> cMessage *[<a class="code" href="class_m_a_c_relay_unit_n_p.html#p1">numCPUs</a>];
00085     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numCPUs; i++)
00086     {
00087         <span class="keywordtype">char</span> msgname[20];
00088         sprintf(msgname, <span class="stringliteral">"endProcessing-cpu%d"</span>, i);
00089         <a class="code" href="class_m_a_c_relay_unit_n_p.html#p8">endProcEvents</a>[i] = <span class="keyword">new</span> cMessage(msgname,i);
00090     }
00091 
00092     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Parameters of ("</span> &lt;&lt; className() &lt;&lt; <span class="stringliteral">") "</span> &lt;&lt; fullPath() &lt;&lt; <span class="stringliteral">"\n"</span>;
00093     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"number of processors: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_n_p.html#p1">numCPUs</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00094     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"processing time: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_n_p.html#p2">processingTime</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00095     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ports: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_base.html#p0">numPorts</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00096     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"buffer size: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_n_p.html#p3">bufferSize</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00097     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"address table size: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_base.html#p1">addressTableSize</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00098     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"aging time: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_base.html#p2">agingTime</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00099     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"high watermark: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_n_p.html#p4">highWatermark</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00100     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"pause time: "</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_n_p.html#p5">pauseUnits</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00101     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00102 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="MACRelayUnitNP::processFrame"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitNP::processFrame           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Triggered when a frame has completed processing, it routes the frame to the appropriate port, and starts processing the next frame. <div class="fragment"><pre class="fragment">00167 {
00168     <span class="keywordtype">int</span> cpu = msg-&gt;kind();
00169     <a class="code" href="class_ether_frame.html">EtherFrame</a> *frame = (<a class="code" href="class_ether_frame.html">EtherFrame</a> *) msg-&gt;decapsulate();
00170     <span class="keywordtype">long</span> length = frame-&gt;byteLength();
00171     <span class="keywordtype">int</span> inputport = frame-&gt;arrivalGate()-&gt;index();
00172 
00173     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"CPU-"</span> &lt;&lt; cpu &lt;&lt; <span class="stringliteral">" completed processing of frame "</span> &lt;&lt; frame &lt;&lt; endl;
00174 
00175     <a class="code" href="class_m_a_c_relay_unit_base.html#b1">handleAndDispatchFrame</a>(frame, inputport);
00176     <a class="code" href="class_m_a_c_relay_unit_base.html#b6">printAddressTable</a>();
00177 
00178     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p7">bufferUsed</a> -= length;
00179     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p12">bufferLevel</a>.record(bufferUsed);
00180 
00181     <a class="code" href="class_m_a_c_relay_unit_n_p.html#p10">numProcessedFrames</a>++;
00182 
00183     <span class="comment">// Process next frame in queue if they are pending</span>
00184     <span class="keywordflow">if</span> (!<a class="code" href="class_m_a_c_relay_unit_n_p.html#p0">queue</a>.empty())
00185     {
00186         <a class="code" href="class_ether_frame.html">EtherFrame</a> *newframe = (<a class="code" href="class_ether_frame.html">EtherFrame</a> *) <a class="code" href="class_m_a_c_relay_unit_n_p.html#p0">queue</a>.pop();
00187         msg-&gt;encapsulate(newframe);
00188         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"CPU-"</span> &lt;&lt; cpu &lt;&lt; <span class="stringliteral">" starting processing of frame "</span> &lt;&lt; newframe &lt;&lt; endl;
00189         scheduleAt(simTime()+processingTime, msg);
00190     }
00191     <span class="keywordflow">else</span>
00192     {
00193         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"CPU-"</span> &lt;&lt; cpu &lt;&lt; <span class="stringliteral">" idle\n"</span>;
00194     }
00195 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p12" doxytag="MACRelayUnitNP::bufferLevel"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector <a class="el" href="class_m_a_c_relay_unit_n_p.html#p12">MACRelayUnitNP::bufferLevel</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="MACRelayUnitNP::bufferSize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_n_p.html#p3">MACRelayUnitNP::bufferSize</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p7" doxytag="MACRelayUnitNP::bufferUsed"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_n_p.html#p7">MACRelayUnitNP::bufferUsed</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p8" doxytag="MACRelayUnitNP::endProcEvents"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage** <a class="el" href="class_m_a_c_relay_unit_n_p.html#p8">MACRelayUnitNP::endProcEvents</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="MACRelayUnitNP::highWatermark"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_m_a_c_relay_unit_n_p.html#p4">MACRelayUnitNP::highWatermark</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="MACRelayUnitNP::numCPUs"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_n_p.html#p1">MACRelayUnitNP::numCPUs</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p11" doxytag="MACRelayUnitNP::numDroppedFrames"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_m_a_c_relay_unit_n_p.html#p11">MACRelayUnitNP::numDroppedFrames</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p10" doxytag="MACRelayUnitNP::numProcessedFrames"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_m_a_c_relay_unit_n_p.html#p10">MACRelayUnitNP::numProcessedFrames</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p6" doxytag="MACRelayUnitNP::pauseInterval"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_m_a_c_relay_unit_n_p.html#p6">MACRelayUnitNP::pauseInterval</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p9" doxytag="MACRelayUnitNP::pauseLastSent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_m_a_c_relay_unit_n_p.html#p9">MACRelayUnitNP::pauseLastSent</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="MACRelayUnitNP::pauseUnits"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_n_p.html#p5">MACRelayUnitNP::pauseUnits</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="MACRelayUnitNP::processingTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_m_a_c_relay_unit_n_p.html#p2">MACRelayUnitNP::processingTime</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="MACRelayUnitNP::queue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cQueue <a class="el" href="class_m_a_c_relay_unit_n_p.html#p0">MACRelayUnitNP::queue</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_m_a_c_relay_unit_n_p_8h.html">MACRelayUnitNP.h</a><li><a class="el" href="_m_a_c_relay_unit_n_p_8cc.html">MACRelayUnitNP.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:26 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
