<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: UDP Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>UDP Class Reference</h1><code>#include &lt;UDP.h&gt;</code>
<p>
<a href="class_u_d_p-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Implements the UDP protocol: encapsulates/decapsulates user data into/from UDP.<p>
More info in the NED file. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::list&lt; <a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#w0">SockDescList</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::map&lt; int, <a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#w1">SocketsByIdMap</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::map&lt; int, <a class="el" href="class_u_d_p.html#w0">SockDescList</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#w2">SocketsByPortMap</a></td></tr>

<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a0">UDP</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#a1">~UDP</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b0">updateDisplayString</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b1">bind</a> (int gateIndex, <a class="el" href="class_u_d_p_control_info.html">UDPControlInfo</a> *ctrl)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b2">connect</a> (int sockId, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> addr, int port)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b3">unbind</a> (int sockId)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">short&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b4">getEphemeralPort</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b5">matchesSocket</a> (<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd, <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udp, <a class="el" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b6">matchesSocket</a> (<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd, <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udp, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b7">matchesSocket</a> (<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;localAddr, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;remoteAddr, short remotePort)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b8">sendUp</a> (cMessage *payload, <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udpHeader, <a class="el" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl, <a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b9">sendUp</a> (cMessage *payload, <a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udpHeader, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl, <a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b10">processUndeliverablePacket</a> (<a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udpPacket, cPolymorphic *ctrl)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b11">sendUpErrorNotification</a> (<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *sd, int msgkind, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;localAddr, const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;remoteAddr, short remotePort)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b12">processICMPError</a> (cMessage *icmpErrorMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b13">processUDPPacket</a> (<a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *udpPacket)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b14">processMsgFromApp</a> (cMessage *appData)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b15">processCommandFromApp</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b16">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#b17">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_u_d_p.html#w1">SocketsByIdMap</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#p0">socketsByIdMap</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_u_d_p.html#w2">SocketsByPortMap</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#p1">socketsByPortMap</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">short&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#p2">lastEphemeralPort</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_c_m_p.html">ICMP</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#p3">icmp</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_c_m_pv6.html">ICMPv6</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#p4">icmpv6</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#p5">numSent</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#p6">numPassedUp</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#p7">numDroppedWrongPort</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_d_p.html#p8">numDroppedBadChecksum</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a></td></tr>

</table>
<hr><h2>Member Typedef Documentation</h2>
<a class="anchor" name="w0" doxytag="UDP::SockDescList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::list&lt;<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&gt; <a class="el" href="class_u_d_p.html#w0">UDP::SockDescList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w1" doxytag="UDP::SocketsByIdMap"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::map&lt;int,<a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&gt; <a class="el" href="class_u_d_p.html#w1">UDP::SocketsByIdMap</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w2" doxytag="UDP::SocketsByPortMap"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::map&lt;int,<a class="el" href="class_u_d_p.html#w0">SockDescList</a>&gt; <a class="el" href="class_u_d_p.html#w2">UDP::SocketsByPortMap</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="UDP::UDP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">UDP::UDP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00120 {}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="UDP::~UDP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">UDP::~<a class="el" href="class_u_d_p.html">UDP</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00077 {
00078     <span class="keywordflow">for</span> (SocketsByIdMap::iterator i=<a class="code" href="class_u_d_p.html#p0">socketsByIdMap</a>.begin(); i!=<a class="code" href="class_u_d_p.html#p0">socketsByIdMap</a>.end(); ++i)
00079         <span class="keyword">delete</span> i-&gt;second;
00080 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b1" doxytag="UDP::bind"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::bind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>gateIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_u_d_p_control_info.html">UDPControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrl</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00102 {
00103     <span class="comment">// XXX checks could be added, of when the bind should be allowed to proceed</span>
00104 
00105     <span class="comment">// create and fill in SockDesc</span>
00106     SockDesc *sd = <span class="keyword">new</span> SockDesc();
00107     sd-&gt;sockId = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a6">sockId</a>();
00108     sd-&gt;<a class="code" href="class_u_d_p_control_info.html#a8">userId</a> = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a8">userId</a>();
00109     sd-&gt;appGateIndex = gateIndex;
00110     sd-&gt;localAddr = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a10">srcAddr</a>();
00111     sd-&gt;remoteAddr = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a13">destAddr</a>();
00112     sd-&gt;localPort = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a16">srcPort</a>();
00113     sd-&gt;remotePort = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a18">destPort</a>();
00114     sd-&gt;<a class="code" href="class_u_d_p_control_info.html#a20">interfaceId</a> = ctrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a20">interfaceId</a>();
00115 
00116     <span class="keywordflow">if</span> (sd-&gt;sockId==-1)
00117         error("sockId in BIND message not filled in");
00118     if (sd-&gt;localPort==0)
00119         sd-&gt;localPort = getEphemeralPort();
00120 
00121     sd-&gt;onlyLocalPortIsSet = sd-&gt;localAddr.isUnspecified() &amp;&amp;
00122                              sd-&gt;remoteAddr.isUnspecified() &amp;&amp;
00123                              sd-&gt;remotePort==0 &amp;&amp;
00124                              sd-&gt;interfaceId==-1;
00125 
00126     EV &lt;&lt; "Binding socket: " &lt;&lt; *sd &lt;&lt; "\n";
00127 
00128     <span class="comment">// add to socketsByIdMap</span>
00129     ASSERT(socketsByIdMap.find(sd-&gt;sockId)==socketsByIdMap.end());
00130     socketsByIdMap[sd-&gt;sockId] = sd;
00131 
00132     <span class="comment">// add to socketsByPortMap</span>
00133     SockDescList&amp; list = socketsByPortMap[sd-&gt;localPort]; <span class="comment">// create if doesn't exist</span>
00134     list.push_back(sd);
00135 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="UDP::connect"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::connect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>sockId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>port</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00138 {
00139     SocketsByIdMap::iterator it = <a class="code" href="class_u_d_p.html#p0">socketsByIdMap</a>.find(sockId);
00140     <span class="keywordflow">if</span> (it==<a class="code" href="class_u_d_p.html#p0">socketsByIdMap</a>.end())
00141         error(<span class="stringliteral">"socket id=%d doesn't exist (already closed?)"</span>, sockId);
00142     <span class="keywordflow">if</span> (addr.<a class="code" href="class_i_pv_x_address.html#z36_0">isUnspecified</a>())
00143         opp_error(<span class="stringliteral">"connect: unspecified remote address"</span>);
00144     <span class="keywordflow">if</span> (port&lt;=0 || port&gt;65535)
00145         opp_error("connect: invalid remote port number %d", port);
00146 
00147     SockDesc *sd = it-&gt;second;
00148     sd-&gt;remoteAddr = addr;
00149     sd-&gt;remotePort = port;
00150 
00151     sd-&gt;onlyLocalPortIsSet = false;
00152 
00153     EV &lt;&lt; "Connecting socket: " &lt;&lt; *sd &lt;&lt; "\n";
00154 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="UDP::getEphemeralPort"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">short UDP::getEphemeralPort           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00178 {
00179     <span class="comment">// start at the last allocated port number + 1, and search for an unused one</span>
00180     <span class="keywordtype">short</span> searchUntil = <a class="code" href="class_u_d_p.html#p2">lastEphemeralPort</a>++;
00181     <span class="keywordflow">if</span> (lastEphemeralPort == EPHEMERAL_PORTRANGE_END) <span class="comment">// wrap</span>
00182         lastEphemeralPort = EPHEMERAL_PORTRANGE_START;
00183 
00184     while (socketsByPortMap.find(lastEphemeralPort)!=socketsByPortMap.end())
00185     {
00186         <span class="keywordflow">if</span> (lastEphemeralPort == searchUntil) <span class="comment">// got back to starting point?</span>
00187             error("Ephemeral port range %d..%d exhausted, all ports occupied", EPHEMERAL_PORTRANGE_START, EPHEMERAL_PORTRANGE_END);
00188         lastEphemeralPort++;
00189         if (lastEphemeralPort == EPHEMERAL_PORTRANGE_END) <span class="comment">// wrap</span>
00190             lastEphemeralPort = EPHEMERAL_PORTRANGE_START;
00191     }
00192 
00193     <span class="comment">// found a free one, return it</span>
00194     return lastEphemeralPort;
00195 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b17" doxytag="UDP::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00198 {
00199     <span class="comment">// received from IP layer</span>
00200     <span class="keywordflow">if</span> (msg-&gt;arrivedOn(<span class="stringliteral">"from_ip"</span>) || msg-&gt;arrivedOn(<span class="stringliteral">"from_ipv6"</span>))
00201     {
00202         <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPMessage *&gt;(msg) || dynamic_cast&lt;ICMPv6Message *&gt;(msg))
00203             <a class="code" href="class_u_d_p.html#b12">processICMPError</a>(msg);
00204         <span class="keywordflow">else</span>
00205             <a class="code" href="class_u_d_p.html#b13">processUDPPacket</a>(check_and_cast&lt;UDPPacket *&gt;(msg));
00206     }
00207     <span class="keywordflow">else</span> <span class="comment">// received from application layer</span>
00208     {
00209         <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_u_d_p_control_info__m_8h.html#a9a1">UDP_C_DATA</a>)
00210             <a class="code" href="class_u_d_p.html#b14">processMsgFromApp</a>(msg);
00211         <span class="keywordflow">else</span>
00212             <a class="code" href="class_u_d_p.html#b15">processCommandFromApp</a>(msg);
00213     }
00214 
00215     <span class="keywordflow">if</span> (ev.isGUI())
00216         <a class="code" href="class_u_d_p.html#b0">updateDisplayString</a>();
00217 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b16" doxytag="UDP::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00083 {
00084     WATCH_PTRMAP(socketsByIdMap);
00085     WATCH_MAP(socketsByPortMap);
00086 
00087     <a class="code" href="class_u_d_p.html#p2">lastEphemeralPort</a> = <a class="code" href="_t_c_p_8cc.html#a0">EPHEMERAL_PORTRANGE_START</a>;
00088     <a class="code" href="structicmp.html">icmp</a> = NULL;
00089     <a class="code" href="class_u_d_p.html#p4">icmpv6</a> = NULL;
00090 
00091     <a class="code" href="class_u_d_p.html#p5">numSent</a> = 0;
00092     <a class="code" href="class_u_d_p.html#p6">numPassedUp</a> = 0;
00093     <a class="code" href="class_u_d_p.html#p7">numDroppedWrongPort</a> = 0;
00094     <a class="code" href="class_u_d_p.html#p8">numDroppedBadChecksum</a> = 0;
00095     WATCH(numSent);
00096     WATCH(numPassedUp);
00097     WATCH(numDroppedWrongPort);
00098     WATCH(numDroppedBadChecksum);
00099 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="UDP::matchesSocket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool UDP::matchesSocket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>sd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>localAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>remoteAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>short&nbsp;</td>
          <td class="mdname" nowrap> <em>remotePort</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00260 {
00261     <span class="keywordflow">return</span> (sd-&gt;remotePort==0 || sd-&gt;remotePort!=remotePort) &amp;&amp;
00262            (sd-&gt;localAddr.isUnspecified() || sd-&gt;localAddr==localAddr) &amp;&amp;
00263            (sd-&gt;remoteAddr.isUnspecified() || sd-&gt;remoteAddr==remoteAddr);
00264 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="UDP::matchesSocket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool UDP::matchesSocket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>sd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>udp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrl</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00246 {
00247     <span class="comment">// IPv6 version</span>
00248     <span class="keywordflow">if</span> (sd-&gt;remotePort!=0 &amp;&amp; sd-&gt;remotePort!=udp-&gt;<a class="code" href="class_u_d_p_packet.html#a7">sourcePort</a>())
00249         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00250     <span class="keywordflow">if</span> (!sd-&gt;localAddr.isUnspecified() &amp;&amp; sd-&gt;localAddr.get6()!=ipCtrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a5">destAddr</a>())
00251         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00252     <span class="keywordflow">if</span> (!sd-&gt;remoteAddr.isUnspecified() &amp;&amp; sd-&gt;remoteAddr.get6()!=ipCtrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>())
00253         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00254     <span class="keywordflow">if</span> (sd-&gt;interfaceId!=-1 &amp;&amp; sd-&gt;interfaceId!=ipCtrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a13">interfaceId</a>())
00255         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00256     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00257 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="UDP::matchesSocket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool UDP::matchesSocket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>sd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>udp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_control_info.html">IPControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrl</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00232 {
00233     <span class="comment">// IPv4 version</span>
00234     <span class="keywordflow">if</span> (sd-&gt;remotePort!=0 &amp;&amp; sd-&gt;remotePort!=udp-&gt;<a class="code" href="class_u_d_p_packet.html#a7">sourcePort</a>())
00235         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00236     <span class="keywordflow">if</span> (!sd-&gt;localAddr.isUnspecified() &amp;&amp; sd-&gt;localAddr.get4()!=ipCtrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a3">destAddr</a>())
00237         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00238     <span class="keywordflow">if</span> (!sd-&gt;remoteAddr.isUnspecified() &amp;&amp; sd-&gt;remoteAddr.get4()!=ipCtrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a6">srcAddr</a>())
00239         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00240     <span class="keywordflow">if</span> (sd-&gt;interfaceId!=-1 &amp;&amp; sd-&gt;interfaceId!=ipCtrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a9">interfaceId</a>())
00241         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00242     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00243 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b15" doxytag="UDP::processCommandFromApp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::processCommandFromApp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00531 {
00532     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = check_and_cast&lt;UDPControlInfo *&gt;(msg-&gt;removeControlInfo());
00533     <span class="keywordflow">switch</span> (msg-&gt;kind())
00534     {
00535         <span class="keywordflow">case</span> <a class="code" href="_u_d_p_control_info__m_8h.html#a9a2">UDP_C_BIND</a>:
00536             <a class="code" href="class_u_d_p.html#b1">bind</a>(msg-&gt;arrivalGate()-&gt;index(), udpCtrl);
00537             <span class="keywordflow">break</span>;
00538         <span class="keywordflow">case</span> <a class="code" href="_u_d_p_control_info__m_8h.html#a9a3">UDP_C_CONNECT</a>:
00539             <a class="code" href="class_u_d_p.html#b2">connect</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a6">sockId</a>(), udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a13">destAddr</a>(), udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a18">destPort</a>());
00540             <span class="keywordflow">break</span>;
00541         <span class="keywordflow">case</span> <a class="code" href="_u_d_p_control_info__m_8h.html#a9a4">UDP_C_UNBIND</a>:
00542             <a class="code" href="class_u_d_p.html#b3">unbind</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a6">sockId</a>());
00543             <span class="keywordflow">break</span>;
00544         <span class="keywordflow">default</span>:
00545             error(<span class="stringliteral">"unknown command code (message kind) %d received from app"</span>, msg-&gt;kind());
00546     }
00547 
00548     <span class="keyword">delete</span> udpCtrl;
00549     <span class="keyword">delete</span> msg;
00550 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b12" doxytag="UDP::processICMPError"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::processICMPError           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>icmpErrorMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00328 {
00329     <span class="comment">// extract details from the error message, then try to notify socket that sent bogus packet</span>
00330     <span class="keywordtype">int</span> type, code;
00331     <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> localAddr, remoteAddr;
00332     <span class="keywordtype">int</span> localPort, remotePort;
00333 
00334     <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPMessage *&gt;(msg))
00335     {
00336         <a class="code" href="class_i_c_m_p_message.html">ICMPMessage</a> *icmpMsg = (<a class="code" href="class_i_c_m_p_message.html">ICMPMessage</a> *)msg;
00337         type = icmpMsg-&gt;<a class="code" href="class_i_c_m_p_message.html#a7">getType</a>();
00338         code = icmpMsg-&gt;<a class="code" href="class_i_c_m_p_message.html#a9">getCode</a>();
00339         icmpMsg-&gt;setLength(icmpMsg-&gt;encapsulatedMsg()-&gt;length()); <span class="comment">// trick because payload in ICMP is conceptually truncated</span>
00340         <a class="code" href="class_i_p_datagram.html">IPDatagram</a> *datagram = check_and_cast&lt;IPDatagram *&gt;(icmpMsg-&gt;decapsulate());
00341         localAddr = datagram-&gt;<a class="code" href="class_i_p_datagram.html#a11">srcAddress</a>();
00342         remoteAddr = datagram-&gt;<a class="code" href="class_i_p_datagram.html#a14">destAddress</a>();
00343         <a class="code" href="class_u_d_p_packet.html">UDPPacket</a> *packet = check_and_cast&lt;UDPPacket *&gt;(datagram-&gt;decapsulate());
00344         localPort = packet-&gt;<a class="code" href="class_u_d_p_packet.html#a7">sourcePort</a>();
00345         remotePort = packet-&gt;<a class="code" href="class_u_d_p_packet.html#a9">destinationPort</a>();
00346         <span class="keyword">delete</span> icmpMsg;
00347         <span class="keyword">delete</span> datagram;
00348         <span class="keyword">delete</span> packet;
00349     }
00350     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPv6Message *&gt;(msg))
00351     {
00352         <a class="code" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *icmpMsg = (<a class="code" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *)msg;
00353         type = icmpMsg-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a7">type</a>();
00354         code = -1; <span class="comment">// FIXME this is dependent on type()...</span>
00355         <a class="code" href="class_i_pv6_datagram.html">IPv6Datagram</a> *datagram = check_and_cast&lt;IPv6Datagram *&gt;(icmpMsg-&gt;decapsulate());
00356         localAddr = datagram-&gt;<a class="code" href="class_i_pv6_datagram___base.html#a4">srcAddress</a>();
00357         remoteAddr = datagram-&gt;<a class="code" href="class_i_pv6_datagram___base.html#a7">destAddress</a>();
00358         <a class="code" href="class_u_d_p_packet.html">UDPPacket</a> *packet = check_and_cast&lt;UDPPacket *&gt;(datagram-&gt;decapsulate());
00359         localPort = packet-&gt;<a class="code" href="class_u_d_p_packet.html#a7">sourcePort</a>();
00360         remotePort = packet-&gt;<a class="code" href="class_u_d_p_packet.html#a9">destinationPort</a>();
00361         <span class="keyword">delete</span> icmpMsg;
00362         <span class="keyword">delete</span> datagram;
00363         <span class="keyword">delete</span> packet;
00364     }
00365     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMP error received: type="</span> &lt;&lt; type &lt;&lt; <span class="stringliteral">" code="</span> &lt;&lt; code
00366        &lt;&lt; <span class="stringliteral">" about packet "</span> &lt;&lt; localAddr &lt;&lt; <span class="stringliteral">":"</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">" &gt; "</span>
00367        &lt;&lt; remoteAddr &lt;&lt; <span class="stringliteral">":"</span> &lt;&lt; remotePort &lt;&lt; <span class="stringliteral">"\n"</span>;
00368 
00369     <span class="comment">// identify socket and report error to it</span>
00370     SocketsByPortMap::iterator it = <a class="code" href="class_u_d_p.html#p1">socketsByPortMap</a>.find(localPort);
00371     <span class="keywordflow">if</span> (it==<a class="code" href="class_u_d_p.html#p1">socketsByPortMap</a>.end())
00372     {
00373         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"No socket on that local port, ignoring ICMP error\n"</span>;
00374         <span class="keywordflow">return</span>;
00375     }
00376     <a class="code" href="class_u_d_p.html#w0">SockDescList</a>&amp; list = it-&gt;second;
00377     SockDesc *srcSocket = NULL;
00378     <span class="keywordflow">for</span> (SockDescList::iterator it=list.begin(); it!=list.end(); ++it)
00379     {
00380         SockDesc *sd = *it;
00381         <span class="keywordflow">if</span> (sd-&gt;onlyLocalPortIsSet || <a class="code" href="class_u_d_p.html#b5">matchesSocket</a>(sd, localAddr, remoteAddr, remotePort))
00382         {
00383             srcSocket = sd; <span class="comment">// FIXME what to do if there's more than one matching socket ???</span>
00384         }
00385     }
00386     <span class="keywordflow">if</span> (!srcSocket)
00387     {
00388         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"No matching socket, ignoring ICMP error\n"</span>;
00389         <span class="keywordflow">return</span>;
00390     }
00391 
00392     <span class="comment">// send UDP_I_ERROR to socket</span>
00393     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Source socket is sockId="</span> &lt;&lt; srcSocket-&gt;sockId &lt;&lt; <span class="stringliteral">", notifying.\n"</span>;
00394     <a class="code" href="class_u_d_p.html#b11">sendUpErrorNotification</a>(srcSocket, UDP_I_ERROR, localAddr, remoteAddr, remotePort);
00395 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b14" doxytag="UDP::processMsgFromApp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::processMsgFromApp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>appData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00488 {
00489     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = check_and_cast&lt;UDPControlInfo *&gt;(appData-&gt;removeControlInfo());
00490 
00491     <a class="code" href="class_u_d_p_packet.html">UDPPacket</a> *udpPacket = <span class="keyword">new</span> <a class="code" href="class_u_d_p_packet.html">UDPPacket</a>(appData-&gt;name());
00492     udpPacket-&gt;setByteLength(UDP_HEADER_BYTES);
00493     udpPacket-&gt;encapsulate(appData);
00494 
00495     <span class="comment">// set source and destination port</span>
00496     udpPacket-&gt;<a class="code" href="class_u_d_p_packet.html#a8">setSourcePort</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a16">srcPort</a>());
00497     udpPacket-&gt;<a class="code" href="class_u_d_p_packet.html#a10">setDestinationPort</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a18">destPort</a>());
00498 
00499     <span class="keywordflow">if</span> (!udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a13">destAddr</a>().<a class="code" href="class_i_pv_x_address.html#z35_0">isIPv6</a>())
00500     {
00501         <span class="comment">// send to IPv4</span>
00502         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending app packet "</span> &lt;&lt; appData-&gt;name() &lt;&lt; <span class="stringliteral">" over IPv4.\n"</span>;
00503         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *ipControlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
00504         ipControlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a12">setProtocol</a>(IP_PROT_UDP);
00505         ipControlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8">setSrcAddr</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a10">srcAddr</a>().<a class="code" href="class_i_pv_x_address.html#z35_1">get4</a>());
00506         ipControlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a5">setDestAddr</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a13">destAddr</a>().<a class="code" href="class_i_pv_x_address.html#z35_1">get4</a>());
00507         ipControlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a10">setInterfaceId</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a20">interfaceId</a>());
00508         udpPacket-&gt;setControlInfo(ipControlInfo);
00509         <span class="keyword">delete</span> udpCtrl;
00510 
00511         send(udpPacket,<span class="stringliteral">"to_ip"</span>);
00512     }
00513     <span class="keywordflow">else</span>
00514     {
00515         <span class="comment">// send to IPv6</span>
00516         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending app packet "</span> &lt;&lt; appData-&gt;name() &lt;&lt; <span class="stringliteral">" over IPv6.\n"</span>;
00517         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ipControlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
00518         ipControlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a4">setProtocol</a>(IP_PROT_UDP);
00519         ipControlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a10">setSrcAddr</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a10">srcAddr</a>().<a class="code" href="class_i_pv_x_address.html#z35_2">get6</a>());
00520         ipControlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a7">setDestAddr</a>(udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a13">destAddr</a>().<a class="code" href="class_i_pv_x_address.html#z35_2">get6</a>());
00521         <span class="comment">// ipControlInfo-&gt;setInterfaceId(udpCtrl-&gt;InterfaceId()); FIXME extend IPv6 with this!!!</span>
00522         udpPacket-&gt;setControlInfo(ipControlInfo);
00523         <span class="keyword">delete</span> udpCtrl;
00524 
00525         send(udpPacket,<span class="stringliteral">"to_ipv6"</span>);
00526     }
00527     <a class="code" href="class_u_d_p.html#p5">numSent</a>++;
00528 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b13" doxytag="UDP::processUDPPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::processUDPPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>udpPacket</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00413 {
00414     <span class="comment">// simulate checksum: discard packet if it has bit error</span>
00415     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Packet "</span> &lt;&lt; udpPacket-&gt;name() &lt;&lt; <span class="stringliteral">" received from network, dest port "</span> &lt;&lt; udpPacket-&gt;<a class="code" href="class_u_d_p_packet.html#a9">destinationPort</a>() &lt;&lt; <span class="stringliteral">"\n"</span>;
00416     <span class="keywordflow">if</span> (udpPacket-&gt;hasBitError())
00417     {
00418         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Packet has bit error, discarding\n"</span>;
00419         <span class="keyword">delete</span> udpPacket;
00420         <a class="code" href="class_u_d_p.html#p8">numDroppedBadChecksum</a>++;
00421         <span class="keywordflow">return</span>;
00422     }
00423 
00424     <span class="keywordtype">int</span> destPort = udpPacket-&gt;<a class="code" href="class_u_d_p_packet.html#a9">destinationPort</a>();
00425     cPolymorphic *ctrl = udpPacket-&gt;removeControlInfo();
00426 
00427     <span class="comment">// send back ICMP error if no socket is bound to that port</span>
00428     SocketsByPortMap::iterator it = <a class="code" href="class_u_d_p.html#p1">socketsByPortMap</a>.find(destPort);
00429     <span class="keywordflow">if</span> (it==<a class="code" href="class_u_d_p.html#p1">socketsByPortMap</a>.end())
00430     {
00431         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"No socket registered on port "</span> &lt;&lt; destPort &lt;&lt; <span class="stringliteral">"\n"</span>;
00432         <a class="code" href="class_u_d_p.html#b10">processUndeliverablePacket</a>(udpPacket, ctrl);
00433         <span class="keywordflow">return</span>;
00434     }
00435     <a class="code" href="class_u_d_p.html#w0">SockDescList</a>&amp; list = it-&gt;second;
00436 
00437     <span class="keywordtype">int</span> matches = 0;
00438 
00439     <span class="comment">// deliver a copy of the packet to each matching socket</span>
00440     cMessage *payload = udpPacket-&gt;encapsulatedMsg();
00441     <span class="keywordflow">if</span> (dynamic_cast&lt;IPControlInfo *&gt;(ctrl)!=NULL)
00442     {
00443         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl4 = (<a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *)ctrl;
00444         <span class="keywordflow">for</span> (SockDescList::iterator it=list.begin(); it!=list.end(); ++it)
00445         {
00446             SockDesc *sd = *it;
00447             <span class="keywordflow">if</span> (sd-&gt;onlyLocalPortIsSet || <a class="code" href="class_u_d_p.html#b5">matchesSocket</a>(sd, udpPacket, ctrl4))
00448             {
00449                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Socket sockId="</span> &lt;&lt; sd-&gt;sockId &lt;&lt; <span class="stringliteral">" matches, sending up a copy.\n"</span>;
00450                 <a class="code" href="class_u_d_p.html#b8">sendUp</a>((cMessage*)payload-&gt;dup(), udpPacket, ctrl4, sd);
00451                 matches++;
00452             }
00453         }
00454     }
00455     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6ControlInfo *&gt;(udpPacket-&gt;controlInfo())!=NULL)
00456     {
00457         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl6 = (<a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *)ctrl;
00458         <span class="keywordflow">for</span> (SockDescList::iterator it=list.begin(); it!=list.end(); ++it)
00459         {
00460             SockDesc *sd = *it;
00461             <span class="keywordflow">if</span> (sd-&gt;onlyLocalPortIsSet || <a class="code" href="class_u_d_p.html#b5">matchesSocket</a>(sd, udpPacket, ctrl6))
00462             {
00463                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Socket sockId="</span> &lt;&lt; sd-&gt;sockId &lt;&lt; <span class="stringliteral">" matches, sending up a copy.\n"</span>;
00464                 <a class="code" href="class_u_d_p.html#b8">sendUp</a>((cMessage*)payload-&gt;dup(), udpPacket, ctrl6, sd);
00465                 matches++;
00466             }
00467         }
00468     }
00469     <span class="keywordflow">else</span>
00470     {
00471         error(<span class="stringliteral">"(%s)%s arrived from lower layer without control info"</span>, udpPacket-&gt;className(), udpPacket-&gt;name());
00472     }
00473 
00474     <span class="comment">// send back ICMP error if there is no matching socket</span>
00475     <span class="keywordflow">if</span> (matches==0)
00476     {
00477         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"None of the sockets on port "</span> &lt;&lt; destPort &lt;&lt; <span class="stringliteral">" matches the packet\n"</span>;
00478         <a class="code" href="class_u_d_p.html#b10">processUndeliverablePacket</a>(udpPacket, ctrl);
00479         <span class="keywordflow">return</span>;
00480     }
00481 
00482     <span class="keyword">delete</span> udpPacket;
00483     <span class="keyword">delete</span> ctrl;
00484 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b10" doxytag="UDP::processUndeliverablePacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::processUndeliverablePacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>udpPacket</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cPolymorphic *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrl</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00301 {
00302     <a class="code" href="class_u_d_p.html#p7">numDroppedWrongPort</a>++;
00303 
00304     <span class="comment">// send back ICMP PORT_UNREACHABLE</span>
00305     <span class="keywordflow">if</span> (dynamic_cast&lt;IPControlInfo *&gt;(ctrl)!=NULL)
00306     {
00307         <span class="keywordflow">if</span> (!<a class="code" href="structicmp.html">icmp</a>)
00308             <a class="code" href="structicmp.html">icmp</a> = <a class="code" href="class_i_c_m_p_access.html">ICMPAccess</a>().get();
00309         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *ctrl4 = (<a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *)ctrl;
00310         if (!ctrl4-&gt;destAddr().isMulticast())
00311             <a class="code" href="structicmp.html">icmp</a>-&gt;sendErrorMessage(udpPacket, ctrl4, ICMP_DESTINATION_UNREACHABLE, ICMP_DU_PORT_UNREACHABLE);
00312     }
00313     else if (dynamic_cast&lt;<a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&gt;(udpPacket-&gt;controlInfo())!=NULL)
00314     {
00315         <span class="keywordflow">if</span> (!icmpv6)
00316             icmpv6 = <a class="code" href="class_i_c_m_pv6_access.html">ICMPv6Access</a>().get();
00317         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrl6 = (<a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *)ctrl;
00318         if (!ctrl6-&gt;destAddr().isMulticast())
00319             icmpv6-&gt;sendErrorMessage(udpPacket, ctrl6, ICMPv6_DESTINATION_UNREACHABLE, PORT_UNREACHABLE);
00320     }
00321     else
00322     {
00323         error(<span class="stringliteral">"(%s)%s arrived from lower layer without control info"</span>, udpPacket-&gt;className(), udpPacket-&gt;name());
00324     }
00325 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="UDP::sendUp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::sendUp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>payload</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>udpHeader</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>sd</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00284 {
00285     <span class="comment">// send payload with UDPControlInfo up to the application -- IPv6 version</span>
00286     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = <span class="keyword">new</span> <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a>();
00287     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a7">setSockId</a>(sd-&gt;sockId);
00288     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a9">setUserId</a>(sd-&gt;userId);
00289     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a12">setSrcAddr</a>(ipCtrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>());
00290     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a15">setDestAddr</a>(ipCtrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a5">destAddr</a>());
00291     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a17">setSrcPort</a>(udpHeader-&gt;<a class="code" href="class_u_d_p_packet.html#a7">sourcePort</a>());
00292     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a19">setDestPort</a>(udpHeader-&gt;<a class="code" href="class_u_d_p_packet.html#a9">destinationPort</a>());
00293     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a21">setInterfaceId</a>(ipCtrl-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a13">interfaceId</a>());
00294     payload-&gt;setControlInfo(udpCtrl);
00295 
00296     send(payload, <span class="stringliteral">"to_app"</span>, sd-&gt;appGateIndex);
00297     <a class="code" href="class_u_d_p.html#p6">numPassedUp</a>++;
00298 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b8" doxytag="UDP::sendUp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::sendUp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>payload</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_u_d_p_packet.html">UDPPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>udpHeader</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_control_info.html">IPControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>sd</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00267 {
00268     <span class="comment">// send payload with UDPControlInfo up to the application -- IPv4 version</span>
00269     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = <span class="keyword">new</span> <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a>();
00270     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a7">setSockId</a>(sd-&gt;sockId);
00271     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a9">setUserId</a>(sd-&gt;userId);
00272     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a12">setSrcAddr</a>(ipCtrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a6">srcAddr</a>());
00273     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a15">setDestAddr</a>(ipCtrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a3">destAddr</a>());
00274     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a17">setSrcPort</a>(udpHeader-&gt;<a class="code" href="class_u_d_p_packet.html#a7">sourcePort</a>());
00275     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a19">setDestPort</a>(udpHeader-&gt;<a class="code" href="class_u_d_p_packet.html#a9">destinationPort</a>());
00276     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a21">setInterfaceId</a>(ipCtrl-&gt;<a class="code" href="class_i_p_control_info___base.html#a9">interfaceId</a>());
00277     payload-&gt;setControlInfo(udpCtrl);
00278 
00279     send(payload, <span class="stringliteral">"to_app"</span>, sd-&gt;appGateIndex);
00280     <a class="code" href="class_u_d_p.html#p6">numPassedUp</a>++;
00281 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b11" doxytag="UDP::sendUpErrorNotification"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::sendUpErrorNotification           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_u_d_p_1_1_sock_desc.html">SockDesc</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>sd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>msgkind</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>localAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>remoteAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>short&nbsp;</td>
          <td class="mdname" nowrap> <em>remotePort</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00398 {
00399     cMessage *notifyMsg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"ERROR"</span>, msgkind);
00400     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *udpCtrl = <span class="keyword">new</span> <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a>();
00401     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a7">setSockId</a>(sd-&gt;sockId);
00402     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a9">setUserId</a>(sd-&gt;userId);
00403     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a12">setSrcAddr</a>(localAddr);
00404     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a15">setDestAddr</a>(remoteAddr);
00405     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a17">setSrcPort</a>(sd-&gt;localPort);
00406     udpCtrl-&gt;<a class="code" href="class_u_d_p_control_info.html#a19">setDestPort</a>(remotePort);
00407     notifyMsg-&gt;setControlInfo(udpCtrl);
00408 
00409     send(notifyMsg, <span class="stringliteral">"to_app"</span>, sd-&gt;appGateIndex);
00410 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="UDP::unbind"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::unbind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sockId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00157 {
00158     <span class="comment">// remove from socketsByIdMap</span>
00159     SocketsByIdMap::iterator it = <a class="code" href="class_u_d_p.html#p0">socketsByIdMap</a>.find(sockId);
00160     <span class="keywordflow">if</span> (it==<a class="code" href="class_u_d_p.html#p0">socketsByIdMap</a>.end())
00161         error(<span class="stringliteral">"socket id=%d doesn't exist (already closed?)"</span>, sockId);
00162     SockDesc *sd = it-&gt;second;
00163     <a class="code" href="class_u_d_p.html#p0">socketsByIdMap</a>.erase(it);
00164 
00165     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Unbinding socket: "</span> &lt;&lt; *sd &lt;&lt; <span class="stringliteral">"\n"</span>;
00166 
00167     <span class="comment">// remove from socketsByPortMap</span>
00168     <a class="code" href="class_u_d_p.html#w0">SockDescList</a>&amp; list = <a class="code" href="class_u_d_p.html#p1">socketsByPortMap</a>[sd-&gt;localPort];
00169     <span class="keywordflow">for</span> (SockDescList::iterator it=list.begin(); it!=list.end(); ++it)
00170         <span class="keywordflow">if</span> (*it == sd)
00171             {list.erase(it); <span class="keywordflow">break</span>;}
00172     <span class="keywordflow">if</span> (list.empty())
00173         <a class="code" href="class_u_d_p.html#p1">socketsByPortMap</a>.erase(sd-&gt;localPort);
00174     <span class="keyword">delete</span> sd;
00175 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="UDP::updateDisplayString"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void UDP::updateDisplayString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00220 {
00221     <span class="keywordtype">char</span> buf[80];
00222     sprintf(buf, <span class="stringliteral">"passed up: %d pks\nsent: %d pks"</span>, numPassedUp, numSent);
00223     <span class="keywordflow">if</span> (numDroppedWrongPort&gt;0)
00224     {
00225         sprintf(buf+strlen(buf), <span class="stringliteral">"\ndropped (no app): %d pks"</span>, numDroppedWrongPort);
00226         displayString().setTagArg(<span class="stringliteral">"i"</span>,1,<span class="stringliteral">"red"</span>);
00227     }
00228     displayString().setTagArg(<span class="stringliteral">"t"</span>,0,buf);
00229 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p3" doxytag="UDP::icmp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_p.html">ICMP</a>* <a class="el" href="class_u_d_p.html#p3">UDP::icmp</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="UDP::icmpv6"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6.html">ICMPv6</a>* <a class="el" href="class_u_d_p.html#p4">UDP::icmpv6</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="UDP::lastEphemeralPort"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">short <a class="el" href="class_u_d_p.html#p2">UDP::lastEphemeralPort</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p8" doxytag="UDP::numDroppedBadChecksum"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_u_d_p.html#p8">UDP::numDroppedBadChecksum</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p7" doxytag="UDP::numDroppedWrongPort"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_u_d_p.html#p7">UDP::numDroppedWrongPort</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p6" doxytag="UDP::numPassedUp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_u_d_p.html#p6">UDP::numPassedUp</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="UDP::numSent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_u_d_p.html#p5">UDP::numSent</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="UDP::socketsByIdMap"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_u_d_p.html#w1">SocketsByIdMap</a> <a class="el" href="class_u_d_p.html#p0">UDP::socketsByIdMap</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="UDP::socketsByPortMap"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_u_d_p.html#w2">SocketsByPortMap</a> <a class="el" href="class_u_d_p.html#p1">UDP::socketsByPortMap</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_transport_2_u_d_p_2_u_d_p_8h.html">Transport/UDP/UDP.h</a><li><a class="el" href="_u_d_p_8cc.html">UDP.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:32 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
