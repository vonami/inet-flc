<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: LDP Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>LDP Class Reference</h1><code>#include &lt;LDP.h&gt;</code>
<p>
<p>Inheritance diagram for LDP:
<p><center><img src="class_l_d_p.png" usemap="#LDP_map" border="0" alt=""></center>
<map name="LDP_map">
<area href="class_t_c_p_socket_1_1_callback_interface.html" alt="TCPSocket::CallbackInterface" shape="rect" coords="0,0,179,24">
<area href="class_i_classifier.html" alt="IClassifier" shape="rect" coords="189,0,368,24">
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="378,0,557,24">
</map>
<a href="class_l_d_p-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
LDP (rfc 3036) protocol implementation. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::vector&lt; <a class="el" href="struct_l_d_p_1_1fec__t.html">fec_t</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#w0">FecVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::vector&lt; <a class="el" href="struct_l_d_p_1_1fec__bind__t.html">fec_bind_t</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#w1">FecBindVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::vector&lt; <a class="el" href="struct_l_d_p_1_1pending__req__t.html">pending_req_t</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#w2">PendingVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::vector&lt; <a class="el" href="struct_l_d_p_1_1peer__info.html">peer_info</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#w3">PeerVector</a></td></tr>

<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#a0">LDP</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#a1">~LDP</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b0">numInitStages</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b1">initialize</a> (int stage)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b2">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b3">sendHelloTo</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> dest)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b4">openTCPConnectionToPeer</a> (int peerIndex)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b5">processLDPHello</a> (<a class="el" href="class_l_d_p_hello.html">LDPHello</a> *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b6">processHelloTimeout</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b7">processMessageFromTCP</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b8">processLDPPacketFromTCP</a> (<a class="el" href="class_l_d_p_packet.html">LDPPacket</a> *ldpPacket)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b9">processLABEL_MAPPING</a> (<a class="el" href="class_l_d_p_label_mapping.html">LDPLabelMapping</a> *packet)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b10">processLABEL_REQUEST</a> (<a class="el" href="class_l_d_p_label_request.html">LDPLabelRequest</a> *packet)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b11">processLABEL_RELEASE</a> (<a class="el" href="class_l_d_p_label_mapping.html">LDPLabelMapping</a> *packet)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b12">processLABEL_WITHDRAW</a> (<a class="el" href="class_l_d_p_label_mapping.html">LDPLabelMapping</a> *packet)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b13">processNOTIFICATION</a> (<a class="el" href="class_l_d_p_notify.html">LDPNotify</a> *packet)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b14">lookupLabel</a> (<a class="el" href="class_i_p_datagram.html">IPDatagram</a> *ipdatagram, <a class="el" href="_l_i_b_table_8h.html#a3">LabelOpVector</a> &amp;outLabel, std::string &amp;outInterface, int &amp;color)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#b15">receiveChangeNotification</a> (int category, cPolymorphic *details)</td></tr>

<tr><td colspan="2"><div class="groupHeader">TCPSocket::CallbackInterface callback methods</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#z59_0">socketEstablished</a> (int connId, void *yourPtr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#z59_1">socketDataArrived</a> (int connId, void *yourPtr, cMessage *msg, bool urgent)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#z59_2">socketPeerClosed</a> (int connId, void *yourPtr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#z59_3">socketClosed</a> (int connId, void *yourPtr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#z59_4">socketFailure</a> (int connId, void *yourPtr, int code)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#z59_5">socketStatusArrived</a> (int connId, void *yourPtr, <a class="el" href="class_t_c_p_status_info.html">TCPStatusInfo</a> *status)</td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d0">locateNextHop</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> dest)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d1">findPeerAddrFromInterface</a> (std::string interfaceName)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d2">findInterfaceFromPeerAddr</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> peerIP)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d3">findPeer</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> peerAddr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_socket.html">TCPSocket</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d4">peerSocket</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> peerAddr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_socket.html">TCPSocket</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d5">peerSocketSoft</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> peerAddr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d6">sendToPeer</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> dest, cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">FecVector::iterator&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d7">findFecEntry</a> (<a class="el" href="class_l_d_p.html#w0">FecVector</a> &amp;fecs, <a class="el" href="class_i_p_address.html">IPAddress</a> addr, int length)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">FecBindVector::iterator&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d8">findFecEntry</a> (<a class="el" href="class_l_d_p.html#w1">FecBindVector</a> &amp;fecs, int fecid, <a class="el" href="class_i_p_address.html">IPAddress</a> peer)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d9">sendMappingRequest</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> dest, <a class="el" href="class_i_p_address.html">IPAddress</a> addr, int length)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d10">sendMapping</a> (int type, <a class="el" href="class_i_p_address.html">IPAddress</a> dest, int label, <a class="el" href="class_i_p_address.html">IPAddress</a> addr, int length)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d11">sendNotify</a> (int status, <a class="el" href="class_i_p_address.html">IPAddress</a> dest, <a class="el" href="class_i_p_address.html">IPAddress</a> addr, int length)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d12">rebuildFecList</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d13">updateFecList</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> nextHop)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d14">updateFecListEntry</a> (<a class="el" href="struct_l_d_p_1_1fec__t.html">fec_t</a> oldItem)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#d15">announceLinkChange</a> (int tedlinkindex)</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r0">holdTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r1">helloInterval</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_l_d_p.html#w0">FecVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r2">fecList</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_l_d_p.html#w1">FecBindVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r3">fecUp</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_l_d_p.html#w1">FecBindVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r4">fecDown</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_l_d_p.html#w2">PendingVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r5">pending</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_l_d_p.html#w3">PeerVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r6">myPeers</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r7">ift</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_routing_table.html">RoutingTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r8">rt</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_l_i_b_table.html">LIBTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r9">lt</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_e_d.html">TED</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r10">tedmod</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_notification_board.html">NotificationBoard</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r11">nb</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_u_d_p_socket.html">UDPSocket</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r12">udpSocket</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_socket.html">TCPSocket</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r13">serverSocket</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_c_p_socket_map.html">TCPSocketMap</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r14">socketMap</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r15">sendHelloMsg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_l_d_p.html#r16">maxFecid</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_l_d_p_1_1fec__bind__t.html">fec_bind_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_l_d_p_1_1fec__t.html">fec_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_l_d_p_1_1peer__info.html">peer_info</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_l_d_p_1_1pending__req__t.html">pending_req_t</a></td></tr>

</table>
<hr><h2>Member Typedef Documentation</h2>
<a class="anchor" name="w1" doxytag="LDP::FecBindVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::vector&lt;<a class="el" href="struct_l_d_p_1_1fec__bind__t.html">fec_bind_t</a>&gt; <a class="el" href="class_l_d_p.html#w1">LDP::FecBindVector</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w0" doxytag="LDP::FecVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::vector&lt;<a class="el" href="struct_l_d_p_1_1fec__t.html">fec_t</a>&gt; <a class="el" href="class_l_d_p.html#w0">LDP::FecVector</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w3" doxytag="LDP::PeerVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::vector&lt;<a class="el" href="struct_l_d_p_1_1peer__info.html">peer_info</a>&gt; <a class="el" href="class_l_d_p.html#w3">LDP::PeerVector</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w2" doxytag="LDP::PendingVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::vector&lt;<a class="el" href="struct_l_d_p_1_1pending__req__t.html">pending_req_t</a>&gt; <a class="el" href="class_l_d_p.html#w2">LDP::PendingVector</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="LDP::LDP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">LDP::LDP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00085 {
00086     <a class="code" href="class_l_d_p.html#r15">sendHelloMsg</a> = NULL;
00087 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="LDP::~LDP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">LDP::~<a class="el" href="class_l_d_p.html">LDP</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00090 {
00091     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="class_l_d_p.html#r6">myPeers</a>.size(); i++)
00092         cancelAndDelete(myPeers[i].timeout);
00093 
00094     cancelAndDelete(sendHelloMsg);
00095     <span class="comment">//this causes segfault at the end of simulation       -- Vojta</span>
00096     <span class="comment">//socketMap.deleteSockets();</span>
00097 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="d15" doxytag="LDP::announceLinkChange"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::announceLinkChange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tedlinkindex</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01246 {
01247     <a class="code" href="class_t_e_d_change_info.html">TEDChangeInfo</a> d;
01248     d.<a class="code" href="class_t_e_d_change_info.html#a6">setTedLinkIndicesArraySize</a>(1);
01249     d.<a class="code" href="class_t_e_d_change_info.html#a9">setTedLinkIndices</a>(0, tedlinkindex);
01250     <a class="code" href="class_l_d_p.html#r11">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_TED_CHANGED, &amp;d);
01251 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d8" doxytag="LDP::findFecEntry"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">LDP::FecBindVector::iterator LDP::findFecEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p.html#w1">FecBindVector</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>fecs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>fecid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>peer</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00789 {
00790     FecBindVector::iterator it;
00791     <span class="keywordflow">for</span> (it = fecs.begin(); it != fecs.end(); it++)
00792     {
00793         <span class="keywordflow">if</span> (it-&gt;fecid != fecid)
00794             continue;
00795 
00796         if (it-&gt;peer != peer)
00797             continue;
00798 
00799         break;
00800     }
00801     return it;
00802 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d7" doxytag="LDP::findFecEntry"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">LDP::FecVector::iterator LDP::findFecEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p.html#w0">FecVector</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>fecs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>length</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00805 {
00806     FecVector::iterator it;
00807     <span class="keywordflow">for</span> (it = fecs.begin(); it != fecs.end(); it++)
00808     {
00809         <span class="keywordflow">if</span> (it-&gt;length != length)
00810             continue;
00811 
00812         if (it-&gt;addr != addr) <span class="comment">// XXX compare only relevant part (?)</span>
00813             continue;
00814 
00815         break;
00816     }
00817     return it;
00818 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d2" doxytag="LDP::findInterfaceFromPeerAddr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">std::string LDP::findInterfaceFromPeerAddr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>peerIP</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00761 {
00762 <span class="comment">/*</span>
00763 <span class="comment">    int i;</span>
00764 <span class="comment">    for (unsigned int i=0;i&lt;myPeers.size();i++)</span>
00765 <span class="comment">    {</span>
00766 <span class="comment">        if (myPeers[i].peerIP == peerIP)</span>
00767 <span class="comment">            return string(myPeers[i].linkInterface);</span>
00768 <span class="comment">    }</span>
00769 <span class="comment">    return string("X");</span>
00770 <span class="comment">*/</span>
00771 <span class="comment">//    Rely on port index to find the interface name</span>
00772 
00773     <span class="comment">// this function is a misnomer, we must recognize our own address too</span>
00774     <span class="keywordflow">if</span> (<a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#z42_0">localDeliver</a>(peerIP))
00775         <span class="keywordflow">return</span> <span class="stringliteral">"lo0"</span>;
00776 
00777     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#z42_2">interfaceForDestAddr</a>(peerIP);
00778     <span class="keywordflow">if</span> (!ie)
00779         error("findInterfaceFromPeerAddr(): %s is not routable", peerIP.str().c_str());
00780     return ie-&gt;name();
00781 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d3" doxytag="LDP::findPeer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int LDP::findPeer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>peerAddr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: return peer's index in myPeers table, or -1 if not found <div class="fragment"><pre class="fragment">01156 {
01157     <span class="keywordflow">for</span> (PeerVector::iterator i=<a class="code" href="class_l_d_p.html#r6">myPeers</a>.begin(); i!=<a class="code" href="class_l_d_p.html#r6">myPeers</a>.end(); ++i)
01158         <span class="keywordflow">if</span> (i-&gt;peerIP==peerAddr)
01159             return i-myPeers.begin();
01160     return -1;
01161 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d1" doxytag="LDP::findPeerAddrFromInterface"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a> LDP::findPeerAddrFromInterface           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">std::string&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>interfaceName</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This method maps the peerIP with the interface name in routing table. It is expected that for <a class="el" href="class_m_p_l_s.html">MPLS</a> host, entries linked to <a class="el" href="class_m_p_l_s.html">MPLS</a> peers are available. In case no corresponding peerIP found, a peerIP (not deterministic) will be returned. <div class="fragment"><pre class="fragment">00722 {
00723     <span class="keywordtype">int</span> i = 0;
00724     <span class="keywordtype">int</span> k = 0;
00725     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_l_d_p.html#r7">ift</a>-&gt;<a class="code" href="class_interface_table.html#a9">interfaceByName</a>(interfaceName.c_str());
00726 
00727     <a class="code" href="class_routing_entry.html">RoutingEntry</a> *anEntry;
00728 
00729     <span class="keywordflow">for</span> (i = 0; i &lt; rt-&gt;numRoutingEntries(); i++)
00730     {
00731         <span class="keywordflow">for</span> (k = 0; k &lt; (<span class="keywordtype">int</span>)<a class="code" href="class_l_d_p.html#r6">myPeers</a>.size(); k++)
00732         {
00733             anEntry = <a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_1">routingEntry</a>(i);
00734             <span class="keywordflow">if</span> (anEntry-&gt;<a class="code" href="class_routing_entry.html#o0">host</a>==myPeers[k].peerIP &amp;&amp; anEntry-&gt;<a class="code" href="class_routing_entry.html#o4">interfacePtr</a>==ie)
00735             {
00736                 <span class="keywordflow">return</span> <a class="code" href="class_l_d_p.html#r6">myPeers</a>[k].peerIP;
00737             }
00738             <span class="comment">// addresses-&gt;push_back(peerIP[k]);</span>
00739         }
00740     }
00741 
00742     <span class="comment">// Return any IP which has default route - not in routing table entries</span>
00743     <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keywordtype">int</span>)<a class="code" href="class_l_d_p.html#r6">myPeers</a>.size(); i++)
00744     {
00745         <span class="keywordflow">for</span> (k = 0; k &lt; rt-&gt;numRoutingEntries(); k++)
00746         {
00747             anEntry = <a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_1">routingEntry</a>(i);
00748             <span class="keywordflow">if</span> (anEntry-&gt;<a class="code" href="class_routing_entry.html#o0">host</a> == myPeers[i].peerIP)
00749                 <span class="keywordflow">break</span>;
00750         }
00751         <span class="keywordflow">if</span> (k == <a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_0">numRoutingEntries</a>())
00752             <span class="keywordflow">break</span>;
00753     }
00754 
00755     <span class="comment">// return the peer's address if found, unspecified address otherwise</span>
00756     <span class="keywordflow">return</span> i==<a class="code" href="class_l_d_p.html#r6">myPeers</a>.size() ? <a class="code" href="class_i_p_address.html">IPAddress</a>() : <a class="code" href="class_l_d_p.html#r6">myPeers</a>[i].peerIP;
00757 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="LDP::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00143 {
00144     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Received: ("</span> &lt;&lt; msg-&gt;className() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; msg-&gt;name() &lt;&lt; <span class="stringliteral">"\n"</span>;
00145     <span class="keywordflow">if</span> (msg==sendHelloMsg)
00146     {
00147         <span class="comment">// every LDP capable router periodically sends HELLO messages to the</span>
00148         <span class="comment">// "all routers in the sub-network" multicast address</span>
00149         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Multicasting LDP Hello to neighboring routers\n"</span>;
00150         <a class="code" href="class_l_d_p.html#b3">sendHelloTo</a>(IPAddress::ALL_ROUTERS_MCAST);
00151 
00152         <span class="comment">// schedule next hello</span>
00153         scheduleAt(simTime() + helloInterval, sendHelloMsg);
00154     }
00155     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
00156     {
00157         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Timer "</span> &lt;&lt; msg-&gt;name() &lt;&lt; <span class="stringliteral">" expired\n"</span>;
00158         <span class="keywordflow">if</span> (!strcmp(msg-&gt;name(), <span class="stringliteral">"HelloTimeout"</span>))
00159         {
00160             <a class="code" href="class_l_d_p.html#b6">processHelloTimeout</a>(msg);
00161         }
00162         <span class="keywordflow">else</span>
00163         {
00164             <a class="code" href="class_l_d_p.html#b13">processNOTIFICATION</a>(check_and_cast&lt;LDPNotify*&gt;(msg));
00165         }
00166     }
00167     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(msg-&gt;arrivalGate()-&gt;name(), <span class="stringliteral">"udpIn"</span>))
00168     {
00169         <span class="comment">// we can only receive LDP Hello from UDP (everything else goes over TCP)</span>
00170         <a class="code" href="class_l_d_p.html#b5">processLDPHello</a>(check_and_cast&lt;LDPHello *&gt;(msg));
00171     }
00172     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(msg-&gt;arrivalGate()-&gt;name(), <span class="stringliteral">"tcpIn"</span>))
00173     {
00174         <a class="code" href="class_l_d_p.html#b7">processMessageFromTCP</a>(msg);
00175     }
00176 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="LDP::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stage</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00100 {
00101     <span class="keywordflow">if</span> (stage != 3)
00102         return; <span class="comment">// wait for routing table to initialize first</span>
00103 
00104     holdTime = par("holdTime").doubleValue();
00105     helloInterval = par("helloInterval").doubleValue();
00106 
00107     ift = <a class="code" href="class_interface_table_access.html">InterfaceTableAccess</a>().get();
00108     rt = <a class="code" href="class_routing_table_access.html">RoutingTableAccess</a>().get();
00109     lt = <a class="code" href="class_l_i_b_table_access.html">LIBTableAccess</a>().get();
00110     tedmod = <a class="code" href="class_t_e_d_access.html">TEDAccess</a>().get();
00111     nb = <a class="code" href="class_notification_board_access.html">NotificationBoardAccess</a>().get();
00112 
00113     WATCH_VECTOR(myPeers);
00114     WATCH_VECTOR(fecUp);
00115     WATCH_VECTOR(fecDown);
00116     WATCH_VECTOR(fecList);
00117     WATCH_VECTOR(pending);
00118 
00119     maxFecid = 0;
00120 
00121     <span class="comment">// schedule first hello</span>
00122     sendHelloMsg = new cMessage("LDPSendHello");
00123     scheduleAt(simTime() + exponential(0.1), sendHelloMsg);
00124 
00125     <span class="comment">// bind UDP socket</span>
00126     udpSocket.setOutputGate(gate("udpOut"));
00127     udpSocket.bind(LDP_PORT);
00128 
00129     <span class="comment">// start listening for incoming TCP conns</span>
00130     EV &lt;&lt; "Starting to listen on port " &lt;&lt; LDP_PORT &lt;&lt; " for incoming <a class="code" href="class_l_d_p.html">LDP</a> sessions\n";
00131     serverSocket.setOutputGate(gate("tcpOut"));
00132     serverSocket.bind(LDP_PORT);
00133     serverSocket.listen();
00134 
00135     <span class="comment">// build list of recognized FECs</span>
00136     rebuildFecList();
00137 
00138     <span class="comment">// listen for routing table modifications</span>
00139     nb-&gt;subscribe(this, NF_IPv4_ROUTINGTABLE_CHANGED);
00140 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d0" doxytag="LDP::locateNextHop"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a> LDP::locateNextHop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dest</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This method finds next peer in upstream direction <div class="fragment"><pre class="fragment">00688 {
00689     <span class="comment">// Mapping L3 IP-host of next hop to L2 peer address.</span>
00690 
00691     <span class="comment">// Lookup the routing table, rfc3036</span>
00692     <span class="comment">// "When the FEC for which a label is requested is a Prefix FEC Element or</span>
00693     <span class="comment">//  a Host Address FEC Element, the receiving LSR uses its routing table to determine</span>
00694     <span class="comment">//  its response. Unless its routing table includes an entry that exactly matches</span>
00695     <span class="comment">//  the requested Prefix or Host Address, the LSR must respond with a</span>
00696     <span class="comment">//  No Route Notification message."</span>
00697     <span class="comment">//</span>
00698     <span class="comment">// FIXME the code below (though seems like that's what the RFC refers to) doesn't work</span>
00699     <span class="comment">// -- we can't reasonably expect the destination host to be exaplicitly in an</span>
00700     <span class="comment">// LSR's routing table!!! Use simple IP routing instead. --Andras</span>
00701     <span class="comment">//</span>
00702     <span class="comment">// Wrong code:</span>
00703     <span class="comment">//int i;</span>
00704     <span class="comment">//for (i=0; i &lt; rt-&gt;numRoutingEntries(); i++)</span>
00705     <span class="comment">//    if (rt-&gt;routingEntry(i)-&gt;host == dest)</span>
00706     <span class="comment">//        break;</span>
00707     <span class="comment">//</span>
00708     <span class="comment">//if (i == rt-&gt;numRoutingEntries())</span>
00709     <span class="comment">//    return IPAddress();  // Signal an NOTIFICATION of NO ROUTE</span>
00710     <span class="comment">//</span>
00711     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#z42_2">interfaceForDestAddr</a>(dest);
00712     <span class="keywordflow">if</span> (!ie)
00713         return <a class="code" href="class_i_p_address.html">IPAddress</a>();  <span class="comment">// no route</span>
00714 
00715     std::string iName = ie-&gt;name(); <span class="comment">// FIXME why use name for lookup?</span>
00716     return findPeerAddrFromInterface(iName);
00717 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b14" doxytag="LDP::lookupLabel"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool LDP::lookupLabel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_datagram.html">IPDatagram</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ipdatagram</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="_l_i_b_table_8h.html#a3">LabelOpVector</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>outLabel</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>std::string &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>outInterface</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>color</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The ipdatagram argument is an input parameter, the rest (outLabel, outInterface, color) are output parameters only.<p>
In subclasses, this function should be implemented to determine the forwarding equivalence class for the <a class="el" href="class_i_p.html">IP</a> datagram passed, and map it to an outLabel and outInterface.<p>
The color parameter (which can be set to an arbitrary value) will only be used for the NAM trace if one will be recorded. 
<p>
Implements <a class="el" href="class_i_classifier.html#a1">IClassifier</a>.<div class="fragment"><pre class="fragment">01185 {
01186     <a class="code" href="class_i_p_address.html">IPAddress</a> destAddr = ipdatagram-&gt;<a class="code" href="class_i_p_datagram.html#a14">destAddress</a>();
01187     <span class="keywordtype">int</span> protocol = ipdatagram-&gt;<a class="code" href="class_i_p_datagram.html#a17">transportProtocol</a>();
01188 
01189     <span class="comment">// never match and always route via L3 if:</span>
01190 
01191     <span class="comment">// OSPF traffic (TED)</span>
01192     <span class="keywordflow">if</span> (protocol == IP_PROT_OSPF)
01193         return false;
01194 
01195     <span class="comment">// LDP traffic (both discovery...</span>
01196     if (protocol == IP_PROT_UDP &amp;&amp; check_and_cast&lt;<a class="code" href="class_u_d_p_packet.html">UDPPacket</a>*&gt;(ipdatagram-&gt;encapsulatedMsg())-&gt;destinationPort() == LDP_PORT)
01197         return false;
01198 
01199     <span class="comment">// ...and session)</span>
01200     if (protocol == IP_PROT_TCP &amp;&amp; check_and_cast&lt;<a class="code" href="class_t_c_p_segment.html">TCPSegment</a>*&gt;(ipdatagram-&gt;encapsulatedMsg())-&gt;destPort() == LDP_PORT)
01201         return false;
01202     if (protocol == IP_PROT_TCP &amp;&amp; check_and_cast&lt;<a class="code" href="class_t_c_p_segment.html">TCPSegment</a>*&gt;(ipdatagram-&gt;encapsulatedMsg())-&gt;srcPort() == LDP_PORT)
01203         return false;
01204 
01205     <span class="comment">// regular traffic, classify, label etc.</span>
01206 
01207     FecVector::iterator it;
01208     for (it = fecList.begin(); it != fecList.end(); it++)
01209     {
01210         <span class="keywordflow">if</span> (!destAddr.<a class="code" href="class_i_p_address.html#a13">prefixMatches</a>(it-&gt;addr, it-&gt;length))
01211             <span class="keywordflow">continue</span>;
01212 
01213         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"FEC matched: "</span> &lt;&lt; *it &lt;&lt; endl;
01214 
01215         FecBindVector::iterator dit = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecDown, it-&gt;fecid, it-&gt;nextHop);
01216         <span class="keywordflow">if</span> (dit != <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end())
01217         {
01218             outLabel = <a class="code" href="class_l_i_b_table.html#e0">LIBTable::pushLabel</a>(dit-&gt;label);
01219             outInterface = <a class="code" href="class_l_d_p.html#d2">findInterfaceFromPeerAddr</a>(it-&gt;nextHop);
01220             color = <a class="code" href="_l_d_p_8h.html#a3">LDP_USER_TRAFFIC</a>;
01221             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"mapping found, outLabel="</span> &lt;&lt; outLabel &lt;&lt; <span class="stringliteral">", outInterface="</span> &lt;&lt; outInterface &lt;&lt; endl;
01222             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01223         }
01224         <span class="keywordflow">else</span>
01225         {
01226             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"no mapping for this FEC exists"</span> &lt;&lt; endl;
01227             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01228         }
01229     }
01230     <span class="keywordflow">return</span> <span class="keyword">false</span>;
01231 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="LDP::numInitStages"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual int LDP::numInitStages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00179 {<span class="keywordflow">return</span> 4;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="LDP::openTCPConnectionToPeer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::openTCPConnectionToPeer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>peerIndex</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00543 {
00544     <a class="code" href="class_t_c_p_socket.html">TCPSocket</a> *socket = <span class="keyword">new</span> <a class="code" href="class_t_c_p_socket.html">TCPSocket</a>();
00545     socket-&gt;<a class="code" href="class_t_c_p_socket.html#z129_0">setOutputGate</a>(gate(<span class="stringliteral">"tcpOut"</span>));
00546     socket-&gt;<a class="code" href="class_t_c_p_socket.html#z131_1">setCallbackObject</a>(<span class="keyword">this</span>, (<span class="keywordtype">void</span>*)peerIndex);
00547     socket-&gt;<a class="code" href="class_t_c_p_socket.html#z129_1">bind</a>(<a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#a4">routerId</a>(), 0);
00548     <a class="code" href="class_l_d_p.html#r14">socketMap</a>.<a class="code" href="class_t_c_p_socket_map.html#a3">addSocket</a>(socket);
00549     <a class="code" href="class_l_d_p.html#r6">myPeers</a>[peerIndex].socket = socket;
00550 
00551     socket-&gt;<a class="code" href="class_t_c_p_socket.html#z129_5">connect</a>(myPeers[peerIndex].peerIP, LDP_PORT);
00552 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d4" doxytag="LDP::peerSocket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_socket.html">TCPSocket</a> * LDP::peerSocket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>peerAddr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: return socket for given peer. Throws error if there's no <a class="el" href="class_t_c_p.html">TCP</a> connection <div class="fragment"><pre class="fragment">01176 {
01177     <a class="code" href="class_t_c_p_socket.html">TCPSocket</a> *sock = <a class="code" href="class_l_d_p.html#d5">peerSocketSoft</a>(peerAddr);
01178     ASSERT(sock);
01179     <span class="keywordflow">if</span> (!sock)
01180         error("No <a class="code" href="class_l_d_p.html">LDP</a> session to peer %s yet", peerAddr.str().c_str());
01181     return sock;
01182 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d5" doxytag="LDP::peerSocketSoft"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_socket.html">TCPSocket</a> * LDP::peerSocketSoft           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>peerAddr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility: return socket for given peer and NULL if session doesn't exist <div class="fragment"><pre class="fragment">01164 {
01165     <span class="comment">// find peer in table and return its socket</span>
01166     <span class="keywordtype">int</span> i = <a class="code" href="class_l_d_p.html#d3">findPeer</a>(peerAddr);
01167     <span class="keywordflow">if</span> (i==-1 || !(myPeers[i].socket) || myPeers[i].socket-&gt;state()!=<a class="code" href="class_t_c_p_socket.html#w9w4">TCPSocket::CONNECTED</a>)
01168     {
01169         <span class="comment">// we don't have an LDP session to this peer</span>
01170         <span class="keywordflow">return</span> NULL;
01171     }
01172     <span class="keywordflow">return</span> <a class="code" href="class_l_d_p.html#r6">myPeers</a>[i].socket;
01173 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="LDP::processHelloTimeout"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::processHelloTimeout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00414 {
00415     <span class="comment">// peer is gone</span>
00416 
00417     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
00418     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="class_l_d_p.html#r6">myPeers</a>.size(); i++)
00419     {
00420         <span class="keywordflow">if</span> (myPeers[i].timeout == msg)
00421             break;
00422     }
00423     ASSERT(i &lt; myPeers.size());
00424 
00425     <a class="code" href="class_i_p_address.html">IPAddress</a> peerIP = myPeers[i].peerIP;
00426 
00427     EV &lt;&lt; "peer=" &lt;&lt; peerIP &lt;&lt; " is gone, removing adjacency" &lt;&lt; endl;
00428 
00429     ASSERT(!myPeers[i].timeout-&gt;isScheduled());
00430     delete myPeers[i].timeout;
00431     ASSERT(myPeers[i].socket);
00432     myPeers[i].socket-&gt;abort(); <span class="comment">// should we only close?</span>
00433     delete myPeers[i].socket;
00434     myPeers.erase(myPeers.begin() + i);
00435 
00436     EV &lt;&lt; "removing (stale) bindings from fecDown for peer=" &lt;&lt; peerIP &lt;&lt; endl;
00437 
00438     FecBindVector::iterator dit;
00439     for (dit = fecDown.begin(); dit != fecDown.end(); dit++)
00440     {
00441         <span class="keywordflow">if</span> (dit-&gt;peer != peerIP)
00442             continue;
00443 
00444         EV &lt;&lt; "label=" &lt;&lt; dit-&gt;label &lt;&lt; endl;
00445 
00446         <span class="comment">// send release message just in case (?)</span>
00447         <span class="comment">// what happens if peer is not really down and</span>
00448         <span class="comment">// hello messages just disappeared?</span>
00449         <span class="comment">// does the protocol recover on its own (XXX check this)</span>
00450 
00451         fecDown.erase(dit--);
00452     }
00453 
00454     EV &lt;&lt; "removing bindings from sent to peer=" &lt;&lt; peerIP &lt;&lt; " from fecUp" &lt;&lt; endl;
00455 
00456     FecBindVector::iterator uit;
00457     for (uit = fecUp.begin(); uit != fecUp.end(); uit++)
00458     {
00459         <span class="keywordflow">if</span> (uit-&gt;peer != peerIP)
00460             continue;
00461 
00462         EV &lt;&lt; "label=" &lt;&lt; uit-&gt;label &lt;&lt; endl;
00463 
00464         <span class="comment">// send withdraw message just in case (?)</span>
00465         <span class="comment">// see comment above...</span>
00466 
00467         fecUp.erase(uit--);
00468     }
00469 
00470     EV &lt;&lt; "updating fecList" &lt;&lt; endl;
00471 
00472     updateFecList(peerIP);
00473 
00474     <span class="comment">// update TED and routing table</span>
00475 
00476     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = tedmod-&gt;linkIndex(rt-&gt;routerId(), peerIP);
00477     tedmod-&gt;ted[index].state = false;
00478     announceLinkChange(index);
00479     tedmod-&gt;rebuildRoutingTable();
00480 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="LDP::processLABEL_MAPPING"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::processLABEL_MAPPING           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p_label_mapping.html">LDPLabelMapping</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>packet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01100 {
01101     <a class="code" href="struct_f_e_c___t_l_v.html">FEC_TLV</a> fec = packet-&gt;<a class="code" href="class_l_d_p_label_mapping.html#a7">getFec</a>();
01102     <span class="keywordtype">int</span> label = packet-&gt;<a class="code" href="class_l_d_p_label_mapping.html#a10">getLabel</a>();
01103     <a class="code" href="class_i_p_address.html">IPAddress</a> fromIP = packet-&gt;<a class="code" href="class_l_d_p_packet.html#a9">senderAddress</a>();
01104 
01105     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Label mapping label="</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">" received for fec="</span> &lt;&lt; fec &lt;&lt; <span class="stringliteral">" from "</span> &lt;&lt; fromIP &lt;&lt; endl;
01106 
01107     ASSERT(label &gt; 0);
01108 
01109     FecVector::iterator it = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecList, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a>, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a>);
01110     ASSERT(it != <a class="code" href="class_l_d_p.html#r2">fecList</a>.end());
01111 
01112     FecBindVector::iterator dit = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecDown, it-&gt;fecid, fromIP);
01113     ASSERT(dit == <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end());
01114 
01115     <span class="comment">// insert among received mappings</span>
01116 
01117     fec_bind_t newItem;
01118     newItem.fecid = it-&gt;fecid;
01119     newItem.peer = fromIP;
01120     newItem.label = label;
01121     <a class="code" href="class_l_d_p.html#r4">fecDown</a>.push_back(newItem);
01122 
01123     <span class="comment">// respond to pending requests</span>
01124 
01125     PendingVector::iterator pit;
01126     <span class="keywordflow">for</span> (pit = <a class="code" href="class_l_d_p.html#r5">pending</a>.begin(); pit != <a class="code" href="class_l_d_p.html#r5">pending</a>.end(); pit++)
01127     {
01128         <span class="keywordflow">if</span> (pit-&gt;fecid != it-&gt;fecid)
01129             continue;
01130 
01131         EV &lt;&lt; "there's pending request for this FEC from " &lt;&lt; pit-&gt;peer &lt;&lt; ", sending mapping" &lt;&lt; endl;
01132 
01133         std::string inInterface = findInterfaceFromPeerAddr(pit-&gt;peer);
01134         std::string outInterface = findInterfaceFromPeerAddr(fromIP);
01135         LabelOpVector outLabel = <a class="code" href="class_l_i_b_table.html">LIBTable</a>::swapLabel(label);
01136 
01137         fec_bind_t newItem;
01138         newItem.fecid = it-&gt;fecid;
01139         newItem.peer = pit-&gt;peer;
01140         newItem.label = lt-&gt;installLibEntry(-1, inInterface, outLabel, outInterface, LDP_USER_TRAFFIC);
01141         fecUp.push_back(newItem);
01142 
01143         EV &lt;&lt; "installed LIB entry inLabel=" &lt;&lt; newItem.label &lt;&lt; " inInterface=" &lt;&lt; inInterface &lt;&lt;
01144                 " outLabel=" &lt;&lt; outLabel &lt;&lt; " outInterface=" &lt;&lt; outInterface &lt;&lt; endl;
01145 
01146         sendMapping(LABEL_MAPPING, pit-&gt;peer, newItem.label, it-&gt;addr, it-&gt;length);
01147 
01148         <span class="comment">// remove request from the list</span>
01149         pending.erase(pit--);
01150     }
01151 
01152     delete packet;
01153 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b11" doxytag="LDP::processLABEL_RELEASE"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::processLABEL_RELEASE           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p_label_mapping.html">LDPLabelMapping</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>packet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01016 {
01017     <a class="code" href="struct_f_e_c___t_l_v.html">FEC_TLV</a> fec = packet-&gt;<a class="code" href="class_l_d_p_label_mapping.html#a7">getFec</a>();
01018     <span class="keywordtype">int</span> label = packet-&gt;<a class="code" href="class_l_d_p_label_mapping.html#a10">getLabel</a>();
01019     <a class="code" href="class_i_p_address.html">IPAddress</a> fromIP = packet-&gt;<a class="code" href="class_l_d_p_packet.html#a9">senderAddress</a>();
01020 
01021     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Mapping release received for label="</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">" fec="</span> &lt;&lt; fec &lt;&lt; <span class="stringliteral">" from "</span> &lt;&lt; fromIP &lt;&lt; endl;
01022 
01023     ASSERT(label &gt; 0);
01024 
01025     <span class="comment">// remove label from fecUp</span>
01026 
01027     FecVector::iterator it = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecList, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a>, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a>);
01028     <span class="keywordflow">if</span> (it == <a class="code" href="class_l_d_p.html#r2">fecList</a>.end())
01029     {
01030         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"FEC no longer recognized here, ignoring"</span> &lt;&lt; endl;
01031         <span class="keyword">delete</span> packet;
01032         <span class="keywordflow">return</span>;
01033     }
01034 
01035     FecBindVector::iterator uit = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecUp, it-&gt;fecid, fromIP);
01036     <span class="keywordflow">if</span> (uit == <a class="code" href="class_l_d_p.html#r3">fecUp</a>.end() || label != uit-&gt;label)
01037     {
01038         <span class="comment">// this is ok and may happen; e.g. we removed the mapping because downstream</span>
01039         <span class="comment">// neighbour withdrew its mapping. we sent withdraw upstream as well and</span>
01040         <span class="comment">// this is upstream's response</span>
01041         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"mapping not found among sent mappings, ignoring"</span> &lt;&lt; endl;
01042         <span class="keyword">delete</span> packet;
01043         <span class="keywordflow">return</span>;
01044     }
01045 
01046     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"removing from LIB table label="</span> &lt;&lt; uit-&gt;label &lt;&lt; endl;
01047     <a class="code" href="class_l_d_p.html#r9">lt</a>-&gt;<a class="code" href="class_l_i_b_table.html#a2">removeLibEntry</a>(uit-&gt;label);
01048 
01049     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"removing label from list of sent mappings"</span> &lt;&lt; endl;
01050     <a class="code" href="class_l_d_p.html#r3">fecUp</a>.erase(uit);
01051 
01052     <span class="keyword">delete</span> packet;
01053 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b10" doxytag="LDP::processLABEL_REQUEST"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::processLABEL_REQUEST           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p_label_request.html">LDPLabelRequest</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>packet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00920 {
00921     <a class="code" href="struct_f_e_c___t_l_v.html">FEC_TLV</a> fec = packet-&gt;<a class="code" href="class_l_d_p_label_request.html#a7">getFec</a>();
00922     <a class="code" href="class_i_p_address.html">IPAddress</a> srcAddr = packet-&gt;<a class="code" href="class_l_d_p_packet.html#a9">senderAddress</a>();
00923 
00924     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Label Request from LSR "</span> &lt;&lt; srcAddr &lt;&lt; <span class="stringliteral">" for FEC "</span> &lt;&lt; fec &lt;&lt; endl;
00925 
00926     FecVector::iterator it = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecList, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a>, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a>);
00927     <span class="keywordflow">if</span> (it == <a class="code" href="class_l_d_p.html#r2">fecList</a>.end())
00928     {
00929         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"FEC not recognized, sending back No route message"</span> &lt;&lt; endl;
00930 
00931         <a class="code" href="class_l_d_p.html#d11">sendNotify</a>(NO_ROUTE, srcAddr, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a>, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a>);
00932 
00933         <span class="keyword">delete</span> packet;
00934         <span class="keywordflow">return</span>;
00935     }
00936 
00937     <span class="comment">// do we already have mapping for this fec from our downstream peer?</span>
00938 
00939     <span class="comment">//</span>
00940     <span class="comment">// XXX this code duplicates rebuildFecList</span>
00941     <span class="comment">//</span>
00942 
00943     <span class="comment">// does upstream have mapping from us?</span>
00944     FecBindVector::iterator uit = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecUp, it-&gt;fecid, srcAddr);
00945 
00946     <span class="comment">// shouldn't!</span>
00947     ASSERT(uit == <a class="code" href="class_l_d_p.html#r3">fecUp</a>.end());
00948 
00949     <span class="comment">// do we have mapping from downstream?</span>
00950     FecBindVector::iterator dit = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecDown, it-&gt;fecid, it-&gt;nextHop);
00951 
00952     <span class="comment">// is next hop our LDP peer?</span>
00953     <span class="keywordtype">bool</span> ER = !<a class="code" href="class_l_d_p.html#d5">peerSocketSoft</a>(it-&gt;nextHop);
00954 
00955     ASSERT(!(ER &amp;&amp; dit != <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end())); <span class="comment">// can't be egress and have mapping at the same time</span>
00956 
00957     <span class="keywordflow">if</span> (ER || dit != <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end())
00958     {
00959         fec_bind_t newItem;
00960         newItem.fecid = it-&gt;fecid;
00961         newItem.label = -1;
00962         newItem.peer = srcAddr;
00963         <a class="code" href="class_l_d_p.html#r3">fecUp</a>.push_back(newItem);
00964         uit = <a class="code" href="class_l_d_p.html#r3">fecUp</a>.end() - 1;
00965     }
00966 
00967     std::string inInterface = <a class="code" href="class_l_d_p.html#d2">findInterfaceFromPeerAddr</a>(srcAddr);
00968     std::string outInterface = <a class="code" href="class_l_d_p.html#d2">findInterfaceFromPeerAddr</a>(it-&gt;nextHop);
00969 
00970     <span class="keywordflow">if</span> (ER)
00971     {
00972         <span class="comment">// we are egress, that's easy:</span>
00973         <a class="code" href="_l_i_b_table_8h.html#a3">LabelOpVector</a> outLabel = <a class="code" href="class_l_i_b_table.html#e2">LIBTable::popLabel</a>();
00974 
00975         uit-&gt;label = <a class="code" href="class_l_d_p.html#r9">lt</a>-&gt;<a class="code" href="class_l_i_b_table.html#a1">installLibEntry</a>(uit-&gt;label, inInterface, outLabel, outInterface, 0);
00976 
00977         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"installed (egress) LIB entry inLabel="</span> &lt;&lt; uit-&gt;label &lt;&lt; <span class="stringliteral">" inInterface="</span> &lt;&lt; inInterface &lt;&lt;
00978                 <span class="stringliteral">" outLabel="</span> &lt;&lt; outLabel &lt;&lt; <span class="stringliteral">" outInterface="</span> &lt;&lt; outInterface &lt;&lt; endl;
00979 
00980         <span class="comment">// We are egress, let our upstream peer know</span>
00981         <span class="comment">// about it by sending back a Label Mapping message</span>
00982 
00983         <a class="code" href="class_l_d_p.html#d10">sendMapping</a>(LABEL_MAPPING, srcAddr, uit-&gt;label, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a>, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a>);
00984 
00985     }
00986     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dit != <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end())
00987     {
00988         <span class="comment">// we have mapping from DS, that's easy</span>
00989         <a class="code" href="_l_i_b_table_8h.html#a3">LabelOpVector</a> outLabel = <a class="code" href="class_l_i_b_table.html#e1">LIBTable::swapLabel</a>(dit-&gt;label);
00990         uit-&gt;label = <a class="code" href="class_l_d_p.html#r9">lt</a>-&gt;<a class="code" href="class_l_i_b_table.html#a1">installLibEntry</a>(uit-&gt;label, inInterface, outLabel, outInterface, LDP_USER_TRAFFIC);
00991 
00992         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"installed LIB entry inLabel="</span> &lt;&lt; uit-&gt;label &lt;&lt; <span class="stringliteral">" inInterface="</span> &lt;&lt; inInterface &lt;&lt;
00993                 <span class="stringliteral">" outLabel="</span> &lt;&lt; outLabel &lt;&lt; <span class="stringliteral">" outInterface="</span> &lt;&lt; outInterface &lt;&lt; endl;
00994 
00995         <span class="comment">// We already have a mapping for this FEC, let our upstream peer know</span>
00996         <span class="comment">// about it by sending back a Label Mapping message</span>
00997 
00998         <a class="code" href="class_l_d_p.html#d10">sendMapping</a>(LABEL_MAPPING, srcAddr, uit-&gt;label, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a>, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a>);
00999     }
01000     <span class="keywordflow">else</span>
01001     {
01002         <span class="comment">// no mapping from DS, mark as pending</span>
01003 
01004         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"no mapping for this FEC from the downstream router, marking as pending"</span> &lt;&lt; endl;
01005 
01006         pending_req_t newItem;
01007         newItem.fecid = it-&gt;fecid;
01008         newItem.peer = srcAddr;
01009         <a class="code" href="class_l_d_p.html#r5">pending</a>.push_back(newItem);
01010     }
01011 
01012     <span class="keyword">delete</span> packet;
01013 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b12" doxytag="LDP::processLABEL_WITHDRAW"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::processLABEL_WITHDRAW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p_label_mapping.html">LDPLabelMapping</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>packet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01056 {
01057     <a class="code" href="struct_f_e_c___t_l_v.html">FEC_TLV</a> fec = packet-&gt;<a class="code" href="class_l_d_p_label_mapping.html#a7">getFec</a>();
01058     <span class="keywordtype">int</span> label = packet-&gt;<a class="code" href="class_l_d_p_label_mapping.html#a10">getLabel</a>();
01059     <a class="code" href="class_i_p_address.html">IPAddress</a> fromIP = packet-&gt;<a class="code" href="class_l_d_p_packet.html#a9">senderAddress</a>();
01060 
01061     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Mapping withdraw received for label="</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">" fec="</span> &lt;&lt; fec &lt;&lt; <span class="stringliteral">" from "</span> &lt;&lt; fromIP &lt;&lt; endl;
01062 
01063     ASSERT(label &gt; 0);
01064 
01065     <span class="comment">// remove label from fecDown</span>
01066 
01067     FecVector::iterator it = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecList, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a>, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a>);
01068     <span class="keywordflow">if</span> (it == <a class="code" href="class_l_d_p.html#r2">fecList</a>.end())
01069     {
01070         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"matching FEC not found, ignoring withdraw message"</span> &lt;&lt; endl;
01071         <span class="keyword">delete</span> packet;
01072         <span class="keywordflow">return</span>;
01073     }
01074 
01075     FecBindVector::iterator dit = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecDown, it-&gt;fecid, fromIP);
01076 
01077     <span class="keywordflow">if</span> (dit == <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end() || label != dit-&gt;label)
01078     {
01079         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"matching mapping not found, ignoring withdraw message"</span> &lt;&lt; endl;
01080         <span class="keyword">delete</span> packet;
01081         <span class="keywordflow">return</span>;
01082     }
01083 
01084     ASSERT(dit != <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end());
01085     ASSERT(label == dit-&gt;label);
01086 
01087     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"removing label from list of received mappings"</span> &lt;&lt; endl;
01088     <a class="code" href="class_l_d_p.html#r4">fecDown</a>.erase(dit);
01089 
01090     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"sending back relase message"</span> &lt;&lt; endl;
01091     packet-&gt;<a class="code" href="class_l_d_p_packet.html#a8">setType</a>(LABEL_RELEASE);
01092 
01093     <span class="comment">// send msg to peer over TCP</span>
01094     <a class="code" href="class_l_d_p.html#d6">sendToPeer</a>(fromIP, packet);
01095 
01096     <a class="code" href="class_l_d_p.html#d14">updateFecListEntry</a>(*it);
01097 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="LDP::processLDPHello"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::processLDPHello           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p_hello.html">LDPHello</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00483 {
00484     <a class="code" href="class_u_d_p_control_info.html">UDPControlInfo</a> *controlInfo = check_and_cast&lt;UDPControlInfo *&gt;(msg-&gt;controlInfo());
00485     <span class="comment">//IPAddress peerAddr = controlInfo-&gt;getSrcAddr().get4();</span>
00486     <a class="code" href="class_i_p_address.html">IPAddress</a> peerAddr = msg-&gt;<a class="code" href="class_l_d_p_packet.html#a9">senderAddress</a>();
00487     <span class="keywordtype">int</span> interfaceId = controlInfo-&gt;<a class="code" href="class_u_d_p_control_info.html#a20">interfaceId</a>();
00488     <span class="keyword">delete</span> msg;
00489 
00490     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Received LDP Hello from "</span> &lt;&lt; peerAddr &lt;&lt; <span class="stringliteral">", "</span>;
00491 
00492     <span class="keywordflow">if</span> (peerAddr.isUnspecified() || peerAddr==<a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#a4">routerId</a>())
00493     {
00494         <span class="comment">// must be ourselves (we're also in the all-routers multicast group), ignore</span>
00495         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"that's myself, ignore\n"</span>;
00496         <span class="keywordflow">return</span>;
00497     }
00498 
00499     <span class="comment">// mark link as working if it was failed, and rebuild table</span>
00500     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = <a class="code" href="class_l_d_p.html#r10">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#z61_6">linkIndex</a>(<a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#a4">routerId</a>(), peerAddr);
00501     <span class="keywordflow">if</span> (!<a class="code" href="class_l_d_p.html#r10">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>[index].state)
00502     {
00503         <a class="code" href="class_l_d_p.html#r10">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>[index].state = <span class="keyword">true</span>;
00504         <a class="code" href="class_l_d_p.html#r10">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#z61_9">rebuildRoutingTable</a>();
00505         <a class="code" href="class_l_d_p.html#d15">announceLinkChange</a>(index);
00506     }
00507 
00508     <span class="comment">// peer already in table?</span>
00509     <span class="keywordtype">int</span> i = <a class="code" href="class_l_d_p.html#d3">findPeer</a>(peerAddr);
00510     <span class="keywordflow">if</span> (i!=-1)
00511     {
00512         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"already in my peer table, rescheduling timeout"</span> &lt;&lt; endl;
00513         ASSERT(myPeers[i].timeout);
00514         cancelEvent(myPeers[i].timeout);
00515         scheduleAt(simTime() + holdTime, myPeers[i].timeout);
00516         <span class="keywordflow">return</span>;
00517     }
00518 
00519     <span class="comment">// not in table, add it</span>
00520     peer_info info;
00521     info.peerIP = peerAddr;
00522     info.linkInterface = <a class="code" href="class_l_d_p.html#r7">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(interfaceId)-&gt;<a class="code" href="class_interface_entry.html#a5">name</a>();
00523     info.activeRole = peerAddr.getInt() &gt; <a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#a4">routerId</a>().<a class="code" href="class_i_p_address.html#a5">getInt</a>();
00524     info.socket = NULL;
00525     info.timeout = <span class="keyword">new</span> cMessage(<span class="stringliteral">"HelloTimeout"</span>);
00526     scheduleAt(simTime() + holdTime, info.timeout);
00527     <a class="code" href="class_l_d_p.html#r6">myPeers</a>.push_back(info);
00528     <span class="keywordtype">int</span> peerIndex = <a class="code" href="class_l_d_p.html#r6">myPeers</a>.size()-1;
00529 
00530     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"added to peer table\n"</span>;
00531     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"We'll be "</span> &lt;&lt; (info.activeRole ? <span class="stringliteral">"ACTIVE"</span> : <span class="stringliteral">"PASSIVE"</span>) &lt;&lt; <span class="stringliteral">" in this session\n"</span>;
00532 
00533     <span class="comment">// introduce ourselves with a Hello, then connect if we're in ACTIVE role</span>
00534     <a class="code" href="class_l_d_p.html#b3">sendHelloTo</a>(peerAddr);
00535     <span class="keywordflow">if</span> (info.activeRole)
00536     {
00537         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Establishing session with it\n"</span>;
00538         <a class="code" href="class_l_d_p.html#b4">openTCPConnectionToPeer</a>(peerIndex);
00539     }
00540 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b8" doxytag="LDP::processLDPPacketFromTCP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::processLDPPacketFromTCP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p_packet.html">LDPPacket</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ldpPacket</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00646 {
00647     <span class="keywordflow">switch</span> (ldpPacket-&gt;<a class="code" href="class_l_d_p_packet.html#a7">type</a>())
00648     {
00649     <span class="keywordflow">case</span> <a class="code" href="_l_d_p_packet__m_8h.html#a31a4">HELLO</a>:
00650         error(<span class="stringliteral">"Received LDP HELLO over TCP (should arrive over UDP)"</span>);
00651 
00652     <span class="keywordflow">case</span> <a class="code" href="_l_d_p_packet__m_8h.html#a31a7">ADDRESS</a>:
00653         <span class="comment">// processADDRESS(ldpPacket);</span>
00654         error(<span class="stringliteral">"Received LDP ADDRESS message, unsupported in this version"</span>);
00655         <span class="keywordflow">break</span>;
00656 
00657     <span class="keywordflow">case</span> <a class="code" href="_l_d_p_packet__m_8h.html#a31a8">ADDRESS_WITHDRAW</a>:
00658         <span class="comment">// processADDRESS_WITHDRAW(ldpPacket);</span>
00659         error(<span class="stringliteral">"LDP PROC DEBUG: Received LDP ADDRESS_WITHDRAW message, unsupported in this version"</span>);
00660         <span class="keywordflow">break</span>;
00661 
00662     <span class="keywordflow">case</span> <a class="code" href="_l_d_p_packet__m_8h.html#a31a9">LABEL_MAPPING</a>:
00663         <a class="code" href="class_l_d_p.html#b9">processLABEL_MAPPING</a>(check_and_cast&lt;LDPLabelMapping *&gt;(ldpPacket));
00664         <span class="keywordflow">break</span>;
00665 
00666     <span class="keywordflow">case</span> <a class="code" href="_l_d_p_packet__m_8h.html#a31a10">LABEL_REQUEST</a>:
00667         <a class="code" href="class_l_d_p.html#b10">processLABEL_REQUEST</a>(check_and_cast&lt;LDPLabelRequest *&gt;(ldpPacket));
00668         <span class="keywordflow">break</span>;
00669 
00670     <span class="keywordflow">case</span> <a class="code" href="_l_d_p_packet__m_8h.html#a31a11">LABEL_WITHDRAW</a>:
00671         <a class="code" href="class_l_d_p.html#b12">processLABEL_WITHDRAW</a>(check_and_cast&lt;LDPLabelMapping *&gt;(ldpPacket));
00672         <span class="keywordflow">break</span>;
00673 
00674     <span class="keywordflow">case</span> <a class="code" href="_l_d_p_packet__m_8h.html#a31a12">LABEL_RELEASE</a>:
00675         <a class="code" href="class_l_d_p.html#b11">processLABEL_RELEASE</a>(check_and_cast&lt;LDPLabelMapping *&gt;(ldpPacket));
00676         <span class="keywordflow">break</span>;
00677 
00678     <span class="keywordflow">case</span> <a class="code" href="_l_d_p_packet__m_8h.html#a31a3">NOTIFICATION</a>:
00679         <a class="code" href="class_l_d_p.html#b13">processNOTIFICATION</a>(check_and_cast&lt;LDPNotify*&gt;(ldpPacket));
00680         <span class="keywordflow">break</span>;
00681 
00682     <span class="keywordflow">default</span>:
00683         error(<span class="stringliteral">"LDP PROC DEBUG: Unrecognized LDP Message Type, type is %d"</span>, ldpPacket-&gt;<a class="code" href="class_l_d_p_packet.html#a7">type</a>());
00684     }
00685 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="LDP::processMessageFromTCP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::processMessageFromTCP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00555 {
00556     <a class="code" href="class_t_c_p_socket.html">TCPSocket</a> *socket = <a class="code" href="class_l_d_p.html#r14">socketMap</a>.<a class="code" href="class_t_c_p_socket_map.html#a2">findSocketFor</a>(msg);
00557     <span class="keywordflow">if</span> (!socket)
00558     {
00559         <span class="comment">// not yet in socketMap, must be new incoming connection.</span>
00560         <span class="comment">// find which peer it is and register connection</span>
00561         socket = <span class="keyword">new</span> <a class="code" href="class_t_c_p_socket.html">TCPSocket</a>(msg);
00562         socket-&gt;<a class="code" href="class_t_c_p_socket.html#z129_0">setOutputGate</a>(gate(<span class="stringliteral">"tcpOut"</span>));
00563 
00564         <span class="comment">// FIXME there seems to be some confusion here. Is it sure that</span>
00565         <span class="comment">// routerIds we use as peerAddrs are the same as IP addresses</span>
00566         <span class="comment">// the routing is based on? --Andras</span>
00567         <a class="code" href="class_i_p_address.html">IPAddress</a> peerAddr = socket-&gt;<a class="code" href="class_t_c_p_socket.html#z127_2">remoteAddress</a>().<a class="code" href="class_i_pv_x_address.html#z35_1">get4</a>();
00568 
00569         <span class="keywordtype">int</span> i = <a class="code" href="class_l_d_p.html#d3">findPeer</a>(peerAddr);
00570         <span class="keywordflow">if</span> (i==-1 || myPeers[i].socket)
00571         {
00572             <span class="comment">// nothing known about this guy, or already connected: refuse</span>
00573             socket-&gt;close(); <span class="comment">// reset()?</span>
00574             <span class="keyword">delete</span> socket;
00575             <span class="keyword">delete</span> msg;
00576             <span class="keywordflow">return</span>;
00577         }
00578         <a class="code" href="class_l_d_p.html#r6">myPeers</a>[i].socket = socket;
00579         socket-&gt;<a class="code" href="class_t_c_p_socket.html#z131_1">setCallbackObject</a>(<span class="keyword">this</span>, (<span class="keywordtype">void</span> *)i);
00580         <a class="code" href="class_l_d_p.html#r14">socketMap</a>.<a class="code" href="class_t_c_p_socket_map.html#a3">addSocket</a>(socket);
00581     }
00582 
00583     <span class="comment">// dispatch to socketEstablished(), socketDataArrived(), socketPeerClosed()</span>
00584     <span class="comment">// or socketFailure()</span>
00585     socket-&gt;<a class="code" href="class_t_c_p_socket.html#z131_2">processMessage</a>(msg);
00586 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b13" doxytag="LDP::processNOTIFICATION"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::processNOTIFICATION           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p_notify.html">LDPNotify</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>packet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00859 {
00860     <a class="code" href="struct_f_e_c___t_l_v.html">FEC_TLV</a> fec = packet-&gt;<a class="code" href="class_l_d_p_notify.html#a9">getFec</a>();
00861     <a class="code" href="class_i_p_address.html">IPAddress</a> srcAddr = packet-&gt;<a class="code" href="class_l_d_p_packet.html#a9">senderAddress</a>();
00862     <span class="keywordtype">int</span> status = packet-&gt;<a class="code" href="class_l_d_p_notify.html#a7">getStatus</a>();
00863 
00864     <span class="comment">// XXX FIXME NO_ROUTE processing should probably be split into two functions,</span>
00865     <span class="comment">// this is not the cleanest thing I ever wrote :)   --Vojta</span>
00866 
00867     <span class="keywordflow">if</span> (packet-&gt;isSelfMessage())
00868     {
00869         <span class="comment">// re-scheduled by ourselves</span>
00870         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"notification retry for peer="</span> &lt;&lt; srcAddr &lt;&lt; <span class="stringliteral">" fec="</span> &lt;&lt; fec &lt;&lt; <span class="stringliteral">" status="</span> &lt;&lt; status &lt;&lt; endl;
00871     }
00872     <span class="keywordflow">else</span>
00873     {
00874         <span class="comment">// received via network</span>
00875         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"notification received from="</span> &lt;&lt; srcAddr &lt;&lt; <span class="stringliteral">" fec="</span> &lt;&lt; fec &lt;&lt; <span class="stringliteral">" status="</span> &lt;&lt; status &lt;&lt; endl;
00876     }
00877 
00878     <span class="keywordflow">switch</span>(status)
00879     {
00880         <span class="keywordflow">case</span> <a class="code" href="_l_d_p_packet__m_8h.html#a32a14">NO_ROUTE</a>:
00881         {
00882             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"route does not exit on that peer"</span> &lt;&lt; endl;
00883 
00884             FecVector::iterator it = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecList, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a>, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a>);
00885             <span class="keywordflow">if</span> (it != <a class="code" href="class_l_d_p.html#r2">fecList</a>.end())
00886             {
00887                 <span class="keywordflow">if</span> (it-&gt;nextHop == srcAddr)
00888                 {
00889                     <span class="keywordflow">if</span> (!packet-&gt;isSelfMessage())
00890                     {
00891                         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"we are still interesed in this mapping, we will retry later"</span> &lt;&lt; endl;
00892 
00893                         scheduleAt(simTime() + 1.0 <span class="comment">/* XXX FIXME */</span>, packet);
00894                         <span class="keywordflow">return</span>;
00895                     }
00896                     <span class="keywordflow">else</span>
00897                     {
00898                         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"reissuing request"</span> &lt;&lt; endl;
00899 
00900                         <a class="code" href="class_l_d_p.html#d9">sendMappingRequest</a>(srcAddr, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a>, fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a>);
00901                     }
00902                 }
00903                 <span class="keywordflow">else</span>
00904                     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"and we still recognize this FEC, but we use different next hop, forget it"</span> &lt;&lt; endl;
00905             }
00906             <span class="keywordflow">else</span>
00907                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"and we do not recognize this any longer, forget it"</span> &lt;&lt; endl;
00908 
00909             <span class="keywordflow">break</span>;
00910         }
00911 
00912         <span class="keywordflow">default</span>:
00913             ASSERT(<span class="keyword">false</span>);
00914     }
00915 
00916     <span class="keyword">delete</span> packet;
00917 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d12" doxytag="LDP::rebuildFecList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::rebuildFecList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00263 {
00264     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"make list of recognized FECs"</span> &lt;&lt; endl;
00265 
00266     <a class="code" href="class_l_d_p.html#w0">FecVector</a> oldList = <a class="code" href="class_l_d_p.html#r2">fecList</a>;
00267     <a class="code" href="class_l_d_p.html#r2">fecList</a>.clear();
00268 
00269     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; rt-&gt;numRoutingEntries(); i++)
00270     {
00271         <span class="comment">// every entry in the routing table</span>
00272 
00273         <a class="code" href="class_routing_entry.html">RoutingEntry</a> *re = <a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#z46_1">routingEntry</a>(i);
00274 
00275         <span class="comment">// ignore multicast routes</span>
00276         <span class="keywordflow">if</span> (re-&gt;<a class="code" href="class_routing_entry.html#o0">host</a>.<a class="code" href="class_i_p_address.html#a8">isMulticast</a>())
00277             <span class="keywordflow">continue</span>;
00278 
00279         <span class="comment">// find out current next hop according to routing table</span>
00280         <a class="code" href="class_i_p_address.html">IPAddress</a> nextHop = (re-&gt;<a class="code" href="class_routing_entry.html#o5">type</a> == <a class="code" href="class_routing_entry.html#w8w0">RoutingEntry::DIRECT</a>)? re-&gt;<a class="code" href="class_routing_entry.html#o0">host</a>: re-&gt;<a class="code" href="class_routing_entry.html#o2">gateway</a>;
00281         ASSERT(!nextHop.<a class="code" href="class_i_p_address.html#a1">isUnspecified</a>());
00282 
00283         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"nextHop &lt;-- "</span> &lt;&lt; nextHop &lt;&lt; endl;
00284 
00285         FecVector::iterator it = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(oldList, re-&gt;<a class="code" href="class_routing_entry.html#o0">host</a>, re-&gt;<a class="code" href="class_routing_entry.html#o1">netmask</a>.<a class="code" href="class_i_p_address.html#a15">netmaskLength</a>());
00286 
00287         <span class="keywordflow">if</span> (it == oldList.end())
00288         {
00289             <span class="comment">// fec didn't exist, it was just created</span>
00290             fec_t newItem;
00291             newItem.fecid = ++<a class="code" href="class_l_d_p.html#r16">maxFecid</a>;
00292             newItem.<a class="code" href="class_i_p_address.html#p0">addr</a> = re-&gt;<a class="code" href="class_routing_entry.html#o0">host</a>;
00293             newItem.length = re-&gt;<a class="code" href="class_routing_entry.html#o1">netmask</a>.<a class="code" href="class_i_p_address.html#a15">netmaskLength</a>();
00294             newItem.nextHop = nextHop;
00295             <a class="code" href="class_l_d_p.html#d14">updateFecListEntry</a>(newItem);
00296             <a class="code" href="class_l_d_p.html#r2">fecList</a>.push_back(newItem);
00297         }
00298         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it-&gt;nextHop != nextHop)
00299         {
00300             <span class="comment">// next hop for this FEC changed,</span>
00301             it-&gt;nextHop = nextHop;
00302             <a class="code" href="class_l_d_p.html#d14">updateFecListEntry</a>(*it);
00303             <a class="code" href="class_l_d_p.html#r2">fecList</a>.push_back(*it);
00304             oldList.erase(it);
00305         }
00306         <span class="keywordflow">else</span>
00307         {
00308             <span class="comment">// FEC didn't change, reusing old values</span>
00309             <a class="code" href="class_l_d_p.html#r2">fecList</a>.push_back(*it);
00310             oldList.erase(it);
00311             <span class="keywordflow">continue</span>;
00312         }
00313     }
00314 
00315 
00316     <span class="comment">// our own addresses (XXX is it needed?)</span>
00317 
00318     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt; ift-&gt;numInterfaces(); ++i)
00319     {
00320         <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_l_d_p.html#r7">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(i);
00321         <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a6">networkLayerGateIndex</a>() &lt; 0)
00322             <span class="keywordflow">continue</span>;
00323 
00324         FecVector::iterator it = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(oldList, ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a4">inetAddress</a>(), 32);
00325         <span class="keywordflow">if</span> (it == oldList.end())
00326         {
00327             fec_t newItem;
00328             newItem.fecid = ++<a class="code" href="class_l_d_p.html#r16">maxFecid</a>;
00329             newItem.addr = ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a4">inetAddress</a>();
00330             newItem.length = 32;
00331             newItem.nextHop = ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a4">inetAddress</a>();
00332             <a class="code" href="class_l_d_p.html#r2">fecList</a>.push_back(newItem);
00333         }
00334         <span class="keywordflow">else</span>
00335         {
00336             <a class="code" href="class_l_d_p.html#r2">fecList</a>.push_back(*it);
00337             oldList.erase(it);
00338         }
00339     }
00340 
00341     <span class="keywordflow">if</span> (oldList.size() &gt; 0)
00342     {
00343         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"there are "</span> &lt;&lt; oldList.size() &lt;&lt; <span class="stringliteral">" deprecated FECs, removing them"</span> &lt;&lt; endl;
00344 
00345         FecVector::iterator it;
00346         <span class="keywordflow">for</span> (it = oldList.begin(); it != oldList.end(); it++)
00347         {
00348             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"removing FEC= "</span> &lt;&lt; *it &lt;&lt; endl;
00349 
00350             FecBindVector::iterator dit;
00351             <span class="keywordflow">for</span> (dit = <a class="code" href="class_l_d_p.html#r4">fecDown</a>.begin(); dit != <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end(); dit++)
00352             {
00353                 <span class="keywordflow">if</span> (dit-&gt;fecid != it-&gt;fecid)
00354                     continue;
00355 
00356                 EV &lt;&lt; "sending release label=" &lt;&lt; dit-&gt;label &lt;&lt; " downstream to " &lt;&lt; dit-&gt;peer &lt;&lt; endl;
00357 
00358                 sendMapping(LABEL_RELEASE, dit-&gt;peer, dit-&gt;label, it-&gt;addr, it-&gt;length);
00359             }
00360 
00361             FecBindVector::iterator uit;
00362             for (uit = fecUp.begin(); uit != fecUp.end(); uit++)
00363             {
00364                 <span class="keywordflow">if</span> (uit-&gt;fecid != it-&gt;fecid)
00365                     continue;
00366 
00367                 EV &lt;&lt; "sending withdraw label=" &lt;&lt; uit-&gt;label &lt;&lt; " upstream to " &lt;&lt; uit-&gt;peer &lt;&lt; endl;
00368 
00369                 sendMapping(LABEL_WITHDRAW, uit-&gt;peer, uit-&gt;label, it-&gt;addr, it-&gt;length);
00370 
00371                 EV &lt;&lt; "removing entry inLabel=" &lt;&lt; uit-&gt;label &lt;&lt; " from LIB" &lt;&lt; endl;
00372 
00373                 lt-&gt;removeLibEntry(uit-&gt;label);
00374             }
00375 
00376         }
00377     }
00378 
00379     <span class="comment">// we must keep this list sorted for matching to work correctly</span>
00380     <span class="comment">// this is probably slower than it must be</span>
00381 
00382     std::sort(fecList.begin(), fecList.end(), fecPrefixCompare);
00383 
00384 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b15" doxytag="LDP::receiveChangeNotification"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::receiveChangeNotification           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>category</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cPolymorphic *&nbsp;</td>
          <td class="mdname" nowrap> <em>details</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Called by the <a class="el" href="class_notification_board.html">NotificationBoard</a> whenever a change of a category occurs to which this client has subscribed. 
<p>
Implements <a class="el" href="class_i_notifiable.html#a1">INotifiable</a>.<div class="fragment"><pre class="fragment">01234 {
01235     Enter_Method_Silent();
01236     <a class="code" href="_notifier_consts_8cc.html#a1">printNotificationBanner</a>(category, details);
01237 
01238     ASSERT(category == NF_IPv4_ROUTINGTABLE_CHANGED);
01239 
01240     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"routing table changed, rebuild list of known FEC"</span> &lt;&lt; endl;
01241 
01242     <a class="code" href="class_l_d_p.html#d12">rebuildFecList</a>();
01243 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="LDP::sendHelloTo"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::sendHelloTo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dest</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00399 {
00400     <a class="code" href="class_l_d_p_hello.html">LDPHello</a> *hello = <span class="keyword">new</span> <a class="code" href="class_l_d_p_hello.html">LDPHello</a>(<span class="stringliteral">"LDP-Hello"</span>);
00401     hello-&gt;setByteLength(LDP_HEADER_BYTES);
00402     hello-&gt;<a class="code" href="class_l_d_p_packet.html#a8">setType</a>(HELLO);
00403     hello-&gt;<a class="code" href="class_l_d_p_packet.html#a11">setSenderAddress</a>(<a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#a4">routerId</a>());
00404     <span class="comment">//hello-&gt;setReceiverAddress(...);</span>
00405     hello-&gt;<a class="code" href="class_l_d_p_hello.html#a8">setHoldTime</a>(holdTime);
00406     <span class="comment">//hello-&gt;setRbit(...);</span>
00407     <span class="comment">//hello-&gt;setTbit(...);</span>
00408     hello-&gt;addPar(<span class="stringliteral">"color"</span>) = <a class="code" href="_l_d_p_8h.html#a2">LDP_HELLO_TRAFFIC</a>;
00409 
00410     <a class="code" href="class_l_d_p.html#r12">udpSocket</a>.<a class="code" href="class_u_d_p_socket.html#z135_6">sendTo</a>(hello, dest, LDP_PORT);
00411 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d10" doxytag="LDP::sendMapping"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::sendMapping           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>length</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00840 {
00841     <span class="comment">// Send LABEL MAPPING downstream</span>
00842     <a class="code" href="class_l_d_p_label_mapping.html">LDPLabelMapping</a> *lmMessage = <span class="keyword">new</span> <a class="code" href="class_l_d_p_label_mapping.html">LDPLabelMapping</a>(<span class="stringliteral">"Lb-Mapping"</span>);
00843     lmMessage-&gt;setByteLength(LDP_HEADER_BYTES); <span class="comment">// FIXME find out actual length</span>
00844     lmMessage-&gt;<a class="code" href="class_l_d_p_packet.html#a8">setType</a>(type);
00845     lmMessage-&gt;<a class="code" href="class_l_d_p_packet.html#a14">setReceiverAddress</a>(dest);
00846     lmMessage-&gt;<a class="code" href="class_l_d_p_packet.html#a11">setSenderAddress</a>(<a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#a4">routerId</a>());
00847     lmMessage-&gt;<a class="code" href="class_l_d_p_label_mapping.html#a11">setLabel</a>(label);
00848 
00849     <a class="code" href="struct_f_e_c___t_l_v.html">FEC_TLV</a> fec;
00850     fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a> = addr;
00851     fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a> = length;
00852 
00853     lmMessage-&gt;<a class="code" href="class_l_d_p_label_mapping.html#a9">setFec</a>(fec);
00854 
00855     <a class="code" href="class_l_d_p.html#d6">sendToPeer</a>(dest, lmMessage);
00856 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d9" doxytag="LDP::sendMappingRequest"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::sendMappingRequest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>length</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00184 {
00185     <a class="code" href="class_l_d_p_label_request.html">LDPLabelRequest</a> *requestMsg = <span class="keyword">new</span> <a class="code" href="class_l_d_p_label_request.html">LDPLabelRequest</a>(<span class="stringliteral">"Lb-Req"</span>);
00186     requestMsg-&gt;setByteLength(LDP_HEADER_BYTES); <span class="comment">// FIXME find out actual length</span>
00187     requestMsg-&gt;<a class="code" href="class_l_d_p_packet.html#a8">setType</a>(LABEL_REQUEST);
00188 
00189     <a class="code" href="struct_f_e_c___t_l_v.html">FEC_TLV</a> fec;
00190     fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a> = addr;
00191     fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a> = length;
00192     requestMsg-&gt;<a class="code" href="class_l_d_p_label_request.html#a9">setFec</a>(fec);
00193 
00194     requestMsg-&gt;<a class="code" href="class_l_d_p_packet.html#a14">setReceiverAddress</a>(dest);
00195     requestMsg-&gt;<a class="code" href="class_l_d_p_packet.html#a11">setSenderAddress</a>(<a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#a4">routerId</a>());
00196 
00197     <a class="code" href="class_l_d_p.html#d6">sendToPeer</a>(dest, requestMsg);
00198 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d11" doxytag="LDP::sendNotify"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::sendNotify           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>status</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>length</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00821 {
00822     <span class="comment">// Send NOTIFY message</span>
00823     <a class="code" href="class_l_d_p_notify.html">LDPNotify</a> *lnMessage = <span class="keyword">new</span> <a class="code" href="class_l_d_p_notify.html">LDPNotify</a>(<span class="stringliteral">"Lb-Notify"</span>);
00824     lnMessage-&gt;setByteLength(LDP_HEADER_BYTES); <span class="comment">// FIXME find out actual length</span>
00825     lnMessage-&gt;<a class="code" href="class_l_d_p_packet.html#a8">setType</a>(NOTIFICATION);
00826     lnMessage-&gt;<a class="code" href="class_l_d_p_notify.html#a8">setStatus</a>(NO_ROUTE);
00827     lnMessage-&gt;<a class="code" href="class_l_d_p_packet.html#a14">setReceiverAddress</a>(dest);
00828     lnMessage-&gt;<a class="code" href="class_l_d_p_packet.html#a11">setSenderAddress</a>(<a class="code" href="class_l_d_p.html#r8">rt</a>-&gt;<a class="code" href="class_routing_table.html#a4">routerId</a>());
00829 
00830     <a class="code" href="struct_f_e_c___t_l_v.html">FEC_TLV</a> fec;
00831     fec.<a class="code" href="struct_f_e_c___t_l_v.html#o0">addr</a> = addr;
00832     fec.<a class="code" href="struct_f_e_c___t_l_v.html#o1">length</a> = length;
00833 
00834     lnMessage-&gt;<a class="code" href="class_l_d_p_notify.html#a11">setFec</a>(fec);
00835 
00836     <a class="code" href="class_l_d_p.html#d6">sendToPeer</a>(dest, lnMessage);
00837 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d6" doxytag="LDP::sendToPeer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::sendToPeer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00179 {
00180     <a class="code" href="class_l_d_p.html#d4">peerSocket</a>(dest)-&gt;<a class="code" href="class_t_c_p_socket.html#z129_6">send</a>(msg);
00181 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z59_3" doxytag="LDP::socketClosed"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::socketClosed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>connId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>yourPtr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_t_c_p_socket_1_1_callback_interface.html#a4">TCPSocket::CallbackInterface</a>.<div class="fragment"><pre class="fragment">00626 {
00627     peer_info&amp; peer = <a class="code" href="class_l_d_p.html#r6">myPeers</a>[(long)yourPtr];
00628     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"TCP connection to peer "</span> &lt;&lt; peer.peerIP &lt;&lt; <span class="stringliteral">" closed\n"</span>;
00629 
00630     ASSERT(<span class="keyword">false</span>);
00631 
00632     <span class="comment">// FIXME what now? reconnect after a delay?</span>
00633 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z59_1" doxytag="LDP::socketDataArrived"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::socketDataArrived           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>connId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>yourPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap> <em>urgent</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Implements <a class="el" href="class_t_c_p_socket_1_1_callback_interface.html#a1">TCPSocket::CallbackInterface</a>.<div class="fragment"><pre class="fragment">00600 {
00601     peer_info&amp; peer = <a class="code" href="class_l_d_p.html#r6">myPeers</a>[(long)yourPtr];
00602     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Message arrived over TCP from peer "</span> &lt;&lt; peer.peerIP &lt;&lt; <span class="stringliteral">"\n"</span>;
00603 
00604     <span class="keyword">delete</span> msg-&gt;removeControlInfo();
00605     <a class="code" href="class_l_d_p.html#b8">processLDPPacketFromTCP</a>(check_and_cast&lt;LDPPacket *&gt;(msg));
00606 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z59_0" doxytag="LDP::socketEstablished"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::socketEstablished           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>connId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>yourPtr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_t_c_p_socket_1_1_callback_interface.html#a2">TCPSocket::CallbackInterface</a>.<div class="fragment"><pre class="fragment">00589 {
00590     peer_info&amp; peer = <a class="code" href="class_l_d_p.html#r6">myPeers</a>[(long)yourPtr];
00591     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"TCP connection established with peer "</span> &lt;&lt; peer.peerIP &lt;&lt; <span class="stringliteral">"\n"</span>;
00592 
00593     <span class="comment">// we must update all entries with nextHop == peerIP</span>
00594     <a class="code" href="class_l_d_p.html#d13">updateFecList</a>(peer.peerIP);
00595 
00596     <span class="comment">// FIXME start LDP session setup (if we're on the active side?)</span>
00597 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z59_4" doxytag="LDP::socketFailure"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::socketFailure           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>connId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>yourPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>code</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_t_c_p_socket_1_1_callback_interface.html#a5">TCPSocket::CallbackInterface</a>.<div class="fragment"><pre class="fragment">00636 {
00637     peer_info&amp; peer = <a class="code" href="class_l_d_p.html#r6">myPeers</a>[(long)yourPtr];
00638     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"TCP connection to peer "</span> &lt;&lt; peer.peerIP &lt;&lt; <span class="stringliteral">" broken\n"</span>;
00639 
00640     ASSERT(<span class="keyword">false</span>);
00641 
00642     <span class="comment">// FIXME what now? reconnect after a delay?</span>
00643 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z59_2" doxytag="LDP::socketPeerClosed"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::socketPeerClosed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>connId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>yourPtr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_t_c_p_socket_1_1_callback_interface.html#a3">TCPSocket::CallbackInterface</a>.<div class="fragment"><pre class="fragment">00609 {
00610     peer_info&amp; peer = <a class="code" href="class_l_d_p.html#r6">myPeers</a>[(long)yourPtr];
00611     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Peer "</span> &lt;&lt; peer.peerIP &lt;&lt; <span class="stringliteral">" closed TCP connection\n"</span>;
00612 
00613     ASSERT(<span class="keyword">false</span>);
00614 
00615 <span class="comment">/*</span>
00616 <span class="comment">    // close the connection (if not already closed)</span>
00617 <span class="comment">    if (socket.state()==TCPSocket::PEER_CLOSED)</span>
00618 <span class="comment">    {</span>
00619 <span class="comment">        EV &lt;&lt; "remote TCP closed, closing here as well\n";</span>
00620 <span class="comment">        close();</span>
00621 <span class="comment">    }</span>
00622 <span class="comment">*/</span>
00623 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z59_5" doxytag="LDP::socketStatusArrived"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual void LDP::socketStatusArrived           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>connId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>yourPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_t_c_p_status_info.html">TCPStatusInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>status</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_t_c_p_socket_1_1_callback_interface.html#a6">TCPSocket::CallbackInterface</a>.<div class="fragment"><pre class="fragment">00204 {<span class="keyword">delete</span> status;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d13" doxytag="LDP::updateFecList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::updateFecList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>nextHop</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00387 {
00388     FecVector::iterator it;
00389     <span class="keywordflow">for</span> (it = <a class="code" href="class_l_d_p.html#r2">fecList</a>.begin(); it != <a class="code" href="class_l_d_p.html#r2">fecList</a>.end(); it++)
00390     {
00391         <span class="keywordflow">if</span> (it-&gt;nextHop != nextHop)
00392             continue;
00393 
00394         updateFecListEntry(*it);
00395     }
00396 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d14" doxytag="LDP::updateFecListEntry"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LDP::updateFecListEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_l_d_p_1_1fec__t.html">fec_t</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>oldItem</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00201 {
00202     <span class="comment">// do we have mapping from downstream?</span>
00203     FecBindVector::iterator dit = <a class="code" href="class_l_d_p.html#d7">findFecEntry</a>(fecDown, oldItem.<a class="code" href="struct_l_d_p_1_1fec__t.html#o0">fecid</a>, oldItem.<a class="code" href="struct_l_d_p_1_1fec__t.html#o3">nextHop</a>);
00204 
00205     <span class="comment">// is next hop our LDP peer?</span>
00206     <span class="keywordtype">bool</span> ER = !<a class="code" href="class_l_d_p.html#d5">peerSocketSoft</a>(oldItem.<a class="code" href="struct_l_d_p_1_1fec__t.html#o3">nextHop</a>);
00207 
00208     ASSERT(!(ER &amp;&amp; dit != <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end())); <span class="comment">// can't be egress and have mapping at the same time</span>
00209 
00210     <span class="comment">// adjust upstream mappings</span>
00211     FecBindVector::iterator uit;
00212     <span class="keywordflow">for</span> (uit = <a class="code" href="class_l_d_p.html#r3">fecUp</a>.begin(); uit != <a class="code" href="class_l_d_p.html#r3">fecUp</a>.end(); uit++)
00213     {
00214         <span class="keywordflow">if</span> (uit-&gt;fecid != oldItem.<a class="code" href="struct_l_d_p_1_1fec__t.html#o0">fecid</a>)
00215             continue;
00216 
00217         std::string inInterface = findInterfaceFromPeerAddr(uit-&gt;peer);
00218         std::string outInterface = findInterfaceFromPeerAddr(oldItem.nextHop);
00219         if (ER)
00220         {
00221             <span class="comment">// we are egress, that's easy:</span>
00222             <a class="code" href="_l_i_b_table_8h.html#a3">LabelOpVector</a> outLabel = <a class="code" href="class_l_i_b_table.html#e2">LIBTable::popLabel</a>();
00223             uit-&gt;label = <a class="code" href="class_l_d_p.html#r9">lt</a>-&gt;<a class="code" href="class_l_i_b_table.html#a1">installLibEntry</a>(uit-&gt;label, inInterface, outLabel, outInterface, LDP_USER_TRAFFIC);
00224 
00225             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"installed (egress) LIB entry inLabel="</span> &lt;&lt; uit-&gt;label &lt;&lt; <span class="stringliteral">" inInterface="</span> &lt;&lt; inInterface &lt;&lt;
00226                     <span class="stringliteral">" outLabel="</span> &lt;&lt; outLabel &lt;&lt; <span class="stringliteral">" outInterface="</span> &lt;&lt; outInterface &lt;&lt; endl;
00227         }
00228         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dit != <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end())
00229         {
00230             <span class="comment">// we have mapping from DS, that's easy</span>
00231             <a class="code" href="_l_i_b_table_8h.html#a3">LabelOpVector</a> outLabel = <a class="code" href="class_l_i_b_table.html#e1">LIBTable::swapLabel</a>(dit-&gt;label);
00232             uit-&gt;label = <a class="code" href="class_l_d_p.html#r9">lt</a>-&gt;<a class="code" href="class_l_i_b_table.html#a1">installLibEntry</a>(uit-&gt;label, inInterface, outLabel, outInterface, LDP_USER_TRAFFIC);
00233 
00234             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"installed LIB entry inLabel="</span> &lt;&lt; uit-&gt;label &lt;&lt; <span class="stringliteral">" inInterface="</span> &lt;&lt; inInterface &lt;&lt;
00235                     <span class="stringliteral">" outLabel="</span> &lt;&lt; outLabel &lt;&lt; <span class="stringliteral">" outInterface="</span> &lt;&lt; outInterface &lt;&lt; endl;
00236 
00237         }
00238         <span class="keywordflow">else</span>
00239         {
00240             <span class="comment">// no mapping from DS, withdraw mapping US</span>
00241 
00242             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"sending withdraw message upstream"</span> &lt;&lt; endl;
00243 
00244             <a class="code" href="class_l_d_p.html#d10">sendMapping</a>(LABEL_WITHDRAW, uit-&gt;peer, uit-&gt;label, oldItem.<a class="code" href="struct_l_d_p_1_1fec__t.html#o1">addr</a>, oldItem.<a class="code" href="struct_l_d_p_1_1fec__t.html#o2">length</a>);
00245 
00246             <span class="comment">// remove from US mappings</span>
00247 
00248             <a class="code" href="class_l_d_p.html#r3">fecUp</a>.erase(uit--);
00249         }
00250     }
00251 
00252     <span class="keywordflow">if</span> (!ER &amp;&amp; dit == <a class="code" href="class_l_d_p.html#r4">fecDown</a>.end())
00253     {
00254         <span class="comment">// and ask DS for mapping</span>
00255 
00256         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"sending request message downstream"</span> &lt;&lt; endl;
00257 
00258         <a class="code" href="class_l_d_p.html#d9">sendMappingRequest</a>(oldItem.<a class="code" href="struct_l_d_p_1_1fec__t.html#o3">nextHop</a>, oldItem.<a class="code" href="struct_l_d_p_1_1fec__t.html#o1">addr</a>, oldItem.<a class="code" href="struct_l_d_p_1_1fec__t.html#o2">length</a>);
00259     }
00260 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="r4" doxytag="LDP::fecDown"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p.html#w1">FecBindVector</a> <a class="el" href="class_l_d_p.html#r4">LDP::fecDown</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r2" doxytag="LDP::fecList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p.html#w0">FecVector</a> <a class="el" href="class_l_d_p.html#r2">LDP::fecList</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r3" doxytag="LDP::fecUp"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p.html#w1">FecBindVector</a> <a class="el" href="class_l_d_p.html#r3">LDP::fecUp</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r1" doxytag="LDP::helloInterval"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_l_d_p.html#r1">LDP::helloInterval</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r0" doxytag="LDP::holdTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_l_d_p.html#r0">LDP::holdTime</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r7" doxytag="LDP::ift"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a>* <a class="el" href="class_l_d_p.html#r7">LDP::ift</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r9" doxytag="LDP::lt"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_i_b_table.html">LIBTable</a>* <a class="el" href="class_l_d_p.html#r9">LDP::lt</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r16" doxytag="LDP::maxFecid"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_l_d_p.html#r16">LDP::maxFecid</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r6" doxytag="LDP::myPeers"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p.html#w3">PeerVector</a> <a class="el" href="class_l_d_p.html#r6">LDP::myPeers</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r11" doxytag="LDP::nb"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_notification_board.html">NotificationBoard</a>* <a class="el" href="class_l_d_p.html#r11">LDP::nb</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r5" doxytag="LDP::pending"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_l_d_p.html#w2">PendingVector</a> <a class="el" href="class_l_d_p.html#r5">LDP::pending</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r8" doxytag="LDP::rt"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_routing_table.html">RoutingTable</a>* <a class="el" href="class_l_d_p.html#r8">LDP::rt</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r15" doxytag="LDP::sendHelloMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage* <a class="el" href="class_l_d_p.html#r15">LDP::sendHelloMsg</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r13" doxytag="LDP::serverSocket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_socket.html">TCPSocket</a> <a class="el" href="class_l_d_p.html#r13">LDP::serverSocket</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r14" doxytag="LDP::socketMap"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_c_p_socket_map.html">TCPSocketMap</a> <a class="el" href="class_l_d_p.html#r14">LDP::socketMap</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r10" doxytag="LDP::tedmod"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_e_d.html">TED</a>* <a class="el" href="class_l_d_p.html#r10">LDP::tedmod</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r12" doxytag="LDP::udpSocket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_u_d_p_socket.html">UDPSocket</a> <a class="el" href="class_l_d_p.html#r12">LDP::udpSocket</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_l_d_p_8h.html">LDP.h</a><li><a class="el" href="_l_d_p_8cc.html">LDP.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:26 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
