<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: NotificationBoard Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>NotificationBoard Class Reference</h1><code>#include &lt;NotificationBoard.h&gt;</code>
<p>
<a href="class_notification_board-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Acts as a intermediary between module where state changes can occur and modules which are interested in learning about those changes; "Notification Broker".<p>
Notification events are grouped into "categories." Examples of categories are: NF_HOSTPOSITION_UPDATED, NF_RADIOSTATE_CHANGED, NF_PP_TX_BEGIN, NF_PP_TX_END, NF_IPv4_ROUTINGTABLE_CHANGED, NF_BEACON_LOST NF_NODE_FAILURE, NF_NODE_RECOVERY, etc. Each category is identified by an integer (right now it's assigned in the source code via an enum, in the future we'll convert to dynamic category registration).<p>
To trigger a notification, the client must obtain a pointer to the NotificationBoard of the given host or router (explained later), and call its <a class="el" href="class_notification_board.html#z24_0">fireChangeNotification()</a> method. The notification will be delivered to all subscribed clients immediately, inside the <a class="el" href="class_notification_board.html#z24_0">fireChangeNotification()</a> call.<p>
Clients that wish to receive notifications should implement (subclass from) the <a class="el" href="class_i_notifiable.html">INotifiable</a> interface, obtain a pointer to the NotificationBoard, and subscribe to the categories they are interested in by calling the <a class="el" href="class_notification_board.html#z22_0">subscribe()</a> method of the NotificationBoard. Notifications will be delivered to the receiveChangeNotification() method of the client (redefined from <a class="el" href="class_i_notifiable.html">INotifiable</a>).<p>
In cases when the category itself (an int) does not carry enough information about the notification event, one can pass additional information in a data class. There is no restriction on what the data class may contain, except that it has to be subclassed from cPolymorphic, and of course producers and consumers of notifications should agree on its contents. If no extra info is needed, one can pass a NULL pointer in the <a class="el" href="class_notification_board.html#z24_0">fireChangeNotification()</a> method.<p>
A module which implements <a class="el" href="class_i_notifiable.html">INotifiable</a> looks like this:<p>
<pre>
 class Foo : public cSimpleModule, public <a class="el" href="class_i_notifiable.html">INotifiable</a> {
     ...
     virtual void receiveChangeNotification(int category, cPolymorphic *details) {..}
     ...
 };
 </pre><p>
Obtaining a pointer to the NotificationBoard module of that host/router:<p>
<pre>
 NotificationBoard *nb; // this is best made a module class member
 nb = NotificationBoardAccess().get();  // best done in <a class="el" href="class_notification_board.html#b0">initialize()</a>
 </pre><p>
See NED file for additional info.<p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="class_i_notifiable.html">INotifiable</a> </dd></dl>
<dl compact><dt><b>Author:</b></dt><dd>Andras Varga </dd></dl>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::vector&lt; <a class="el" href="class_i_notifiable.html">INotifiable</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_notification_board.html#w0">NotifiableVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::map&lt; int, <a class="el" href="class_notification_board.html#w0">NotifiableVector</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_notification_board.html#w1">ClientMap</a></td></tr>

<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Methods for consumers of change notifications</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_notification_board.html#z22_0">subscribe</a> (<a class="el" href="class_i_notifiable.html">INotifiable</a> *client, int category)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_notification_board.html#z22_1">unsubscribe</a> (<a class="el" href="class_i_notifiable.html">INotifiable</a> *client, int category)</td></tr>

<tr><td colspan="2"><div class="groupHeader">Methods for producers of change notifications</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_notification_board.html#z24_0">fireChangeNotification</a> (int category, cPolymorphic *details=NULL)</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_notification_board.html#b0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_notification_board.html#b1">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_notification_board.html#w1">ClientMap</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_notification_board.html#p0">clientMap</a></td></tr>

<tr><td colspan="2"><br><h2>Friends</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">std::ostream &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_notification_board.html#n0">operator&lt;&lt;</a> (std::ostream &amp;, const <a class="el" href="class_notification_board.html#w0">NotifiableVector</a> &amp;)</td></tr>

</table>
<hr><h2>Member Typedef Documentation</h2>
<a class="anchor" name="w1" doxytag="NotificationBoard::ClientMap"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::map&lt;int, <a class="el" href="class_notification_board.html#w0">NotifiableVector</a>&gt; <a class="el" href="class_notification_board.html#w1">NotificationBoard::ClientMap</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w0" doxytag="NotificationBoard::NotifiableVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::vector&lt;<a class="el" href="class_i_notifiable.html">INotifiable</a> *&gt; <a class="el" href="class_notification_board.html#w0">NotificationBoard::NotifiableVector</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="z24_0" doxytag="NotificationBoard::fireChangeNotification"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void NotificationBoard::fireChangeNotification           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>category</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cPolymorphic *&nbsp;</td>
          <td class="mdname" nowrap> <em>details</em> = <code>NULL</code></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Tells NotificationBoard that a change of the given category has taken place. The optional details object may carry more specific information about the change (e.g. exact location, specific attribute that changed, old value, new value, etc). <div class="fragment"><pre class="fragment">00088 {
00089     Enter_Method(<span class="stringliteral">"fireChangeNotification(%s, %s)"</span>, <a class="code" href="_notifier_consts_8cc.html#a0">notificationCategoryName</a>(category),
00090                  details?details-&gt;info().c_str() : <span class="stringliteral">"n/a"</span>);
00091 
00092     ClientMap::iterator it = <a class="code" href="class_notification_board.html#p0">clientMap</a>.find(category);
00093     <span class="keywordflow">if</span> (it==<a class="code" href="class_notification_board.html#p0">clientMap</a>.end())
00094         <span class="keywordflow">return</span>;
00095     <a class="code" href="class_notification_board.html#w0">NotifiableVector</a>&amp; clients = it-&gt;second;
00096     <span class="keywordflow">for</span> (NotifiableVector::iterator j=clients.begin(); j!=clients.end(); j++)
00097         (*j)-&gt;receiveChangeNotification(category, details);
00098 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="NotificationBoard::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void NotificationBoard::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Does nothing. <div class="fragment"><pre class="fragment">00057 {
00058     error(<span class="stringliteral">"NotificationBoard doesn't handle messages, it can be accessed via direct method calls"</span>);
00059 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="NotificationBoard::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void NotificationBoard::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize. <div class="fragment"><pre class="fragment">00052 {
00053     WATCH_MAP(clientMap);
00054 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z22_0" doxytag="NotificationBoard::subscribe"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void NotificationBoard::subscribe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_notifiable.html">INotifiable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>category</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Subscribe to changes of the given category <div class="fragment"><pre class="fragment">00063 {
00064     Enter_Method(<span class="stringliteral">"subscribe(%s)"</span>, <a class="code" href="_notifier_consts_8cc.html#a0">notificationCategoryName</a>(category));
00065 
00066     <span class="comment">// find or create entry for this category</span>
00067     <a class="code" href="class_notification_board.html#w0">NotifiableVector</a>&amp; clients = <a class="code" href="class_notification_board.html#p0">clientMap</a>[category];
00068 
00069     <span class="comment">// add client if not already there</span>
00070     <span class="keywordflow">if</span> (std::find(clients.begin(), clients.end(), client) == clients.end())
00071         clients.push_back(client);
00072 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="z22_1" doxytag="NotificationBoard::unsubscribe"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void NotificationBoard::unsubscribe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_notifiable.html">INotifiable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>category</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Unsubscribe from changes of the given category <div class="fragment"><pre class="fragment">00075 {
00076     Enter_Method(<span class="stringliteral">"unsubscribe(%s)"</span>, <a class="code" href="_notifier_consts_8cc.html#a0">notificationCategoryName</a>(category));
00077 
00078     <span class="comment">// find (or create) entry for this category</span>
00079     <a class="code" href="class_notification_board.html#w0">NotifiableVector</a>&amp; clients = <a class="code" href="class_notification_board.html#p0">clientMap</a>[category];
00080 
00081     <span class="comment">// remove client if there</span>
00082     NotifiableVector::iterator it = <a class="code" href="_r_s_v_p___t_e_2_utils_8cc.html#a2">std::find</a>(clients.begin(), clients.end(), client);
00083     <span class="keywordflow">if</span> (it!=clients.end())
00084         clients.erase(it);
00085 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Friends And Related Function Documentation</h2>
<a class="anchor" name="n0" doxytag="NotificationBoard::operator<<"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">std::ostream&amp; operator&lt;&lt;           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">std::ostream &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>os</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_notification_board.html#w0">NotifiableVector</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>v</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [friend]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00027 {
00028     os &lt;&lt; v.size() &lt;&lt; <span class="stringliteral">" client(s)"</span>;
00029     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;v.size(); i++)
00030     {
00031         os &lt;&lt; (i==0 ? <span class="stringliteral">": "</span> : <span class="stringliteral">", "</span>);
00032         <span class="keywordflow">if</span> (dynamic_cast&lt;cModule*&gt;(v[i]))
00033         {
00034             cModule *mod = dynamic_cast&lt;cModule*&gt;(v[i]);
00035             os &lt;&lt; <span class="stringliteral">"mod ("</span> &lt;&lt; mod-&gt;className() &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; mod-&gt;fullName() &lt;&lt; <span class="stringliteral">" id="</span> &lt;&lt; mod-&gt;id();
00036         }
00037         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;cPolymorphic*&gt;(v[i]))
00038         {
00039             cPolymorphic *obj = dynamic_cast&lt;cPolymorphic*&gt;(v[i]);
00040             os &lt;&lt; <span class="stringliteral">"a "</span> &lt;&lt; obj-&gt;className();
00041         }
00042         <span class="keywordflow">else</span>
00043         {
00044             os &lt;&lt; <span class="stringliteral">"a "</span> &lt;&lt; opp_typename(<span class="keyword">typeid</span>(v[i]));
00045         }
00046     }
00047     <span class="keywordflow">return</span> os;
00048 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p0" doxytag="NotificationBoard::clientMap"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_notification_board.html#w1">ClientMap</a> <a class="el" href="class_notification_board.html#p0">NotificationBoard::clientMap</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_notification_board_8h.html">NotificationBoard.h</a><li><a class="el" href="_notification_board_8cc.html">NotificationBoard.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:27 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
