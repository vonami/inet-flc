<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: OSPF::DatabaseDescriptionHandler Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="namespace_o_s_p_f.html">OSPF</a>::<a class="el" href="class_o_s_p_f_1_1_database_description_handler.html">DatabaseDescriptionHandler</a></div>
<h1>OSPF::DatabaseDescriptionHandler Class Reference</h1><code>#include &lt;DatabaseDescriptionHandler.h&gt;</code>
<p>
<p>Inheritance diagram for OSPF::DatabaseDescriptionHandler:
<p><center><img src="class_o_s_p_f_1_1_database_description_handler.png" usemap="#OSPF::DatabaseDescriptionHandler_map" border="0" alt=""></center>
<map name="OSPF::DatabaseDescriptionHandler_map">
<area href="class_o_s_p_f_1_1_i_message_handler.html" alt="OSPF::IMessageHandler" shape="rect" coords="0,0,214,24">
</map>
<a href="class_o_s_p_f_1_1_database_description_handler-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_database_description_handler.html#a0">DatabaseDescriptionHandler</a> (<a class="el" href="class_o_s_p_f_1_1_router.html">Router</a> *containingRouter)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_database_description_handler.html#a1">ProcessPacket</a> (<a class="el" href="class_o_s_p_f_packet.html">OSPFPacket</a> *packet, <a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf, <a class="el" href="class_o_s_p_f_1_1_neighbor.html">Neighbor</a> *neighbor)</td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_database_description_handler.html#d0">ProcessDDPacket</a> (<a class="el" href="class_o_s_p_f_database_description_packet.html">OSPFDatabaseDescriptionPacket</a> *ddPacket, <a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf, <a class="el" href="class_o_s_p_f_1_1_neighbor.html">Neighbor</a> *neighbor, bool inExchangeStart)</td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="OSPF::DatabaseDescriptionHandler::DatabaseDescriptionHandler"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">OSPF::DatabaseDescriptionHandler::DatabaseDescriptionHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_1_1_router.html">Router</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>containingRouter</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00007                                                                                         :
00008     <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html">OSPF::IMessageHandler</a> (containingRouter)
00009 {
00010 }

</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="d0" doxytag="OSPF::DatabaseDescriptionHandler::ProcessDDPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool OSPF::DatabaseDescriptionHandler::ProcessDDPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_database_description_packet.html">OSPFDatabaseDescriptionPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ddPacket</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>intf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_neighbor.html">Neighbor</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>neighbor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap> <em>inExchangeStart</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00162 {
00163     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"  Processing packet contents (ddOptions="</span>
00164        &lt;&lt; ((ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a12">getDdOptions</a> ().<a class="code" href="struct_o_s_p_f_d_d_options.html#o5">I_Init</a>) ? <span class="stringliteral">"I "</span> : <span class="stringliteral">"_ "</span>)
00165        &lt;&lt; ((ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a12">getDdOptions</a> ().<a class="code" href="struct_o_s_p_f_d_d_options.html#o6">M_More</a>) ? <span class="stringliteral">"M "</span> : <span class="stringliteral">"_ "</span>)
00166        &lt;&lt; ((ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a12">getDdOptions</a> ().<a class="code" href="struct_o_s_p_f_d_d_options.html#o7">MS_MasterSlave</a>) ? <span class="stringliteral">"MS"</span> : <span class="stringliteral">"__"</span>)
00167        &lt;&lt; <span class="stringliteral">"; seqNumber="</span>
00168        &lt;&lt; ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a15">getDdSequenceNumber</a> ()
00169        &lt;&lt; <span class="stringliteral">"):\n"</span>;
00170 
00171     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> headerCount = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a18">getLsaHeadersArraySize</a> ();
00172 
00173     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; headerCount; i++) {
00174         <a class="code" href="class_o_s_p_f_l_s_a_header.html">OSPFLSAHeader</a>&amp; currentHeader = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a19">getLsaHeaders</a> (i);
00175         <a class="code" href="_o_s_p_f_packet__m_8h.html#a54">LSAType</a>        lsaType       = static_cast&lt;LSAType&gt; (currentHeader.<a class="code" href="class_o_s_p_f_l_s_a_header.html#a11">getLsType</a> ());
00176 
00177         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"    "</span>;
00178         <a class="code" href="_l_s_a_8h.html#a10">PrintLSAHeader</a> (currentHeader);
00179 
00180         <span class="keywordflow">if</span> ((lsaType &lt; RouterLSAType) || (lsaType &gt; ASExternalLSAType) ||
00181             ((lsaType == ASExternalLSAType) &amp;&amp; (!intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;GetExternalRoutingCapability ())))
00182         {
00183             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">" Error!\n"</span>;
00184             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::SequenceNumberMismatch);
00185             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00186         } <span class="keywordflow">else</span> {
00187             <a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html">OSPF::LSAKeyType</a> lsaKey;
00188 
00189             lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#o0">linkStateID</a> = currentHeader.<a class="code" href="class_o_s_p_f_l_s_a_header.html#a13">getLinkStateID</a> ();
00190             lsaKey.<a class="code" href="struct_o_s_p_f_1_1_l_s_a_key_type.html#o1">advertisingRouter</a> = currentHeader.<a class="code" href="class_o_s_p_f_l_s_a_header.html#a15">getAdvertisingRouter</a> ().<a class="code" href="class_i_p_address.html#a5">getInt</a> ();
00191 
00192             <a class="code" href="class_o_s_p_f_l_s_a.html">OSPFLSA</a>* lsaInDatabase = <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;FindLSA (lsaType, lsaKey, intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a25">GetAreaID</a> ());
00193 
00194             <span class="comment">// operator&lt; and operator== on OSPFLSAHeaders determines which one is newer (less means older)</span>
00195             <span class="keywordflow">if</span> ((lsaInDatabase == NULL) || (lsaInDatabase-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> () &lt; currentHeader)) {
00196                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">" (newer)"</span>;
00197                 neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a18">AddToRequestList</a> (&amp;currentHeader);
00198             }
00199         }
00200         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00201     }
00202 
00203     <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a48">GetDatabaseExchangeRelationship</a> () == <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w29w25">OSPF::Neighbor::Master</a>) {
00204         neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a62">IncrementDDSequenceNumber</a> ();
00205         <span class="keywordflow">if</span> ((neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a61">GetDatabaseSummaryListCount</a> () == 0) &amp;&amp; !ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a12">getDdOptions</a> ().<a class="code" href="struct_o_s_p_f_d_d_options.html#o6">M_More</a>) {
00206             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::ExchangeDone);  <span class="comment">// does nothing in ExchangeStart</span>
00207         } <span class="keywordflow">else</span> {
00208             <span class="keywordflow">if</span> (!inExchangeStart) {
00209                 neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a6">SendDatabaseDescriptionPacket</a> ();
00210             }
00211         }
00212     } <span class="keywordflow">else</span> {
00213         neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a41">SetDDSequenceNumber</a> (ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a15">getDdSequenceNumber</a> ());
00214         <span class="keywordflow">if</span> (!inExchangeStart) {
00215             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a6">SendDatabaseDescriptionPacket</a> ();
00216         }
00217         <span class="keywordflow">if</span> (!ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a12">getDdOptions</a> ().<a class="code" href="struct_o_s_p_f_d_d_options.html#o6">M_More</a> &amp;&amp;
00218             (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a61">GetDatabaseSummaryListCount</a> () == 0))
00219         {
00220             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::ExchangeDone);  <span class="comment">// does nothing in ExchangeStart</span>
00221         }
00222     }
00223     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00224 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="OSPF::DatabaseDescriptionHandler::ProcessPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void OSPF::DatabaseDescriptionHandler::ProcessPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_packet.html">OSPFPacket</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>intf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_neighbor.html">Neighbor</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>neighbor</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00013 {
00014     <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetMessageHandler ()-&gt;PrintEvent (<span class="stringliteral">"Database Description packet received"</span>, intf, neighbor);
00015 
00016     <a class="code" href="class_o_s_p_f_database_description_packet.html">OSPFDatabaseDescriptionPacket</a>* ddPacket = check_and_cast&lt;OSPFDatabaseDescriptionPacket*&gt; (packet);
00017 
00018     <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28">OSPF::Neighbor::NeighborStateType</a> neighborState = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a5">GetState</a> ();
00019 
00020     <span class="keywordflow">if</span> ((ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a7">getInterfaceMTU</a> () &lt;= intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a23">GetMTU</a> ()) &amp;&amp;
00021         (neighborState &gt; <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w18">OSPF::Neighbor::AttemptState</a>))
00022     {
00023         <span class="keywordflow">switch</span> (neighborState) {
00024             <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w20">OSPF::Neighbor::TwoWayState</a>:
00025                 <span class="keywordflow">break</span>;
00026             <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w19">OSPF::Neighbor::InitState</a>:
00027                 neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::TwoWayReceived);
00028                 <span class="keywordflow">break</span>;
00029             <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w21">OSPF::Neighbor::ExchangeStartState</a>:
00030                 {
00031                     <a class="code" href="struct_o_s_p_f_d_d_options.html">OSPFDDOptions</a>&amp; ddOptions = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a12">getDdOptions</a> ();
00032 
00033                     <span class="keywordflow">if</span> (ddOptions.<a class="code" href="struct_o_s_p_f_d_d_options.html#o5">I_Init</a> &amp;&amp; ddOptions.<a class="code" href="struct_o_s_p_f_d_d_options.html#o6">M_More</a> &amp;&amp; ddOptions.<a class="code" href="struct_o_s_p_f_d_d_options.html#o7">MS_MasterSlave</a> &amp;&amp;
00034                         (ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a18">getLsaHeadersArraySize</a> () == 0))
00035                     {
00036                         <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a30">GetNeighborID</a> () &gt; <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetRouterID ()) {
00037                             <a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html">OSPF::Neighbor::DDPacketID</a> packetID;
00038                             packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o0">ddOptions</a>      = ddOptions;
00039                             packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o1">options</a>        = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a9">getOptions</a> ();
00040                             packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o2">sequenceNumber</a> = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a15">getDdSequenceNumber</a> ();
00041 
00042                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a43">SetOptions</a> (packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o1">options</a>);
00043                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a47">SetDatabaseExchangeRelationship</a> (OSPF::Neighbor::Slave);
00044                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a41">SetDDSequenceNumber</a> (packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o2">sequenceNumber</a>);
00045                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a45">SetLastReceivedDDPacket</a> (packetID);
00046 
00047                             <span class="keywordflow">if</span> (!ProcessDDPacket (ddPacket, intf, neighbor, <span class="keyword">true</span>)) {
00048                                 <span class="keywordflow">break</span>;
00049                             }
00050 
00051                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::NegotiationDone);
00052                             <span class="keywordflow">if</span> (!neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a63">IsLinkStateRequestListEmpty</a> () &amp;&amp;
00053                                 !neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a57">IsRequestRetransmissionTimerActive</a> ())
00054                             {
00055                                 neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a9">SendLinkStateRequestPacket</a> ();
00056                                 neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a23">ClearRequestRetransmissionTimer</a> ();
00057                                 neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a22">StartRequestRetransmissionTimer</a> ();
00058                             }
00059                         } <span class="keywordflow">else</span> {
00060                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a6">SendDatabaseDescriptionPacket</a> (<span class="keyword">true</span>);
00061                         }
00062                     }
00063                     <span class="keywordflow">if</span> (!ddOptions.<a class="code" href="struct_o_s_p_f_d_d_options.html#o5">I_Init</a> &amp;&amp; !ddOptions.<a class="code" href="struct_o_s_p_f_d_d_options.html#o7">MS_MasterSlave</a> &amp;&amp;
00064                         (ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a15">getDdSequenceNumber</a> () == neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a42">GetDDSequenceNumber</a> ()) &amp;&amp;
00065                         (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a30">GetNeighborID</a> () &lt; <a class="code" href="class_o_s_p_f_1_1_i_message_handler.html#p0">router</a>-&gt;GetRouterID ()))
00066                     {
00067                         <a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html">OSPF::Neighbor::DDPacketID</a> packetID;
00068                         packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o0">ddOptions</a>      = ddOptions;
00069                         packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o1">options</a>        = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a9">getOptions</a> ();
00070                         packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o2">sequenceNumber</a> = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a15">getDdSequenceNumber</a> ();
00071 
00072                         neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a43">SetOptions</a> (packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o1">options</a>);
00073                         neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a47">SetDatabaseExchangeRelationship</a> (OSPF::Neighbor::Master);
00074                         neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a45">SetLastReceivedDDPacket</a> (packetID);
00075 
00076                         <span class="keywordflow">if</span> (!ProcessDDPacket (ddPacket, intf, neighbor, <span class="keyword">true</span>)) {
00077                             <span class="keywordflow">break</span>;
00078                         }
00079 
00080                         neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::NegotiationDone);
00081                         <span class="keywordflow">if</span> (!neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a63">IsLinkStateRequestListEmpty</a> () &amp;&amp;
00082                             !neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a57">IsRequestRetransmissionTimerActive</a> ())
00083                         {
00084                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a9">SendLinkStateRequestPacket</a> ();
00085                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a23">ClearRequestRetransmissionTimer</a> ();
00086                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a22">StartRequestRetransmissionTimer</a> ();
00087                         }
00088                     }
00089                 }
00090                 <span class="keywordflow">break</span>;
00091             <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w22">OSPF::Neighbor::ExchangeState</a>:
00092                 {
00093                     <a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html">OSPF::Neighbor::DDPacketID</a> packetID;
00094                     packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o0">ddOptions</a>      = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a12">getDdOptions</a> ();
00095                     packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o1">options</a>        = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a9">getOptions</a> ();
00096                     packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o2">sequenceNumber</a> = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a15">getDdSequenceNumber</a> ();
00097 
00098                     <span class="keywordflow">if</span> (packetID != neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a46">GetLastReceivedDDPacket</a> ()) {
00099                         <span class="keywordflow">if</span> ((packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o0">ddOptions</a>.<a class="code" href="struct_o_s_p_f_d_d_options.html#o7">MS_MasterSlave</a> &amp;&amp;
00100                              (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a48">GetDatabaseExchangeRelationship</a> () != <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w29w26">OSPF::Neighbor::Slave</a>)) ||
00101                             (!packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o0">ddOptions</a>.<a class="code" href="struct_o_s_p_f_d_d_options.html#o7">MS_MasterSlave</a> &amp;&amp;
00102                              (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a48">GetDatabaseExchangeRelationship</a> () != <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w29w25">OSPF::Neighbor::Master</a>)) ||
00103                             packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o0">ddOptions</a>.<a class="code" href="struct_o_s_p_f_d_d_options.html#o5">I_Init</a> ||
00104                             (packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o1">options</a> != neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a46">GetLastReceivedDDPacket</a> ().options))
00105                         {
00106                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::SequenceNumberMismatch);
00107                         } <span class="keywordflow">else</span> {
00108                             <span class="keywordflow">if</span> (((neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a48">GetDatabaseExchangeRelationship</a> () == <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w29w25">OSPF::Neighbor::Master</a>) &amp;&amp;
00109                                  (packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o2">sequenceNumber</a> == neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a42">GetDDSequenceNumber</a> ())) ||
00110                                 ((neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a48">GetDatabaseExchangeRelationship</a> () == <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w29w26">OSPF::Neighbor::Slave</a>) &amp;&amp;
00111                                  (packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o2">sequenceNumber</a> == (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a42">GetDDSequenceNumber</a> () + 1))))
00112                             {
00113                                 neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a45">SetLastReceivedDDPacket</a> (packetID);
00114                                 <span class="keywordflow">if</span> (!ProcessDDPacket (ddPacket, intf, neighbor, <span class="keyword">false</span>)) {
00115                                     <span class="keywordflow">break</span>;
00116                                 }
00117                                 <span class="keywordflow">if</span> (!neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a63">IsLinkStateRequestListEmpty</a> () &amp;&amp;
00118                                     !neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a57">IsRequestRetransmissionTimerActive</a> ())
00119                                 {
00120                                     neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a9">SendLinkStateRequestPacket</a> ();
00121                                     neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a23">ClearRequestRetransmissionTimer</a> ();
00122                                     neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a22">StartRequestRetransmissionTimer</a> ();
00123                                 }
00124                             } <span class="keywordflow">else</span> {
00125                                 neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::SequenceNumberMismatch);
00126                             }
00127                         }
00128                     } <span class="keywordflow">else</span> {
00129                         <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a48">GetDatabaseExchangeRelationship</a> () == <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w29w26">OSPF::Neighbor::Slave</a>) {
00130                             neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a7">RetransmitDatabaseDescriptionPacket</a> ();
00131                         }
00132                     }
00133                 }
00134                 <span class="keywordflow">break</span>;
00135             <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w23">OSPF::Neighbor::LoadingState</a>:
00136             <span class="keywordflow">case</span> <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w24">OSPF::Neighbor::FullState</a>:
00137                 {
00138                     <a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html">OSPF::Neighbor::DDPacketID</a> packetID;
00139                     packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o0">ddOptions</a>      = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a12">getDdOptions</a> ();
00140                     packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o1">options</a>        = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a9">getOptions</a> ();
00141                     packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o2">sequenceNumber</a> = ddPacket-&gt;<a class="code" href="class_o_s_p_f_database_description_packet.html#a15">getDdSequenceNumber</a> ();
00142 
00143                     <span class="keywordflow">if</span> ((packetID != neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a46">GetLastReceivedDDPacket</a> ()) ||
00144                         (packetID.<a class="code" href="struct_o_s_p_f_1_1_neighbor_1_1_d_d_packet_i_d.html#o0">ddOptions</a>.<a class="code" href="struct_o_s_p_f_d_d_options.html#o5">I_Init</a>))
00145                     {
00146                         neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::SequenceNumberMismatch);
00147                     } <span class="keywordflow">else</span> {
00148                         <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a48">GetDatabaseExchangeRelationship</a> () == <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w29w26">OSPF::Neighbor::Slave</a>) {
00149                             <span class="keywordflow">if</span> (!neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a7">RetransmitDatabaseDescriptionPacket</a> ()) {
00150                                 neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a2">ProcessEvent</a> (OSPF::Neighbor::SequenceNumberMismatch);
00151                             }
00152                         }
00153                     }
00154                 }
00155                 <span class="keywordflow">break</span>;
00156             <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;
00157         }
00158     }
00159 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_database_description_handler_8h.html">DatabaseDescriptionHandler.h</a><li><a class="el" href="_database_description_handler_8cc.html">DatabaseDescriptionHandler.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:32 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
