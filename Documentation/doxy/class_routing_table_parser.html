<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: RoutingTableParser Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>RoutingTableParser Class Reference</h1><code>#include &lt;RoutingTableParser.h&gt;</code>
<p>
<a href="class_routing_table_parser-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Parses a routing table file into a routing table. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#a0">RoutingTableParser</a> (<a class="el" href="class_interface_table.html">InterfaceTable</a> *<a class="el" href="class_routing_table_parser.html#r0">ift</a>, <a class="el" href="class_routing_table.html">RoutingTable</a> *<a class="el" href="class_routing_table_parser.html#r1">rt</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#a1">readRoutingTableFromFile</a> (const char *filename)</td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#d0">createFilteredFile</a> (char *file, int &amp;charpointer, const char *endtoken)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#d1">parseInterfaces</a> (char *ifconfigFile)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#d2">parseRouting</a> (char *routeFile)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#d3">parseEntry</a> (char *ifconfigFile, const char *tokenStr, int &amp;charpointer, char *destStr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#d4">parseMulticastGroups</a> (char *groupStr, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *)</td></tr>

<tr><td colspan="2"><br><h2>Static Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#h0">streq</a> (const char *str1, const char *str2)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#h1">skipBlanks</a> (char *str, int &amp;charptr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#h2">strcpyword</a> (char *dest, const char *src)</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#r0">ift</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_routing_table.html">RoutingTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_routing_table_parser.html#r1">rt</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="RoutingTableParser::RoutingTableParser"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">RoutingTableParser::RoutingTableParser           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ift</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_routing_table.html">RoutingTable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>rt</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Constructor <div class="fragment"><pre class="fragment">00046 {
00047     <a class="code" href="class_routing_table_parser.html#r0">ift</a> = i;
00048     <a class="code" href="class_routing_table_parser.html#r1">rt</a> = r;
00049 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="d0" doxytag="RoutingTableParser::createFilteredFile"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char * RoutingTableParser::createFilteredFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>charpointer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>endtoken</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00140 {
00141     <span class="keywordtype">int</span> i = 0;
00142     <span class="keywordtype">char</span> *filterFile = <span class="keyword">new</span> <span class="keywordtype">char</span>[<a class="code" href="_routing_table_parser_8cc.html#a0">MAX_FILESIZE</a>];
00143     filterFile[0] = <span class="charliteral">'\0'</span>;
00144 
00145     <span class="keywordflow">while</span>(<span class="keyword">true</span>) {
00146         <span class="comment">// skip blank lines and comments</span>
00147         <span class="keywordflow">while</span> ( !isalnum(file[charpointer]) &amp;&amp; !isspace(file[charpointer]) ) {
00148             <span class="keywordflow">while</span> (file[charpointer++] != <span class="charliteral">'\n'</span>) ;
00149         }
00150 
00151         <span class="comment">// check for endtoken:</span>
00152         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(file + charpointer, endtoken)) {
00153             filterFile[i] = <span class="charliteral">'\0'</span>;
00154             <span class="keywordflow">break</span>;
00155         }
00156 
00157         <span class="comment">// copy whole line to filterFile</span>
00158         <span class="keywordflow">while</span> ((filterFile[i++] = file[charpointer++]) != <span class="charliteral">'\n'</span>) ;
00159     }
00160 
00161     <span class="keywordflow">return</span> filterFile;
00162 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d3" doxytag="RoutingTableParser::parseEntry"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char * RoutingTableParser::parseEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>ifconfigFile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>tokenStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>charpointer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>destStr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00270 {
00271     <span class="keywordtype">int</span> temp = 0;
00272 
00273     charpointer += strlen(tokenStr);
00274     <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(ifconfigFile, charpointer);
00275     temp = <a class="code" href="class_routing_table_parser.html#h2">strcpyword</a>(destStr, ifconfigFile + charpointer);
00276     charpointer += temp;
00277 
00278     <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(ifconfigFile, charpointer);
00279 
00280     <span class="keywordflow">return</span> destStr;
00281 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d1" doxytag="RoutingTableParser::parseInterfaces"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RoutingTableParser::parseInterfaces           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ifconfigFile</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00166 {
00167     <span class="keywordtype">char</span> buf[<a class="code" href="_routing_table_parser_8cc.html#a1">MAX_ENTRY_STRING_SIZE</a>];
00168     <span class="keywordtype">int</span> charpointer = 0;
00169     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie;
00170 
00171     <span class="comment">// parsing of entries in interface definition</span>
00172     <span class="keywordflow">while</span>(ifconfigFile[charpointer] != <span class="charliteral">'\0'</span>)
00173     {
00174         <span class="comment">// name entry</span>
00175         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"name:"</span>)) {
00176             <span class="comment">// find existing interface with this name</span>
00177             <span class="keywordtype">char</span> *name = <a class="code" href="class_routing_table_parser.html#d3">parseEntry</a>(ifconfigFile, <span class="stringliteral">"name:"</span>, charpointer,buf);
00178             ie = <a class="code" href="class_routing_table_parser.html#r0">ift</a>-&gt;<a class="code" href="class_interface_table.html#a9">interfaceByName</a>(name);
00179             <span class="keywordflow">if</span> (!ie)
00180                 opp_error("Error in routing file: interface name `%s' not registered by any L2 module", name);
00181             continue;
00182         }
00183 
00184         <span class="comment">// encap entry</span>
00185         if (streq(ifconfigFile + charpointer, "encap:")) {
00186             <span class="comment">// ignore encap</span>
00187             <a class="code" href="class_routing_table_parser.html#d3">parseEntry</a>(ifconfigFile, <span class="stringliteral">"encap:"</span>, charpointer, buf);
00188             <span class="keywordflow">continue</span>;
00189         }
00190 
00191         <span class="comment">// HWaddr entry</span>
00192         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"HWaddr:"</span>)) {
00193             <span class="comment">// ignore hwAddr</span>
00194             <a class="code" href="class_routing_table_parser.html#d3">parseEntry</a>(ifconfigFile, <span class="stringliteral">"HWaddr:"</span>, charpointer, buf);
00195             <span class="keywordflow">continue</span>;
00196         }
00197 
00198         <span class="comment">// inet_addr entry</span>
00199         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"inet_addr:"</span>)) {
00200             ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a8">setInetAddress</a>(<a class="code" href="class_i_p_address.html">IPAddress</a>(<a class="code" href="class_routing_table_parser.html#d3">parseEntry</a>(ifconfigFile, <span class="stringliteral">"inet_addr:"</span>, charpointer,buf)));
00201             <span class="keywordflow">continue</span>;
00202         }
00203 
00204         <span class="comment">// Broadcast address entry</span>
00205         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"Bcast:"</span>)) {
00206             <span class="comment">// ignore Bcast</span>
00207             <a class="code" href="class_routing_table_parser.html#d3">parseEntry</a>(ifconfigFile, <span class="stringliteral">"Bcast:"</span>, charpointer, buf);
00208             <span class="keywordflow">continue</span>;
00209         }
00210 
00211         <span class="comment">// Mask entry</span>
00212         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"Mask:"</span>)) {
00213             ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a9">setNetmask</a>(<a class="code" href="class_i_p_address.html">IPAddress</a>(<a class="code" href="class_routing_table_parser.html#d3">parseEntry</a>(ifconfigFile, <span class="stringliteral">"Mask:"</span>, charpointer,buf)));
00214             <span class="keywordflow">continue</span>;
00215         }
00216 
00217         <span class="comment">// Multicast groups entry</span>
00218         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"Groups:"</span>)) {
00219             <span class="keywordtype">char</span> *grStr = <a class="code" href="class_routing_table_parser.html#d3">parseEntry</a>(ifconfigFile, <span class="stringliteral">"Groups:"</span>, charpointer, buf);
00220             <a class="code" href="class_routing_table_parser.html#d4">parseMulticastGroups</a>(grStr, ie);
00221             <span class="keywordflow">continue</span>;
00222         }
00223 
00224         <span class="comment">// MTU entry</span>
00225         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"MTU:"</span>)) {
00226             ie-&gt;<a class="code" href="class_interface_entry.html#a24">setMtu</a>(atoi(<a class="code" href="class_routing_table_parser.html#d3">parseEntry</a>(ifconfigFile, <span class="stringliteral">"MTU:"</span>, charpointer,buf)));
00227             <span class="keywordflow">continue</span>;
00228         }
00229 
00230         <span class="comment">// Metric entry</span>
00231         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"Metric:"</span>)) {
00232             ie-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a10">setMetric</a>(atoi(<a class="code" href="class_routing_table_parser.html#d3">parseEntry</a>(ifconfigFile, <span class="stringliteral">"Metric:"</span>, charpointer,buf)));
00233             <span class="keywordflow">continue</span>;
00234         }
00235 
00236         <span class="comment">// BROADCAST Flag</span>
00237         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"BROADCAST"</span>)) {
00238             ie-&gt;<a class="code" href="class_interface_entry.html#a26">setBroadcast</a>(<span class="keyword">true</span>);
00239             charpointer += strlen(<span class="stringliteral">"BROADCAST"</span>);
00240             <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(ifconfigFile, charpointer);
00241             <span class="keywordflow">continue</span>;
00242         }
00243 
00244         <span class="comment">// MULTICAST Flag</span>
00245         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"MULTICAST"</span>)) {
00246             ie-&gt;<a class="code" href="class_interface_entry.html#a27">setMulticast</a>(<span class="keyword">true</span>);
00247             charpointer += strlen(<span class="stringliteral">"MULTICAST"</span>);
00248             <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(ifconfigFile, charpointer);
00249             <span class="keywordflow">continue</span>;
00250         }
00251 
00252         <span class="comment">// POINTTOPOINT Flag</span>
00253         <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(ifconfigFile + charpointer, <span class="stringliteral">"POINTTOPOINT"</span>)) {
00254             ie-&gt;<a class="code" href="class_interface_entry.html#a28">setPointToPoint</a>(<span class="keyword">true</span>);
00255             charpointer += strlen(<span class="stringliteral">"POINTTOPOINT"</span>);
00256             <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(ifconfigFile, charpointer);
00257             <span class="keywordflow">continue</span>;
00258         }
00259 
00260         <span class="comment">// no entry discovered: move charpointer on</span>
00261         charpointer++;
00262     }
00263 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d4" doxytag="RoutingTableParser::parseMulticastGroups"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RoutingTableParser::parseMulticastGroups           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>groupStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00286 {
00287     <a class="code" href="class_i_pv4_interface_data.html#w0">IPv4InterfaceData::IPAddressVector</a> mcg = itf-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a7">multicastGroups</a>();
00288 
00289     <span class="comment">// add "224.0.0.1" automatically</span>
00290     mcg.push_back(IPAddress::ALL_HOSTS_MCAST);
00291 
00292     <span class="comment">// add 224.0.0.2" only if Router (IP forwarding enabled)</span>
00293     <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#r1">rt</a>-&gt;<a class="code" href="class_routing_table.html#a3">ipForward</a>())
00294         mcg.push_back(IPAddress::ALL_ROUTERS_MCAST);
00295 
00296     <span class="comment">// Parse string (IP addresses separated by colons)</span>
00297     cStringTokenizer tokenizer(groupStr,<span class="stringliteral">":"</span>);
00298     <span class="keyword">const</span> <span class="keywordtype">char</span> *token;
00299     <span class="keywordflow">while</span> ((token = tokenizer.nextToken())!=NULL)
00300         mcg.push_back(<a class="code" href="class_i_p_address.html">IPAddress</a>(token));
00301 
00302     itf-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a11">setMulticastGroups</a>(mcg);
00303 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d2" doxytag="RoutingTableParser::parseRouting"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RoutingTableParser::parseRouting           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>routeFile</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00306 {
00307     <span class="keywordtype">char</span> *str = <span class="keyword">new</span> <span class="keywordtype">char</span>[<a class="code" href="_routing_table_parser_8cc.html#a1">MAX_ENTRY_STRING_SIZE</a>];
00308 
00309     <span class="keywordtype">int</span> pos = strlen(ROUTE_START_TOKEN);
00310     <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(routeFile, pos);
00311     <span class="keywordflow">while</span> (routeFile[pos] != <span class="charliteral">'\0'</span>)
00312     {
00313         <span class="comment">// 1st entry: Host</span>
00314         pos += <a class="code" href="class_routing_table_parser.html#h2">strcpyword</a>(str, routeFile + pos);
00315         <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(routeFile, pos);
00316         <a class="code" href="class_routing_entry.html">RoutingEntry</a> *e = <span class="keyword">new</span> <a class="code" href="class_routing_entry.html">RoutingEntry</a>();
00317         <span class="keywordflow">if</span> (strcmp(str, <span class="stringliteral">"default:"</span>))
00318         {
00319             <span class="comment">// if entry is not the default entry</span>
00320             <span class="keywordflow">if</span> (!IPAddress::isWellFormed(str))
00321                 opp_error(<span class="stringliteral">"Syntax error in routing file: `%s' on 1st column should be `default:' or a valid IP address"</span>, str);
00322             e-&gt;<a class="code" href="class_routing_entry.html#o0">host</a> = <a class="code" href="class_i_p_address.html">IPAddress</a>(str);
00323         }
00324 
00325         <span class="comment">// 2nd entry: Gateway</span>
00326         pos += <a class="code" href="class_routing_table_parser.html#h2">strcpyword</a>(str, routeFile + pos);
00327         <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(routeFile, pos);
00328         <span class="keywordflow">if</span> (!strcmp(str, <span class="stringliteral">"*"</span>) || !strcmp(str, <span class="stringliteral">"0.0.0.0"</span>))
00329         {
00330             e-&gt;<a class="code" href="class_routing_entry.html#o2">gateway</a> = <a class="code" href="class_i_p_address.html#z27_0">IPAddress::UNSPECIFIED_ADDRESS</a>;
00331         }
00332         <span class="keywordflow">else</span>
00333         {
00334             <span class="keywordflow">if</span> (!IPAddress::isWellFormed(str))
00335                 opp_error(<span class="stringliteral">"Syntax error in routing file: `%s' on 2nd column should be `*' or a valid IP address"</span>, str);
00336             e-&gt;<a class="code" href="class_routing_entry.html#o2">gateway</a> = <a class="code" href="class_i_p_address.html">IPAddress</a>(str);
00337         }
00338 
00339         <span class="comment">// 3rd entry: Netmask</span>
00340         pos += <a class="code" href="class_routing_table_parser.html#h2">strcpyword</a>(str, routeFile + pos);
00341         <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(routeFile, pos);
00342         <span class="keywordflow">if</span> (!IPAddress::isWellFormed(str))
00343             opp_error(<span class="stringliteral">"Syntax error in routing file: `%s' on 3rd column should be a valid IP address"</span>, str);
00344         e-&gt;<a class="code" href="class_routing_entry.html#o1">netmask</a> = <a class="code" href="class_i_p_address.html">IPAddress</a>(str);
00345 
00346         <span class="comment">// 4th entry: flags</span>
00347         pos += <a class="code" href="class_routing_table_parser.html#h2">strcpyword</a>(str, routeFile + pos);
00348         <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(routeFile, pos);
00349         <span class="comment">// parse flag-String to set flags</span>
00350         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; str[i]; i++)
00351         {
00352             <span class="keywordflow">if</span> (str[i] == <span class="charliteral">'H'</span>) {
00353                 e-&gt;<a class="code" href="class_routing_entry.html#o5">type</a> = <a class="code" href="class_routing_entry.html#w8w0">RoutingEntry::DIRECT</a>;
00354             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (str[i] == <span class="charliteral">'G'</span>) {
00355                 e-&gt;<a class="code" href="class_routing_entry.html#o5">type</a> = <a class="code" href="class_routing_entry.html#w8w1">RoutingEntry::REMOTE</a>;
00356             } <span class="keywordflow">else</span> {
00357                 opp_error(<span class="stringliteral">"Syntax error in routing file: 4th column should be `G' or `H' not `%s'"</span>, str);
00358             }
00359         }
00360 
00361         <span class="comment">// 5th entry: metric</span>
00362         pos += <a class="code" href="class_routing_table_parser.html#h2">strcpyword</a>(str, routeFile + pos);
00363         <a class="code" href="class_routing_table_parser.html#h1">skipBlanks</a>(routeFile, pos);
00364         <span class="keywordtype">int</span> metric = atoi(str);
00365         <span class="keywordflow">if</span> (metric==0 &amp;&amp; str[0]!=<span class="charliteral">'0'</span>)
00366             opp_error("Syntax error in routing file: 5th column should be numeric not `%s'", str);
00367         e-&gt;metric = metric;
00368 
00369         <span class="comment">// 6th entry: interfaceName</span>
00370         e-&gt;interfaceName.reserve(MAX_ENTRY_STRING_SIZE);
00371         pos += strcpyword(e-&gt;interfaceName.buffer(), routeFile + pos);
00372         skipBlanks(routeFile, pos);
00373         e-&gt;interfacePtr = ift-&gt;interfaceByName(e-&gt;interfaceName.c_str());
00374         if (e-&gt;interfacePtr==NULL)
00375             opp_error("Syntax error in routing file: 6th column should be an existing "
00376                       "interface name not `%s'", e-&gt;interfaceName.c_str());
00377 
00378         <span class="comment">// add entry</span>
00379         rt-&gt;addRoutingEntry(e);
00380     }
00381 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="RoutingTableParser::readRoutingTableFromFile"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int RoutingTableParser::readRoutingTableFromFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>filename</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read Routing Table file; return 0 on success, -1 on error <div class="fragment"><pre class="fragment">00074 {
00075     FILE *fp;
00076     <span class="keywordtype">int</span> charpointer;
00077     <span class="keywordtype">char</span> *file = <span class="keyword">new</span> <span class="keywordtype">char</span>[<a class="code" href="_routing_table_parser_8cc.html#a0">MAX_FILESIZE</a>];
00078     <span class="keywordtype">char</span> *ifconfigFile = NULL;
00079     <span class="keywordtype">char</span> *routeFile = NULL;
00080 
00081     fp = fopen(filename, <span class="stringliteral">"r"</span>);
00082     <span class="keywordflow">if</span> (fp == NULL)
00083         opp_error("Error opening routing table file `%s'", filename);
00084 
00085     <span class="comment">// read the whole into the file[] char-array</span>
00086     for (charpointer = 0;
00087          (file[charpointer] = getc(fp)) != EOF;
00088          charpointer++) ;
00089 
00090     charpointer++;
00091     for (; charpointer &lt; MAX_FILESIZE; charpointer++)
00092         file[charpointer] = '\0';
00093     <span class="comment">//    file[++charpointer] = '\0';</span>
00094 
00095     fclose(fp);
00096 
00097 
00098     <span class="comment">// copy file into specialized, filtered char arrays</span>
00099     for (charpointer = 0;
00100          (charpointer &lt; MAX_FILESIZE) &amp;&amp; (file[charpointer] != EOF);
00101          charpointer++) {
00102         <span class="comment">// check for tokens at beginning of file or line</span>
00103         <span class="keywordflow">if</span> (charpointer == 0 || file[charpointer - 1] == <span class="charliteral">'\n'</span>) {
00104             <span class="comment">// copy into ifconfig filtered chararray</span>
00105             <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(file + charpointer, IFCONFIG_START_TOKEN)) {
00106                 ifconfigFile = <a class="code" href="class_routing_table_parser.html#d0">createFilteredFile</a>(file,
00107                                                   charpointer,
00108                                                   IFCONFIG_END_TOKEN);
00109                 <span class="comment">//PRINTF("Filtered File 1 created:\n%s\n", ifconfigFile);</span>
00110             }
00111 
00112             <span class="comment">// copy into route filtered chararray</span>
00113             <span class="keywordflow">if</span> (<a class="code" href="class_routing_table_parser.html#h0">streq</a>(file + charpointer, ROUTE_START_TOKEN)) {
00114                 routeFile = <a class="code" href="class_routing_table_parser.html#d0">createFilteredFile</a>(file,
00115                                                charpointer,
00116                                                ROUTE_END_TOKEN);
00117                 <span class="comment">//PRINTF("Filtered File 2 created:\n%s\n", routeFile);</span>
00118             }
00119         }
00120     }
00121 
00122     <span class="keyword">delete</span> file;
00123 
00124     <span class="comment">// parse filtered files</span>
00125     <span class="keywordflow">if</span> (ifconfigFile)
00126         parseInterfaces(ifconfigFile);
00127     if (routeFile)
00128         parseRouting(routeFile);
00129 
00130     delete ifconfigFile;
00131     delete routeFile;
00132 
00133     return 0;
00134 
00135 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="h1" doxytag="RoutingTableParser::skipBlanks"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void RoutingTableParser::skipBlanks           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>charptr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00068 {
00069     <span class="keywordflow">for</span>(;isspace(str[charptr]); charptr++) ;
00070 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="h2" doxytag="RoutingTableParser::strcpyword"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int RoutingTableParser::strcpyword           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00059 {
00060     <span class="keywordtype">int</span> i;
00061     <span class="keywordflow">for</span>(i = 0; !isspace(dest[i] = src[i]); i++) ;
00062     dest[i] = <span class="charliteral">'\0'</span>;
00063     <span class="keywordflow">return</span> i;
00064 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="h0" doxytag="RoutingTableParser::streq"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int RoutingTableParser::streq           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>str1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>str2</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00053 {
00054     <span class="keywordflow">return</span> (strncmp(str1, str2, strlen(str2)) == 0);
00055 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="r0" doxytag="RoutingTableParser::ift"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a>* <a class="el" href="class_routing_table_parser.html#r0">RoutingTableParser::ift</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r1" doxytag="RoutingTableParser::rt"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_routing_table.html">RoutingTable</a>* <a class="el" href="class_routing_table_parser.html#r1">RoutingTableParser::rt</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_routing_table_parser_8h.html">RoutingTableParser.h</a><li><a class="el" href="_routing_table_parser_8cc.html">RoutingTableParser.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:28 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
