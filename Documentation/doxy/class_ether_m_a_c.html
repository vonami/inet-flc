<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: EtherMAC Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>EtherMAC Class Reference</h1><code>#include &lt;EtherMAC.h&gt;</code>
<p>
<p>Inheritance diagram for EtherMAC:
<p><center><img src="class_ether_m_a_c.png" usemap="#EtherMAC_map" border="0" alt=""></center>
<map name="EtherMAC_map">
<area href="class_ether_m_a_c_base.html" alt="EtherMACBase" shape="rect" coords="0,0,99,24">
</map>
<a href="class_ether_m_a_c-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Ethernet MAC module. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#a0">EtherMAC</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#a1">~EtherMAC</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#b0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#b1">initializeTxrate</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#b2">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#b3">finish</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d0">processFrameFromUpperLayer</a> (<a class="el" href="class_ether_frame.html">EtherFrame</a> *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d1">processMsgFromNetwork</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d2">handleEndIFGPeriod</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d3">handleEndTxPeriod</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d4">handleEndRxPeriod</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d5">handleEndBackoffPeriod</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d6">handleEndJammingPeriod</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d7">startAutoconfig</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d8">handleAutoconfigMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d9">printState</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d10">scheduleEndRxPeriod</a> (cMessage *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d11">sendJamSignal</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d12">handleRetransmission</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#d13">startFrameTransmission</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r0">autoconfigInProgress</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r1">lowestTxrateSuggested</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r2">duplexVetoed</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r3">backoffs</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r4">numConcurrentTransmissions</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_ether_frame.html">EtherFrame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r5">frameBeingReceived</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r6">endRxMsg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r7">endBackoffMsg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r8">endJammingMsg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r9">totalCollisionTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r10">totalSuccessfulRxTxTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r11">channelBusySince</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r12">numCollisions</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r13">numBackoffs</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r14">numCollisionsVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cOutVector&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_m_a_c.html#r15">numBackoffsVector</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="EtherMAC::EtherMAC"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">EtherMAC::EtherMAC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00043 {
00044     <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a> = NULL;
00045     <a class="code" href="class_ether_m_a_c.html#r8">endJammingMsg</a> = <a class="code" href="class_ether_m_a_c.html#r6">endRxMsg</a> = <a class="code" href="class_ether_m_a_c.html#r7">endBackoffMsg</a> = NULL;
00046 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="EtherMAC::~EtherMAC"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">EtherMAC::~<a class="el" href="class_ether_m_a_c.html">EtherMAC</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00049 {
00050     <span class="keyword">delete</span> <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a>;
00051     cancelAndDelete(endRxMsg);
00052     cancelAndDelete(endBackoffMsg);
00053     cancelAndDelete(endJammingMsg);
00054 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b3" doxytag="EtherMAC::finish"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::finish           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_ether_m_a_c_base.html#b11">EtherMACBase</a>.<div class="fragment"><pre class="fragment">00631 {
00632     <a class="code" href="class_ether_m_a_c_base.html#b11">EtherMACBase::finish</a>();
00633 
00634     <span class="keywordflow">if</span> (!disabled &amp;&amp; par(<span class="stringliteral">"writeScalars"</span>).boolValue())
00635     {
00636         <span class="keywordtype">double</span> t = simTime();
00637         simtime_t totalChannelIdleTime = t - <a class="code" href="class_ether_m_a_c.html#r10">totalSuccessfulRxTxTime</a> - <a class="code" href="class_ether_m_a_c.html#r9">totalCollisionTime</a>;
00638         recordScalar(<span class="stringliteral">"rx channel idle (%)"</span>, 100*totalChannelIdleTime/t);
00639         recordScalar(<span class="stringliteral">"rx channel utilization (%)"</span>, 100*totalSuccessfulRxTxTime/t);
00640         recordScalar(<span class="stringliteral">"rx channel collision (%)"</span>, 100*totalCollisionTime);
00641         recordScalar(<span class="stringliteral">"collisions"</span>,     numCollisions);
00642         recordScalar(<span class="stringliteral">"backoffs"</span>,       numBackoffs);
00643     }
00644 }</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d8" doxytag="EtherMAC::handleAutoconfigMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::handleAutoconfigMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00140 {
00141     <span class="keywordflow">if</span> (!msg-&gt;isSelfMessage())
00142     {
00143         <span class="keywordflow">if</span> (msg-&gt;arrivalGate() == gate(<span class="stringliteral">"upperLayerIn"</span>))
00144         {
00145             <span class="comment">// from upper layer</span>
00146             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Received frame from upper layer during autoconfig period: "</span> &lt;&lt; msg &lt;&lt; endl;
00147             <a class="code" href="class_ether_m_a_c.html#d0">processFrameFromUpperLayer</a>(check_and_cast&lt;EtherFrame *&gt;(msg));
00148         }
00149         <span class="keywordflow">else</span>
00150         {
00151             <span class="comment">// from network: must be autoconfig message</span>
00152             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Message from network during autoconfig period: "</span> &lt;&lt; msg &lt;&lt; endl;
00153             <a class="code" href="class_ether_autoconfig.html">EtherAutoconfig</a> *autoconf = check_and_cast&lt;EtherAutoconfig *&gt;(msg);
00154             <span class="keywordtype">double</span> acTxrate = autoconf-&gt;<a class="code" href="class_ether_autoconfig.html#a7">getTxrate</a>();
00155 
00156             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Autoconfig message: "</span>;
00157             <span class="keywordflow">if</span> (acTxrate&gt;0)
00158                 EV &lt;&lt; acTxrate/1000000 &lt;&lt; "Mb ";
00159             if (autoconf-&gt;getHalfDuplex())
00160                 EV &lt;&lt; "non-duplex";
00161             EV &lt;&lt; "\n";
00162 
00163             if (acTxrate&gt;0 &amp;&amp; (acTxrate&lt;lowestTxrateSuggested || lowestTxrateSuggested==0))
00164                 lowestTxrateSuggested = acTxrate;
00165             if (!duplexVetoed &amp;&amp; autoconf-&gt;getHalfDuplex())
00166                 duplexVetoed = true;
00167             delete msg;
00168         }
00169     }
00170     else
00171     {
00172         <span class="comment">// self-message signals end of autoconfig period</span>
00173         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Self-message during autoconfig period: "</span> &lt;&lt; msg &lt;&lt; endl;
00174 
00175         <span class="keyword">delete</span> msg;
00176         <a class="code" href="class_ether_m_a_c.html#r0">autoconfigInProgress</a> = <span class="keyword">false</span>;
00177 
00178         <span class="keywordtype">double</span> initialTxrate = par(<span class="stringliteral">"txrate"</span>);
00179         <span class="keywordtype">bool</span> duplexEnabled = par(<span class="stringliteral">"duplexEnabled"</span>);
00180 
00181         <a class="code" href="class_ether_m_a_c_base.html#p8">txrate</a> = (initialTxrate==0 &amp;&amp; <a class="code" href="class_ether_m_a_c.html#r1">lowestTxrateSuggested</a>==0) ? 100000000 <span class="comment">/* 100 Mb */</span>:
00182                  (initialTxrate==0) ? <a class="code" href="class_ether_m_a_c.html#r1">lowestTxrateSuggested</a> :
00183                  (<a class="code" href="class_ether_m_a_c.html#r1">lowestTxrateSuggested</a>==0) ? initialTxrate :
00184                  (<a class="code" href="class_ether_m_a_c.html#r1">lowestTxrateSuggested</a>&lt;initialTxrate) ? <a class="code" href="class_ether_m_a_c.html#r1">lowestTxrateSuggested</a> : initialTxrate;
00185         <a class="code" href="class_ether_m_a_c_base.html#p5">duplexMode</a> = (duplexEnabled &amp;&amp; !<a class="code" href="class_ether_m_a_c.html#r2">duplexVetoed</a>);
00186         <a class="code" href="class_ether_m_a_c_base.html#b9">calculateParameters</a>();
00187 
00188         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Parameters after autoconfig: txrate="</span> &lt;&lt; <a class="code" href="class_ether_m_a_c_base.html#p8">txrate</a>/1000000 &lt;&lt; <span class="stringliteral">"Mb, "</span> &lt;&lt; (<a class="code" href="class_ether_m_a_c_base.html#p5">duplexMode</a> ? <span class="stringliteral">"duplex"</span> : <span class="stringliteral">"half-duplex"</span>) &lt;&lt; endl;
00189 
00190         <span class="keywordflow">if</span> (ev.isGUI())
00191         {
00192             <span class="keywordtype">char</span> modestr[64];
00193             sprintf(modestr, <span class="stringliteral">"%dMb\n%s"</span>, <span class="keywordtype">int</span>(txrate/1000000), (duplexMode ? <span class="stringliteral">"full duplex"</span> : <span class="stringliteral">"half duplex"</span>));
00194             displayString().setTagArg(<span class="stringliteral">"t"</span>,0,modestr);
00195             <span class="comment">//displayString().setTagArg("t",1,"r");</span>
00196             sprintf(modestr, <span class="stringliteral">"%s: %dMb %s"</span>, fullName(), <span class="keywordtype">int</span>(txrate/1000000), (duplexMode ? <span class="stringliteral">"duplex"</span> : <span class="stringliteral">"half duplex"</span>));
00197             parentModule()-&gt;bubble(modestr);
00198         }
00199 
00200         <span class="keywordflow">if</span> (!<a class="code" href="class_ether_m_a_c_base.html#p17">txQueue</a>.empty())
00201         {
00202             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Autoconfig period over, starting to send frames\n"</span>;
00203             <a class="code" href="class_ether_m_a_c_base.html#b19">scheduleEndIFGPeriod</a>();
00204         }
00205     }
00206 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d5" doxytag="EtherMAC::handleEndBackoffPeriod"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::handleEndBackoffPeriod           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00538 {
00539     <span class="keywordflow">if</span> (transmitState != BACKOFF_STATE)
00540         error("At end of BACKOFF not in BACKOFF_STATE!");
00541     if (txQueue.empty())
00542         error("At end of BACKOFF and buffer empty!");
00543 
00544     if (receiveState==RX_IDLE_STATE)
00545     {
00546         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Backoff period ended, wait IFG\n"</span>;
00547         <a class="code" href="class_ether_m_a_c_base.html#b19">scheduleEndIFGPeriod</a>();
00548     }
00549     <span class="keywordflow">else</span>
00550     {
00551         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Backoff period ended but channel not free, idling\n"</span>;
00552         <a class="code" href="class_ether_m_a_c_base.html#p14">transmitState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a7">TX_IDLE_STATE</a>;
00553     }
00554 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d2" doxytag="EtherMAC::handleEndIFGPeriod"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::handleEndIFGPeriod           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_ether_m_a_c_base.html#b16">EtherMACBase</a>.<div class="fragment"><pre class="fragment">00401 {
00402     <a class="code" href="class_ether_m_a_c_base.html#b16">EtherMACBase::handleEndIFGPeriod</a>();
00403 
00404     <span class="comment">// End of IFG period, okay to transmit, if Rx idle OR duplexMode</span>
00405     cMessage *frame = (cMessage *)<a class="code" href="class_ether_m_a_c_base.html#p17">txQueue</a>.tail();
00406 
00407     <span class="comment">// Perform carrier extension if in Gigabit Ethernet</span>
00408     <span class="keywordflow">if</span> (carrierExtension &amp;&amp; frame-&gt;byteLength() &lt; <a class="code" href="_ethernet_8h.html#a5">GIGABIT_MIN_FRAME_WITH_EXT</a>)
00409     {
00410         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Performing carrier extension of small frame\n"</span>;
00411         frame-&gt;setByteLength(GIGABIT_MIN_FRAME_WITH_EXT);
00412     }
00413 
00414     <span class="comment">// send frame to network</span>
00415     <a class="code" href="class_ether_m_a_c.html#d13">startFrameTransmission</a>();
00416 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d6" doxytag="EtherMAC::handleEndJammingPeriod"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::handleEndJammingPeriod           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00557 {
00558     <span class="keywordflow">if</span> (transmitState != JAMMING_STATE)
00559         error("At end of JAMMING not in JAMMING_STATE!");
00560     EV &lt;&lt; "Jamming finished, executing backoff\n";
00561     handleRetransmission();
00562 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d4" doxytag="EtherMAC::handleEndRxPeriod"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::handleEndRxPeriod           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00512 {
00513     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Frame reception complete\n"</span>;
00514     simtime_t dt = simTime()-<a class="code" href="class_ether_m_a_c.html#r11">channelBusySince</a>;
00515     <span class="keywordflow">if</span> (receiveState==RECEIVING_STATE) <span class="comment">// i.e. not RX_COLLISION_STATE</span>
00516     {
00517         <a class="code" href="class_ether_frame.html">EtherFrame</a> *frame = <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a>;
00518         <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a> = NULL;
00519         <a class="code" href="class_ether_m_a_c_base.html#b25">frameReceptionComplete</a>(frame);
00520         <a class="code" href="class_ether_m_a_c.html#r10">totalSuccessfulRxTxTime</a> += dt;
00521     }
00522     <span class="keywordflow">else</span>
00523     {
00524         <a class="code" href="class_ether_m_a_c.html#r9">totalCollisionTime</a> += dt;
00525     }
00526 
00527     <a class="code" href="class_ether_m_a_c_base.html#p15">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a13">RX_IDLE_STATE</a>;
00528     <a class="code" href="class_ether_m_a_c.html#r4">numConcurrentTransmissions</a> = 0;
00529 
00530     <span class="keywordflow">if</span> (transmitState==TX_IDLE_STATE &amp;&amp; !<a class="code" href="class_ether_m_a_c_base.html#p17">txQueue</a>.empty())
00531     {
00532         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Receiver now idle, can transmit frames in output buffer after IFG period\n"</span>;
00533         <a class="code" href="class_ether_m_a_c_base.html#b19">scheduleEndIFGPeriod</a>();
00534     }
00535 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d3" doxytag="EtherMAC::handleEndTxPeriod"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::handleEndTxPeriod           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_ether_m_a_c_base.html#b17">EtherMACBase</a>.<div class="fragment"><pre class="fragment">00472 {
00473     <a class="code" href="class_ether_m_a_c_base.html#b17">EtherMACBase::handleEndTxPeriod</a>();
00474 
00475     <span class="comment">// only count transmissions in totalSuccessfulRxTxTime if channel is half-duplex</span>
00476     <span class="keywordflow">if</span> (!duplexMode)
00477     {
00478         simtime_t dt = simTime()-<a class="code" href="class_ether_m_a_c.html#r11">channelBusySince</a>;
00479         <a class="code" href="class_ether_m_a_c.html#r10">totalSuccessfulRxTxTime</a> += dt;
00480     }
00481 
00482     <a class="code" href="class_ether_m_a_c.html#r3">backoffs</a> = 0;
00483 
00484     <span class="comment">// check for and obey received PAUSE frames after each transmission</span>
00485     <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c_base.html#b22">checkAndScheduleEndPausePeriod</a>())
00486         return;
00487 
00488     <span class="comment">// Gigabit Ethernet: now decide if we transmit next frame right away (burst) or wait IFG</span>
00489     <span class="comment">// FIXME! this is not entirely correct, there must be IFG between burst frames too</span>
00490     <span class="keywordtype">bool</span> burstFrame=false;
00491     if (frameBursting &amp;&amp; !txQueue.empty())
00492     {
00493         <span class="comment">// check if max bytes for burst not exceeded</span>
00494         <span class="keywordflow">if</span> (bytesSentInBurst&lt;GIGABIT_MAX_BURST_BYTES)
00495         {
00496              burstFrame=<span class="keyword">true</span>;
00497              <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Transmitting next frame in current burst\n"</span>;
00498         }
00499         <span class="keywordflow">else</span>
00500         {
00501              <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Next frame does not fit in current burst\n"</span>;
00502         }
00503     }
00504 
00505     <span class="keywordflow">if</span> (burstFrame)
00506         startFrameTransmission();
00507     else
00508         beginSendFrames();
00509 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="EtherMAC::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00209 {
00210     <span class="keywordflow">if</span> (disabled)
00211     {
00212         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"MAC is disabled -- dropping message "</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">"\n"</span>;
00213         <span class="keyword">delete</span> msg;
00214         <span class="keywordflow">return</span>;
00215     }
00216     <span class="keywordflow">if</span> (autoconfigInProgress)
00217     {
00218         <a class="code" href="class_ether_m_a_c.html#d8">handleAutoconfigMessage</a>(msg);
00219         <span class="keywordflow">return</span>;
00220     }
00221 
00222     <a class="code" href="class_ether_m_a_c.html#d9">printState</a>();
00223     <span class="comment">// some consistency check</span>
00224     <span class="keywordflow">if</span> (!duplexMode &amp;&amp; transmitState==TRANSMITTING_STATE &amp;&amp; receiveState!=RX_IDLE_STATE)
00225         error("Inconsistent state -- transmitting and receiving at the same time");
00226 
00227     if (!msg-&gt;isSelfMessage())
00228     {
00229         <span class="comment">// either frame from upper layer, or frame/jam signal from the network</span>
00230         <span class="keywordflow">if</span> (msg-&gt;arrivalGate() == gate(<span class="stringliteral">"upperLayerIn"</span>))
00231             <a class="code" href="class_ether_m_a_c.html#d0">processFrameFromUpperLayer</a>(check_and_cast&lt;EtherFrame *&gt;(msg));
00232         <span class="keywordflow">else</span>
00233             <a class="code" href="class_ether_m_a_c.html#d1">processMsgFromNetwork</a>(msg);
00234     }
00235     <span class="keywordflow">else</span>
00236     {
00237         <span class="comment">// Process different self-messages (timer signals)</span>
00238         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Self-message "</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">" received\n"</span>;
00239         <span class="keywordflow">switch</span> (msg-&gt;kind())
00240         {
00241             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a0">ENDIFG</a>:
00242                 <a class="code" href="class_ether_m_a_c.html#d2">handleEndIFGPeriod</a>();
00243                 <span class="keywordflow">break</span>;
00244 
00245             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a3">ENDTRANSMISSION</a>:
00246                 <a class="code" href="class_ether_m_a_c.html#d3">handleEndTxPeriod</a>();
00247                 <span class="keywordflow">break</span>;
00248 
00249             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a1">ENDRECEPTION</a>:
00250                 <a class="code" href="class_ether_m_a_c.html#d4">handleEndRxPeriod</a>();
00251                 <span class="keywordflow">break</span>;
00252 
00253             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a2">ENDBACKOFF</a>:
00254                 <a class="code" href="class_ether_m_a_c.html#d5">handleEndBackoffPeriod</a>();
00255                 <span class="keywordflow">break</span>;
00256 
00257             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a4">ENDJAMMING</a>:
00258                 <a class="code" href="class_ether_m_a_c.html#d6">handleEndJammingPeriod</a>();
00259                 <span class="keywordflow">break</span>;
00260 
00261             <span class="keywordflow">case</span> <a class="code" href="_ether_m_a_c_base_8h.html#a5">ENDPAUSE</a>:
00262                 <a class="code" href="class_ether_m_a_c_base.html#b18">handleEndPausePeriod</a>();
00263                 <span class="keywordflow">break</span>;
00264 
00265             <span class="keywordflow">default</span>:
00266                 error(<span class="stringliteral">"self-message with unexpected message kind %d"</span>, msg-&gt;kind());
00267         }
00268     }
00269     <a class="code" href="class_ether_m_a_c.html#d9">printState</a>();
00270 
00271     <span class="keywordflow">if</span> (ev.isGUI())
00272         <a class="code" href="class_ether_m_a_c_base.html#b28">updateDisplayString</a>();
00273 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d12" doxytag="EtherMAC::handleRetransmission"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::handleRetransmission           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00582 {
00583     <span class="keywordflow">if</span> (++backoffs &gt; MAX_ATTEMPTS)
00584     {
00585         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Number of retransmit attempts of frame exceeds maximum, cancelling transmission of frame\n"</span>;
00586         <span class="keyword">delete</span> <a class="code" href="class_ether_m_a_c_base.html#p17">txQueue</a>.pop();
00587 
00588         <a class="code" href="class_ether_m_a_c_base.html#p14">transmitState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a7">TX_IDLE_STATE</a>;
00589         <a class="code" href="class_ether_m_a_c.html#r3">backoffs</a> = 0;
00590         <span class="comment">// no beginSendFrames(), because end of jam signal sending will trigger it automatically</span>
00591         <span class="keywordflow">return</span>;
00592     }
00593 
00594     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Executing backoff procedure\n"</span>;
00595     <span class="keywordtype">int</span> backoffrange = (<a class="code" href="class_ether_m_a_c.html#r3">backoffs</a>&gt;=<a class="code" href="_ethernet_8h.html#a14">BACKOFF_RANGE_LIMIT</a>) ? 1024 : (1 &lt;&lt; <a class="code" href="class_ether_m_a_c.html#r3">backoffs</a>);
00596     <span class="keywordtype">int</span> slotNumber = intuniform(0,backoffrange-1);
00597     simtime_t backofftime = slotNumber*<a class="code" href="class_ether_m_a_c_base.html#p10">slotTime</a>;
00598 
00599     scheduleAt(simTime()+backofftime, endBackoffMsg);
00600     <a class="code" href="class_ether_m_a_c_base.html#p14">transmitState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a11">BACKOFF_STATE</a>;
00601 
00602     <a class="code" href="class_ether_m_a_c.html#r13">numBackoffs</a>++;
00603     <a class="code" href="class_ether_m_a_c.html#r15">numBackoffsVector</a>.record(numBackoffs);
00604 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="EtherMAC::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_ether_m_a_c_base.html#b0">EtherMACBase</a>.<div class="fragment"><pre class="fragment">00057 {
00058     <a class="code" href="class_ether_m_a_c_base.html#b0">EtherMACBase::initialize</a>();
00059 
00060     <a class="code" href="class_ether_m_a_c.html#r6">endRxMsg</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">"EndReception"</span>, ENDRECEPTION);
00061     <a class="code" href="class_ether_m_a_c.html#r7">endBackoffMsg</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">"EndBackoff"</span>, ENDBACKOFF);
00062     <a class="code" href="class_ether_m_a_c.html#r8">endJammingMsg</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">"EndJamming"</span>, ENDJAMMING);
00063 
00064     <span class="comment">// check: datarate is forbidden with EtherMAC -- module's txrate must be used</span>
00065     cGate *g = gate(<span class="stringliteral">"physOut"</span>);
00066     <span class="keywordflow">while</span> (g)
00067     {
00068         cSimpleChannel *chan = dynamic_cast&lt;cSimpleChannel*&gt;(g-&gt;channel());
00069         <span class="keywordflow">if</span> (chan &amp;&amp; chan-&gt;datarate()&gt;0)
00070             error(<span class="stringliteral">"connection on gate %s has data rate set: using data rate with EtherMAC "</span>
00071                   <span class="stringliteral">"is forbidden, module's txrate parameter must be used instead"</span>,
00072                   g-&gt;fullPath().c_str());
00073         g = g-&gt;toGate();
00074     }
00075 
00076     <span class="comment">// launch autoconfig process</span>
00077     <span class="keywordtype">bool</span> performAutoconfig = <span class="keyword">true</span>;
00078     <span class="keywordflow">if</span> (!disabled &amp;&amp; connected &amp;&amp; performAutoconfig)
00079     {
00080         <a class="code" href="class_ether_m_a_c.html#d7">startAutoconfig</a>();
00081     }
00082     <span class="keywordflow">else</span>
00083     {
00084         <a class="code" href="class_ether_m_a_c.html#r0">autoconfigInProgress</a> = <span class="keyword">false</span>;
00085         <a class="code" href="class_ether_m_a_c_base.html#p5">duplexMode</a> = par(<span class="stringliteral">"duplexEnabled"</span>);
00086         <a class="code" href="class_ether_m_a_c_base.html#b9">calculateParameters</a>();
00087     }
00088     WATCH(autoconfigInProgress);
00089 
00090     <span class="comment">// initialize state info</span>
00091     <a class="code" href="class_ether_m_a_c.html#r3">backoffs</a> = 0;
00092     <a class="code" href="class_ether_m_a_c.html#r4">numConcurrentTransmissions</a> = 0;
00093 
00094     WATCH(backoffs);
00095     WATCH(numConcurrentTransmissions);
00096 
00097     <span class="comment">// initialize statistics</span>
00098     <a class="code" href="class_ether_m_a_c.html#r9">totalCollisionTime</a> = 0.0;
00099     <a class="code" href="class_ether_m_a_c.html#r10">totalSuccessfulRxTxTime</a> = 0.0;
00100     <a class="code" href="class_ether_m_a_c.html#r12">numCollisions</a> = <a class="code" href="class_ether_m_a_c.html#r13">numBackoffs</a> = 0;
00101 
00102     WATCH(numCollisions);
00103     WATCH(numBackoffs);
00104 
00105     <a class="code" href="class_ether_m_a_c.html#r14">numCollisionsVector</a>.setName(<span class="stringliteral">"collisions"</span>);
00106     <a class="code" href="class_ether_m_a_c.html#r15">numBackoffsVector</a>.setName(<span class="stringliteral">"backoffs"</span>);
00107 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="EtherMAC::initializeTxrate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::initializeTxrate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Implements <a class="el" href="class_ether_m_a_c_base.html#b1">EtherMACBase</a>.<div class="fragment"><pre class="fragment">00110 {
00111     <a class="code" href="class_ether_m_a_c_base.html#p8">txrate</a> = par(<span class="stringliteral">"txrate"</span>);
00112 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d9" doxytag="EtherMAC::printState"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::printState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00607 {
00608 <span class="preprocessor">#define CASE(x) case x: EV &lt;&lt; #x; break</span>
00609 <span class="preprocessor"></span>    <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"transmitState: "</span>;
00610     <span class="keywordflow">switch</span> (transmitState) {
00611         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TX_IDLE_STATE);
00612         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(WAIT_IFG_STATE);
00613         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(TRANSMITTING_STATE);
00614         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(JAMMING_STATE);
00615         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(BACKOFF_STATE);
00616         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(PAUSE_STATE);
00617     }
00618     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">",  receiveState: "</span>;
00619     <span class="keywordflow">switch</span> (receiveState) {
00620         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(RX_IDLE_STATE);
00621         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(RECEIVING_STATE);
00622         <a class="code" href="_ether_m_a_c_8cc.html#a0">CASE</a>(RX_COLLISION_STATE);
00623     }
00624     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">",  backoffs: "</span> &lt;&lt; <a class="code" href="class_ether_m_a_c.html#r3">backoffs</a>;
00625     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">",  numConcurrentTransmissions: "</span> &lt;&lt; <a class="code" href="class_ether_m_a_c.html#r4">numConcurrentTransmissions</a>;
00626     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">",  queueLength: "</span> &lt;&lt; <a class="code" href="class_ether_m_a_c_base.html#p17">txQueue</a>.length() &lt;&lt; endl;
00627 <span class="preprocessor">#undef CASE</span>
00628 <span class="preprocessor"></span>}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d0" doxytag="EtherMAC::processFrameFromUpperLayer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::processFrameFromUpperLayer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_ether_frame.html">EtherFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_ether_m_a_c_base.html#b12">EtherMACBase</a>.<div class="fragment"><pre class="fragment">00277 {
00278     <a class="code" href="class_ether_m_a_c_base.html#b12">EtherMACBase::processFrameFromUpperLayer</a>(frame);
00279 
00280     <span class="keywordflow">if</span> (!autoconfigInProgress &amp;&amp; (duplexMode || receiveState==RX_IDLE_STATE) &amp;&amp; transmitState==TX_IDLE_STATE)
00281     {
00282         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"No incoming carrier signals detected, frame clear to send, wait IFG first\n"</span>;
00283         <a class="code" href="class_ether_m_a_c_base.html#b19">scheduleEndIFGPeriod</a>();
00284     }
00285 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d1" doxytag="EtherMAC::processMsgFromNetwork"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::processMsgFromNetwork           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Reimplemented from <a class="el" href="class_ether_m_a_c_base.html#b13">EtherMACBase</a>.<div class="fragment"><pre class="fragment">00289 {
00290     <a class="code" href="class_ether_m_a_c_base.html#b13">EtherMACBase::processMsgFromNetwork</a>(msg);
00291 
00292     simtime_t endRxTime = simTime() + msg-&gt;length()*<a class="code" href="class_ether_m_a_c_base.html#p9">bitTime</a>;
00293 
00294     <span class="keywordflow">if</span> (!duplexMode &amp;&amp; transmitState==TRANSMITTING_STATE)
00295     {
00296         <span class="comment">// since we're halfduplex, receiveState must be RX_IDLE_STATE (asserted at top of handleMessage)</span>
00297         <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_ether_frame__m_8h.html#a1">JAM_SIGNAL</a>)
00298             error(<span class="stringliteral">"Stray jam signal arrived while transmitting (usual cause is cable length exceeding allowed maximum)"</span>);
00299 
00300         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Transmission interrupted by incoming frame, handling collision\n"</span>;
00301         cancelEvent(endTxMsg);
00302 
00303         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Transmitting jam signal\n"</span>;
00304         <a class="code" href="class_ether_m_a_c.html#d11">sendJamSignal</a>(); <span class="comment">// backoff will be executed when jamming finished</span>
00305 
00306         <span class="comment">// set receive state and schedule end of reception</span>
00307         <a class="code" href="class_ether_m_a_c_base.html#p15">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a15">RX_COLLISION_STATE</a>;
00308         <a class="code" href="class_ether_m_a_c.html#r4">numConcurrentTransmissions</a>++;
00309         simtime_t endJamTime = simTime()+<a class="code" href="class_ether_m_a_c_base.html#p12">jamDuration</a>;
00310         scheduleAt(endRxTime&lt;endJamTime ? endJamTime : endRxTime, endRxMsg);
00311         <span class="keyword">delete</span> msg;
00312 
00313         <a class="code" href="class_ether_m_a_c.html#r12">numCollisions</a>++;
00314         <a class="code" href="class_ether_m_a_c.html#r14">numCollisionsVector</a>.record(numCollisions);
00315     }
00316     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (receiveState==RX_IDLE_STATE)
00317     {
00318         <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_ether_frame__m_8h.html#a1">JAM_SIGNAL</a>)
00319             error(<span class="stringliteral">"Stray jam signal arrived (usual cause is cable length exceeding allowed maximum)"</span>);
00320 
00321         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Start reception of frame\n"</span>;
00322         <a class="code" href="class_ether_m_a_c.html#r4">numConcurrentTransmissions</a>++;
00323         <span class="keywordflow">if</span> (frameBeingReceived)
00324             error("frameBeingReceived!=0 in RX_IDLE_STATE");
00325         frameBeingReceived = (<a class="code" href="class_ether_frame.html">EtherFrame</a> *)msg;
00326         scheduleEndRxPeriod(msg);
00327         channelBusySince = simTime();
00328     }
00329     else if (receiveState==RECEIVING_STATE &amp;&amp; msg-&gt;kind()!=JAM_SIGNAL &amp;&amp; endRxMsg-&gt;arrivalTime()-simTime()&lt;bitTime)
00330     {
00331         <span class="comment">// With the above condition we filter out "false" collisions that may occur with</span>
00332         <span class="comment">// back-to-back frames. That is: when "beginning of frame" message (this one) occurs</span>
00333         <span class="comment">// BEFORE "end of previous frame" event (endRxMsg) -- same simulation time,</span>
00334         <span class="comment">// only wrong order.</span>
00335 
00336         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Back-to-back frames: completing reception of current frame, starting reception of next one\n"</span>;
00337 
00338         <span class="comment">// complete reception of previous frame</span>
00339         cancelEvent(endRxMsg);
00340         <a class="code" href="class_ether_frame.html">EtherFrame</a> *frame = <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a>;
00341         <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a> = NULL;
00342         <a class="code" href="class_ether_m_a_c_base.html#b25">frameReceptionComplete</a>(frame);
00343 
00344         <span class="comment">// start receiving next frame</span>
00345         <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a> = (<a class="code" href="class_ether_frame.html">EtherFrame</a> *)msg;
00346         <a class="code" href="class_ether_m_a_c.html#d10">scheduleEndRxPeriod</a>(msg);
00347     }
00348     <span class="keywordflow">else</span> <span class="comment">// (receiveState==RECEIVING_STATE || receiveState==RX_COLLISION_STATE)</span>
00349     {
00350         <span class="comment">// handle overlapping receptions</span>
00351         <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_ether_frame__m_8h.html#a1">JAM_SIGNAL</a>)
00352         {
00353             <span class="keywordflow">if</span> (numConcurrentTransmissions&lt;=0)
00354                 error("numConcurrentTransmissions=%d on jam arrival (stray jam?)",numConcurrentTransmissions);
00355 
00356             numConcurrentTransmissions--;
00357             EV &lt;&lt; "Jam signal received, this marks end of one transmission\n";
00358 
00359             <span class="comment">// by the time jamming ends, all transmissions will have been aborted</span>
00360             if (numConcurrentTransmissions==0)
00361             {
00362                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Last jam signal received, collision will ends when jam ends\n"</span>;
00363                 cancelEvent(endRxMsg);
00364                 scheduleAt(endRxTime, endRxMsg);
00365             }
00366         }
00367         <span class="keywordflow">else</span> <span class="comment">// ETH_FRAME or ETH_PAUSE</span>
00368         {
00369             <a class="code" href="class_ether_m_a_c.html#r4">numConcurrentTransmissions</a>++;
00370             <span class="keywordflow">if</span> (<a class="code" href="class_ether_m_a_c.html#r6">endRxMsg</a>-&gt;arrivalTime() &lt; endRxTime)
00371             {
00372                 <span class="comment">// otherwise just wait until the end of the longest transmission</span>
00373                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Overlapping receptions -- setting collision state and extending collision period\n"</span>;
00374                 cancelEvent(endRxMsg);
00375                 scheduleAt(endRxTime, endRxMsg);
00376             }
00377             <span class="keywordflow">else</span>
00378             {
00379                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Overlapping receptions -- setting collision state\n"</span>;
00380             }
00381         }
00382 
00383         <span class="comment">// delete collided frames: arrived frame as well as the one we're currently receiving</span>
00384         <span class="keyword">delete</span> msg;
00385         <span class="keywordflow">if</span> (receiveState==RECEIVING_STATE)
00386         {
00387             <span class="keyword">delete</span> <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a>;
00388             <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a> = NULL;
00389 
00390             <a class="code" href="class_ether_m_a_c.html#r12">numCollisions</a>++;
00391             <a class="code" href="class_ether_m_a_c.html#r14">numCollisionsVector</a>.record(numCollisions);
00392         }
00393 
00394         <span class="comment">// go to collision state</span>
00395         <a class="code" href="class_ether_m_a_c_base.html#p15">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a15">RX_COLLISION_STATE</a>;
00396     }
00397 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d10" doxytag="EtherMAC::scheduleEndRxPeriod"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::scheduleEndRxPeriod           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00576 {
00577     scheduleAt(simTime()+frame-&gt;length()*<a class="code" href="class_ether_m_a_c_base.html#p9">bitTime</a>, <a class="code" href="class_ether_m_a_c.html#r6">endRxMsg</a>);
00578     <a class="code" href="class_ether_m_a_c_base.html#p15">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a14">RECEIVING_STATE</a>;
00579 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d11" doxytag="EtherMAC::sendJamSignal"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::sendJamSignal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00565 {
00566     cMessage *jam = <span class="keyword">new</span> cMessage(<span class="stringliteral">"JAM_SIGNAL"</span>, JAM_SIGNAL);
00567     jam-&gt;setByteLength(JAM_SIGNAL_BYTES);
00568     <span class="keywordflow">if</span> (ev.isGUI())  <a class="code" href="class_ether_m_a_c_base.html#b29">updateConnectionColor</a>(JAMMING_STATE);
00569     send(jam, <span class="stringliteral">"physOut"</span>);
00570 
00571     scheduleAt(simTime()+jamDuration, endJammingMsg);
00572     <a class="code" href="class_ether_m_a_c_base.html#p14">transmitState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a10">JAMMING_STATE</a>;
00573 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d7" doxytag="EtherMAC::startAutoconfig"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::startAutoconfig           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00115 {
00116     <a class="code" href="class_ether_m_a_c.html#r0">autoconfigInProgress</a> = <span class="keyword">true</span>;
00117     <a class="code" href="class_ether_m_a_c.html#r1">lowestTxrateSuggested</a> = 0;  <span class="comment">// none suggested</span>
00118     <a class="code" href="class_ether_m_a_c.html#r2">duplexVetoed</a> = <span class="keyword">false</span>;
00119 
00120     <span class="keywordtype">double</span> initialTxrate = par(<span class="stringliteral">"txrate"</span>);
00121     <span class="keywordtype">bool</span> duplexEnabled = par(<span class="stringliteral">"duplexEnabled"</span>);
00122     <a class="code" href="class_ether_m_a_c_base.html#p8">txrate</a> = 0;
00123     <a class="code" href="class_ether_m_a_c_base.html#p5">duplexMode</a> = duplexEnabled;
00124     <span class="keywordflow">if</span> (!duplexEnabled || initialTxrate&gt;0)
00125     {
00126         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Autoconfig: advertising our settings: "</span> &lt;&lt; initialTxrate/1000000 &lt;&lt; <span class="stringliteral">"Mb, "</span>
00127            &lt;&lt; (<a class="code" href="class_ether_m_a_c_base.html#p5">duplexMode</a> ? <span class="stringliteral">"duplex"</span> : <span class="stringliteral">"half-duplex"</span>) &lt;&lt; endl;
00128 
00129         <a class="code" href="class_ether_autoconfig.html">EtherAutoconfig</a> *autoconf = <span class="keyword">new</span> <a class="code" href="class_ether_autoconfig.html">EtherAutoconfig</a>(<span class="stringliteral">"autoconf"</span>);
00130         <span class="keywordflow">if</span> (!duplexEnabled)
00131             autoconf-&gt;setHalfDuplex(true);
00132         if (initialTxrate&gt;0)
00133             autoconf-&gt;setTxrate(initialTxrate);
00134         send(autoconf, "physOut");
00135     }
00136     scheduleAt(simTime()+AUTOCONFIG_PERIOD, new cMessage("EndAutoconfig",ENDAUTOCONFIG));
00137 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d13" doxytag="EtherMAC::startFrameTransmission"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherMAC::startFrameTransmission           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00419 {
00420     cMessage *origFrame = (cMessage *)<a class="code" href="class_ether_m_a_c_base.html#p17">txQueue</a>.tail();
00421     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Transmitting a copy of frame "</span> &lt;&lt; origFrame &lt;&lt; endl;
00422     cMessage *frame = (cMessage *) origFrame-&gt;dup();
00423 
00424     <span class="comment">// add preamble and SFD (Starting Frame Delimiter), then send out</span>
00425     frame-&gt;addByteLength(PREAMBLE_BYTES+SFD_BYTES);
00426     <span class="keywordflow">if</span> (ev.isGUI())  <a class="code" href="class_ether_m_a_c_base.html#b29">updateConnectionColor</a>(TRANSMITTING_STATE);
00427     send(frame, <span class="stringliteral">"physOut"</span>);
00428 
00429     <span class="comment">// update burst variables</span>
00430     <span class="keywordflow">if</span> (frameBursting)
00431     {
00432         <a class="code" href="class_ether_m_a_c_base.html#p26">bytesSentInBurst</a> = frame-&gt;byteLength();
00433         <a class="code" href="class_ether_m_a_c_base.html#p25">framesSentInBurst</a>++;
00434     }
00435 
00436     <span class="comment">// check for collisions (there might be an ongoing reception which we don't know about, see below)</span>
00437     <span class="keywordflow">if</span> (!duplexMode &amp;&amp; receiveState!=RX_IDLE_STATE)
00438     {
00439         <span class="comment">// During the IFG period the hardware cannot listen to the channel,</span>
00440         <span class="comment">// so it might happen that receptions have begun during the IFG,</span>
00441         <span class="comment">// and even collisions might be in progress.</span>
00442         <span class="comment">//</span>
00443         <span class="comment">// But we don't know of any ongoing transmission so we blindly</span>
00444         <span class="comment">// start transmitting, immediately collide and send a jam signal.</span>
00445         <span class="comment">//</span>
00446         <a class="code" href="class_ether_m_a_c.html#d11">sendJamSignal</a>();
00447         <span class="comment">// numConcurrentTransmissions stays the same: +1 transmission, -1 jam</span>
00448 
00449         <span class="keywordflow">if</span> (receiveState==RECEIVING_STATE)
00450         {
00451             <span class="keyword">delete</span> <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a>;
00452             <a class="code" href="class_ether_m_a_c.html#r5">frameBeingReceived</a> = NULL;
00453 
00454             <a class="code" href="class_ether_m_a_c.html#r12">numCollisions</a>++;
00455             <a class="code" href="class_ether_m_a_c.html#r14">numCollisionsVector</a>.record(numCollisions);
00456         }
00457         <span class="comment">// go to collision state</span>
00458         <a class="code" href="class_ether_m_a_c_base.html#p15">receiveState</a> = <a class="code" href="_ether_m_a_c_base_8h.html#a15">RX_COLLISION_STATE</a>;
00459     }
00460     <span class="keywordflow">else</span>
00461     {
00462         <span class="comment">// no collision</span>
00463         <a class="code" href="class_ether_m_a_c_base.html#b20">scheduleEndTxPeriod</a>(frame);
00464 
00465         <span class="comment">// only count transmissions in totalSuccessfulRxTxTime if channel is half-duplex</span>
00466         <span class="keywordflow">if</span> (!duplexMode)
00467             channelBusySince = simTime();
00468     }
00469 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="r0" doxytag="EtherMAC::autoconfigInProgress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool <a class="el" href="class_ether_m_a_c.html#r0">EtherMAC::autoconfigInProgress</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r3" doxytag="EtherMAC::backoffs"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_ether_m_a_c.html#r3">EtherMAC::backoffs</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r11" doxytag="EtherMAC::channelBusySince"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_ether_m_a_c.html#r11">EtherMAC::channelBusySince</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r2" doxytag="EtherMAC::duplexVetoed"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool <a class="el" href="class_ether_m_a_c.html#r2">EtherMAC::duplexVetoed</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r7" doxytag="EtherMAC::endBackoffMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage * <a class="el" href="class_ether_m_a_c.html#r7">EtherMAC::endBackoffMsg</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r8" doxytag="EtherMAC::endJammingMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage * <a class="el" href="class_ether_m_a_c.html#r8">EtherMAC::endJammingMsg</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r6" doxytag="EtherMAC::endRxMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage* <a class="el" href="class_ether_m_a_c.html#r6">EtherMAC::endRxMsg</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r5" doxytag="EtherMAC::frameBeingReceived"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_ether_frame.html">EtherFrame</a>* <a class="el" href="class_ether_m_a_c.html#r5">EtherMAC::frameBeingReceived</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r1" doxytag="EtherMAC::lowestTxrateSuggested"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_ether_m_a_c.html#r1">EtherMAC::lowestTxrateSuggested</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r13" doxytag="EtherMAC::numBackoffs"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">unsigned long <a class="el" href="class_ether_m_a_c.html#r13">EtherMAC::numBackoffs</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r15" doxytag="EtherMAC::numBackoffsVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector <a class="el" href="class_ether_m_a_c.html#r15">EtherMAC::numBackoffsVector</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r12" doxytag="EtherMAC::numCollisions"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">unsigned long <a class="el" href="class_ether_m_a_c.html#r12">EtherMAC::numCollisions</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r14" doxytag="EtherMAC::numCollisionsVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cOutVector <a class="el" href="class_ether_m_a_c.html#r14">EtherMAC::numCollisionsVector</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r4" doxytag="EtherMAC::numConcurrentTransmissions"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_ether_m_a_c.html#r4">EtherMAC::numConcurrentTransmissions</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r9" doxytag="EtherMAC::totalCollisionTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_ether_m_a_c.html#r9">EtherMAC::totalCollisionTime</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="r10" doxytag="EtherMAC::totalSuccessfulRxTxTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_ether_m_a_c.html#r10">EtherMAC::totalSuccessfulRxTxTime</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_ether_m_a_c_8h.html">EtherMAC.h</a><li><a class="el" href="_ether_m_a_c_8cc.html">EtherMAC.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:22 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
