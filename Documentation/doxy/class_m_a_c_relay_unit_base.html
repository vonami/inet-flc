<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: MACRelayUnitBase Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>MACRelayUnitBase Class Reference</h1><code>#include &lt;MACRelayUnitBase.h&gt;</code>
<p>
<p>Inheritance diagram for MACRelayUnitBase:
<p><center><img src="class_m_a_c_relay_unit_base.png" usemap="#MACRelayUnitBase_map" border="0" alt=""></center>
<map name="MACRelayUnitBase_map">
<area href="class_m_a_c_relay_unit_n_p.html" alt="MACRelayUnitNP" shape="rect" coords="0,56,122,80">
<area href="class_m_a_c_relay_unit_p_p.html" alt="MACRelayUnitPP" shape="rect" coords="132,56,254,80">
</map>
<a href="class_m_a_c_relay_unit_base-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Implements base switching functionality of Ethernet switches. Note that neither activity() nor handleMessage() is redefined here -- active behavior (incl. queueing and performance aspects) must be addressed in subclasses. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::map&lt; <a class="el" href="class_m_a_c_address.html">MACAddress</a>,<br>
 <a class="el" href="struct_m_a_c_relay_unit_base_1_1_address_entry.html">AddressEntry</a>, <a class="el" href="struct_m_a_c_relay_unit_base_1_1_m_a_c__compare.html">MAC_compare</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#x0">AddressTable</a></td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b1">handleAndDispatchFrame</a> (<a class="el" href="class_ether_frame.html">EtherFrame</a> *frame, int inputport)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b2">broadcastFrame</a> (<a class="el" href="class_ether_frame.html">EtherFrame</a> *frame, int inputport)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b3">readAddressTable</a> (const char *fileName)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b4">updateTableWithAddress</a> (<a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp;address, int portno)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b5">getPortForAddress</a> (<a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp;address)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b6">printAddressTable</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b7">removeAgedEntriesFromTable</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b8">removeOldestTableEntry</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#b9">sendPauseFrame</a> (int portno, int pauseUnits)</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#p0">numPorts</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#p1">addressTableSize</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">simtime_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#p2">agingTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_m_a_c_relay_unit_base.html#x0">AddressTable</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_m_a_c_relay_unit_base.html#p4">seqNum</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_m_a_c_relay_unit_base_1_1_address_entry.html">AddressEntry</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_m_a_c_relay_unit_base_1_1_m_a_c__compare.html">MAC_compare</a></td></tr>

</table>
<hr><h2>Member Typedef Documentation</h2>
<a class="anchor" name="x0" doxytag="MACRelayUnitBase::AddressTable"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::map&lt;<a class="el" href="class_m_a_c_address.html">MACAddress</a>, <a class="el" href="struct_m_a_c_relay_unit_base_1_1_address_entry.html">AddressEntry</a>, <a class="el" href="struct_m_a_c_relay_unit_base_1_1_m_a_c__compare.html">MAC_compare</a>&gt; <a class="el" href="class_m_a_c_relay_unit_base.html#x0">MACRelayUnitBase::AddressTable</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b2" doxytag="MACRelayUnitBase::broadcastFrame"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitBase::broadcastFrame           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_ether_frame.html">EtherFrame</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>frame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>inputport</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility function: sends the frame on all ports except inputport. The message pointer should not be referenced any more after this call. <div class="fragment"><pre class="fragment">00108 {
00109     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numPorts; ++i)
00110         if (i!=inputport)
00111             send((<a class="code" href="class_ether_frame.html">EtherFrame</a>*)frame-&gt;dup(), "lowerLayerOut", i);
00112     delete frame;
00113 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="MACRelayUnitBase::getPortForAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int MACRelayUnitBase::getPortForAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>address</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns output port for address, or -1 if unknown. <div class="fragment"><pre class="fragment">00197 {
00198     AddressTable::iterator iter = <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.find(address);
00199     <span class="keywordflow">if</span> (iter == <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.end())
00200     {
00201         <span class="comment">// not found</span>
00202         <span class="keywordflow">return</span> -1;
00203     }
00204     <span class="keywordflow">if</span> (iter-&gt;second.insertionTime + agingTime &lt;= simTime())
00205     {
00206         <span class="comment">// don't use (and throw out) aged entries</span>
00207         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Ignoring and deleting aged entry: "</span>&lt;&lt; iter-&gt;first &lt;&lt; <span class="stringliteral">" --&gt; port"</span> &lt;&lt; iter-&gt;second.portno &lt;&lt; <span class="stringliteral">"\n"</span>;
00208         <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.erase(iter);
00209         <span class="keywordflow">return</span> -1;
00210     }
00211     <span class="keywordflow">return</span> iter-&gt;second.portno;
00212 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="MACRelayUnitBase::handleAndDispatchFrame"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitBase::handleAndDispatchFrame           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_ether_frame.html">EtherFrame</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>frame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>inputport</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Updates address table with source address, determines output port and sends out (or broadcasts) frame on ports. Includes calls to <a class="el" href="class_m_a_c_relay_unit_base.html#b4">updateTableWithAddress()</a> and <a class="el" href="class_m_a_c_relay_unit_base.html#b5">getPortForAddress()</a>.<p>
The message pointer should not be referenced any more after this call. <div class="fragment"><pre class="fragment">00073 {
00074     <span class="comment">// update address table</span>
00075     <a class="code" href="class_m_a_c_relay_unit_base.html#b4">updateTableWithAddress</a>(frame-&gt;<a class="code" href="class_ether_frame.html#a10">getSrc</a>(), inputport);
00076 
00077     <span class="comment">// handle broadcast frames first</span>
00078     <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="class_ether_frame.html#a7">getDest</a>().<a class="code" href="class_m_a_c_address.html#a11">isBroadcast</a>())
00079     {
00080         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Broadcasting broadcast frame "</span> &lt;&lt; frame &lt;&lt; endl;
00081         <a class="code" href="class_m_a_c_relay_unit_base.html#b2">broadcastFrame</a>(frame, inputport);
00082         <span class="keywordflow">return</span>;
00083     }
00084 
00085     <span class="comment">// Finds output port of destination address and sends to output port</span>
00086     <span class="comment">// if not found then broadcasts to all other ports instead</span>
00087     <span class="keywordtype">int</span> outputport = <a class="code" href="class_m_a_c_relay_unit_base.html#b5">getPortForAddress</a>(frame-&gt;<a class="code" href="class_ether_frame.html#a7">getDest</a>());
00088     <span class="keywordflow">if</span> (inputport==outputport)
00089     {
00090         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Output port is same as input port, "</span> &lt;&lt; frame-&gt;fullName() &lt;&lt;
00091               <span class="stringliteral">" dest "</span> &lt;&lt; frame-&gt;<a class="code" href="class_ether_frame.html#a7">getDest</a>() &lt;&lt; <span class="stringliteral">", discarding frame\n"</span>;
00092         <span class="keyword">delete</span> frame;
00093         <span class="keywordflow">return</span>;
00094     }
00095     <span class="keywordflow">if</span> (outputport&gt;=0)
00096     {
00097         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending frame "</span> &lt;&lt; frame &lt;&lt; <span class="stringliteral">" with dest address "</span> &lt;&lt; frame-&gt;<a class="code" href="class_ether_frame.html#a7">getDest</a>() &lt;&lt; <span class="stringliteral">" to port "</span> &lt;&lt; outputport &lt;&lt; endl;
00098         send(frame, <span class="stringliteral">"lowerLayerOut"</span>, outputport);
00099     }
00100     <span class="keywordflow">else</span>
00101     {
00102         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Dest address "</span> &lt;&lt; frame-&gt;<a class="code" href="class_ether_frame.html#a7">getDest</a>() &lt;&lt; <span class="stringliteral">" unknown, broadcasting frame "</span> &lt;&lt; frame &lt;&lt; endl;
00103         <a class="code" href="class_m_a_c_relay_unit_base.html#b2">broadcastFrame</a>(frame, inputport);
00104     }
00105 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="MACRelayUnitBase::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitBase::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read parameters parameters. 
<p>
Reimplemented in <a class="el" href="class_m_a_c_relay_unit_n_p.html#z63_0">MACRelayUnitNP</a>, and <a class="el" href="class_m_a_c_relay_unit_p_p.html#z65_0">MACRelayUnitPP</a>.<div class="fragment"><pre class="fragment">00049 {
00050     <span class="comment">// number of ports</span>
00051     <a class="code" href="class_m_a_c_relay_unit_base.html#p0">numPorts</a> = gate(<span class="stringliteral">"lowerLayerOut"</span>,0)-&gt;size();
00052     <span class="keywordflow">if</span> (gate(<span class="stringliteral">"lowerLayerIn"</span>,0)-&gt;size()!=numPorts)
00053         error("the sizes of the lowerLayerIn[] and lowerLayerOut[] gate vectors must be the same");
00054 
00055     <span class="comment">// other parameters</span>
00056     addressTableSize = par("addressTableSize");
00057     addressTableSize = addressTableSize &gt;= 0 ? addressTableSize : 0;
00058 
00059     agingTime = par("agingTime");
00060     agingTime = agingTime &gt; 0 ? agingTime : 10;
00061 
00062     <span class="comment">// Option to pre-read in Address Table. To turn ot off, set addressTableFile to empty string</span>
00063     const <span class="keywordtype">char</span> *addressTableFile = par("addressTableFile");
00064     if (addressTableFile &amp;&amp; *addressTableFile)
00065         readAddressTable(addressTableFile);
00066 
00067     seqNum = 0;
00068 
00069     WATCH_MAP(addresstable);
00070 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="MACRelayUnitBase::printAddressTable"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitBase::printAddressTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Prints contents of address table on ev. <div class="fragment"><pre class="fragment">00116 {
00117     AddressTable::iterator iter;
00118     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Address Table ("</span> &lt;&lt; <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.size() &lt;&lt; <span class="stringliteral">" entries):\n"</span>;
00119     <span class="keywordflow">for</span> (iter = <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.begin(); iter!=<a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.end(); ++iter)
00120     {
00121         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"  "</span> &lt;&lt; iter-&gt;first &lt;&lt; <span class="stringliteral">" --&gt; port"</span> &lt;&lt; iter-&gt;second.portno &lt;&lt;
00122               (iter-&gt;second.insertionTime+<a class="code" href="class_m_a_c_relay_unit_base.html#p2">agingTime</a> &lt;= simTime() ? <span class="stringliteral">" (aged)"</span> : <span class="stringliteral">""</span>) &lt;&lt; endl;
00123     }
00124 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="MACRelayUnitBase::readAddressTable"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitBase::readAddressTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fileName</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Pre-reads in entries for Address Table during initialization. <div class="fragment"><pre class="fragment">00216 {
00217     FILE *fp = fopen(fileName, <span class="stringliteral">"r"</span>);
00218     <span class="keywordflow">if</span> (fp == NULL)
00219         error("cannot open address table file `%s'", fileName);
00220 
00221     <span class="comment">//  Syntax of the file goes as:</span>
00222     <span class="comment">//  Address in hexadecimal representation, Portno</span>
00223     <span class="comment">//  ffffffff    1</span>
00224     <span class="comment">//  ffffeed1    2</span>
00225     <span class="comment">//  aabcdeff    3</span>
00226     <span class="comment">//</span>
00227     <span class="comment">//  etc...</span>
00228     <span class="comment">//</span>
00229     <span class="comment">//  Each iteration of the loop reads in an entire line i.e. up to '\n' or EOF characters</span>
00230     <span class="comment">//  and uses strtok to extract tokens from the resulting string</span>
00231     <span class="keywordtype">char</span> *line;
00232     <span class="keywordtype">int</span> lineno = 0;
00233     while ((line = fgetline(fp)) != NULL)
00234     {
00235         lineno++;
00236 
00237         <span class="comment">// lines beginning with '#' are treated as comments</span>
00238         <span class="keywordflow">if</span> (line[0]==<span class="charliteral">'#'</span>)
00239             continue;
00240 
00241         <span class="comment">// scan in hexaddress</span>
00242         <span class="keywordtype">char</span> *hexaddress = strtok(line, " \t");
00243         <span class="comment">// scan in port number</span>
00244         <span class="keywordtype">char</span> *portno = strtok(NULL, " \t");
00245 
00246         <span class="comment">// empty line?</span>
00247         if (!hexaddress)
00248             continue;
00249 
00250         <span class="comment">// broken line?</span>
00251         if (!portno)
00252             error("line %d invalid in address table file `%s'", lineno, fileName);
00253 
00254         <span class="comment">// Create an entry with address and portno and insert into table</span>
00255         AddressEntry entry;
00256         entry.insertionTime = 0;
00257         entry.portno = atoi(portno);
00258         addresstable[<a class="code" href="class_m_a_c_address.html">MACAddress</a>(hexaddress)] = entry;
00259 
00260         <span class="comment">// Garbage collection before next iteration</span>
00261         delete [] line;
00262     }
00263     fclose(fp);
00264 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="MACRelayUnitBase::removeAgedEntriesFromTable"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitBase::removeAgedEntriesFromTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility function: throws out all aged entries from table. <div class="fragment"><pre class="fragment">00127 {
00128     <span class="keywordflow">for</span> (AddressTable::iterator iter = <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.begin(); iter != <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.end();)
00129     {
00130         AddressTable::iterator cur = iter++; <span class="comment">// iter will get invalidated after erase()</span>
00131         AddressEntry&amp; entry = cur-&gt;second;
00132         <span class="keywordflow">if</span> (entry.insertionTime + agingTime &lt;= simTime())
00133         {
00134             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Removing aged entry from Address Table: "</span> &lt;&lt;
00135                   cur-&gt;first &lt;&lt; <span class="stringliteral">" --&gt; port"</span> &lt;&lt; cur-&gt;second.portno &lt;&lt; <span class="stringliteral">"\n"</span>;
00136             <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.erase(cur);
00137         }
00138     }
00139 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b8" doxytag="MACRelayUnitBase::removeOldestTableEntry"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitBase::removeOldestTableEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility function: throws out oldest (not necessarily aged) entry from table. <div class="fragment"><pre class="fragment">00142 {
00143     AddressTable::iterator oldest = <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.end();
00144     simtime_t oldestInsertTime = simTime()+1;
00145     <span class="keywordflow">for</span> (AddressTable::iterator iter = <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.begin(); iter != <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.end(); iter++)
00146     {
00147         <span class="keywordflow">if</span> (iter-&gt;second.insertionTime &lt; oldestInsertTime)
00148         {
00149             oldest = iter;
00150             oldestInsertTime = iter-&gt;second.insertionTime;
00151         }
00152     }
00153     <span class="keywordflow">if</span> (oldest != <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.end())
00154     {
00155         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Table full, removing oldest entry: "</span> &lt;&lt;
00156               oldest-&gt;first &lt;&lt; <span class="stringliteral">" --&gt; port"</span> &lt;&lt; oldest-&gt;second.portno &lt;&lt; <span class="stringliteral">"\n"</span>;
00157         <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.erase(oldest);
00158     }
00159 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="MACRelayUnitBase::sendPauseFrame"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitBase::sendPauseFrame           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>portno</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>pauseUnits</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Utility function (for use by subclasses) to send a flow control PAUSE frame on the given port. <div class="fragment"><pre class="fragment">00268 {
00269     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Creating and sending PAUSE frame on port "</span> &lt;&lt; portno &lt;&lt; <span class="stringliteral">" with duration="</span> &lt;&lt; pauseUnits &lt;&lt; <span class="stringliteral">" units\n"</span>;
00270 
00271     <span class="comment">// create Ethernet frame</span>
00272     <span class="keywordtype">char</span> framename[40];
00273     sprintf(framename, <span class="stringliteral">"pause-%d-%d"</span>, <span class="keywordtype">id</span>(), seqNum++);
00274     <a class="code" href="class_ether_pause_frame.html">EtherPauseFrame</a> *frame = <span class="keyword">new</span> <a class="code" href="class_ether_pause_frame.html">EtherPauseFrame</a>(framename, ETH_PAUSE);
00275     frame-&gt;<a class="code" href="class_ether_pause_frame.html#a8">setPauseTime</a>(pauseUnits);
00276 
00277     frame-&gt;setByteLength(ETHER_MAC_FRAME_BYTES+ETHER_PAUSE_COMMAND_BYTES);
00278     <span class="keywordflow">if</span> (frame-&gt;byteLength() &lt; <a class="code" href="_ethernet_8h.html#a4">MIN_ETHERNET_FRAME</a>)
00279         frame-&gt;setByteLength(MIN_ETHERNET_FRAME);
00280 
00281     send(frame, <span class="stringliteral">"lowerLayerOut"</span>, portno);
00282 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="MACRelayUnitBase::updateTableWithAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void MACRelayUnitBase::updateTableWithAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>address</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>portno</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Enters address into table. <div class="fragment"><pre class="fragment">00162 {
00163     AddressTable::iterator iter;
00164 
00165     iter = <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.find(address);
00166     <span class="keywordflow">if</span> (iter == <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.end())
00167     {
00168         <span class="comment">// Observe finite table size</span>
00169         <span class="keywordflow">if</span> (addressTableSize!=0 &amp;&amp; <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.size() == (<span class="keywordtype">unsigned</span> int)<a class="code" href="class_m_a_c_relay_unit_base.html#p1">addressTableSize</a>)
00170         {
00171             <span class="comment">// lazy removal of aged entries: only if table gets full (this step is not strictly needed)</span>
00172             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Making room in Address Table by throwing out aged entries.\n"</span>;
00173             <a class="code" href="class_m_a_c_relay_unit_base.html#b7">removeAgedEntriesFromTable</a>();
00174 
00175             <span class="keywordflow">if</span> (<a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>.size() == (<span class="keywordtype">unsigned</span> int)<a class="code" href="class_m_a_c_relay_unit_base.html#p1">addressTableSize</a>)
00176                 <a class="code" href="class_m_a_c_relay_unit_base.html#b8">removeOldestTableEntry</a>();
00177         }
00178 
00179         <span class="comment">// Add entry to table</span>
00180         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Adding entry to Address Table: "</span>&lt;&lt; address &lt;&lt; <span class="stringliteral">" --&gt; port"</span> &lt;&lt; portno &lt;&lt; <span class="stringliteral">"\n"</span>;
00181         AddressEntry entry;
00182         entry.portno = portno;
00183         entry.insertionTime = simTime();
00184         <a class="code" href="class_m_a_c_relay_unit_base.html#p3">addresstable</a>[address] = entry;
00185     }
00186     <span class="keywordflow">else</span>
00187     {
00188         <span class="comment">// Update existing entry</span>
00189         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Updating entry in Address Table: "</span>&lt;&lt; address &lt;&lt; <span class="stringliteral">" --&gt; port"</span> &lt;&lt; portno &lt;&lt; <span class="stringliteral">"\n"</span>;
00190         AddressEntry&amp; entry = iter-&gt;second;
00191         entry.insertionTime = simTime();
00192         entry.portno = portno;
00193     }
00194 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p3" doxytag="MACRelayUnitBase::addresstable"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_m_a_c_relay_unit_base.html#x0">AddressTable</a> <a class="el" href="class_m_a_c_relay_unit_base.html#p3">MACRelayUnitBase::addresstable</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="MACRelayUnitBase::addressTableSize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_base.html#p1">MACRelayUnitBase::addressTableSize</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="MACRelayUnitBase::agingTime"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">simtime_t <a class="el" href="class_m_a_c_relay_unit_base.html#p2">MACRelayUnitBase::agingTime</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="MACRelayUnitBase::numPorts"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_base.html#p0">MACRelayUnitBase::numPorts</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="MACRelayUnitBase::seqNum"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_m_a_c_relay_unit_base.html#p4">MACRelayUnitBase::seqNum</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_m_a_c_relay_unit_base_8h.html">MACRelayUnitBase.h</a><li><a class="el" href="_m_a_c_relay_unit_base_8cc.html">MACRelayUnitBase.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:26 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
