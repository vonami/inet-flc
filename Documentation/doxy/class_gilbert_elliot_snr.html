<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: GilbertElliotSnr Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>GilbertElliotSnr Class Reference</h1><code>#include &lt;GilbertElliotSnr.h&gt;</code>
<p>
<p>Inheritance diagram for GilbertElliotSnr:
<p><center><img src="class_gilbert_elliot_snr.png" usemap="#GilbertElliotSnr_map" border="0" alt=""></center>
<map name="GilbertElliotSnr_map">
<area href="class_snr_eval.html" alt="SnrEval" shape="rect" coords="0,224,101,248">
<area href="class_basic_snr_eval.html" alt="BasicSnrEval" shape="rect" coords="0,168,101,192">
<area href="class_channel_access.html" alt="ChannelAccess" shape="rect" coords="0,112,101,136">
<area href="class_basic_module.html" alt="BasicModule" shape="rect" coords="0,56,101,80">
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="0,0,101,24">
</map>
<a href="class_gilbert_elliot_snr-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Keeps track of the different snir levels when receiving a packet and switches between states GOOD and BAD (Gilbert-Elliot-Model). 
<p>
This module has exactly the same functionality as the <a class="el" href="class_snr_eval.html">SnrEval</a> module, but furthermore it puts a Gilbert-Elliot model on top of the SNIR level computation. This means that it changes between the states GOOD and BAD. If it is in state BAD a received frame will be marked as corrupted.<p>
The Gilbert Elliot model is used to simulate outer system disturbances.<p>
This module should be used in combination with the GilbertElliotDecider moulde which evaluates the snr levels as well as the marked frames.<p>
<dl compact><dt><b>Author:</b></dt><dd>Marc Loebbers </dd></dl>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a0">GilbertElliotSnr</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#a1">~GilbertElliotSnr</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#x2">State</a> { <a class="el" href="class_gilbert_elliot_snr.html#x2x0">GOOD</a>, 
<a class="el" href="class_gilbert_elliot_snr.html#x2x1">BAD</a>
 }</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gilbert-Elliot state types.  <a href="#x2">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#b0">initialize</a> (int)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize variables and publish the radio status.  <a href="#b0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#b1">handleSelfMsg</a> (cMessage *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle timers.  <a href="#b1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#b2">handleLowerMsgStart</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Buffer the frame and update noise levels and snr information...  <a href="#b2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#b3">handleLowerMsgEnd</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unbuffer the frame and update noise levels and snr information.  <a href="#b3"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_gilbert_elliot_snr.html#x2">State</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#p0">state</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">System state.  <a href="#p0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#p1">meanGood</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">mean value to compute the time the xystem stays in the GOOD state  <a href="#p1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#p2">meanBad</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">mean value to compute the time the xystem stays in the BAD state  <a href="#p2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gilbert_elliot_snr.html#p3">stateChange</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">timer to indicate a change of state  <a href="#p3"></a><br></td></tr>
</table>
<hr><h2>Member Enumeration Documentation</h2>
<a class="anchor" name="x2" doxytag="GilbertElliotSnr::State"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">enum <a class="el" href="class_gilbert_elliot_snr.html#x2">GilbertElliotSnr::State</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Gilbert-Elliot state types. 
<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="x2x0" doxytag="GOOD"></a>GOOD</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="x2x1" doxytag="BAD"></a>BAD</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>
<div class="fragment"><pre class="fragment">00067               {
00068       <a class="code" href="class_gilbert_elliot_snr.html#x2x0">GOOD</a>,
00069       <a class="code" href="class_gilbert_elliot_snr.html#x2x1">BAD</a>
00070     };
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="GilbertElliotSnr::GilbertElliotSnr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GilbertElliotSnr::GilbertElliotSnr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00027 {
00028     <a class="code" href="class_gilbert_elliot_snr.html#p3">stateChange</a> = NULL;
00029 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="GilbertElliotSnr::~GilbertElliotSnr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">GilbertElliotSnr::~<a class="el" href="class_gilbert_elliot_snr.html">GilbertElliotSnr</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00032 {
00033     cancelAndDelete(stateChange);
00034 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b3" doxytag="GilbertElliotSnr::handleLowerMsgEnd"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void GilbertElliotSnr::handleLowerMsgEnd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Unbuffer the frame and update noise levels and snr information. 
<p>
This function is called right after the transmission is over, i.e. right after unbuffering. The noise level of the channel and the snr information of the buffered messages have to be updated.<p>
Additionally the <a class="el" href="class_radio_state.html">RadioState</a> has to be updated.<p>
If the corresponding <a class="el" href="class_air_frame.html">AirFrame</a> was not only noise the corresponding SnrList and the <a class="el" href="class_air_frame.html">AirFrame</a> are sent to the decider. 
<p>
Reimplemented from <a class="el" href="class_snr_eval.html#b8">SnrEval</a>.<div class="fragment"><pre class="fragment">00216 {
00217 
00218     <span class="comment">//check state again:</span>
00219     <span class="keywordflow">if</span> (state == BAD)
00220         frame-&gt;setBitError(true);
00221 
00222     <span class="comment">// check if message has to be send to the decider</span>
00223     if (snrInfo.ptr == frame)
00224     {
00225         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"reception of frame over, preparing to send packet to upper layer\n"</span>;
00226         <span class="comment">// get Packet and list out of the receive buffer:</span>
00227         <a class="code" href="_snr_list_8h.html#a0">SnrList</a> list;
00228         list = <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.sList;
00229 
00230         <span class="comment">// delete the pointer to indicate that no message is currently</span>
00231         <span class="comment">// being received and clear the list</span>
00232         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.ptr = NULL;
00233         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.sList.clear();
00234 
00235         <span class="comment">// delete the frame from the recvBuff</span>
00236         <a class="code" href="class_snr_eval.html#p1">recvBuff</a>.erase(frame);
00237 
00238         <span class="comment">//Don't forget to send:</span>
00239         <a class="code" href="class_basic_snr_eval.html#z116_2">sendUp</a>(frame, list);
00240         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"packet sent to the decider\n"</span>;
00241     }
00242     <span class="comment">// all other messages are noise</span>
00243     <span class="keywordflow">else</span>
00244     {
00245         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"reception of noise message over, removing recvdPower from noiseLevel....\n"</span>;
00246         <span class="comment">// get the rcvdPower and subtract it from the noiseLevel</span>
00247         <a class="code" href="class_snr_eval.html#p5">noiseLevel</a> -= <a class="code" href="class_snr_eval.html#p1">recvBuff</a>[frame];
00248 
00249         <span class="comment">// delete message from the recvBuff</span>
00250         <a class="code" href="class_snr_eval.html#p1">recvBuff</a>.erase(frame);
00251 
00252         <span class="comment">// update snr info for message currently being received if any</span>
00253         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p0">snrInfo</a>.ptr != NULL)
00254         {
00255             <a class="code" href="class_snr_eval.html#b11">addNewSnr</a>();
00256         }
00257 
00258         <span class="comment">// message should be deleted</span>
00259         <span class="keyword">delete</span> frame;
00260         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"message deleted\n"</span>;
00261     }
00262 
00263     <span class="comment">// check the RadioState and update if necessary</span>
00264     <span class="comment">// change to idle if noiseLevel smaller than threshold and state was</span>
00265     <span class="comment">// not idle before</span>
00266     <span class="comment">// do not change state if currently sending or receiving a message!!!</span>
00267     <span class="keywordflow">if</span> (noiseLevel &lt; sensitivity &amp;&amp; <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() == <a class="code" href="class_radio_state.html#w4w1">RadioState::RECV</a> &amp;&amp; <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.ptr == NULL)
00268     {
00269         <span class="comment">// publish the new RadioState:</span>
00270         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"new RadioState is IDLE\n"</span>;
00271         <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::IDLE);
00272         <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00273     }
00274 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="GilbertElliotSnr::handleLowerMsgStart"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void GilbertElliotSnr::handleLowerMsgStart           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Buffer the frame and update noise levels and snr information... 
<p>
This function is called right after a packet arrived, i.e. right before it is buffered for 'transmission time'.<p>
First the receive power of the packet has to be calculated and is stored in the recvBuff. Afterwards it has to be decided whether the packet is just noise or a "real" packet that needs to be received.<p>
The message is not treated as noise if all of the follwoing conditions apply:<p>
<ol type=1>
<li>the power of the received signal is higher than the sensitivity.</li><li>the host is currently not sending a message</li><li>no other packet is already being received</li></ol>
<p>
If all conditions apply a new SnrList is created and the <a class="el" href="class_radio_state.html">RadioState</a> is changed to RECV. If the Gilbert Elliot model is in state BAD, the frame is marked as corrupted. The cMessage's bitError flag is used for it. If the packet is just noise the receive power is added to the noise Level of the channel. Additionally the snr information of the currently received message (if any) has to be updated as well as the <a class="el" href="class_radio_state.html">RadioState</a>. 
<p>
Reimplemented from <a class="el" href="class_snr_eval.html#b7">SnrEval</a>.<div class="fragment"><pre class="fragment">00136 {
00137     <span class="comment">// Calculate the receive power of the message</span>
00138 
00139     <span class="comment">// calculate distance</span>
00140     <span class="keyword">const</span> <a class="code" href="class_coord.html">Coord</a>&amp; myPos = <a class="code" href="class_channel_access.html#b1">myPosition</a>();
00141     <span class="keyword">const</span> <a class="code" href="class_coord.html">Coord</a>&amp; framePos = frame-&gt;<a class="code" href="class_air_frame.html#a15">getSenderPos</a>();
00142     <span class="keywordtype">double</span> distance = myPos.<a class="code" href="class_coord.html#a7">distance</a>(framePos);
00143 
00144     <span class="comment">// receive power</span>
00145     <span class="keywordtype">double</span> rcvdPower = <a class="code" href="class_snr_eval.html#b9">calcRcvdPower</a>(frame-&gt;<a class="code" href="class_air_frame.html#a7">getPSend</a>(), distance);
00146 
00147     <span class="keywordflow">if</span> (state == BAD)
00148         frame-&gt;setBitError(true);
00149 
00150     <span class="comment">// store the receive power in the recvBuff</span>
00151     recvBuff[frame] = rcvdPower;
00152 
00153     <span class="comment">// if receive power is bigger than sensitivity and if not sending</span>
00154     <span class="comment">// and currently not receiving another message</span>
00155     if (rcvdPower &gt;= sensitivity &amp;&amp; rs.getState() != <a class="code" href="class_radio_state.html">RadioState</a>::TRANSMIT &amp;&amp; snrInfo.ptr == NULL)
00156     {
00157         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"receiving frame\n"</span>;
00158 
00159         <span class="comment">// Put frame and related SnrList in receive buffer</span>
00160         <a class="code" href="_snr_list_8h.html#a0">SnrList</a> snrList;        <span class="comment">//defined in SnrList.h!!</span>
00161         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.ptr = frame;
00162         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.rcvdPower = rcvdPower;
00163         <a class="code" href="class_snr_eval.html#p0">snrInfo</a>.sList = snrList;
00164 
00165         <span class="comment">// add initial snr value</span>
00166         <a class="code" href="class_snr_eval.html#b11">addNewSnr</a>();
00167 
00168         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() != <a class="code" href="class_radio_state.html#w4w1">RadioState::RECV</a>)
00169         {
00170             <span class="comment">// publish new RadioState</span>
00171             <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::RECV);
00172             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"publish new RadioState:RECV\n"</span>;
00173             <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00174         }
00175     }
00176     <span class="comment">// receive power is to low or another message is being send or received</span>
00177     <span class="keywordflow">else</span>
00178     {
00179         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"frame is just noise\n"</span>;
00180         <span class="comment">//add receive power to the noise level</span>
00181         <a class="code" href="class_snr_eval.html#p5">noiseLevel</a> += rcvdPower;
00182 
00183         <span class="comment">// if a message is being received add a new snr value</span>
00184         <span class="keywordflow">if</span> (<a class="code" href="class_snr_eval.html#p0">snrInfo</a>.ptr != NULL)
00185         {
00186             <span class="comment">// update snr info for currently being received message</span>
00187             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"add new snr value to snr list of message being received\n"</span>;
00188             <a class="code" href="class_snr_eval.html#b11">addNewSnr</a>();
00189         }
00190 
00191         <span class="comment">// update the RadioState if the noiseLevel exceeded the threshold</span>
00192         <span class="comment">// and the radio is currently not in receive or in send mode</span>
00193         <span class="keywordflow">if</span> (noiseLevel &gt;= sensitivity &amp;&amp; <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a2">getState</a>() == <a class="code" href="class_radio_state.html#w4w0">RadioState::IDLE</a>)
00194         {
00195             <span class="comment">// publish new RadioState</span>
00196             <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::RECV);
00197             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"publish new RadioState:RECV\n"</span>;
00198             <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00199         }
00200     }
00201 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="GilbertElliotSnr::handleSelfMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void GilbertElliotSnr::handleSelfMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle timers. 
<p>
If the selfMsg is the time to indicate a transmission is over, the <a class="el" href="class_radio_state.html">RadioState</a> has to be changed based on the noise level on the channel. If the noise level is bigger than the sensitivity switch to receive mode otherwise to idle mode.<p>
If the timer indicates a change of state in the Gilbert-Elliot model, the state variable has to be changed. 
<p>
Reimplemented from <a class="el" href="class_snr_eval.html#b5">SnrEval</a>.<div class="fragment"><pre class="fragment">00067 {
00068     <span class="keywordflow">if</span> (msg-&gt;kind() == <a class="code" href="class_snr_eval.html#x2x1">TRANSM_OVER</a>)
00069     {
00070 
00071         <span class="keywordflow">if</span> (noiseLevel &lt; sensitivity)
00072         {
00073             <span class="comment">// set the RadioState to IDLE</span>
00074             <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::IDLE);
00075             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"transmission over, switch to idle mode (state:IDLE)\n"</span>;
00076             <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00077         }
00078         <span class="keywordflow">else</span>
00079         {
00080             <span class="comment">// set the RadioState to RECV</span>
00081             <a class="code" href="class_snr_eval.html#p2">rs</a>.<a class="code" href="class_radio_state.html#a3">setState</a>(RadioState::RECV);
00082             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"transmission over but noise level to high, switch to recv mode (state:RECV)\n"</span>;
00083             <a class="code" href="class_basic_module.html#p0">nb</a>-&gt;<a class="code" href="class_notification_board.html#z24_0">fireChangeNotification</a>(NF_RADIOSTATE_CHANGED, &amp;rs);
00084         }
00085 
00086         <span class="comment">// delete the timer</span>
00087         <span class="keyword">delete</span> msg;
00088     }
00089     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg == stateChange)
00090     {
00091         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"GilbertElliot state changed!\n"</span>;
00092         <span class="keywordflow">if</span> (state == GOOD)
00093         {
00094             <a class="code" href="class_gilbert_elliot_snr.html#p0">state</a> = <a class="code" href="class_gilbert_elliot_snr.html#x2x1">BAD</a>;
00095             <span class="keywordflow">for</span> (RecvBuff::iterator it = <a class="code" href="class_snr_eval.html#p1">recvBuff</a>.begin(); it != <a class="code" href="class_snr_eval.html#p1">recvBuff</a>.end(); it++)
00096                 (it-&gt;first)-&gt;setBitError(<span class="keyword">true</span>);
00097             scheduleAt(simTime() + exponential(meanBad, 0), stateChange);
00098         }
00099         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == BAD)
00100         {
00101             <a class="code" href="class_gilbert_elliot_snr.html#p0">state</a> = <a class="code" href="class_gilbert_elliot_snr.html#x2x0">GOOD</a>;
00102             scheduleAt(simTime() + exponential(meanGood, 0), stateChange);
00103         }
00104     }
00105     <span class="keywordflow">else</span>
00106         error(<span class="stringliteral">"Internal error: unknown self-message `%s'"</span>, msg-&gt;name());
00107 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="GilbertElliotSnr::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void GilbertElliotSnr::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stage</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize variables and publish the radio status. 
<p>
All values not present in the ned file will be read from the <a class="el" href="class_channel_control.html">ChannelControl</a> module or assigned default values. 
<p>
Reimplemented from <a class="el" href="class_snr_eval.html#b0">SnrEval</a>.<div class="fragment"><pre class="fragment">00041 {
00042     <a class="code" href="class_snr_eval.html#b0">SnrEval::initialize</a>(stage);
00043 
00044     <span class="keywordflow">if</span> (stage == 0)
00045     {
00046         <a class="code" href="class_gilbert_elliot_snr.html#p1">meanGood</a> = par(<span class="stringliteral">"meanGood"</span>);
00047         <a class="code" href="class_gilbert_elliot_snr.html#p2">meanBad</a> = par(<span class="stringliteral">"meanBad"</span>);
00048         <a class="code" href="class_gilbert_elliot_snr.html#p3">stateChange</a> = <span class="keyword">new</span> cMessage();
00049         <a class="code" href="class_gilbert_elliot_snr.html#p3">stateChange</a>-&gt;setKind(38);
00050         <a class="code" href="class_gilbert_elliot_snr.html#p0">state</a> = <a class="code" href="class_gilbert_elliot_snr.html#x2x0">GOOD</a>;
00051         scheduleAt(simTime() + exponential(meanGood, 0), stateChange);
00052         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"GE state will change at: "</span> &lt;&lt; <a class="code" href="class_gilbert_elliot_snr.html#p3">stateChange</a>-&gt;arrivalTime() &lt;&lt; endl;
00053     }
00054 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p2" doxytag="GilbertElliotSnr::meanBad"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_gilbert_elliot_snr.html#p2">GilbertElliotSnr::meanBad</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
mean value to compute the time the xystem stays in the BAD state 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="GilbertElliotSnr::meanGood"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_gilbert_elliot_snr.html#p1">GilbertElliotSnr::meanGood</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
mean value to compute the time the xystem stays in the GOOD state 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="GilbertElliotSnr::state"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_gilbert_elliot_snr.html#x2">State</a> <a class="el" href="class_gilbert_elliot_snr.html#p0">GilbertElliotSnr::state</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
System state. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="GilbertElliotSnr::stateChange"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage* <a class="el" href="class_gilbert_elliot_snr.html#p3">GilbertElliotSnr::stateChange</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
timer to indicate a change of state 
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_gilbert_elliot_snr_8h.html">GilbertElliotSnr.h</a><li><a class="el" href="_gilbert_elliot_snr_8cc.html">GilbertElliotSnr.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:22 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
