<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: Decider80211 Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>Decider80211 Class Reference</h1><code>#include &lt;Decider80211.h&gt;</code>
<p>
<p>Inheritance diagram for Decider80211:
<p><center><img src="class_decider80211.png" usemap="#Decider80211_map" border="0" alt=""></center>
<map name="Decider80211_map">
<area href="class_basic_decider.html" alt="BasicDecider" shape="rect" coords="0,112,92,136">
<area href="class_basic_module.html" alt="BasicModule" shape="rect" coords="0,56,92,80">
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="0,0,92,24">
</map>
<a href="class_decider80211-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Decider for the 802.11 modules. 
<p>
Depending on the minimum of the snr included in the PhySDU this module computes a bit error probability. The header (1 Mbit/s) is always modulated with DBQPSK. The PDU is normally modulated either with DBPSK (1 and 2 Mbit/s) or CCK (5.5 and 11 Mbit/s). CCK is not easy to model, therefore it is modeled as DQPSK with a 16-QAM for 5.5 Mbit/s and a 256-QAM for 11 Mbit/s.<p>
<dl compact><dt><b>Author:</b></dt><dd>Marc Löbbers, David Raguin </dd></dl>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_decider80211.html#b0">initialize</a> (int)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialization of the module and some variables.  <a href="#b0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_decider80211.html#b1">handleLowerMsg</a> (<a class="el" href="class_air_frame.html">AirFrame</a> *, <a class="el" href="_snr_list_8h.html#a0">SnrList</a> &amp;)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">In this function the decision whether a frame is received correctly or not is made.  <a href="#b1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_decider80211.html#b2">dB2fraction</a> (double)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">converts a dB value into a normal fraction  <a href="#b2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_decider80211.html#b3">packetOk</a> (double, int)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">computes if packet is ok or has errors  <a href="#b3"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_decider80211.html#p0">bitrate</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">should be set in the omnetpp.ini  <a href="#p0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_decider80211.html#p1">snirThreshold</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">should be set in the omnetpp.ini; everthing below this threshold can't be read and is therefor considered as a collision  <a href="#p1"></a><br></td></tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b2" doxytag="Decider80211::dB2fraction"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double Decider80211::dB2fraction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">double&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
converts a dB value into a normal fraction 
<p>
<div class="fragment"><pre class="fragment">00136 {
00137     <span class="keywordflow">return</span> pow(10.0, (dB / 10));
00138 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="Decider80211::handleLowerMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void Decider80211::handleLowerMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_air_frame.html">AirFrame</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>af</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="_snr_list_8h.html#a0">SnrList</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>receivedList</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
In this function the decision whether a frame is received correctly or not is made. 
<p>
Handle message from lower layer. The minimal snir is read in and it is computed wether the packet has collided or has bit errors or was received correctly. The corresponding kind is set and it is handed on to the upper layer. 
<p>
Reimplemented from <a class="el" href="class_basic_decider.html#z109_1">BasicDecider</a>.<div class="fragment"><pre class="fragment">00057 {
00058 
00059     <span class="keywordtype">double</span> snirMin;
00060 
00061     <span class="comment">//initialize snirMin:</span>
00062     snirMin = receivedList.begin()-&gt;snr;
00063 
00064     <span class="keywordflow">for</span> (SnrList::iterator iter = receivedList.begin(); iter != receivedList.end(); iter++)
00065     {
00066         <span class="keywordflow">if</span> (iter-&gt;snr &lt; snirMin)
00067             snirMin = iter-&gt;snr;
00068     }
00069     cMessage *fr = af-&gt;encapsulatedMsg();
00070     EV &lt;&lt; "packet (" &lt;&lt; fr-&gt;className() &lt;&lt; ")" &lt;&lt; fr-&gt;name() &lt;&lt; " (" &lt;&lt; fr-&gt;info() &lt;&lt; ") snrMin=" &lt;&lt; snirMin &lt;&lt; endl;
00071 
00072     <span class="comment">//if snir is big enough so that packet can be recognized at all</span>
00073     if (snirMin &gt; snirThreshold)
00074     {
00075         <span class="keywordflow">if</span> (<a class="code" href="class_decider80211.html#b3">packetOk</a>(snirMin, af-&gt;encapsulatedMsg()-&gt;length()))
00076         {
00077             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"packet was received correctly, it is now handed to upper layer...\n"</span>;
00078             <a class="code" href="class_basic_decider.html#z111_0">sendUp</a>(af);
00079         }
00080         <span class="keywordflow">else</span>
00081         {
00082             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Packet has BIT ERRORS! It is lost!\n"</span>;
00083             af-&gt;setName(<span class="stringliteral">"ERROR"</span>);
00084             af-&gt;encapsulatedMsg()-&gt;setKind(BITERROR);
00085             <a class="code" href="class_basic_decider.html#z111_0">sendUp</a>(af);
00086         }
00087     }
00088     <span class="keywordflow">else</span>
00089     {
00090         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"COLLISION! Packet got lost\n"</span>;
00091         af-&gt;setName(<span class="stringliteral">"COLLISION"</span>);
00092         af-&gt;encapsulatedMsg()-&gt;setKind(COLLISION);
00093         <a class="code" href="class_basic_decider.html#z111_0">sendUp</a>(af);
00094     }
00095 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="Decider80211::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void Decider80211::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stage</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialization of the module and some variables. 
<p>
First we have to initialize the module from which we derived ours, in this case <a class="el" href="class_basic_decider.html">BasicDecider</a>.<p>
This decider also needs the bitrate and some 802.11 parameters are initialized 
<p>
Reimplemented from <a class="el" href="class_basic_decider.html#a0">BasicDecider</a>.<div class="fragment"><pre class="fragment">00035 {
00036     <a class="code" href="class_basic_decider.html#a0">BasicDecider::initialize</a>(stage);
00037 
00038     <span class="keywordflow">if</span> (stage == 0)
00039     {
00040         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"initializing stage 0\n"</span>;
00041         <a class="code" href="class_decider80211.html#p0">bitrate</a> = par(<span class="stringliteral">"bitrate"</span>);
00042         <span class="keywordflow">if</span> (bitrate != 1E+6 &amp;&amp; bitrate != 2E+6 &amp;&amp; bitrate != 5.5E+6 &amp;&amp; bitrate != 11E+6)
00043             error("Wrong bitrate!! Please chose 1E+6, 2E+6, 5.5E+6 or 11E+6 as bitrate!!");
00044         snirThreshold = dB2fraction(par("snirThreshold"));
00045     }
00046 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="Decider80211::packetOk"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool Decider80211::packetOk           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">double&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
computes if packet is ok or has errors 
<p>
<div class="fragment"><pre class="fragment">00099 {
00100     <span class="keywordtype">double</span> berHeader, berMPDU;
00101 
00102     berHeader = 0.5 * exp(-snirMin * BANDWIDTH / BITRATE_HEADER);
00103     <span class="comment">//if PSK modulation</span>
00104     <span class="keywordflow">if</span> (bitrate == 1E+6 || bitrate == 2E+6)
00105         berMPDU = 0.5 * exp(-snirMin * BANDWIDTH / bitrate);
00106     <span class="comment">//if CCK modulation (modeled with 16-QAM)</span>
00107     else if (bitrate == 5.5E+6)
00108         berMPDU = 0.5 * (1 - 1 / sqrt(pow(2.0, 4))) * erfc(snirMin * BANDWIDTH / bitrate);
00109     else                        <span class="comment">// CCK, modelled with 256-QAM</span>
00110         berMPDU = 0.25 * (1 - 1 / sqrt(pow(2.0, 8))) * erfc(snirMin * BANDWIDTH / bitrate);
00111     <span class="comment">//probability of no bit error in the PLCP header</span>
00112     <span class="keywordtype">double</span> headerNoError = pow(1.0 - berHeader, HEADER_WITHOUT_PREAMBLE);
00113 
00114     <span class="comment">//probability of no bit error in the MPDU</span>
00115     <span class="keywordtype">double</span> MpduNoError = pow(1.0 - berMPDU, lengthMPDU);
00116     EV &lt;&lt; "berHeader: " &lt;&lt; berHeader &lt;&lt; " berMPDU: " &lt;&lt; berMPDU &lt;&lt; endl;
00117     <span class="keywordtype">double</span> rand = dblrand();
00118 
00119     <span class="comment">//if error in header</span>
00120     if (rand &gt; headerNoError)
00121         return (false);
00122     else
00123     {
00124         rand = dblrand();
00125 
00126         <span class="comment">//if error in MPDU</span>
00127         <span class="keywordflow">if</span> (rand &gt; MpduNoError)
00128             return (false);
00129         <span class="comment">//if no error</span>
00130         else
00131             return (true);
00132     }
00133 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p0" doxytag="Decider80211::bitrate"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_decider80211.html#p0">Decider80211::bitrate</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
should be set in the omnetpp.ini 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="Decider80211::snirThreshold"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">double <a class="el" href="class_decider80211.html#p1">Decider80211::snirThreshold</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
should be set in the omnetpp.ini; everthing below this threshold can't be read and is therefor considered as a collision 
<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_decider80211_8h.html">Decider80211.h</a><li><a class="el" href="_decider80211_8cc.html">Decider80211.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:21 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
