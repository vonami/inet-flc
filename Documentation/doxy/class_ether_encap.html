<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: EtherEncap Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>EtherEncap Class Reference</h1><a href="class_ether_encap-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Performs Ethernet II encapsulation/decapsulation. More info in the NED file. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#b0">initialize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#b1">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#b2">finish</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#b3">processPacketFromHigherLayer</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#b4">processFrameFromMAC</a> (<a class="el" href="class_ether_frame.html">EtherFrame</a> *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#b5">handleSendPause</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#b6">updateDisplayString</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#p0">seqNum</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#p1">totalFromHigherLayer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#p2">totalFromMAC</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_ether_encap.html#p3">totalPauseSent</a></td></tr>

</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b2" doxytag="EtherEncap::finish"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherEncap::finish           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00186 {
00187     <span class="keywordflow">if</span> (par(<span class="stringliteral">"writeScalars"</span>).boolValue())
00188     {
00189         recordScalar(<span class="stringliteral">"packets from higher layer"</span>, totalFromHigherLayer);
00190         recordScalar(<span class="stringliteral">"frames from MAC"</span>, totalFromMAC);
00191     }
00192 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="EtherEncap::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherEncap::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00073 {
00074     <span class="keywordflow">if</span> (msg-&gt;arrivedOn(<span class="stringliteral">"lowerLayerIn"</span>))
00075     {
00076         <a class="code" href="class_ether_encap.html#b4">processFrameFromMAC</a>(check_and_cast&lt;EtherFrame *&gt;(msg));
00077     }
00078     <span class="keywordflow">else</span>
00079     {
00080         <span class="comment">// from higher layer</span>
00081         <span class="keywordflow">switch</span>(msg-&gt;kind())
00082         {
00083             <span class="keywordflow">case</span> <a class="code" href="_ieee802_ctrl__m_8h.html#a18a1">IEEE802CTRL_DATA</a>:
00084             <span class="keywordflow">case</span> 0: <span class="comment">// default message kind (0) is also accepted</span>
00085               <a class="code" href="class_ether_encap.html#b3">processPacketFromHigherLayer</a>(msg);
00086               <span class="keywordflow">break</span>;
00087 
00088             <span class="keywordflow">case</span> <a class="code" href="_ieee802_ctrl__m_8h.html#a18a4">IEEE802CTRL_SENDPAUSE</a>:
00089               <span class="comment">// higher layer want MAC to send PAUSE frame</span>
00090               <a class="code" href="class_ether_encap.html#b5">handleSendPause</a>(msg);
00091               <span class="keywordflow">break</span>;
00092 
00093             <span class="keywordflow">default</span>:
00094               error(<span class="stringliteral">"received message `%s' with unknown message kind %d"</span>, msg-&gt;name(), msg-&gt;kind());
00095         }
00096     }
00097 
00098     <span class="keywordflow">if</span> (ev.isGUI())
00099         <a class="code" href="class_ether_encap.html#b6">updateDisplayString</a>();
00100 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="EtherEncap::handleSendPause"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherEncap::handleSendPause           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00160 {
00161     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *etherctrl = dynamic_cast&lt;Ieee802Ctrl*&gt;(msg-&gt;removeControlInfo());
00162     <span class="keywordflow">if</span> (!etherctrl)
00163         error("PAUSE command `%s' from higher layer received without <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a>", msg-&gt;name());
00164     <span class="keywordtype">int</span> pauseUnits = etherctrl-&gt;getPauseUnits();
00165     delete etherctrl;
00166 
00167     EV &lt;&lt; "Creating and sending PAUSE frame, with duration=" &lt;&lt; pauseUnits &lt;&lt; " units\n";
00168 
00169     <span class="comment">// create Ethernet frame</span>
00170     <span class="keywordtype">char</span> framename[30];
00171     sprintf(framename, "pause-%d-%d", <span class="keywordtype">id</span>(), seqNum++);
00172     <a class="code" href="class_ether_pause_frame.html">EtherPauseFrame</a> *frame = new <a class="code" href="class_ether_pause_frame.html">EtherPauseFrame</a>(framename, ETH_PAUSE);
00173     frame-&gt;setPauseTime(pauseUnits);
00174 
00175     frame-&gt;setByteLength(ETHER_MAC_FRAME_BYTES+ETHER_PAUSE_COMMAND_BYTES);
00176     if (frame-&gt;byteLength() &lt; MIN_ETHERNET_FRAME)
00177         frame-&gt;setByteLength(MIN_ETHERNET_FRAME);
00178 
00179     send(frame, "lowerLayerOut");
00180     delete msg;
00181 
00182     totalPauseSent++;
00183 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="EtherEncap::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherEncap::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00062 {
00063     <a class="code" href="class_ether_encap.html#p0">seqNum</a> = 0;
00064     WATCH(seqNum);
00065 
00066     <a class="code" href="class_ether_encap.html#p1">totalFromHigherLayer</a> = <a class="code" href="class_ether_encap.html#p2">totalFromMAC</a> = <a class="code" href="class_ether_encap.html#p3">totalPauseSent</a> = 0;
00067     WATCH(totalFromHigherLayer);
00068     WATCH(totalFromMAC);
00069     WATCH(totalPauseSent);
00070 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="EtherEncap::processFrameFromMAC"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherEncap::processFrameFromMAC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_ether_frame.html">EtherFrame</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00139 {
00140     <a class="code" href="class_ether_encap.html#p2">totalFromMAC</a>++;
00141 
00142     <span class="comment">// decapsulate and attach control info</span>
00143     cMessage *higherlayermsg = frame-&gt;decapsulate();
00144 
00145     <span class="comment">// add Ieee802Ctrl to packet</span>
00146     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *etherctrl = <span class="keyword">new</span> <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a>();
00147     etherctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a8">setSrc</a>(frame-&gt;<a class="code" href="class_ether_frame.html#a10">getSrc</a>());
00148     etherctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a11">setDest</a>(frame-&gt;<a class="code" href="class_ether_frame.html#a7">getDest</a>());
00149     higherlayermsg-&gt;setControlInfo(etherctrl);
00150 
00151     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Decapsulating frame `"</span> &lt;&lt; frame-&gt;name() &lt;&lt;<span class="stringliteral">"', passing up contained "</span>
00152           <span class="stringliteral">"packet `"</span> &lt;&lt; higherlayermsg-&gt;name() &lt;&lt; <span class="stringliteral">"' to higher layer\n"</span>;
00153 
00154     <span class="comment">// pass up to higher layers.</span>
00155     send(higherlayermsg, <span class="stringliteral">"upperLayerOut"</span>);
00156     <span class="keyword">delete</span> frame;
00157 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="EtherEncap::processPacketFromHigherLayer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherEncap::processPacketFromHigherLayer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00110 {
00111     <span class="keywordflow">if</span> (msg-&gt;byteLength() &gt; <a class="code" href="_ethernet_8h.html#a2">MAX_ETHERNET_DATA</a>)
00112         error(<span class="stringliteral">"packet from higher layer (%d bytes) exceeds maximum Ethernet payload length (%d)"</span>, msg-&gt;byteLength(), <a class="code" href="_ethernet_8h.html#a2">MAX_ETHERNET_DATA</a>);
00113 
00114     <a class="code" href="class_ether_encap.html#p1">totalFromHigherLayer</a>++;
00115 
00116     <span class="comment">// Creates MAC header information and encapsulates received higher layer data</span>
00117     <span class="comment">// with this information and transmits resultant frame to lower layer</span>
00118 
00119     <span class="comment">// create Ethernet frame, fill it in from Ieee802Ctrl and encapsulate msg in it</span>
00120     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Encapsulating higher layer packet `"</span> &lt;&lt; msg-&gt;name() &lt;&lt;<span class="stringliteral">"' for MAC\n"</span>;
00121 
00122     <a class="code" href="class_ieee802_ctrl.html">Ieee802Ctrl</a> *etherctrl = check_and_cast&lt;Ieee802Ctrl*&gt;(msg-&gt;removeControlInfo());
00123     <a class="code" href="class_ethernet_i_i_frame.html">EthernetIIFrame</a> *frame = <span class="keyword">new</span> <a class="code" href="class_ethernet_i_i_frame.html">EthernetIIFrame</a>(msg-&gt;name(), <a class="code" href="_ether_frame__m_8h.html#a2">ETH_FRAME</a>);
00124 
00125     frame-&gt;<a class="code" href="class_ether_frame.html#a12">setSrc</a>(etherctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a6">getSrc</a>());  <span class="comment">// if blank, will be filled in by MAC</span>
00126     frame-&gt;<a class="code" href="class_ether_frame.html#a9">setDest</a>(etherctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a9">getDest</a>());
00127     frame-&gt;<a class="code" href="class_ethernet_i_i_frame.html#a8">setEtherType</a>(etherctrl-&gt;<a class="code" href="class_ieee802_ctrl.html#a12">getEtherType</a>());
00128     frame-&gt;setByteLength(ETHER_MAC_FRAME_BYTES);
00129     <span class="keyword">delete</span> etherctrl;
00130 
00131     frame-&gt;encapsulate(msg);
00132     <span class="keywordflow">if</span> (frame-&gt;byteLength() &lt; <a class="code" href="_ethernet_8h.html#a4">MIN_ETHERNET_FRAME</a>)
00133         frame-&gt;setByteLength(MIN_ETHERNET_FRAME);  <span class="comment">// "padding"</span>
00134 
00135     send(frame, <span class="stringliteral">"lowerLayerOut"</span>);
00136 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="EtherEncap::updateDisplayString"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void EtherEncap::updateDisplayString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00103 {
00104     <span class="keywordtype">char</span> buf[80];
00105     sprintf(buf, <span class="stringliteral">"passed up: %ld\nsent: %ld"</span>, totalFromMAC, totalFromHigherLayer);
00106     displayString().setTagArg(<span class="stringliteral">"t"</span>,0,buf);
00107 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p0" doxytag="EtherEncap::seqNum"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="class_ether_encap.html#p0">EtherEncap::seqNum</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="EtherEncap::totalFromHigherLayer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ether_encap.html#p1">EtherEncap::totalFromHigherLayer</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="EtherEncap::totalFromMAC"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ether_encap.html#p2">EtherEncap::totalFromMAC</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="EtherEncap::totalPauseSent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">long <a class="el" href="class_ether_encap.html#p3">EtherEncap::totalPauseSent</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="_ether_encap_8cc.html">EtherEncap.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:21 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
