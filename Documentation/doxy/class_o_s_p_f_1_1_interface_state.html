<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: OSPF::InterfaceState Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="namespace_o_s_p_f.html">OSPF</a>::<a class="el" href="class_o_s_p_f_1_1_interface_state.html">InterfaceState</a></div>
<h1>OSPF::InterfaceState Class Reference</h1><code>#include &lt;OSPFInterfaceState.h&gt;</code>
<p>
<p>Inheritance diagram for OSPF::InterfaceState:
<p><center><img src="class_o_s_p_f_1_1_interface_state.png" usemap="#OSPF::InterfaceState_map" border="0" alt=""></center>
<map name="OSPF::InterfaceState_map">
<area href="class_o_s_p_f_1_1_interface_state_backup.html" alt="OSPF::InterfaceStateBackup" shape="rect" coords="0,56,249,80">
<area href="class_o_s_p_f_1_1_interface_state_designated_router.html" alt="OSPF::InterfaceStateDesignatedRouter" shape="rect" coords="259,56,508,80">
<area href="class_o_s_p_f_1_1_interface_state_down.html" alt="OSPF::InterfaceStateDown" shape="rect" coords="518,56,767,80">
<area href="class_o_s_p_f_1_1_interface_state_loopback.html" alt="OSPF::InterfaceStateLoopback" shape="rect" coords="777,56,1026,80">
<area href="class_o_s_p_f_1_1_interface_state_not_designated_router.html" alt="OSPF::InterfaceStateNotDesignatedRouter" shape="rect" coords="1036,56,1285,80">
<area href="class_o_s_p_f_1_1_interface_state_point_to_point.html" alt="OSPF::InterfaceStatePointToPoint" shape="rect" coords="1295,56,1544,80">
<area href="class_o_s_p_f_1_1_interface_state_waiting.html" alt="OSPF::InterfaceStateWaiting" shape="rect" coords="1554,56,1803,80">
</map>
<a href="class_o_s_p_f_1_1_interface_state-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#a0">~InterfaceState</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#a1">ProcessEvent</a> (<a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf, <a class="el" href="class_o_s_p_f_1_1_interface.html#w22">Interface::InterfaceEventType</a> event)=0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual <a class="el" href="class_o_s_p_f_1_1_interface.html#w24">Interface::InterfaceStateType</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#a2">GetState</a> (void) const =0</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (<a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf, <a class="el" href="class_o_s_p_f_1_1_interface_state.html">InterfaceState</a> *newState, <a class="el" href="class_o_s_p_f_1_1_interface_state.html">InterfaceState</a> *currentState)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_s_p_f_1_1_interface_state.html#b1">CalculateDesignatedRouter</a> (<a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *intf)</td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="OSPF::InterfaceState::~InterfaceState"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual OSPF::InterfaceState::~<a class="el" href="class_o_s_p_f_1_1_interface_state.html">InterfaceState</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00014 {}
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b1" doxytag="OSPF::InterfaceState::CalculateDesignatedRouter"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void OSPF::InterfaceState::CalculateDesignatedRouter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>intf</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00098 {
00099     OSPF::RouterID           routerID                = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r27">parentArea</a>-&gt;GetRouter ()-&gt;GetRouterID ();
00100     <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> currentDesignatedRouter = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r20">designatedRouter</a>;
00101     <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> currentBackupRouter     = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r21">backupDesignatedRouter</a>;
00102 
00103     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>             neighborCount           = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r18">neighboringRouters</a>.size ();
00104     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            repeatCount             = 0;
00105     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>             i;
00106 
00107     <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> declaredBackup;
00108     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            declaredBackupPriority;
00109     OSPF::RouterID           declaredBackupID;
00110     <span class="keywordtype">bool</span>                     backupDeclared;
00111 
00112     <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> declaredDesignatedRouter;
00113     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            declaredDesignatedRouterPriority;
00114     OSPF::RouterID           declaredDesignatedRouterID;
00115     <span class="keywordtype">bool</span>                     designatedRouterDeclared;
00116 
00117     <span class="keywordflow">do</span> {
00118         <span class="comment">// calculating backup designated router</span>
00119         declaredBackup = OSPF::NullDesignatedRouterID;
00120         declaredBackupPriority = 0;
00121         declaredBackupID = OSPF::NullRouterID;
00122         backupDeclared = <span class="keyword">false</span>;
00123 
00124         <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> highestRouter                 = OSPF::NullDesignatedRouterID;
00125         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            highestPriority               = 0;
00126         OSPF::RouterID           highestID                     = OSPF::NullRouterID;
00127 
00128         <span class="keywordflow">for</span> (i = 0; i &lt; neighborCount; i++) {
00129             <a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* neighbor         = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r18">neighboringRouters</a>[i];
00130             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   neighborPriority = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a32">GetPriority</a> ();
00131 
00132             <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a5">GetState</a> () &lt; <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w20">OSPF::Neighbor::TwoWayState</a>) {
00133                 <span class="keywordflow">continue</span>;
00134             }
00135             <span class="keywordflow">if</span> (neighborPriority == 0) {
00136                 <span class="keywordflow">continue</span>;
00137             }
00138 
00139             OSPF::RouterID           neighborID                      = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a30">GetNeighborID</a> ();
00140             <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> neighborsDesignatedRouter       = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a36">GetDesignatedRouter</a> ();
00141             <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> neighborsBackupDesignatedRouter = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a38">GetBackupDesignatedRouter</a> ();
00142 
00143             <span class="keywordflow">if</span> (neighborsDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != neighborID) {
00144                 <span class="keywordflow">if</span> (neighborsBackupDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == neighborID) {
00145                     <span class="keywordflow">if</span> ((neighborPriority &gt; declaredBackupPriority) ||
00146                         ((neighborPriority == declaredBackupPriority) &amp;&amp;
00147                          (neighborID &gt; declaredBackupID)))
00148                     {
00149                         declaredBackup = neighborsBackupDesignatedRouter;
00150                         declaredBackupPriority = neighborPriority;
00151                         declaredBackupID = neighborID;
00152                         backupDeclared = <span class="keyword">true</span>;
00153                     }
00154                 }
00155                 <span class="keywordflow">if</span> (!backupDeclared) {
00156                     <span class="keywordflow">if</span> ((neighborPriority &gt; highestPriority) ||
00157                         ((neighborPriority == highestPriority) &amp;&amp;
00158                          (neighborID &gt; highestID)))
00159                     {
00160                         highestRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> = neighborID;
00161                         highestRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o1">ipInterfaceAddress</a> = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a34">GetAddress</a> ();
00162                         highestPriority = neighborPriority;
00163                         highestID = neighborID;
00164                     }
00165                 }
00166             }
00167         }
00168         <span class="comment">// also include the router itself in the calculations</span>
00169         <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a> &gt; 0) {
00170             <span class="keywordflow">if</span> (currentDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != routerID) {
00171                 <span class="keywordflow">if</span> (currentBackupRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == routerID) {
00172                     <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a> &gt; declaredBackupPriority) ||
00173                         ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a> == declaredBackupPriority) &amp;&amp;
00174                          (routerID &gt; declaredBackupID)))
00175                     {
00176                         declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> = routerID;
00177                         declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o1">ipInterfaceAddress</a> = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r5">interfaceAddressRange</a>.address;
00178                         declaredBackupPriority = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a>;
00179                         declaredBackupID = routerID;
00180                         backupDeclared = <span class="keyword">true</span>;
00181                     }
00182 
00183                 }
00184                 <span class="keywordflow">if</span> (!backupDeclared) {
00185                     <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a> &gt; highestPriority) ||
00186                         ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a> == highestPriority) &amp;&amp;
00187                          (routerID &gt; highestID)))
00188                     {
00189                         declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> = routerID;
00190                         declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o1">ipInterfaceAddress</a> = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r5">interfaceAddressRange</a>.address;
00191                         declaredBackupPriority = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a>;
00192                         declaredBackupID = routerID;
00193                         backupDeclared = <span class="keyword">true</span>;
00194                     } <span class="keywordflow">else</span> {
00195                         declaredBackup = highestRouter;
00196                         declaredBackupPriority = highestPriority;
00197                         declaredBackupID = highestID;
00198                         backupDeclared = <span class="keyword">true</span>;
00199                     }
00200                 }
00201             }
00202         }
00203 
00204         <span class="comment">// calculating backup designated router</span>
00205         declaredDesignatedRouter = OSPF::NullDesignatedRouterID;
00206         declaredDesignatedRouterPriority = 0;
00207         declaredDesignatedRouterID = OSPF::NullRouterID;
00208         designatedRouterDeclared = <span class="keyword">false</span>;
00209 
00210         <span class="keywordflow">for</span> (i = 0; i &lt; neighborCount; i++) {
00211             <a class="code" href="class_o_s_p_f_1_1_neighbor.html">OSPF::Neighbor</a>* neighbor         = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r18">neighboringRouters</a>[i];
00212             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   neighborPriority = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a32">GetPriority</a> ();
00213 
00214             <span class="keywordflow">if</span> (neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a5">GetState</a> () &lt; <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w20">OSPF::Neighbor::TwoWayState</a>) {
00215                 <span class="keywordflow">continue</span>;
00216             }
00217             <span class="keywordflow">if</span> (neighborPriority == 0) {
00218                 <span class="keywordflow">continue</span>;
00219             }
00220 
00221             OSPF::RouterID           neighborID                      = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a30">GetNeighborID</a> ();
00222             <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> neighborsDesignatedRouter       = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a36">GetDesignatedRouter</a> ();
00223             <a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html">OSPF::DesignatedRouterID</a> neighborsBackupDesignatedRouter = neighbor-&gt;<a class="code" href="class_o_s_p_f_1_1_neighbor.html#a38">GetBackupDesignatedRouter</a> ();
00224 
00225             <span class="keywordflow">if</span> (neighborsDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == neighborID) {
00226                 <span class="keywordflow">if</span> ((neighborPriority &gt; declaredDesignatedRouterPriority) ||
00227                     ((neighborPriority == declaredDesignatedRouterPriority) &amp;&amp;
00228                      (neighborID &gt; declaredDesignatedRouterID)))
00229                 {
00230                     declaredDesignatedRouter = neighborsDesignatedRouter;
00231                     declaredDesignatedRouterPriority = neighborPriority;
00232                     declaredDesignatedRouterID = neighborID;
00233                     designatedRouterDeclared = <span class="keyword">true</span>;
00234                 }
00235             }
00236         }
00237         <span class="comment">// also include the router itself in the calculations</span>
00238         <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a> &gt; 0) {
00239             <span class="keywordflow">if</span> (currentDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == routerID) {
00240                 <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a> &gt; declaredDesignatedRouterPriority) ||
00241                     ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a> == declaredDesignatedRouterPriority) &amp;&amp;
00242                      (routerID &gt; declaredDesignatedRouterID)))
00243                 {
00244                     declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> = routerID;
00245                     declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o1">ipInterfaceAddress</a> = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r5">interfaceAddressRange</a>.address;
00246                     declaredDesignatedRouterPriority = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r12">routerPriority</a>;
00247                     declaredDesignatedRouterID = routerID;
00248                     designatedRouterDeclared = <span class="keyword">true</span>;
00249                 }
00250 
00251             }
00252         }
00253         <span class="keywordflow">if</span> (!designatedRouterDeclared) {
00254             declaredDesignatedRouter = declaredBackup;
00255             declaredDesignatedRouterPriority = declaredBackupPriority;
00256             declaredDesignatedRouterID = declaredBackupID;
00257             designatedRouterDeclared = <span class="keyword">true</span>;
00258         }
00259 
00260         <span class="comment">// if the router is any kind of DR or is no longer one of them, then repeat</span>
00261         <span class="keywordflow">if</span> (((declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != OSPF::NullRouterID) &amp;&amp;
00262              ((currentDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == routerID) &amp;&amp;
00263               (declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != routerID)) ||
00264              ((currentDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != routerID) &amp;&amp;
00265               (declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == routerID))) ||
00266             ((declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != OSPF::NullRouterID) &amp;&amp;
00267              ((currentBackupRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == routerID) &amp;&amp;
00268               (declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != routerID)) ||
00269              ((currentBackupRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != routerID) &amp;&amp;
00270               (declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == routerID))))
00271         {
00272             currentDesignatedRouter = declaredDesignatedRouter;
00273             currentBackupRouter = declaredBackup;
00274             repeatCount++;
00275         } <span class="keywordflow">else</span> {
00276             repeatCount += 2;
00277         }
00278 
00279     } <span class="keywordflow">while</span> (repeatCount &lt; 2);
00280 
00281     OSPF::RouterID routersOldDesignatedRouterID = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r20">designatedRouter</a>.routerID;
00282     OSPF::RouterID routersOldBackupID           = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r21">backupDesignatedRouter</a>.routerID;
00283 
00284     intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r20">designatedRouter</a> = declaredDesignatedRouter;
00285     intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r21">backupDesignatedRouter</a> = declaredBackup;
00286 
00287     <span class="keywordtype">bool</span> wasBackupDesignatedRouter = (routersOldBackupID == routerID);
00288     <span class="keywordtype">bool</span> wasDesignatedRouter       = (routersOldDesignatedRouterID == routerID);
00289     <span class="keywordtype">bool</span> wasOther                  = (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a9">GetState</a> () == <a class="code" href="class_o_s_p_f_1_1_interface.html#w24w19">OSPF::Interface::NotDesignatedRouterState</a>);
00290     <span class="keywordtype">bool</span> wasWaiting                = (!wasBackupDesignatedRouter &amp;&amp; !wasDesignatedRouter &amp;&amp; !wasOther);
00291     <span class="keywordtype">bool</span> isBackupDesignatedRouter  = (declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == routerID);
00292     <span class="keywordtype">bool</span> isDesignatedRouter        = (declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> == routerID);
00293     <span class="keywordtype">bool</span> isOther                   = (!isBackupDesignatedRouter &amp;&amp; !isDesignatedRouter);
00294 
00295     <span class="keywordflow">if</span> (wasBackupDesignatedRouter) {
00296         <span class="keywordflow">if</span> (isDesignatedRouter) {
00297             <a class="code" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_designated_router.html">OSPF::InterfaceStateDesignatedRouter</a>, <span class="keyword">this</span>);
00298         }
00299         <span class="keywordflow">if</span> (isOther) {
00300             <a class="code" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_not_designated_router.html">OSPF::InterfaceStateNotDesignatedRouter</a>, <span class="keyword">this</span>);
00301         }
00302     }
00303     <span class="keywordflow">if</span> (wasDesignatedRouter) {
00304         <span class="keywordflow">if</span> (isBackupDesignatedRouter) {
00305             <a class="code" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_backup.html">OSPF::InterfaceStateBackup</a>, <span class="keyword">this</span>);
00306         }
00307         <span class="keywordflow">if</span> (isOther) {
00308             <a class="code" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_not_designated_router.html">OSPF::InterfaceStateNotDesignatedRouter</a>, <span class="keyword">this</span>);
00309         }
00310     }
00311     <span class="keywordflow">if</span> (wasOther) {
00312         <span class="keywordflow">if</span> (isDesignatedRouter) {
00313             <a class="code" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_designated_router.html">OSPF::InterfaceStateDesignatedRouter</a>, <span class="keyword">this</span>);
00314         }
00315         <span class="keywordflow">if</span> (isBackupDesignatedRouter) {
00316             <a class="code" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_backup.html">OSPF::InterfaceStateBackup</a>, <span class="keyword">this</span>);
00317         }
00318     }
00319     <span class="keywordflow">if</span> (wasWaiting) {
00320         <span class="keywordflow">if</span> (isDesignatedRouter) {
00321             <a class="code" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_designated_router.html">OSPF::InterfaceStateDesignatedRouter</a>, <span class="keyword">this</span>);
00322         }
00323         <span class="keywordflow">if</span> (isBackupDesignatedRouter) {
00324             <a class="code" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_backup.html">OSPF::InterfaceStateBackup</a>, <span class="keyword">this</span>);
00325         }
00326         <span class="keywordflow">if</span> (isOther) {
00327             <a class="code" href="class_o_s_p_f_1_1_interface_state.html#b0">ChangeState</a> (intf, <span class="keyword">new</span> <a class="code" href="class_o_s_p_f_1_1_interface_state_not_designated_router.html">OSPF::InterfaceStateNotDesignatedRouter</a>, <span class="keyword">this</span>);
00328         }
00329     }
00330 
00331     <span class="keywordflow">for</span> (i = 0; i &lt; neighborCount; i++) {
00332         <span class="keywordflow">if</span> ((intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r0">interfaceType</a> == OSPF::Interface::NBMA) &amp;&amp;
00333             ((!wasBackupDesignatedRouter &amp;&amp; isBackupDesignatedRouter) ||
00334              (!wasDesignatedRouter &amp;&amp; isDesignatedRouter)))
00335         {
00336             <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r18">neighboringRouters</a>[i]-&gt;GetPriority () == 0) {
00337                 intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r18">neighboringRouters</a>[i]-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a2">ProcessEvent</a> (OSPF::Neighbor::Start);
00338             }
00339         }
00340         <span class="keywordflow">if</span> ((declaredDesignatedRouter.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != routersOldDesignatedRouterID) ||
00341             (declaredBackup.<a class="code" href="struct_o_s_p_f_1_1_designated_router_i_d.html#o0">routerID</a> != routersOldBackupID))
00342         {
00343             <span class="keywordflow">if</span> (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r18">neighboringRouters</a>[i]-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a9">GetState</a> () &gt;= <a class="code" href="class_o_s_p_f_1_1_neighbor.html#w28w20">OSPF::Neighbor::TwoWayState</a>) {
00344                 intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#r18">neighboringRouters</a>[i]-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a2">ProcessEvent</a> (OSPF::Neighbor::IsAdjacencyOK);
00345             }
00346         }
00347     }
00348 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="OSPF::InterfaceState::ChangeState"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void OSPF::InterfaceState::ChangeState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>intf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_interface_state.html">InterfaceState</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>newState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_interface_state.html">InterfaceState</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>currentState</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00011 {
00012     <a class="code" href="class_o_s_p_f_1_1_interface.html#w24">OSPF::Interface::InterfaceStateType</a> oldState            = currentState-&gt;<a class="code" href="class_o_s_p_f_1_1_interface_state.html#a2">GetState</a> ();
00013     <a class="code" href="class_o_s_p_f_1_1_interface.html#w24">OSPF::Interface::InterfaceStateType</a> nextState           = newState-&gt;<a class="code" href="class_o_s_p_f_1_1_interface_state.html#a2">GetState</a> ();
00014     <a class="code" href="class_o_s_p_f_1_1_interface.html#w23">OSPF::Interface::OSPFInterfaceType</a>  intfType            = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a19">GetType</a> ();
00015     <span class="keywordtype">bool</span>                                rebuildRoutingTable = <span class="keyword">false</span>;
00016 
00017     intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#d0">ChangeState</a> (newState, currentState);
00018 
00019     <span class="keywordflow">if</span> ((oldState == OSPF::Interface::DownState) ||
00020         (nextState == OSPF::Interface::DownState) ||
00021         (oldState == OSPF::Interface::LoopbackState) ||
00022         (nextState == OSPF::Interface::LoopbackState) ||
00023         (oldState == OSPF::Interface::DesignatedRouterState) ||
00024         (nextState == OSPF::Interface::DesignatedRouterState) ||
00025         ((intfType == OSPF::Interface::PointToPoint) &amp;&amp;
00026          ((oldState == OSPF::Interface::PointToPointState) ||
00027           (nextState == OSPF::Interface::PointToPointState))) ||
00028         (((intfType == OSPF::Interface::Broadcast) ||
00029           (intfType == OSPF::Interface::NBMA)) &amp;&amp;
00030          ((oldState == OSPF::Interface::WaitingState) ||
00031           (nextState == OSPF::Interface::WaitingState))))
00032     {
00033         <a class="code" href="class_o_s_p_f_1_1_router_l_s_a.html">OSPF::RouterLSA</a>* routerLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;FindRouterLSA (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;GetRouter ()-&gt;GetRouterID ());
00034 
00035         <span class="keywordflow">if</span> (routerLSA != NULL) {
00036             <span class="keywordtype">long</span> sequenceNumber = routerLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a18">getLsSequenceNumber</a> ();
00037             <span class="keywordflow">if</span> (sequenceNumber == MAX_SEQUENCE_NUMBER) {
00038                 routerLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a7">setLsAge</a> (MAX_AGE);
00039                 intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a13">FloodLSA</a> (routerLSA);
00040                 routerLSA-&gt;<a class="code" href="class_o_s_p_f_1_1_l_s_a_tracking_info.html#a4">IncrementInstallTime</a> ();
00041             } <span class="keywordflow">else</span> {
00042                 <a class="code" href="class_o_s_p_f_1_1_router_l_s_a.html">OSPF::RouterLSA</a>* newLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;OriginateRouterLSA ();
00043 
00044                 newLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a19">setLsSequenceNumber</a> (sequenceNumber + 1);
00045                 newLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a21">setLsChecksum</a> (0);    <span class="comment">// TODO: calculate correct LS checksum</span>
00046                 rebuildRoutingTable |= routerLSA-&gt;<a class="code" href="class_o_s_p_f_1_1_router_l_s_a.html#a5">Update</a> (newLSA);
00047                 <span class="keyword">delete</span> newLSA;
00048 
00049                 intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a13">FloodLSA</a> (routerLSA);
00050             }
00051         } <span class="keywordflow">else</span> {  <span class="comment">// (lsa == NULL) -&gt; This must be the first time any interface is up...</span>
00052             <a class="code" href="class_o_s_p_f_1_1_router_l_s_a.html">OSPF::RouterLSA</a>* newLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;OriginateRouterLSA ();
00053 
00054             rebuildRoutingTable |= intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;InstallRouterLSA (newLSA);
00055 
00056             routerLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;FindRouterLSA (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;GetRouter ()-&gt;GetRouterID ());
00057 
00058             intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;SetSPFTreeRoot (routerLSA);
00059             intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a13">FloodLSA</a> (newLSA);
00060             <span class="keyword">delete</span> newLSA;
00061         }
00062     }
00063 
00064     <span class="keywordflow">if</span> (nextState == OSPF::Interface::DesignatedRouterState) {
00065         <a class="code" href="class_o_s_p_f_1_1_network_l_s_a.html">OSPF::NetworkLSA</a>* newLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;OriginateNetworkLSA (intf);
00066         <span class="keywordflow">if</span> (newLSA != NULL) {
00067             rebuildRoutingTable |= intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;InstallNetworkLSA (newLSA);
00068 
00069             intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a13">FloodLSA</a> (newLSA);
00070             <span class="keyword">delete</span> newLSA;
00071         } <span class="keywordflow">else</span> {    <span class="comment">// no neighbors on the network -&gt; old NetworkLSA must be flushed</span>
00072             <a class="code" href="class_o_s_p_f_1_1_network_l_s_a.html">OSPF::NetworkLSA</a>* oldLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;FindNetworkLSA (ULongFromIPv4Address (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a49">GetAddressRange</a> ().address));
00073 
00074             <span class="keywordflow">if</span> (oldLSA != NULL) {
00075                 oldLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a7">setLsAge</a> (MAX_AGE);
00076                 intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a13">FloodLSA</a> (oldLSA);
00077                 oldLSA-&gt;<a class="code" href="class_o_s_p_f_1_1_l_s_a_tracking_info.html#a4">IncrementInstallTime</a> ();
00078             }
00079         }
00080     }
00081 
00082     <span class="keywordflow">if</span> (oldState == OSPF::Interface::DesignatedRouterState) {
00083         <a class="code" href="class_o_s_p_f_1_1_network_l_s_a.html">OSPF::NetworkLSA</a>* networkLSA = intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;FindNetworkLSA (ULongFromIPv4Address (intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a49">GetAddressRange</a> ().address));
00084 
00085         <span class="keywordflow">if</span> (networkLSA != NULL) {
00086             networkLSA-&gt;<a class="code" href="class_o_s_p_f_l_s_a.html#a6">getHeader</a> ().<a class="code" href="class_o_s_p_f_l_s_a_header.html#a7">setLsAge</a> (MAX_AGE);
00087             intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a13">FloodLSA</a> (networkLSA);
00088             networkLSA-&gt;<a class="code" href="class_o_s_p_f_1_1_l_s_a_tracking_info.html#a4">IncrementInstallTime</a> ();
00089         }
00090     }
00091 
00092     <span class="keywordflow">if</span> (rebuildRoutingTable) {
00093         intf-&gt;<a class="code" href="class_o_s_p_f_1_1_interface.html#a59">GetArea</a> ()-&gt;GetRouter ()-&gt;RebuildRoutingTable ();
00094     }
00095 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="OSPF::InterfaceState::GetState"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual <a class="el" href="class_o_s_p_f_1_1_interface.html#w24">Interface::InterfaceStateType</a> OSPF::InterfaceState::GetState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [pure virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Implemented in <a class="el" href="class_o_s_p_f_1_1_interface_state_backup.html#a1">OSPF::InterfaceStateBackup</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_designated_router.html#a1">OSPF::InterfaceStateDesignatedRouter</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_down.html#a1">OSPF::InterfaceStateDown</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_loopback.html#a1">OSPF::InterfaceStateLoopback</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_not_designated_router.html#a1">OSPF::InterfaceStateNotDesignatedRouter</a>, <a class="el" href="class_o_s_p_f_1_1_interface_state_point_to_point.html#a1">OSPF::InterfaceStatePointToPoint</a>, and <a class="el" href="class_o_s_p_f_1_1_interface_state_waiting.html#a1">OSPF::InterfaceStateWaiting</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="OSPF::InterfaceState::ProcessEvent"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual void OSPF::InterfaceState::ProcessEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_o_s_p_f_1_1_interface.html">Interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>intf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_o_s_p_f_1_1_interface.html#w22">Interface::InterfaceEventType</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [pure virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_o_s_p_f_interface_state_8h.html">OSPFInterfaceState.h</a><li><a class="el" href="_o_s_p_f_interface_state_8cc.html">OSPFInterfaceState.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:32 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
