<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: LinkStateRouting Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>LinkStateRouting Class Reference</h1><code>#include &lt;LinkStateRouting.h&gt;</code>
<p>
<p>Inheritance diagram for LinkStateRouting:
<p><center><img src="class_link_state_routing.png" usemap="#LinkStateRouting_map" border="0" alt=""></center>
<map name="LinkStateRouting_map">
<area href="class_i_notifiable.html" alt="INotifiable" shape="rect" coords="0,0,105,24">
</map>
<a href="class_link_state_routing-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Implements a minimalistic link state routing protocol that employs flooding. Flooding works like this:<p>
When a router receives a link state packet, it merges the packet contents into its own link state database (ted). If the packet contained new information (ted got updated), the router broadcasts the ted contents to all its other neighbours; otherwise (when the packet didn't contain any new info), nothing happens.<p>
Also: when the announceMsg timer expires, LinkStateRouting sends out an initial link state message. (Currently this happens only once, at the beginning of the simulation). The "request" bit in the message is set then, asking neighbours to send back their link state databases. (FIXME why's this? redundant messaging: same msg is often sent twice: both as reply and as voluntary "announce").<p>
TODO discover peers by "hello". Peers are those from which the router has received a Hello in the last X seconds. <a class="el" href="class_link.html">Link</a> info to all peers are maintained; links to ex-peers (those haven't heard of for more than X seconds) are assumed to be down.<p>
See NED file for more info. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#a0">LinkStateRouting</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#a1">~LinkStateRouting</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#b0">initialize</a> (int stage)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#b1">numInitStages</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#b2">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#b3">processLINK_STATE_MESSAGE</a> (<a class="el" href="class_link_state_msg.html">LinkStateMsg</a> *msg, <a class="el" href="class_i_p_address.html">IPAddress</a> sender)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#b4">receiveChangeNotification</a> (int category, cPolymorphic *details)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#b5">sendToPeers</a> (const std::vector&lt; <a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> &gt; &amp;list, bool req, <a class="el" href="class_i_p_address.html">IPAddress</a> exceptPeer)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#b6">sendToPeer</a> (<a class="el" href="class_i_p_address.html">IPAddress</a> peer, const std::vector&lt; <a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> &gt; &amp;list, bool req)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#b7">sendToIP</a> (<a class="el" href="class_link_state_msg.html">LinkStateMsg</a> *msg, <a class="el" href="class_i_p_address.html">IPAddress</a> destAddr)</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_t_e_d.html">TED</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#p0">tedmod</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#p1">announceMsg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#p2">routerId</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_link_state_routing.html#p3">peerIfAddrs</a></td></tr>

</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="LinkStateRouting::LinkStateRouting"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">LinkStateRouting::LinkStateRouting           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00031 {
00032     <a class="code" href="class_link_state_routing.html#p1">announceMsg</a> = NULL;
00033 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="LinkStateRouting::~LinkStateRouting"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">LinkStateRouting::~<a class="el" href="class_link_state_routing.html">LinkStateRouting</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00036 {
00037     cancelAndDelete(announceMsg);
00038 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b2" doxytag="LinkStateRouting::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LinkStateRouting::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00072 {
00073     <span class="keywordflow">if</span> (msg == announceMsg)
00074     {
00075         <span class="keyword">delete</span> <a class="code" href="class_link_state_routing.html#p1">announceMsg</a>;
00076         <a class="code" href="class_link_state_routing.html#p1">announceMsg</a> = NULL;
00077         <a class="code" href="class_link_state_routing.html#b5">sendToPeers</a>(<a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>, <span class="keyword">true</span>, <a class="code" href="class_i_p_address.html">IPAddress</a>());
00078     }
00079     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(msg-&gt;arrivalGate()-&gt;name(), <span class="stringliteral">"from_ip"</span>))
00080     {
00081         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Processing message from IP: "</span> &lt;&lt; msg &lt;&lt; endl;
00082         <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = check_and_cast&lt;IPControlInfo *&gt;(msg-&gt;controlInfo());
00083         <a class="code" href="class_i_p_address.html">IPAddress</a> sender = controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a6">srcAddr</a>();
00084         <a class="code" href="class_link_state_routing.html#b3">processLINK_STATE_MESSAGE</a>(check_and_cast&lt;LinkStateMsg*&gt;(msg), sender);
00085     }
00086     <span class="keywordflow">else</span>
00087         ASSERT(<span class="keyword">false</span>);
00088 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="LinkStateRouting::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LinkStateRouting::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stage</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00041 {
00042     <span class="comment">// we have to wait until routerId gets assigned in stage 3</span>
00043     <span class="keywordflow">if</span> (stage==4)
00044     {
00045         <a class="code" href="class_link_state_routing.html#p0">tedmod</a> = <a class="code" href="class_t_e_d_access.html">TEDAccess</a>().get();
00046 
00047         <a class="code" href="class_routing_table.html">RoutingTable</a> *rt = <a class="code" href="class_routing_table_access.html">RoutingTableAccess</a>().get();
00048         <a class="code" href="class_link_state_routing.html#p2">routerId</a> = rt-&gt;<a class="code" href="class_routing_table.html#a4">routerId</a>();
00049 
00050         <span class="comment">// listen for TED modifications</span>
00051         <a class="code" href="class_notification_board.html">NotificationBoard</a> *nb = <a class="code" href="class_notification_board_access.html">NotificationBoardAccess</a>().get();
00052         nb-&gt;<a class="code" href="class_notification_board.html#z22_0">subscribe</a>(<span class="keyword">this</span>, NF_TED_CHANGED);
00053 
00054         <span class="comment">// peers are given as interface names in the "peers" module parameter;</span>
00055         <span class="comment">// store corresponding interface addresses in peerIfAddrs[]</span>
00056         cStringTokenizer tokenizer(par(<span class="stringliteral">"peers"</span>));
00057         <a class="code" href="class_interface_table.html">InterfaceTable</a> *ift = <a class="code" href="class_interface_table_access.html">InterfaceTableAccess</a>().get();
00058         <span class="keyword">const</span> <span class="keywordtype">char</span> *token;
00059         <span class="keywordflow">while</span> ((token = tokenizer.nextToken())!=NULL)
00060         {
00061             ASSERT(ift-&gt;<a class="code" href="class_interface_table.html#a9">interfaceByName</a>(token));
00062             <a class="code" href="class_link_state_routing.html#p3">peerIfAddrs</a>.push_back(ift-&gt;<a class="code" href="class_interface_table.html#a9">interfaceByName</a>(token)-&gt;<a class="code" href="class_interface_entry.html#a33">ipv4</a>()-&gt;<a class="code" href="class_i_pv4_interface_data.html#a4">inetAddress</a>());
00063         }
00064 
00065         <span class="comment">// schedule start of flooding link state info</span>
00066         <a class="code" href="class_link_state_routing.html#p1">announceMsg</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">"announce"</span>);
00067         scheduleAt(simTime() + exponential(0.01), announceMsg);
00068     }
00069 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="LinkStateRouting::numInitStages"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual int LinkStateRouting::numInitStages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00071 {<span class="keywordflow">return</span> 5;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="LinkStateRouting::processLINK_STATE_MESSAGE"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LinkStateRouting::processLINK_STATE_MESSAGE           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_link_state_msg.html">LinkStateMsg</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>sender</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00119 {
00120     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"received LINK_STATE message from "</span> &lt;&lt; sender &lt;&lt; endl;
00121 
00122     <a class="code" href="_t_e_d__m_8h.html#a2">TELinkStateInfoVector</a> forward;
00123 
00124     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n = msg-&gt;<a class="code" href="class_link_state_msg.html#a8">getLinkInfoArraySize</a>();
00125 
00126     <span class="keywordtype">bool</span> change = <span class="keyword">false</span>; <span class="comment">// in topology</span>
00127 
00128     <span class="comment">// loop through every link in the message</span>
00129     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; n; i++)
00130     {
00131         <span class="keyword">const</span> <a class="code" href="struct_t_e_link_state_info.html">TELinkStateInfo</a>&amp; link = msg-&gt;<a class="code" href="class_link_state_msg.html#a9">getLinkInfo</a>(i);
00132 
00133         <a class="code" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> *match;
00134 
00135         <span class="comment">// process link if we haven't seen this already and timestamp is newer</span>
00136         <span class="keywordflow">if</span>(<a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#a2">checkLinkValidity</a>(link, match))
00137         {
00138             ASSERT(link.<a class="code" href="struct_t_e_link_state_info.html#o8">sourceId</a> == link.<a class="code" href="struct_t_e_link_state_info.html#o0">advrouter</a>.<a class="code" href="class_i_p_address.html#a5">getInt</a>());
00139 
00140             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"new information found"</span> &lt;&lt; endl;
00141 
00142             <span class="keywordflow">if</span>(!match)
00143             {
00144                 <span class="comment">// and we have no info on this link so far, store it as it is</span>
00145                 <a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>.push_back(link);
00146                 change = <span class="keyword">true</span>;
00147             }
00148             <span class="keywordflow">else</span>
00149             {
00150                 <span class="comment">// copy over the information from it</span>
00151                 <span class="keywordflow">if</span>(match-&gt;<a class="code" href="struct_t_e_link_state_info.html#o10">state</a> != link.<a class="code" href="struct_t_e_link_state_info.html#o10">state</a>)
00152                 {
00153                     match-&gt;<a class="code" href="struct_t_e_link_state_info.html#o10">state</a> = link.<a class="code" href="struct_t_e_link_state_info.html#o10">state</a>;
00154                     change = <span class="keyword">true</span>;
00155                 }
00156                 match-&gt;<a class="code" href="struct_t_e_link_state_info.html#o9">messageId</a> = link.<a class="code" href="struct_t_e_link_state_info.html#o9">messageId</a>;
00157                 match-&gt;<a class="code" href="struct_t_e_link_state_info.html#o8">sourceId</a> = link.<a class="code" href="struct_t_e_link_state_info.html#o8">sourceId</a>;
00158                 match-&gt;<a class="code" href="struct_t_e_link_state_info.html#o7">timestamp</a> = link.<a class="code" href="struct_t_e_link_state_info.html#o7">timestamp</a>;
00159                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 8; i++)
00160                     match-&gt;<a class="code" href="struct_t_e_link_state_info.html#o6">UnResvBandwidth</a>[i] = link.<a class="code" href="struct_t_e_link_state_info.html#o6">UnResvBandwidth</a>[i];
00161                 match-&gt;<a class="code" href="struct_t_e_link_state_info.html#o5">MaxBandwidth</a> = link.<a class="code" href="struct_t_e_link_state_info.html#o5">MaxBandwidth</a>;
00162                 match-&gt;<a class="code" href="struct_t_e_link_state_info.html#o4">metric</a> = link.<a class="code" href="struct_t_e_link_state_info.html#o4">metric</a>;
00163             }
00164 
00165             forward.push_back(link);
00166         }
00167     }
00168 
00169     <span class="keywordflow">if</span>(change)
00170         <a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#z61_9">rebuildRoutingTable</a>();
00171 
00172     <span class="keywordflow">if</span>(msg-&gt;<a class="code" href="class_link_state_msg.html#a12">getRequest</a>())
00173     {
00174         <a class="code" href="class_link_state_routing.html#b6">sendToPeer</a>(sender, <a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>, <span class="keyword">false</span>);
00175     }
00176 
00177     <span class="keywordflow">if</span>(forward.size() &gt; 0)
00178     {
00179         <a class="code" href="class_link_state_routing.html#b5">sendToPeers</a>(forward, <span class="keyword">false</span>, sender);
00180     }
00181 
00182     <span class="keyword">delete</span> msg;
00183 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="LinkStateRouting::receiveChangeNotification"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LinkStateRouting::receiveChangeNotification           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>category</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>cPolymorphic *&nbsp;</td>
          <td class="mdname" nowrap> <em>details</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Called by the <a class="el" href="class_notification_board.html">NotificationBoard</a> whenever a change of a category occurs to which this client has subscribed. 
<p>
Implements <a class="el" href="class_i_notifiable.html#a1">INotifiable</a>.<div class="fragment"><pre class="fragment">00091 {
00092     Enter_Method_Silent();
00093     <a class="code" href="_notifier_consts_8cc.html#a1">printNotificationBanner</a>(category, details);
00094 
00095     ASSERT(category == NF_TED_CHANGED);
00096 
00097     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"TED changed\n"</span>;
00098 
00099     <a class="code" href="class_t_e_d_change_info.html">TEDChangeInfo</a> *d = check_and_cast&lt;TEDChangeInfo *&gt;(details);
00100 
00101     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k = d-&gt;<a class="code" href="class_t_e_d_change_info.html#a7">getTedLinkIndicesArraySize</a>();
00102 
00103     ASSERT(k &gt; 0);
00104 
00105     <span class="comment">// build linkinfo list</span>
00106     std::vector&lt;TELinkStateInfo&gt; links;
00107     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; k; i++)
00108     {
00109         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = d-&gt;<a class="code" href="class_t_e_d_change_info.html#a8">getTedLinkIndices</a>(i);
00110 
00111         <a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#a3">updateTimestamp</a>(&amp;<a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>[index]);
00112         links.push_back(<a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>[index]);
00113     }
00114 
00115     <a class="code" href="class_link_state_routing.html#b5">sendToPeers</a>(links, <span class="keyword">false</span>, <a class="code" href="class_i_p_address.html">IPAddress</a>());
00116 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="LinkStateRouting::sendToIP"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LinkStateRouting::sendToIP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_link_state_msg.html">LinkStateMsg</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>destAddr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00225 {
00226     <span class="comment">// attach control info to packet</span>
00227     <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
00228     controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a5">setDestAddr</a>(destAddr);
00229     controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a8">setSrcAddr</a>(routerId);
00230     controlInfo-&gt;<a class="code" href="class_i_p_control_info___base.html#a12">setProtocol</a>(IP_PROT_OSPF);
00231     msg-&gt;setControlInfo(controlInfo);
00232 
00233     <span class="keywordtype">int</span> length = msg-&gt;<a class="code" href="class_link_state_msg.html#a8">getLinkInfoArraySize</a>() * 72;
00234     msg-&gt;setByteLength(length);
00235 
00236     msg-&gt;addPar(<span class="stringliteral">"color"</span>) = <a class="code" href="_link_state_routing_8h.html#a0">TED_TRAFFIC</a>;
00237 
00238     send(msg, <span class="stringliteral">"to_ip"</span>);
00239 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="LinkStateRouting::sendToPeer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LinkStateRouting::sendToPeer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>peer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const std::vector&lt; <a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> &gt; &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap> <em>req</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00210 {
00211     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"sending LINK_STATE message to "</span> &lt;&lt; peer &lt;&lt; endl;
00212 
00213     <a class="code" href="class_link_state_msg.html">LinkStateMsg</a> *out = <span class="keyword">new</span> <a class="code" href="class_link_state_msg.html">LinkStateMsg</a>(<span class="stringliteral">"link state"</span>);
00214 
00215     out-&gt;<a class="code" href="class_link_state_msg.html#a7">setLinkInfoArraySize</a>(list.size());
00216     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; list.size(); j++)
00217         out-&gt;<a class="code" href="class_link_state_msg.html#a11">setLinkInfo</a>(j, list[j]);
00218 
00219     out-&gt;<a class="code" href="class_link_state_msg.html#a13">setRequest</a>(req);
00220 
00221     <a class="code" href="class_link_state_routing.html#b7">sendToIP</a>(out, peer);
00222 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="LinkStateRouting::sendToPeers"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void LinkStateRouting::sendToPeers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const std::vector&lt; <a class="el" href="struct_t_e_link_state_info.html">TELinkStateInfo</a> &gt; &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>bool&nbsp;</td>
          <td class="mdname" nowrap> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_p_address.html">IPAddress</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>exceptPeer</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00186 {
00187     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"sending LINK_STATE message to peers"</span> &lt;&lt; endl;
00188 
00189     <span class="comment">// send "list" to every peer (linkid in our ted[] entries???) in a LinkStateMsg</span>
00190     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; tedmod-&gt;ted.size(); i++)
00191     {
00192         <span class="keywordflow">if</span>(<a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>[i].advrouter != <a class="code" href="class_link_state_routing.html#p2">routerId</a>)
00193             <span class="keywordflow">continue</span>;
00194 
00195         <span class="keywordflow">if</span>(<a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>[i].linkid == exceptPeer)
00196             <span class="keywordflow">continue</span>;
00197 
00198         <span class="keywordflow">if</span>(!<a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>[i].state)
00199             <span class="keywordflow">continue</span>;
00200 
00201         <span class="keywordflow">if</span>(<a class="code" href="_r_s_v_p___t_e_2_utils_8cc.html#a2">find</a>(<a class="code" href="class_link_state_routing.html#p3">peerIfAddrs</a>.begin(), <a class="code" href="class_link_state_routing.html#p3">peerIfAddrs</a>.end(), <a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>[i].local) == <a class="code" href="class_link_state_routing.html#p3">peerIfAddrs</a>.end())
00202             <span class="keywordflow">continue</span>;
00203 
00204         <span class="comment">// send a copy</span>
00205         <a class="code" href="class_link_state_routing.html#b6">sendToPeer</a>(<a class="code" href="class_link_state_routing.html#p0">tedmod</a>-&gt;<a class="code" href="class_t_e_d.html#o0">ted</a>[i].linkid, list, req);
00206     }
00207 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p1" doxytag="LinkStateRouting::announceMsg"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cMessage* <a class="el" href="class_link_state_routing.html#p1">LinkStateRouting::announceMsg</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="LinkStateRouting::peerIfAddrs"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="_int_serv__m_8h.html#a1">IPAddressVector</a> <a class="el" href="class_link_state_routing.html#p3">LinkStateRouting::peerIfAddrs</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="LinkStateRouting::routerId"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_p_address.html">IPAddress</a> <a class="el" href="class_link_state_routing.html#p2">LinkStateRouting::routerId</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="LinkStateRouting::tedmod"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_t_e_d.html">TED</a>* <a class="el" href="class_link_state_routing.html#p0">LinkStateRouting::tedmod</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_link_state_routing_8h.html">LinkStateRouting.h</a><li><a class="el" href="_link_state_routing_8cc.html">LinkStateRouting.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:26 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
