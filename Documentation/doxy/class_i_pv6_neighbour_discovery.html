<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>INET Framework for OMNeT++/OMNEST: IPv6NeighbourDiscovery Class Reference</title>
<link href="opp.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.0 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>IPv6NeighbourDiscovery Class Reference</h1><code>#include &lt;IPv6NeighbourDiscovery.h&gt;</code>
<p>
<a href="class_i_pv6_neighbour_discovery-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Implements RFC 2461 Neighbor Discovery for <a class="el" href="class_i_pv6.html">IPv6</a>. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::vector&lt; cMessage * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#w0">MsgPtrVector</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="struct_i_pv6_neighbour_cache_1_1_key.html">IPv6NeighbourCache::Key</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#w1">Key</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">IPv6NeighbourCache::Neighbour</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a></td></tr>

<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#a0">IPv6NeighbourDiscovery</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#a1">~IPv6NeighbourDiscovery</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const <a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#a2">resolveNeighbour</a> (const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;nextHop, int interfaceId)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#a3">reachabilityConfirmed</a> (const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;neighbour, int interfaceId)</td></tr>

<tr><td colspan="2"><br><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::set&lt; cMessage * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#x0">RATimerList</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::set&lt; <a class="el" href="struct_i_pv6_neighbour_discovery_1_1_d_a_d_entry.html">DADEntry</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#x1">DADList</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::set&lt; <a class="el" href="struct_i_pv6_neighbour_discovery_1_1_r_d_entry.html">RDEntry</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#x2">RDList</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::set&lt; <a class="el" href="struct_i_pv6_neighbour_discovery_1_1_adv_if_entry.html">AdvIfEntry</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#x3">AdvIfList</a></td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b0">numInitStages</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b1">initialize</a> (int stage)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b2">handleMessage</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b3">processNDMessage</a> (<a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *msg, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b4">finish</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b5">processIPv6Datagram</a> (<a class="el" href="class_i_pv6_datagram.html">IPv6Datagram</a> *datagram)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct_i_pv6_neighbour_discovery_1_1_adv_if_entry.html">IPv6NeighbourDiscovery::AdvIfEntry</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b6">fetchAdvIfEntry</a> (<a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct_i_pv6_neighbour_discovery_1_1_r_d_entry.html">IPv6NeighbourDiscovery::RDEntry</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b7">fetchRDEntry</a> (<a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_address.html">IPv6Address</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b8">determineNextHop</a> (const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;destAddr, int &amp;outIfID)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b9">initiateNeighbourUnreachabilityDetection</a> (<a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">Neighbour</a> *neighbour)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b10">processNUDTimeout</a> (cMessage *timeoutMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_address.html">IPv6Address</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b11">selectDefaultRouter</a> (int &amp;outIfID)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b12">timeoutPrefixEntry</a> (const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;destPrefix, int prefixLength)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b13">timeoutDefaultRouter</a> (const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;addr, int interfaceID)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b14">initiateAddressResolution</a> (const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;dgSrcAddr, <a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">Neighbour</a> *nce)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b15">processARTimeout</a> (cMessage *arTimeoutMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b16">dropQueuedPacketsAwaitingAR</a> (<a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">Neighbour</a> *nce)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b17">sendPacketToIPv6Module</a> (cMessage *msg, const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;destAddr, const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;srcAddr, int interfaceId)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b18">sendQueuedPacketsToIPv6Module</a> (<a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">Neighbour</a> *nce)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b19">initiateDAD</a> (const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;tentativeAddr, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b20">processDADTimeout</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b21">assignLinkLocalAddress</a> (cMessage *timerMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b22">createAndSendRSPacket</a> (<a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b23">initiateRouterDiscovery</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b24">cancelRouterDiscovery</a> (<a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b25">processRDTimeout</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b26">processRSPacket</a> (<a class="el" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a> *rs, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *rsCtrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b27">validateRSPacket</a> (<a class="el" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a> *rs, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *rsCtrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b28">createAndSendRAPacket</a> (const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;destAddr, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b29">processRAPacket</a> (<a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *ra, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *raCtrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b30">processRAForRouterUpdates</a> (<a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *ra, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *raCtrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b31">processRAPrefixInfo</a> (<a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *ra, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b32">processRAPrefixInfoForAddrAutoConf</a> (<a class="el" href="class_i_pv6_n_d_prefix_information.html">IPv6NDPrefixInformation</a> &amp;prefixInfo, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b33">createRATimer</a> (<a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b34">resetRATimer</a> (<a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b35">sendPeriodicRA</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b36">sendSolicitedRA</a> (cMessage *msg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b37">validateRAPacket</a> (<a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *ra, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *raCtrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b38">createAndSendNSPacket</a> (const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;nsTargetAddr, const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;dgDestAddr, const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;dgSrcAddr, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b39">processNSPacket</a> (<a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *ns, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *naCtrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b40">validateNSPacket</a> (<a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *ns, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *nsCtrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b41">processNSForTentativeAddress</a> (<a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *ns, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b42">processNSForNonTentativeAddress</a> (<a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *ns, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrlInfo, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b43">processNSWithSpecifiedSrcAddr</a> (<a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *ns, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrlInfo, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b44">createAndSendNAPacket</a> (<a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *ns, const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;nsSrcAddr, const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;nsDestAddr, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b45">sendSolicitedNA</a> (<a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *ns, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *nsCtrlInfo, <a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b46">sendUnsolicitedNA</a> (<a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b47">processNAPacket</a> (<a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *na, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *naCtrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b48">validateNAPacket</a> (<a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *na, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *naCtrlInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b49">processNAForIncompleteNCEState</a> (<a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *na, <a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">IPv6NeighbourCache::Neighbour</a> *nce)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b50">processNAForOtherNCEStates</a> (<a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *na, <a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">IPv6NeighbourCache::Neighbour</a> *nce)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_redirect.html">IPv6Redirect</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b51">createAndSendRedirectPacket</a> (<a class="el" href="class_interface_entry.html">InterfaceEntry</a> *ie)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#b52">processRedirectPacket</a> (<a class="el" href="class_i_pv6_redirect.html">IPv6Redirect</a> *redirect, <a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrlInfo)</td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">cQueue&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#p0">pendingQueue</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#p1">ift</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_routing_table6.html">RoutingTable6</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_c_m_pv6.html">ICMPv6</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#p3">icmpv6</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_neighbour_cache.html">IPv6NeighbourCache</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_neighbour_discovery.html#x0">RATimerList</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#p5">raTimerList</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_neighbour_discovery.html#x1">DADList</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#p6">dadList</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_neighbour_discovery.html#x2">RDList</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#p7">rdList</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_i_pv6_neighbour_discovery.html#x3">AdvIfList</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_i_pv6_neighbour_discovery.html#p8">advIfList</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_i_pv6_neighbour_discovery_1_1_adv_if_entry.html">AdvIfEntry</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_i_pv6_neighbour_discovery_1_1_d_a_d_entry.html">DADEntry</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_i_pv6_neighbour_discovery_1_1_r_d_entry.html">RDEntry</a></td></tr>

</table>
<hr><h2>Member Typedef Documentation</h2>
<a class="anchor" name="x3" doxytag="IPv6NeighbourDiscovery::AdvIfList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::set&lt;<a class="el" href="struct_i_pv6_neighbour_discovery_1_1_adv_if_entry.html">AdvIfEntry</a>*&gt; <a class="el" href="class_i_pv6_neighbour_discovery.html#x3">IPv6NeighbourDiscovery::AdvIfList</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="x1" doxytag="IPv6NeighbourDiscovery::DADList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::set&lt;<a class="el" href="struct_i_pv6_neighbour_discovery_1_1_d_a_d_entry.html">DADEntry</a>*&gt; <a class="el" href="class_i_pv6_neighbour_discovery.html#x1">IPv6NeighbourDiscovery::DADList</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w1" doxytag="IPv6NeighbourDiscovery::Key"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef <a class="el" href="struct_i_pv6_neighbour_cache_1_1_key.html">IPv6NeighbourCache::Key</a> <a class="el" href="struct_i_pv6_neighbour_cache_1_1_key.html">IPv6NeighbourDiscovery::Key</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w0" doxytag="IPv6NeighbourDiscovery::MsgPtrVector"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::vector&lt;cMessage*&gt; <a class="el" href="class_i_pv6_neighbour_discovery.html#w0">IPv6NeighbourDiscovery::MsgPtrVector</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="w2" doxytag="IPv6NeighbourDiscovery::Neighbour"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef <a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">IPv6NeighbourCache::Neighbour</a> <a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">IPv6NeighbourDiscovery::Neighbour</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="x0" doxytag="IPv6NeighbourDiscovery::RATimerList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::set&lt;cMessage*&gt; <a class="el" href="class_i_pv6_neighbour_discovery.html#x0">IPv6NeighbourDiscovery::RATimerList</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="x2" doxytag="IPv6NeighbourDiscovery::RDList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef std::set&lt;<a class="el" href="struct_i_pv6_neighbour_discovery_1_1_r_d_entry.html">RDEntry</a>*&gt; <a class="el" href="class_i_pv6_neighbour_discovery.html#x2">IPv6NeighbourDiscovery::RDList</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="IPv6NeighbourDiscovery::IPv6NeighbourDiscovery"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">IPv6NeighbourDiscovery::IPv6NeighbourDiscovery           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00036 {
00037 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="IPv6NeighbourDiscovery::~IPv6NeighbourDiscovery"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">IPv6NeighbourDiscovery::~<a class="el" href="class_i_pv6_neighbour_discovery.html">IPv6NeighbourDiscovery</a>           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00040 {
00041     <span class="comment">// FIXME delete the following data structures, cancelAndDelete timers in them etc.</span>
00042     <span class="comment">// Deleting the data structures my become unnecessary if the lists store the</span>
00043     <span class="comment">// structs themselves and not pointers.</span>
00044     <span class="comment">//   RATimerList raTimerList;</span>
00045     <span class="comment">//   DADList dadList;</span>
00046     <span class="comment">//   RDList rdList;</span>
00047     <span class="comment">//   AdvIfList advIfList;</span>
00048 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="b21" doxytag="IPv6NeighbourDiscovery::assignLinkLocalAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::assignLinkLocalAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>timerMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
as it is not possbile to explicitly define RFC 2462. ND is the next best place to do this.<p>
RFC 2462-IPv6 Stateless Address Autoconfiguration: Section 1 The autoconfiguration process specified in this document applies only to hosts and not routers. Since host autoconfiguration uses information advertised by routers, routers will need to be configured by some other means. However, it is expected that routers will generate link-local addresses using the mechanism described in this document. In addition, routers are expected to successfully pass the Duplicate Address Detection procedure described in this document on all addresses prior to assigning them to an interface. <div class="fragment"><pre class="fragment">00732 {
00733     <span class="comment">//Node has booted up. Start assigning a link-local address for each</span>
00734     <span class="comment">//interface in this node.</span>
00735     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; ift-&gt;numInterfaces(); i++)
00736 {
00737         <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(i);
00738 
00739         <span class="comment">//Skip the loopback interface.</span>
00740         <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a15">isLoopback</a>()) <span class="keywordflow">continue</span>;
00741 
00742     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> linkLocalAddr = ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_10">linkLocalAddress</a>();
00743     <span class="keywordflow">if</span> (linkLocalAddr.<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
00744     {
00745         <span class="comment">//if no link local address exists for this interface, we assign one to it.</span>
00746             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"No link local address exists. Forming one"</span> &lt;&lt; endl;
00747         linkLocalAddr = <a class="code" href="class_i_pv6_address.html">IPv6Address</a>().<a class="code" href="class_i_pv6_address.html#e2">formLinkLocalAddress</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a18">interfaceToken</a>());
00748         ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_0">assignAddress</a>(linkLocalAddr, <span class="keyword">true</span>, 0, 0);
00749     }
00750 
00751         <span class="comment">//Before we can use this address, we MUST initiate DAD first.</span>
00752         <a class="code" href="class_i_pv6_neighbour_discovery.html#b19">initiateDAD</a>(linkLocalAddr, ie);
00753     }
00754     <span class="keyword">delete</span> timerMsg;
00755 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b24" doxytag="IPv6NeighbourDiscovery::cancelRouterDiscovery"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::cancelRouterDiscovery           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ie</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
RFC 2461: Section 6.3.7 4th paragraph Once the host sends a Router Solicitation, and receives a valid Router Advertisement with a non-zero Router Lifetime, the host MUST desist from sending additional solicitations on that interface,<p>
Cancel Router Discovery on the Interface where a RA was received with the given Interface Entry. <div class="fragment"><pre class="fragment">00891 {
00892     <span class="comment">//Next we retrieve the rdEntry with the Interface Entry.</span>
00893     RDEntry *rdEntry = <a class="code" href="class_i_pv6_neighbour_discovery.html#b7">fetchRDEntry</a>(ie);
00894     <span class="keywordflow">if</span> (rdEntry != NULL)
00895     {
00896         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"rdEntry is not NULL, RD cancelled!"</span> &lt;&lt; endl;
00897         cancelEvent(rdEntry-&gt;timeoutMsg);
00898         <a class="code" href="class_i_pv6_neighbour_discovery.html#p7">rdList</a>.erase(rdEntry);
00899         <span class="keyword">delete</span> rdEntry;
00900     }
00901     <span class="keywordflow">else</span>
00902         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"rdEntry is NULL, not cancelling RD!"</span> &lt;&lt; endl;
00903 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b44" doxytag="IPv6NeighbourDiscovery::createAndSendNAPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a>* IPv6NeighbourDiscovery::createAndSendNAPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>nsSrcAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>nsDestAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b38" doxytag="IPv6NeighbourDiscovery::createAndSendNSPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> * IPv6NeighbourDiscovery::createAndSendNSPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>nsTargetAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>dgDestAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>dgSrcAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01571 {
01572     <a class="code" href="class_m_a_c_address.html">MACAddress</a> myMacAddr = ie-&gt;<a class="code" href="class_interface_entry.html#a17">macAddress</a>();
01573 
01574     <span class="comment">//Construct a Neighbour Solicitation message</span>
01575     <a class="code" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *ns = <span class="keyword">new</span> <a class="code" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a>(<span class="stringliteral">"NSpacket"</span>);
01576     ns-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_NEIGHBOUR_SOL);
01577 
01578     <span class="comment">//Neighbour Solicitation Specific Information</span>
01579     ns-&gt;<a class="code" href="class_i_pv6_neighbour_solicitation.html#a9">setTargetAddress</a>(nsTargetAddr);
01580 
01581     <span class="comment">/*If the solicitation is being sent to a solicited-node multicast</span>
01582 <span class="comment">    address, the sender MUST include its link-layer address (if it has</span>
01583 <span class="comment">    one) as a Source Link-Layer Address option.*/</span>
01584     <span class="keywordflow">if</span> (dgDestAddr.<a class="code" href="class_i_pv6_address.html#a21">matches</a>(<a class="code" href="class_i_pv6_address.html">IPv6Address</a>(<span class="stringliteral">"FF02::1:FF00:0"</span>),104) &amp;&amp; <span class="comment">// FIXME what's this? make constant...</span>
01585         !dgSrcAddr.<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
01586         ns-&gt;<a class="code" href="class_i_pv6_neighbour_solicitation.html#a12">setSourceLinkLayerAddress</a>(myMacAddr);
01587 
01588     <a class="code" href="class_i_pv6_neighbour_discovery.html#b17">sendPacketToIPv6Module</a>(ns, dgDestAddr, dgSrcAddr, ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>());
01589 
01590     <span class="keywordflow">return</span> ns;
01591 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b28" doxytag="IPv6NeighbourDiscovery::createAndSendRAPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> * IPv6NeighbourDiscovery::createAndSendRAPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>destAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01047 {
01048     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Create and send RA invoked!\n"</span>;
01049     <span class="comment">//Must use link-local addr. See: RFC2461 Section 6.1.2</span>
01050     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> sourceAddr = ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_10">linkLocalAddress</a>();
01051 
01052     <span class="comment">//This operation includes all options, regardless whether it is solicited or unsolicited.</span>
01053     <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_58">advSendAdvertisements</a>()) <span class="comment">//if this is an advertising interface</span>
01054     {
01055         <span class="comment">//Construct a Router Advertisment message</span>
01056         <a class="code" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *ra = <span class="keyword">new</span> <a class="code" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a>(<span class="stringliteral">"RApacket"</span>);
01057         ra-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_ROUTER_AD);
01058 
01059         <span class="comment">//RFC 2461: Section 6.2.3 Router Advertisment Message Content</span>
01060         <span class="comment">/*A router sends periodic as well as solicited Router Advertisements out</span>
01061 <span class="comment">        its advertising interfaces.  Outgoing Router Advertisements are filled</span>
01062 <span class="comment">        with the following values consistent with the message format given in</span>
01063 <span class="comment">        Section 4.2:*/</span>
01064 
01065         <span class="comment">//- In the Router Lifetime field: the interface's configured AdvDefaultLifetime.</span>
01066         ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a14">setRouterLifetime</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_67">advDefaultLifetime</a>());
01067 
01068         <span class="comment">//- In the M and O flags: the interface's configured AdvManagedFlag and</span>
01069         <span class="comment">//AdvOtherConfigFlag, respectively.  See [ADDRCONF].</span>
01070         ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a10">setManagedAddrConfFlag</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_61">advManagedFlag</a>());
01071         ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a12">setOtherStatefulConfFlag</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_62">advOtherConfigFlag</a>());
01072 
01073         <span class="comment">//- In the Cur Hop Limit field: the interface's configured CurHopLimit.</span>
01074         ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a8">setCurHopLimit</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_66">advCurHopLimit</a>());
01075 
01076         <span class="comment">//- In the Reachable Time field: the interface's configured AdvReachableTime.</span>
01077         ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a16">setReachableTime</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_64">advReachableTime</a>());
01078 
01079         <span class="comment">//- In the Retrans Timer field: the interface's configured AdvRetransTimer.</span>
01080         ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a18">setRetransTimer</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_65">advRetransTimer</a>());
01081 
01082         <span class="comment">//- In the options:</span>
01083         <span class="comment">/*o Source Link-Layer Address option: link-layer address of the sending</span>
01084 <span class="comment">            interface.  (Assumption: We always send this)*/</span>
01085         ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a21">setSourceLinkLayerAddress</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a17">macAddress</a>());
01086         ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a23">setMTU</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_63">advLinkMTU</a>());
01087 
01088         <span class="comment">//Add all Advertising Prefixes to the RA</span>
01089         <span class="keywordtype">int</span> numAdvPrefixes = ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z50_1">numAdvPrefixes</a>();
01090         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Number of Adv Prefixes: "</span> &lt;&lt; numAdvPrefixes &lt;&lt; endl;
01091         ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a24">setPrefixInformationArraySize</a>(numAdvPrefixes);
01092         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numAdvPrefixes; i++)
01093         {
01094             <a class="code" href="struct_i_pv6_interface_data_1_1_adv_prefix.html">IPv6InterfaceData::AdvPrefix</a> advPrefix = ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z50_2">advPrefix</a>(i);
01095             <a class="code" href="class_i_pv6_n_d_prefix_information.html">IPv6NDPrefixInformation</a> prefixInfo;
01096             prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a18">setPrefix</a>(advPrefix.<a class="code" href="struct_i_pv6_interface_data_1_1_adv_prefix.html#o0">prefix</a>);
01097             prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a7">setPrefixLength</a>(advPrefix.<a class="code" href="struct_i_pv6_interface_data_1_1_adv_prefix.html#o1">prefixLength</a>);
01098 
01099             <span class="comment">//- In the "on-link" flag: the entry's AdvOnLinkFlag.</span>
01100             prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a9">setOnlinkFlag</a>(advPrefix.<a class="code" href="struct_i_pv6_interface_data_1_1_adv_prefix.html#o3">advOnLinkFlag</a>);
01101             <span class="comment">//- In the Valid Lifetime field: the entry's AdvValidLifetime.</span>
01102             prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a13">setValidLifetime</a>(advPrefix.<a class="code" href="struct_i_pv6_interface_data_1_1_adv_prefix.html#o2">advValidLifetime</a>);
01103             <span class="comment">//- In the "Autonomous address configuration" flag: the entry's</span>
01104             <span class="comment">//AdvAutonomousFlag.</span>
01105             prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a11">setAutoAddressConfFlag</a>(advPrefix.<a class="code" href="struct_i_pv6_interface_data_1_1_adv_prefix.html#o5">advAutonomousFlag</a>);
01106             <span class="comment">//- In the Preferred Lifetime field: the entry's AdvPreferredLifetime.</span>
01107             prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a15">setPreferredLifetime</a>(advPrefix.<a class="code" href="struct_i_pv6_interface_data_1_1_adv_prefix.html#o4">advPreferredLifetime</a>);
01108             <span class="comment">//Now we pop the prefix info into the RA.</span>
01109             ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a28">setPrefixInformation</a>(i, prefixInfo);
01110         }
01111         <a class="code" href="class_i_pv6_neighbour_discovery.html#b17">sendPacketToIPv6Module</a>(ra, destAddr, sourceAddr, ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>());
01112         <span class="keywordflow">return</span> ra;
01113     }
01114 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b51" doxytag="IPv6NeighbourDiscovery::createAndSendRedirectPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_redirect.html">IPv6Redirect</a> * IPv6NeighbourDiscovery::createAndSendRedirectPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ie</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">02128 {
02129     <span class="comment">//Construct a Redirect message</span>
02130     <a class="code" href="class_i_pv6_redirect.html">IPv6Redirect</a> *redirect = <span class="keyword">new</span> <a class="code" href="class_i_pv6_redirect.html">IPv6Redirect</a>(<span class="stringliteral">"redirectMsg"</span>);
02131     redirect-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_REDIRECT);
02132 
02133     <span class="comment">//Redirect Message Specific Information</span>
02134     <span class="comment">//redirect-&gt;setTargetAddress();</span>
02135     <span class="comment">//redirect-&gt;setDestinationAddress();</span>
02136 
02137     <span class="comment">//Possible Option</span>
02138     <span class="comment">//redirect-&gt;setTargetLinkLayerAddress();</span>
02139 
02140     <span class="keywordflow">return</span> redirect;
02141 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b22" doxytag="IPv6NeighbourDiscovery::createAndSendRSPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a> * IPv6NeighbourDiscovery::createAndSendRSPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ie</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00830 {
00831     ASSERT(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_58">advSendAdvertisements</a>() == <span class="keyword">false</span>);
00832     <span class="comment">//RFC 2461: Section 6.3.7 Sending Router Solicitations</span>
00833     <span class="comment">//A host sends Router Solicitations to the All-Routers multicast address. The</span>
00834     <span class="comment">//IP source address is set to either one of the interface's unicast addresses</span>
00835     <span class="comment">//or the unspecified address.</span>
00836     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> myIPv6Address = ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_9">preferredAddress</a>();
00837     <span class="keywordflow">if</span> (myIPv6Address.<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
00838         myIPv6Address = ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_10">linkLocalAddress</a>();<span class="comment">//so we use the link local address instead</span>
00839     <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_4">isTentativeAddress</a>(myIPv6Address))
00840         myIPv6Address = <a class="code" href="class_i_pv6_address.html#z33_0">IPv6Address::UNSPECIFIED_ADDRESS</a>;<span class="comment">//set my IPv6 address to unspecified.</span>
00841     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> destAddr = <a class="code" href="class_i_pv6_address.html#z33_5">IPv6Address::ALL_ROUTERS_2</a>;<span class="comment">//all_routers multicast</span>
00842     <a class="code" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a> *rs = <span class="keyword">new</span> <a class="code" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a>(<span class="stringliteral">"RSpacket"</span>);
00843     rs-&gt;<a class="code" href="class_i_c_m_pv6_message.html#a8">setType</a>(ICMPv6_ROUTER_SOL);
00844 
00845     <span class="comment">//The Source Link-Layer Address option SHOULD be set to the host's link-layer</span>
00846     <span class="comment">//address, if the IP source address is not the unspecified address.</span>
00847     <span class="keywordflow">if</span> (!myIPv6Address.<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
00848         rs-&gt;<a class="code" href="class_i_pv6_router_solicitation.html#a9">setSourceLinkLayerAddress</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a17">macAddress</a>());
00849 
00850     <span class="comment">//Construct a Router Solicitation message</span>
00851     <a class="code" href="class_i_pv6_neighbour_discovery.html#b17">sendPacketToIPv6Module</a>(rs, destAddr, myIPv6Address, ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>());
00852     <span class="keywordflow">return</span> rs;
00853 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b33" doxytag="IPv6NeighbourDiscovery::createRATimer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::createRATimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ie</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create a timer for the given interface entry that sends periodic Router Advertisements <div class="fragment"><pre class="fragment">01441 {
01442     cMessage *msg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"sendPeriodicRA"</span>, MK_SEND_PERIODIC_RTRADV);
01443     msg-&gt;setContextPointer(ie);
01444     AdvIfEntry *advIfEntry = <span class="keyword">new</span> AdvIfEntry();
01445     advIfEntry-&gt;interfaceId = ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>();
01446     advIfEntry-&gt;numRASent = 0;
01447     simtime_t interval
01448         = uniform(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_60">minRtrAdvInterval</a>(),ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_59">maxRtrAdvInterval</a>());
01449     advIfEntry-&gt;raTimeoutMsg = msg;
01450 
01451     simtime_t nextScheduledTime = simTime() + interval;
01452     advIfEntry-&gt;nextScheduledRATime = nextScheduledTime;
01453     <a class="code" href="class_i_pv6_neighbour_discovery.html#p8">advIfList</a>.insert(advIfEntry);
01454     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Interval: "</span> &lt;&lt; interval &lt;&lt; endl;
01455     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Next scheduled time: "</span> &lt;&lt; nextScheduledTime &lt;&lt; endl;
01456     <span class="comment">//now we schedule the msg for whatever time that was derived</span>
01457     scheduleAt(nextScheduledTime, msg);
01458 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b8" doxytag="IPv6NeighbourDiscovery::determineNextHop"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_address.html">IPv6Address</a> IPv6NeighbourDiscovery::determineNextHop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>destAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>outIfID</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function accepts the datagram's destination address and attempts to determine the destination's next hop address and interface ID by: (1) looking up the destination cache, (2)looking up the routing table, or (3) selecting a default router. It then updates the destination cache. If no default router can be selected than we assume the destination address to be onlink and simply return any available interface. <div class="fragment"><pre class="fragment">00384 {
00385     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nextHopAddr;
00386 
00387     <span class="comment">//RFC 2461 Section 5.2</span>
00388     <span class="comment">//Next-hop determination for a given unicast destination operates as follows.</span>
00389 
00390     <span class="comment">//The sender performs a longest prefix match against the Prefix List to</span>
00391     <span class="comment">//determine whether the packet's destination is on- or off-link.</span>
00392     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Find out if supplied dest addr is on-link or off-link.\n"</span>;
00393     <span class="keyword">const</span> <a class="code" href="class_i_pv6_route.html">IPv6Route</a> *route = <a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#z54_2">doLongestPrefixMatch</a>(destAddr);
00394 
00395     <span class="keywordflow">if</span> (route != NULL)
00396     {
00397         <span class="comment">//If the destination is on-link, the next-hop address is the same as the</span>
00398         <span class="comment">//packet's destination address.</span>
00399         <span class="keywordflow">if</span> (route-&gt;<a class="code" href="class_i_pv6_route.html#a11">nextHop</a>().<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
00400         {
00401             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Dest is on-link, next-hop addr is same as dest addr.\n"</span>;
00402             outIfID = route-&gt;<a class="code" href="class_i_pv6_route.html#a10">interfaceID</a>();
00403             nextHopAddr = destAddr;
00404         }
00405         <span class="keywordflow">else</span>
00406         {
00407             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"A next-hop address was found with the route, dest is off-link\n"</span>;
00408             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Assume next-hop address as the selected default router.\n"</span>;
00409             outIfID = route-&gt;<a class="code" href="class_i_pv6_route.html#a10">interfaceID</a>();
00410             nextHopAddr = route-&gt;<a class="code" href="class_i_pv6_route.html#a11">nextHop</a>();
00411         }
00412     }
00413     <span class="keywordflow">else</span>
00414     {
00415         <span class="comment">//Otherwise, the sender selects a router from the Default Router List</span>
00416         <span class="comment">//(following the rules described in Section 6.3.6).</span>
00417 
00418         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"No routes were found, Dest addr is off-link.\n"</span>;
00419         nextHopAddr = <a class="code" href="class_i_pv6_neighbour_discovery.html#b11">selectDefaultRouter</a>(outIfID);
00420 
00421         <span class="keywordflow">if</span> (outIfID == -1) EV &lt;&lt; "No Default Routers were found.";
00422         else EV &lt;&lt; "Default router found.\n";
00423     }
00424 
00425     <span class="comment">/*the results of next-hop determination computations are saved in the Destination</span>
00426 <span class="comment">    Cache (which also contains updates learned from Redirect messages).*/</span>
00427     rt6-&gt;updateDestCache(destAddr, nextHopAddr, outIfID);
00428     return nextHopAddr;
00429 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b16" doxytag="IPv6NeighbourDiscovery::dropQueuedPacketsAwaitingAR"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::dropQueuedPacketsAwaitingAR           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">Neighbour</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>nce</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Drops specific queued packets for a specific NCE AR-timeout. TODO: Not implemented yet! <div class="fragment"><pre class="fragment">00672 {
00673     <span class="keyword">const</span> <a class="code" href="class_i_pv6_neighbour_discovery.html#w1">Key</a> *nceKey = nce-&gt;nceKey;
00674     <span class="comment">//RFC 2461: Section 7.2.2</span>
00675     <span class="comment">/*If no Neighbor Advertisement is received after MAX_MULTICAST_SOLICIT</span>
00676 <span class="comment">    solicitations, address resolution has failed. The sender MUST return ICMP</span>
00677 <span class="comment">    destination unreachable indications with code 3 (Address Unreachable) for</span>
00678 <span class="comment">    each packet queued awaiting address resolution.*/</span>
00679     <a class="code" href="class_i_pv6_neighbour_discovery.html#w0">MsgPtrVector</a> pendingPackets = nce-&gt;pendingPackets;
00680     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Pending Packets empty:"</span> &lt;&lt; pendingPackets.empty() &lt;&lt; endl;
00681     <span class="keywordflow">while</span> (!pendingPackets.empty())
00682     {
00683         MsgPtrVector::iterator i = pendingPackets.begin();
00684         cMessage *msg = (*i);
00685         <a class="code" href="class_i_pv6_datagram.html">IPv6Datagram</a> *ipv6Msg = (<a class="code" href="class_i_pv6_datagram.html">IPv6Datagram</a> *)msg;
00686         <span class="comment">//Assume msg is the packet itself. I need the datagram's source addr.</span>
00687         <span class="comment">//The datagram's src addr will be the destination of the unreachable msg.</span>
00688         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending ICMP unreachable destination."</span> &lt;&lt; endl;
00689         pendingPackets.erase(i);
00690         <a class="code" href="class_i_pv6_neighbour_discovery.html#p0">pendingQueue</a>.remove(msg);
00691         <a class="code" href="class_i_pv6_neighbour_discovery.html#p3">icmpv6</a>-&gt;<a class="code" href="class_i_c_m_pv6.html#a0">sendErrorMessage</a>(ipv6Msg, ICMPv6_DESTINATION_UNREACHABLE, ADDRESS_UNREACHABLE);
00692     }
00693 
00694     <span class="comment">//RFC 2461: Section 7.3.3</span>
00695     <span class="comment">/*If address resolution fails, the entry SHOULD be deleted, so that subsequent</span>
00696 <span class="comment">    traffic to that neighbor invokes the next-hop determination procedure again.*/</span>
00697     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Removing neighbour cache entry"</span> &lt;&lt; endl;
00698     <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a10">remove</a>(nceKey-&gt;address, nceKey-&gt;interfaceID);
00699 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b6" doxytag="IPv6NeighbourDiscovery::fetchAdvIfEntry"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="struct_i_pv6_neighbour_discovery_1_1_adv_if_entry.html">IPv6NeighbourDiscovery::AdvIfEntry</a> * IPv6NeighbourDiscovery::fetchAdvIfEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ie</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00262 {
00263    <span class="keywordflow">for</span> (AdvIfList::iterator it=<a class="code" href="class_i_pv6_neighbour_discovery.html#p8">advIfList</a>.begin(); it!=<a class="code" href="class_i_pv6_neighbour_discovery.html#p8">advIfList</a>.end(); it++)
00264    {
00265        AdvIfEntry *advIfEntry = (*it);
00266        <span class="keywordflow">if</span> (advIfEntry-&gt;interfaceId == ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>())
00267        {
00268            <span class="keywordflow">return</span> advIfEntry;
00269        }
00270    }
00271    <span class="keywordflow">return</span> NULL;
00272 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b7" doxytag="IPv6NeighbourDiscovery::fetchRDEntry"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="struct_i_pv6_neighbour_discovery_1_1_r_d_entry.html">IPv6NeighbourDiscovery::RDEntry</a> * IPv6NeighbourDiscovery::fetchRDEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ie</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00275 {
00276    <span class="keywordflow">for</span> (RDList::iterator it=<a class="code" href="class_i_pv6_neighbour_discovery.html#p7">rdList</a>.begin(); it!=<a class="code" href="class_i_pv6_neighbour_discovery.html#p7">rdList</a>.end(); it++)
00277    {
00278        RDEntry *rdEntry = (*it);
00279        <span class="keywordflow">if</span> (rdEntry-&gt;interfaceId == ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>())
00280        {
00281            <span class="keywordflow">return</span> rdEntry;
00282        }
00283    }
00284    <span class="keywordflow">return</span> NULL;
00285 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b4" doxytag="IPv6NeighbourDiscovery::finish"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::finish           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00183 {
00184 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b2" doxytag="IPv6NeighbourDiscovery::handleMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::handleMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00083 {
00084     <span class="keywordflow">if</span> (msg-&gt;isSelfMessage())
00085     {
00086         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Self message received!\n"</span>;
00087         <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_i_pv6_neighbour_discovery_8cc.html#a1">MK_SEND_PERIODIC_RTRADV</a>)
00088         {
00089             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending periodic RA\n"</span>;
00090             <a class="code" href="class_i_pv6_neighbour_discovery.html#b35">sendPeriodicRA</a>(msg);
00091         }
00092         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_i_pv6_neighbour_discovery_8cc.html#a2">MK_SEND_SOL_RTRADV</a>)
00093         {
00094             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending solicited RA\n"</span>;
00095             <a class="code" href="class_i_pv6_neighbour_discovery.html#b36">sendSolicitedRA</a>(msg);
00096         }
00097         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_i_pv6_neighbour_discovery_8cc.html#a0">MK_ASSIGN_LINKLOCAL_ADDRESS</a>)
00098         {
00099             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Assigning Link Local Address\n"</span>;
00100             <a class="code" href="class_i_pv6_neighbour_discovery.html#b21">assignLinkLocalAddress</a>(msg);
00101         }
00102         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_i_pv6_neighbour_discovery_8cc.html#a4">MK_DAD_TIMEOUT</a>)
00103         {
00104             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"DAD Timeout message received\n"</span>;
00105             <a class="code" href="class_i_pv6_neighbour_discovery.html#b20">processDADTimeout</a>(msg);
00106         }
00107         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_i_pv6_neighbour_discovery_8cc.html#a5">MK_RD_TIMEOUT</a>)
00108         {
00109             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Router Discovery message received\n"</span>;
00110             <a class="code" href="class_i_pv6_neighbour_discovery.html#b25">processRDTimeout</a>(msg);
00111         }
00112         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_i_pv6_neighbour_discovery_8cc.html#a3">MK_INITIATE_RTRDIS</a>)
00113         {
00114             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"initiate router discovery.\n"</span>;
00115             <a class="code" href="class_i_pv6_neighbour_discovery.html#b23">initiateRouterDiscovery</a>(msg);
00116         }
00117         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_i_pv6_neighbour_discovery_8cc.html#a6">MK_NUD_TIMEOUT</a>)
00118         {
00119             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NUD Timeout message received\n"</span>;
00120             <a class="code" href="class_i_pv6_neighbour_discovery.html#b10">processNUDTimeout</a>(msg);
00121         }
00122         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg-&gt;kind()==<a class="code" href="_i_pv6_neighbour_discovery_8cc.html#a7">MK_AR_TIMEOUT</a>)
00123         {
00124             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Address Resolution Timeout message received\n"</span>;
00125             <a class="code" href="class_i_pv6_neighbour_discovery.html#b15">processARTimeout</a>(msg);
00126         }
00127         <span class="keywordflow">else</span>
00128             error(<span class="stringliteral">"Unrecognized Timer"</span>);<span class="comment">//stops sim w/ error msg.</span>
00129     }
00130     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;ICMPv6Message *&gt;(msg))
00131     {
00132         <span class="comment">//This information will serve as input parameters to various processors.</span>
00133         <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *ctrlInfo
00134             = check_and_cast&lt;IPv6ControlInfo*&gt;(msg-&gt;removeControlInfo());
00135         <a class="code" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *ndMsg = (<a class="code" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *)msg;
00136         <a class="code" href="class_i_pv6_neighbour_discovery.html#b3">processNDMessage</a>(ndMsg, ctrlInfo);
00137     }
00138     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6Datagram *&gt;(msg))<span class="comment">// not ND message</span>
00139     {
00140         <a class="code" href="class_i_pv6_datagram.html">IPv6Datagram</a> *datagram = (<a class="code" href="class_i_pv6_datagram.html">IPv6Datagram</a> *)msg;
00141         <a class="code" href="class_i_pv6_neighbour_discovery.html#b5">processIPv6Datagram</a>(datagram);
00142     }
00143     <span class="keywordflow">else</span>
00144         error(<span class="stringliteral">"Unknown message type received.\n"</span>);
00145 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b1" doxytag="IPv6NeighbourDiscovery::initialize"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::initialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stage</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00051 {
00052     <span class="comment">// We have to wait until the 3rd stage (stage 2) with scheduling messages,</span>
00053     <span class="comment">// because interface registration and IPv6 configuration takes places</span>
00054     <span class="comment">// in the first two stages.</span>
00055     <span class="keywordflow">if</span> (stage==3)
00056     {
00057         <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a> = <a class="code" href="class_interface_table_access.html">InterfaceTableAccess</a>().get();
00058         <a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a> = <a class="code" href="class_routing_table6_access.html">RoutingTable6Access</a>().get();
00059         <a class="code" href="class_i_pv6_neighbour_discovery.html#p3">icmpv6</a> = <a class="code" href="class_i_c_m_pv6_access.html">ICMPv6Access</a>().get();
00060         <a class="code" href="class_i_pv6_neighbour_discovery.html#p0">pendingQueue</a>.setName(<span class="stringliteral">"pendingQueue"</span>);
00061 
00062         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; ift-&gt;numInterfaces(); i++)
00063         {
00064             <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(i);
00065 
00066             <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_58">advSendAdvertisements</a>() &amp;&amp; !(ie-&gt;<a class="code" href="class_interface_entry.html#a15">isLoopback</a>()))
00067             {
00068                 <a class="code" href="class_i_pv6_neighbour_discovery.html#b33">createRATimer</a>(ie);
00069             }
00070         }
00071         <span class="comment">//This simulates random node bootup time. Link local address assignment</span>
00072         <span class="comment">//takes place during this time.</span>
00073         cMessage *msg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"assignLinkLocalAddr"</span>, MK_ASSIGN_LINKLOCAL_ADDRESS);
00074         <span class="comment">//We want routers to boot up faster!</span>
00075         <span class="keywordflow">if</span> (<a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#a2">isRouter</a>())
00076             scheduleAt(uniform(0,0.3), msg);<span class="comment">//Random Router bootup time</span>
00077         <span class="keywordflow">else</span>
00078             scheduleAt(uniform(0.4,1), msg);<span class="comment">//Random Host bootup time</span>
00079     }
00080 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b14" doxytag="IPv6NeighbourDiscovery::initiateAddressResolution"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::initiateAddressResolution           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>dgSrcAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">Neighbour</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nce</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This method attempts to resolve the given neighbour's link-layer address. The source address of the packet prompting address resolution is also given in order to decide the source address of the NS to be sent. nceKey stores 2 pieces of information (Neighbour address and Interface ID) which is needed for addr resolution and access to the corresponding nce. <div class="fragment"><pre class="fragment">00596 {
00597     <span class="keyword">const</span> <a class="code" href="class_i_pv6_neighbour_discovery.html#w1">Key</a> *nceKey = nce-&gt;nceKey;
00598     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(nceKey-&gt;interfaceID);
00599     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> neighbourAddr = nceKey-&gt;address;
00600     <span class="keywordtype">int</span> ifID = nceKey-&gt;interfaceID;
00601 
00602     <span class="comment">//RFC2461: Section 7.2.2</span>
00603     <span class="comment">//When a node has a unicast packet to send to a neighbor, but does not</span>
00604     <span class="comment">//know the neighbor's link-layer address, it performs address</span>
00605     <span class="comment">//resolution.  For multicast-capable interfaces this entails creating a</span>
00606     <span class="comment">//Neighbor Cache entry in the INCOMPLETE state(already created if not done yet)</span>
00607     <span class="comment">//WEI-If entry already exists, we still have to ensure that its state is INCOMPLETE.</span>
00608     nce-&gt;reachabilityState = <a class="code" href="class_i_pv6_neighbour_cache.html#w8w3">IPv6NeighbourCache::INCOMPLETE</a>;
00609 
00610     <span class="comment">//and transmitting a Neighbor Solicitation message targeted at the</span>
00611     <span class="comment">//neighbor.  The solicitation is sent to the solicited-node multicast</span>
00612     <span class="comment">//address "corresponding to"(or "derived from") the target address.</span>
00613     <span class="comment">//(in this case, the target address is the address we are trying to resolve)</span>
00614     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Preparing to send NS to solicited-node multicast group\n"</span>;
00615     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"on the next hop interface\n"</span>;
00616     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nsDestAddr = neighbourAddr.<a class="code" href="class_i_pv6_address.html#a19">formSolicitedNodeMulticastAddress</a>();<span class="comment">//for NS datagram</span>
00617     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nsTargetAddr = neighbourAddr;<span class="comment">//for the field within the NS</span>
00618     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nsSrcAddr;
00619 
00620     <span class="comment">/*If the source address of the packet prompting the solicitation is the</span>
00621 <span class="comment">    same as one of the addresses assigned to the outgoing interface,*/</span>
00622     <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_5">hasAddress</a>(dgSrcAddr))
00623         <span class="comment">/*that address SHOULD be placed in the IP Source Address of the outgoing</span>
00624 <span class="comment">        solicitation.*/</span>
00625         nsSrcAddr = dgSrcAddr;
00626     <span class="keywordflow">else</span>
00627         <span class="comment">/*Otherwise, any one of the addresses assigned to the interface</span>
00628 <span class="comment">        should be used.*/</span>
00629         nsSrcAddr = ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_9">preferredAddress</a>();
00630     ASSERT(ifID != -1);
00631     <span class="comment">//Sending NS on specified interface.</span>
00632     <a class="code" href="class_i_pv6_neighbour_discovery.html#b38">createAndSendNSPacket</a>(nsTargetAddr, nsDestAddr, nsSrcAddr, ie);
00633     nce-&gt;numOfARNSSent = 1;
00634     nce-&gt;nsSrcAddr = nsSrcAddr;
00635 
00636     <span class="comment">/*While awaiting a response, the sender SHOULD retransmit Neighbor Solicitation</span>
00637 <span class="comment">    messages approximately every RetransTimer milliseconds, even in the absence</span>
00638 <span class="comment">    of additional traffic to the neighbor. Retransmissions MUST be rate-limited</span>
00639 <span class="comment">    to at most one solicitation per neighbor every RetransTimer milliseconds.*/</span>
00640     cMessage *msg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"arTimeout"</span>, MK_AR_TIMEOUT);<span class="comment">//AR msg timer</span>
00641     nce-&gt;arTimer = msg;
00642     msg-&gt;setContextPointer(nce);
00643     scheduleAt(simTime()+ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_33">_retransTimer</a>(), msg);
00644 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b19" doxytag="IPv6NeighbourDiscovery::initiateDAD"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::initiateDAD           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>tentativeAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initiating DAD means to send off a Neighbour Solicitation with its target address set as this node's tentative link-local address. <div class="fragment"><pre class="fragment">00759 {
00760     DADEntry *dadEntry = <span class="keyword">new</span> DADEntry();
00761     dadEntry-&gt;interfaceId = ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>();
00762     dadEntry-&gt;address = tentativeAddr;
00763     dadEntry-&gt;numNSSent = 0;
00764     <a class="code" href="class_i_pv6_neighbour_discovery.html#p6">dadList</a>.insert(dadEntry);
00765     <span class="comment">/*</span>
00766 <span class="comment">    RFC2462: Section 5.4.2</span>
00767 <span class="comment">    To check an address, a node sends DupAddrDetectTransmits Neighbor</span>
00768 <span class="comment">    Solicitations, each separated by RetransTimer milliseconds. The</span>
00769 <span class="comment">    solicitation's Target Address is set to the address being checked,</span>
00770 <span class="comment">    the IP source is set to the unspecified address and the IP</span>
00771 <span class="comment">    destination is set to the solicited-node multicast address of the</span>
00772 <span class="comment">    target address.*/</span>
00773     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> destAddr = tentativeAddr.<a class="code" href="class_i_pv6_address.html#a19">formSolicitedNodeMulticastAddress</a>();
00774     <span class="comment">//Send a NS</span>
00775     <a class="code" href="class_i_pv6_neighbour_discovery.html#b38">createAndSendNSPacket</a>(tentativeAddr, destAddr,
00776         IPv6Address::UNSPECIFIED_ADDRESS, ie);
00777     dadEntry-&gt;numNSSent++;
00778 
00779     cMessage *msg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"dadTimeout"</span>, MK_DAD_TIMEOUT);
00780     msg-&gt;setContextPointer(dadEntry);
00781     scheduleAt(simTime()+ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_52">retransTimer</a>(), msg);
00782 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b9" doxytag="IPv6NeighbourDiscovery::initiateNeighbourUnreachabilityDetection"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::initiateNeighbourUnreachabilityDetection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">Neighbour</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>neighbour</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00433 {
00434     ASSERT(nce-&gt;reachabilityState==IPv6NeighbourCache::STALE);
00435     <span class="keyword">const</span> <a class="code" href="class_i_pv6_neighbour_discovery.html#w1">Key</a> *nceKey = nce-&gt;nceKey;
00436     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Initiating Neighbour Unreachability Detection"</span>;
00437     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(nceKey-&gt;interfaceID);
00438     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Setting NCE state to DELAY.\n"</span>;
00439     <span class="comment">/*The first time a node sends a packet to a neighbor whose entry is</span>
00440 <span class="comment">    STALE, the sender changes the state to DELAY*/</span>
00441     nce-&gt;reachabilityState = <a class="code" href="class_i_pv6_neighbour_cache.html#w8w6">IPv6NeighbourCache::DELAY</a>;
00442 
00443     <span class="comment">/*and sets a timer to expire in DELAY_FIRST_PROBE_TIME seconds.*/</span>
00444     cMessage *msg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"NUDTimeout"</span>, MK_NUD_TIMEOUT);
00445     msg-&gt;setContextPointer(nce);
00446     nce-&gt;nudTimeoutEvent = msg;
00447     scheduleAt(simTime()+ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_34">_delayFirstProbeTime</a>(), msg);
00448 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b23" doxytag="IPv6NeighbourDiscovery::initiateRouterDiscovery"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::initiateRouterDiscovery           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00856 {
00857     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Initiating Router Discovery"</span> &lt;&lt; endl;
00858     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = (<a class="code" href="class_interface_entry.html">InterfaceEntry</a> *)msg-&gt;contextPointer();
00859     <span class="keyword">delete</span> msg;
00860     <span class="comment">//RFC2461: Section 6.3.7</span>
00861     <span class="comment">/*When an interface becomes enabled, a host may be unwilling to wait for the</span>
00862 <span class="comment">    next unsolicited Router Advertisement to locate default routers or learn</span>
00863 <span class="comment">    prefixes.  To obtain Router Advertisements quickly, a host SHOULD transmit up</span>
00864 <span class="comment">    to MAX_RTR_SOLICITATIONS Router Solicitation messages each separated by at</span>
00865 <span class="comment">    least RTR_SOLICITATION_INTERVAL seconds.(FIXME:Therefore this should be invoked</span>
00866 <span class="comment">    at the beginning of the simulation-WEI)*/</span>
00867     RDEntry *rdEntry = <span class="keyword">new</span> RDEntry();
00868     rdEntry-&gt;interfaceId = ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>();
00869     rdEntry-&gt;numRSSent = 0;
00870     <a class="code" href="class_i_pv6_neighbour_discovery.html#b22">createAndSendRSPacket</a>(ie);
00871     rdEntry-&gt;numRSSent++;
00872 
00873     <span class="comment">//Create and schedule a message for retransmission to this module</span>
00874     cMessage *rdTimeoutMsg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"processRDTimeout"</span>, MK_RD_TIMEOUT);
00875     rdTimeoutMsg-&gt;setContextPointer(ie);
00876     rdEntry-&gt;timeoutMsg = rdTimeoutMsg;
00877     <a class="code" href="class_i_pv6_neighbour_discovery.html#p7">rdList</a>.insert(rdEntry);
00878     <span class="comment">/*Before a host sends an initial solicitation, it SHOULD delay the</span>
00879 <span class="comment">    transmission for a random amount of time between 0 and</span>
00880 <span class="comment">    MAX_RTR_SOLICITATION_DELAY.  This serves to alleviate congestion when</span>
00881 <span class="comment">    many hosts start up on a link at the same time, such as might happen</span>
00882 <span class="comment">    after recovery from a power failure.  If a host has already performed</span>
00883 <span class="comment">    a random delay since the interface became (re)enabled (e.g., as part</span>
00884 <span class="comment">    of Duplicate Address Detection [ADDRCONF]) there is no need to delay</span>
00885 <span class="comment">    again before sending the first Router Solicitation message.*/</span>
00886     <span class="comment">//simtime_t rndInterval = uniform(0, ie-&gt;ipv6()-&gt;_maxRtrSolicitationDelay());</span>
00887     scheduleAt(simTime()+ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_23">_rtrSolicitationInterval</a>(), rdTimeoutMsg);
00888 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0" doxytag="IPv6NeighbourDiscovery::numInitStages"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual int IPv6NeighbourDiscovery::numInitStages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const<code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00135 {<span class="keywordflow">return</span> 4;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b15" doxytag="IPv6NeighbourDiscovery::processARTimeout"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processARTimeout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>arTimeoutMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Resends a NS packet to the address intended for address resolution. TODO: Not implemented yet! <div class="fragment"><pre class="fragment">00648 {
00649     <span class="comment">//AR timeouts are cancelled when a valid solicited NA is received.</span>
00650     <a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *nce = (<a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *)arTimeoutMsg-&gt;contextPointer();
00651     <span class="keyword">const</span> <a class="code" href="class_i_pv6_neighbour_discovery.html#w1">Key</a> *nceKey = nce-&gt;nceKey;
00652     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nsTargetAddr = nceKey-&gt;<a class="code" href="struct_i_pv6_neighbour_cache_1_1_key.html#o0">address</a>;
00653     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(nceKey-&gt;interfaceID);
00654     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Num Of NS Sent:"</span> &lt;&lt; nce-&gt;numOfARNSSent &lt;&lt; endl;
00655     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Max Multicast Solicitation:"</span> &lt;&lt; ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_28">_maxMulticastSolicit</a>() &lt;&lt; endl;
00656     <span class="keywordflow">if</span> (nce-&gt;numOfARNSSent &lt; ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_28">_maxMulticastSolicit</a>())
00657     {
00658         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending another Address Resolution NS message"</span> &lt;&lt; endl;
00659         <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nsDestAddr = nsTargetAddr.<a class="code" href="class_i_pv6_address.html#a19">formSolicitedNodeMulticastAddress</a>();
00660         <a class="code" href="class_i_pv6_neighbour_discovery.html#b38">createAndSendNSPacket</a>(nsTargetAddr, nsDestAddr, nce-&gt;nsSrcAddr, ie);
00661         nce-&gt;numOfARNSSent++;
00662         scheduleAt(simTime()+ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_33">_retransTimer</a>(), arTimeoutMsg);
00663         <span class="keywordflow">return</span>;
00664     }
00665     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Address Resolution has failed."</span> &lt;&lt; endl;
00666     <a class="code" href="class_i_pv6_neighbour_discovery.html#b16">dropQueuedPacketsAwaitingAR</a>(nce);
00667     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Deleting AR timeout msg\n"</span>;
00668     <span class="keyword">delete</span> arTimeoutMsg;
00669 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b20" doxytag="IPv6NeighbourDiscovery::processDADTimeout"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processDADTimeout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sends a scheduled DAD NS packet. If number of sends is equals or more than dupAddrDetectTransmits, then permantly assign target link local address as permanent address for given interface entry. <div class="fragment"><pre class="fragment">00785 {
00786     DADEntry *dadEntry = (DADEntry *)msg-&gt;contextPointer();
00787     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = (<a class="code" href="class_interface_entry.html">InterfaceEntry</a> *)<a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(dadEntry-&gt;interfaceId);
00788     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> tentativeAddr = dadEntry-&gt;address;
00789     <span class="comment">//Here, we need to check how many DAD messages for the interface entry were</span>
00790     <span class="comment">//sent vs. DupAddrDetectTransmits</span>
00791     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"numOfDADMessagesSent is: "</span> &lt;&lt; dadEntry-&gt;numNSSent &lt;&lt; endl;
00792     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"dupAddrDetectTrans is: "</span> &lt;&lt; ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_46">dupAddrDetectTransmits</a>() &lt;&lt; endl;
00793     <span class="keywordflow">if</span> (dadEntry-&gt;numNSSent &lt; ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_46">dupAddrDetectTransmits</a>())
00794     {
00795         bubble(<span class="stringliteral">"Sending another DAD NS message."</span>);
00796         <a class="code" href="class_i_pv6_address.html">IPv6Address</a> destAddr = tentativeAddr.<a class="code" href="class_i_pv6_address.html#a19">formSolicitedNodeMulticastAddress</a>();
00797         <a class="code" href="class_i_pv6_neighbour_discovery.html#b38">createAndSendNSPacket</a>(dadEntry-&gt;address, destAddr, IPv6Address::UNSPECIFIED_ADDRESS, ie);
00798         dadEntry-&gt;numNSSent++;
00799         <span class="comment">//Reuse the received msg</span>
00800         scheduleAt(simTime()+ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_52">retransTimer</a>(), msg);
00801     }
00802     <span class="keywordflow">else</span>
00803     {
00804         bubble(<span class="stringliteral">"Max number of DAD messages for interface sent. Address is unique."</span>);
00805         ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_8">permanentlyAssign</a>(tentativeAddr);
00806         <a class="code" href="class_i_pv6_neighbour_discovery.html#p6">dadList</a>.erase(dadEntry);
00807         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"delete dadEntry and msg\n"</span>;
00808         <span class="keyword">delete</span> dadEntry;
00809         <span class="keyword">delete</span> msg;
00810         <span class="comment">/*RFC 2461: Section 6.3.7 2nd Paragraph</span>
00811 <span class="comment">        Before a host sends an initial solicitation, it SHOULD delay the</span>
00812 <span class="comment">        transmission for a random amount of time between 0 and</span>
00813 <span class="comment">        MAX_RTR_SOLICITATION_DELAY.  This serves to alleviate congestion when</span>
00814 <span class="comment">        many hosts start up on a link at the same time, such as might happen</span>
00815 <span class="comment">        after recovery from a power failure.*/</span>
00816         <span class="comment">//TODO: Placing these operations here means fast router solicitation is</span>
00817         <span class="comment">//not adopted. Will relocate.</span>
00818         <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_58">advSendAdvertisements</a>() == <span class="keyword">false</span>)
00819         {
00820             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"creating router discovery message timer\n"</span>;
00821             cMessage *rtrDisMsg = <span class="keyword">new</span> cMessage(<span class="stringliteral">"initiateRTRDIS"</span>,MK_INITIATE_RTRDIS);
00822             rtrDisMsg-&gt;setContextPointer(ie);
00823             simtime_t interval = uniform(0,ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_22">_maxRtrSolicitationDelay</a>());<span class="comment">//random delay</span>
00824             scheduleAt(simTime()+interval, rtrDisMsg);
00825         }
00826     }
00827 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5" doxytag="IPv6NeighbourDiscovery::processIPv6Datagram"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processIPv6Datagram           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_datagram.html">IPv6Datagram</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>datagram</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00187 {
00188     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Packet "</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">" arrived from IPv6 module.\n"</span>;
00189 
00190     <span class="keywordtype">int</span> nextHopIfID;
00191     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Determining Next Hop"</span> &lt;&lt; endl;
00192     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nextHopAddr = <a class="code" href="class_i_pv6_neighbour_discovery.html#b8">determineNextHop</a>(msg-&gt;destAddress(), nextHopIfID);
00193     <span class="keywordflow">if</span> (nextHopIfID == -1)
00194     {
00195         <span class="comment">//draft-ietf-ipv6-2461bis-04 has omitted on-link assumption.</span>
00196         <span class="comment">//draft-ietf-v6ops-onlinkassumption-03 explains why.</span>
00197         <a class="code" href="class_i_pv6_neighbour_discovery.html#p3">icmpv6</a>-&gt;<a class="code" href="class_i_c_m_pv6.html#a0">sendErrorMessage</a>(msg, ICMPv6_DESTINATION_UNREACHABLE, NO_ROUTE_TO_DEST);
00198         <span class="keywordflow">return</span>;
00199     }
00200     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Next Hop Address is: "</span> &lt;&lt; nextHopAddr &lt;&lt; <span class="stringliteral">" on interface: "</span> &lt;&lt; nextHopIfID &lt;&lt; endl;
00201 
00202     <span class="comment">//RFC2461: Section 5.2 Conceptual Sending Algorithm</span>
00203     <span class="comment">//Once the IP address of the next-hop node is known, the sender examines the</span>
00204     <span class="comment">//Neighbor Cache for link-layer information about that neighbor.</span>
00205     <a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *nce = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a2">lookup</a>(nextHopAddr, nextHopIfID);
00206 
00207     <span class="keywordflow">if</span> (nce==NULL)
00208     {
00209         <span class="comment">//If no entry exists,</span>
00210         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"No Entry exists in the Neighbour Cache.\n"</span>;
00211 
00212         <span class="comment">//the sender creates one, sets its state to INCOMPLETE,</span>
00213         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Creating an INCOMPLETE entry in the neighbour cache.\n"</span>;
00214         nce = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a6">addNeighbour</a>(nextHopAddr, nextHopIfID);
00215 
00216         <span class="comment">//initiates Address Resolution,</span>
00217         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Initiating Address Resolution for:"</span> &lt;&lt; nextHopAddr
00218            &lt;&lt; <span class="stringliteral">" on Interface:"</span> &lt;&lt; nextHopIfID &lt;&lt; endl;
00219         <a class="code" href="class_i_pv6_neighbour_discovery.html#b14">initiateAddressResolution</a>(msg-&gt;srcAddress(), nce);
00220 
00221         <span class="comment">//and then queues the data packet pending completion of address resolution.</span>
00222         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Add packet to entry's queue until Address Resolution is complete.\n"</span>;
00223         nce-&gt;pendingPackets.push_back(msg);
00224         <a class="code" href="class_i_pv6_neighbour_discovery.html#p0">pendingQueue</a>.insert(msg);
00225     }
00226     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nce-&gt;reachabilityState == IPv6NeighbourCache::INCOMPLETE)
00227     {
00228         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Reachability State is INCOMPLETE.Address Resolution already initiated.\n"</span>;
00229         bubble(<span class="stringliteral">"Packet added to queue until Address Resolution is complete."</span>);
00230         nce-&gt;pendingPackets.push_back(msg);
00231         <a class="code" href="class_i_pv6_neighbour_discovery.html#p0">pendingQueue</a>.insert(msg);
00232     }
00233     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nce-&gt;macAddress.isUnspecified())
00234     {
00235         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NCE's MAC address is unspecified.\n"</span>;
00236         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Initiate Address Resolution and add packet to queue.\n"</span>;
00237         <a class="code" href="class_i_pv6_neighbour_discovery.html#b14">initiateAddressResolution</a>(msg-&gt;srcAddress(), nce);
00238         nce-&gt;pendingPackets.push_back(msg);
00239         <a class="code" href="class_i_pv6_neighbour_discovery.html#p0">pendingQueue</a>.insert(msg);
00240     }
00241     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nce-&gt;reachabilityState == IPv6NeighbourCache::STALE)
00242     {
00243         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Reachability State is STALE.\n"</span>;
00244         send(msg,<span class="stringliteral">"toIPv6"</span>);
00245         <a class="code" href="class_i_pv6_neighbour_discovery.html#b9">initiateNeighbourUnreachabilityDetection</a>(nce);
00246     }
00247     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nce-&gt;reachabilityState == IPv6NeighbourCache::REACHABLE)
00248     {
00249         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Next hop is REACHABLE, sending packet to next-hop address."</span>;
00250         <a class="code" href="class_i_pv6_neighbour_discovery.html#b17">sendPacketToIPv6Module</a>(msg, nextHopAddr, msg-&gt;srcAddress(), nextHopIfID);
00251     }
00252     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nce-&gt;reachabilityState == IPv6NeighbourCache::DELAY)<span class="comment">//TODO: What if NCE is in PROBE state?</span>
00253     {
00254         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Next hop is in DELAY state, sending packet to next-hop address."</span>;
00255         <a class="code" href="class_i_pv6_neighbour_discovery.html#b17">sendPacketToIPv6Module</a>(msg, nextHopAddr, msg-&gt;srcAddress(), nextHopIfID);
00256     }
00257     <span class="keywordflow">else</span>
00258         error(<span class="stringliteral">"Unknown Neighbour cache entry state."</span>);
00259 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b49" doxytag="IPv6NeighbourDiscovery::processNAForIncompleteNCEState"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processNAForIncompleteNCEState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>na</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">IPv6NeighbourCache::Neighbour</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nce</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b50" doxytag="IPv6NeighbourDiscovery::processNAForOtherNCEStates"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processNAForOtherNCEStates           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>na</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">IPv6NeighbourCache::Neighbour</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nce</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b47" doxytag="IPv6NeighbourDiscovery::processNAPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processNAPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>na</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>naCtrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01895 {
01896     <span class="keywordflow">if</span> (<a class="code" href="class_i_pv6_neighbour_discovery.html#b48">validateNAPacket</a>(na, naCtrlInfo) == <span class="keyword">false</span>)
01897     {
01898         <span class="keyword">delete</span> naCtrlInfo;
01899         <span class="keyword">delete</span> na;
01900         <span class="keywordflow">return</span>;
01901     }
01902 
01903     <span class="comment">//Neighbour Advertisement Information</span>
01904     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> naTargetAddr = na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a13">targetAddress</a>();
01905 
01906     <span class="comment">//First, we check if the target address in NA is found in the interface it</span>
01907     <span class="comment">//was received on is tentative.</span>
01908     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(naCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a13">interfaceId</a>());
01909     <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_4">isTentativeAddress</a>(naTargetAddr))
01910     {
01911         error(<span class="stringliteral">"Duplicate Address Detected! Manual attention needed!"</span>);
01912     }
01913     <span class="comment">//Logic as defined in Section 7.2.5</span>
01914     <a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *neighbourEntry = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a2">lookup</a>(naTargetAddr, ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>());
01915 
01916     <span class="keywordflow">if</span> (neighbourEntry == NULL)
01917     {
01918         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NA received. Target Address not found in Neighbour Cache\n"</span>;
01919         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Dropping NA packet.\n"</span>;
01920         <span class="keyword">delete</span> naCtrlInfo;
01921         <span class="keyword">delete</span> na;
01922         <span class="keywordflow">return</span>;
01923     }
01924 
01925     <span class="comment">//Target Address has entry in Neighbour Cache</span>
01926     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NA received. Target Address found in Neighbour Cache\n"</span>;
01927 
01928     <span class="keywordflow">if</span> (neighbourEntry-&gt;reachabilityState == IPv6NeighbourCache::INCOMPLETE)
01929         processNAForIncompleteNCEState(na, neighbourEntry);
01930     else
01931         processNAForOtherNCEStates(na, neighbourEntry);
01932     delete naCtrlInfo;
01933     delete na;
01934 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3" doxytag="IPv6NeighbourDiscovery::processNDMessage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processNDMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6_message.html">ICMPv6Message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00149 {
00150 
00151     <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6RouterSolicitation *&gt;(msg))
00152     {
00153         <a class="code" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a> *rs = (<a class="code" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a> *)msg;
00154         <a class="code" href="class_i_pv6_neighbour_discovery.html#b26">processRSPacket</a>(rs, ctrlInfo);
00155     }
00156     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6RouterAdvertisement *&gt;(msg))
00157     {
00158         <a class="code" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *ra = (<a class="code" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *)msg;
00159         <a class="code" href="class_i_pv6_neighbour_discovery.html#b29">processRAPacket</a>(ra, ctrlInfo);
00160     }
00161     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6NeighbourSolicitation *&gt;(msg))
00162     {
00163         <a class="code" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *ns = (<a class="code" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *)msg;
00164         <a class="code" href="class_i_pv6_neighbour_discovery.html#b39">processNSPacket</a>(ns, ctrlInfo);
00165     }
00166     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6NeighbourAdvertisement *&gt;(msg))
00167     {
00168         <a class="code" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *na = (<a class="code" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *)msg;
00169         <a class="code" href="class_i_pv6_neighbour_discovery.html#b47">processNAPacket</a>(na, ctrlInfo);
00170     }
00171     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;IPv6Redirect *&gt;(msg))
00172     {
00173         <a class="code" href="class_i_pv6_redirect.html">IPv6Redirect</a> *redirect = (<a class="code" href="class_i_pv6_redirect.html">IPv6Redirect</a> *)msg;
00174         <a class="code" href="class_i_pv6_neighbour_discovery.html#b52">processRedirectPacket</a>(redirect, ctrlInfo);
00175     }
00176     <span class="keywordflow">else</span>
00177     {
00178         error(<span class="stringliteral">"Unrecognized ND message!"</span>);
00179     }
00180 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b42" doxytag="IPv6NeighbourDiscovery::processNSForNonTentativeAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processNSForNonTentativeAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrlInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01703 {
01704     <span class="comment">//Neighbour Solicitation Information</span>
01705     <a class="code" href="class_m_a_c_address.html">MACAddress</a> nsMacAddr = ns-&gt;<a class="code" href="class_i_pv6_neighbour_solicitation.html#a10">sourceLinkLayerAddress</a>();
01706 
01707     <span class="keywordtype">int</span> ifID = ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>();
01708 
01709     <span class="comment">//target addr is not tentative addr</span>
01710     <span class="comment">//solicitation processed as described in RFC2461:section 7.2.3</span>
01711     <span class="keywordflow">if</span> (nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>().<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
01712     {
01713         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Address is duplicate! Inform Sender of duplicate address!\n"</span>;
01714         <a class="code" href="class_i_pv6_neighbour_discovery.html#b45">sendSolicitedNA</a>(ns, nsCtrlInfo, ie);
01715     }
01716     <span class="keywordflow">else</span>
01717     {
01718         <a class="code" href="class_i_pv6_neighbour_discovery.html#b43">processNSWithSpecifiedSrcAddr</a>(ns, nsCtrlInfo, ie);
01719     }
01720 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b41" doxytag="IPv6NeighbourDiscovery::processNSForTentativeAddress"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processNSForTentativeAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01675 {
01676     <span class="comment">//Control Information</span>
01677     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nsSrcAddr = nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>();
01678     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nsDestAddr = nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a5">destAddr</a>();
01679 
01680     ASSERT(nsSrcAddr.<a class="code" href="class_i_pv6_address.html#a24">isUnicast</a>() || nsSrcAddr.<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>());
01681     <span class="comment">//solicitation is processed as described in RFC2462:section 5.4.3</span>
01682 
01683     <span class="keywordflow">if</span> (nsSrcAddr.<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
01684     {
01685         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Source Address is UNSPECIFIED. Sender is performing DAD\n"</span>;
01686         <span class="comment">//Sender performing Duplicate Address Detection</span>
01687         <span class="keywordflow">if</span> (<a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#z54_0">localDeliver</a>(nsSrcAddr))
01688             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NS comes from myself. Ignoring NS\n"</span>;
01689         <span class="keywordflow">else</span>
01690             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NS comes from another node. Address is duplicate!\n"</span>;
01691             error(<span class="stringliteral">"Duplicate Address Detected! Manual Attention Required!"</span>);
01692     }
01693     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nsSrcAddr.<a class="code" href="class_i_pv6_address.html#a24">isUnicast</a>())
01694     {
01695         <span class="comment">//Sender performing address resolution</span>
01696         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sender is performing Address Resolution\n"</span>;
01697         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Target Address is tentative. Ignoring NS.\n"</span>;
01698     }
01699 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b39" doxytag="IPv6NeighbourDiscovery::processNSPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processNSPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>naCtrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01595 {
01596     <span class="comment">//Control Information</span>
01597     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a13">interfaceId</a>());
01598 
01599     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> nsTargetAddr = ns-&gt;<a class="code" href="class_i_pv6_neighbour_solicitation.html#a7">targetAddress</a>();
01600 
01601     <span class="comment">//RFC 2461:Section 7.2.3</span>
01602     <span class="comment">//If target address is not a valid "unicast" or anycast address assigned to the</span>
01603     <span class="comment">//receiving interface, we should silently discard the packet.</span>
01604     <span class="keywordflow">if</span> (<a class="code" href="class_i_pv6_neighbour_discovery.html#b40">validateNSPacket</a>(ns, nsCtrlInfo) == <span class="keyword">false</span>
01605         || ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_5">hasAddress</a>(nsTargetAddr) == <span class="keyword">false</span>)
01606     {
01607         bubble(<span class="stringliteral">"NS validation failed\n"</span>);
01608         <span class="keyword">delete</span> nsCtrlInfo;
01609         <span class="keyword">delete</span> ns;
01610         <span class="keywordflow">return</span>;
01611     }
01612     bubble(<span class="stringliteral">"NS validation passed.\n"</span>);
01613     <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_4">isTentativeAddress</a>(nsTargetAddr))
01614     {
01615         <span class="comment">//If the Target Address is tentative, the Neighbor Solicitation should</span>
01616         <span class="comment">//be processed as described in [ADDRCONF].</span>
01617         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Process NS for Tentative target address.\n"</span>;
01618         <a class="code" href="class_i_pv6_neighbour_discovery.html#b41">processNSForTentativeAddress</a>(ns, nsCtrlInfo);
01619     }
01620     <span class="keywordflow">else</span>
01621     {
01622         <span class="comment">//Otherwise, the following description applies.</span>
01623         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Process NS for Non-Tentative target address.\n"</span>;
01624         <a class="code" href="class_i_pv6_neighbour_discovery.html#b42">processNSForNonTentativeAddress</a>(ns, nsCtrlInfo, ie);
01625     }
01626     <span class="keyword">delete</span> nsCtrlInfo;
01627     <span class="keyword">delete</span> ns;
01628 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b43" doxytag="IPv6NeighbourDiscovery::processNSWithSpecifiedSrcAddr"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processNSWithSpecifiedSrcAddr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrlInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01724 {
01725     <span class="comment">//RFC 2461, Section 7.2.3</span>
01726     <span class="comment">/*If the Source Address is not the unspecified address and, on link layers</span>
01727 <span class="comment">    that have addresses, the solicitation includes a Source Link-Layer Address</span>
01728 <span class="comment">    option, then the recipient SHOULD create or update the Neighbor Cache entry</span>
01729 <span class="comment">    for the IP Source Address of the solicitation.*/</span>
01730 
01731     <span class="comment">//Neighbour Solicitation Information</span>
01732     <a class="code" href="class_m_a_c_address.html">MACAddress</a> nsMacAddr = ns-&gt;<a class="code" href="class_i_pv6_neighbour_solicitation.html#a10">sourceLinkLayerAddress</a>();
01733 
01734     <span class="keywordtype">int</span> ifID = ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>();
01735 
01736     <span class="comment">//Look for the Neighbour Cache Entry</span>
01737     <a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *entry = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a2">lookup</a>(nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>(), ifID);
01738 
01739     <span class="keywordflow">if</span> (entry == NULL)
01740     {
01741         <span class="comment">/*If an entry does not already exist, the node SHOULD create a new one</span>
01742 <span class="comment">        and set its reachability state to STALE as specified in Section 7.3.3.*/</span>
01743         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Neighbour Entry not found. Create a Neighbour Cache Entry.\n"</span>;
01744         <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a6">addNeighbour</a>(nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>(), ifID, nsMacAddr);
01745     }
01746     <span class="keywordflow">else</span>
01747     {
01748         <span class="comment">/*If an entry already exists, and the cached link-layer address differs from</span>
01749 <span class="comment">        the one in the received Source Link-Layer option,*/</span>
01750         <span class="keywordflow">if</span> (!(entry-&gt;macAddress.equals(nsMacAddr)) &amp;&amp; !nsMacAddr.<a class="code" href="class_m_a_c_address.html#a13">isUnspecified</a>())
01751         {
01752             <span class="comment">//the cached address should be replaced by the received address</span>
01753             entry-&gt;<a class="code" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html#o1">macAddress</a> = nsMacAddr;
01754             <span class="comment">//and the entry's reachability state MUST be set to STALE.</span>
01755             entry-&gt;reachabilityState = <a class="code" href="class_i_pv6_neighbour_cache.html#w8w5">IPv6NeighbourCache::STALE</a>;
01756         }
01757     }
01758     <span class="comment">/*After any updates to the Neighbor Cache, the node sends a Neighbor</span>
01759 <span class="comment">    Advertisement response as described in the next section.*/</span>
01760     <a class="code" href="class_i_pv6_neighbour_discovery.html#b45">sendSolicitedNA</a>(ns, nsCtrlInfo, ie);
01761 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b10" doxytag="IPv6NeighbourDiscovery::processNUDTimeout"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processNUDTimeout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>timeoutMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00451 {
00452     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NUD has timed out\n"</span>;
00453     <a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *nce = (<a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *) timeoutMsg-&gt;contextPointer();
00454     <span class="keyword">const</span> <a class="code" href="class_i_pv6_neighbour_discovery.html#w1">Key</a> *nceKey = nce-&gt;nceKey;
00455     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(nceKey-&gt;interfaceID);
00456 
00457     <span class="keywordflow">if</span> (nce-&gt;reachabilityState == IPv6NeighbourCache::DELAY)
00458     {
00459         <span class="comment">/*If the entry is still in the DELAY state when the timer expires, the</span>
00460 <span class="comment">        entry's state changes to PROBE. If reachability confirmation is received,</span>
00461 <span class="comment">        the entry's state changes to REACHABLE.*/</span>
00462         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Neighbour Entry is still in DELAY state.\n"</span>;
00463         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Entering PROBE state. Sending NS probe.\n"</span>;
00464         nce-&gt;reachabilityState = <a class="code" href="class_i_pv6_neighbour_cache.html#w8w7">IPv6NeighbourCache::PROBE</a>;
00465         nce-&gt;numProbesSent = 0;
00466     }
00467 
00468     <span class="comment">/*If no response is received after waiting RetransTimer milliseconds</span>
00469 <span class="comment">    after sending the MAX_UNICAST_SOLICIT solicitations, retransmissions cease</span>
00470 <span class="comment">    and the entry SHOULD be deleted. Subsequent traffic to that neighbor will</span>
00471 <span class="comment">    recreate the entry and performs address resolution again.*/</span>
00472     <span class="keywordflow">if</span> (nce-&gt;numProbesSent == ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_29">_maxUnicastSolicit</a>())
00473     {
00474         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Max number of probes have been sent."</span> &lt;&lt; endl;
00475         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Neighbour is Unreachable, removing NCE."</span> &lt;&lt; endl;
00476         <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a10">remove</a>(nceKey-&gt;address, nceKey-&gt;interfaceID);
00477         <span class="keywordflow">return</span>;
00478     }
00479 
00480     <span class="comment">/*Upon entering the PROBE state, a node sends a unicast Neighbor Solicitation</span>
00481 <span class="comment">    message to the neighbor using the cached link-layer address.*/</span>
00482     <a class="code" href="class_i_pv6_neighbour_discovery.html#b38">createAndSendNSPacket</a>(nceKey-&gt;address, nceKey-&gt;address,
00483         ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_9">preferredAddress</a>(), ie);
00484     nce-&gt;numProbesSent++;
00485     <span class="comment">/*While in the PROBE state, a node retransmits Neighbor Solicitation messages</span>
00486 <span class="comment">    every RetransTimer milliseconds until reachability confirmation is obtained.</span>
00487 <span class="comment">    Probes are retransmitted even if no additional packets are sent to the</span>
00488 <span class="comment">    neighbor.*/</span>
00489     scheduleAt(simTime()+ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_33">_retransTimer</a>(), timeoutMsg);
00490 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b30" doxytag="IPv6NeighbourDiscovery::processRAForRouterUpdates"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processRAForRouterUpdates           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ra</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>raCtrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01155 {
01156     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Processing RA for Router Updates\n"</span>;
01157     <span class="comment">//RFC2461: Section 6.3.4</span>
01158     <span class="comment">//Paragraphs 1 and 2 omitted.</span>
01159 
01160     <span class="comment">//On receipt of a valid Router Advertisement, a host extracts the source</span>
01161     <span class="comment">//address of the packet and does the following:</span>
01162     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> raSrcAddr = raCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>();
01163     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(raCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a13">interfaceId</a>());
01164     <span class="keywordtype">int</span> ifID = ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>();
01165 
01166     <span class="comment">/*- If the address is not already present in the host's Default Router List,</span>
01167 <span class="comment">    and the advertisement's Router Lifetime is non-zero, create a new entry in</span>
01168 <span class="comment">    the list, and initialize its invalidation timer value from the advertisement's</span>
01169 <span class="comment">    Router Lifetime field.*/</span>
01170     <a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *neighbour = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a2">lookup</a>(raSrcAddr, ifID);
01171     <span class="keywordflow">if</span> (neighbour == NULL)
01172     {
01173         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Neighbour Cache Entry does not contain RA's source address\n"</span>;
01174         <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a13">routerLifetime</a>() != 0)
01175         {
01176             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"RA's router lifetime is non-zero, creating an entry in the "</span>
01177                &lt;&lt; <span class="stringliteral">"Host's default router list.\n"</span> &lt;&lt; ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a13">routerLifetime</a>();
01178             <span class="comment">//If a Neighbor Cache entry is created for the router its reachability</span>
01179             <span class="comment">//state MUST be set to STALE as specified in Section 7.3.3.</span>
01180             <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a19">sourceLinkLayerAddress</a>().<a class="code" href="class_m_a_c_address.html#a13">isUnspecified</a>())
01181             {
01182                 neighbour = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a8">addRouter</a>(raSrcAddr, ifID,
01183                     simTime()+ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a13">routerLifetime</a>());
01184                 <span class="comment">//Note:invalidation timers are not explicitly defined.</span>
01185             }
01186             <span class="keywordflow">else</span>
01187             {
01188                 neighbour = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a8">addRouter</a>(raSrcAddr, ifID,
01189                     ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a19">sourceLinkLayerAddress</a>(), simTime()+ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a13">routerLifetime</a>());
01190                 <span class="comment">//According to Greg, we should add a default route for hosts as well!</span>
01191                 <a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#z57_4">addDefaultRoute</a>(raSrcAddr, ifID, simTime()+ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a13">routerLifetime</a>());
01192             }
01193         }
01194         <span class="keywordflow">else</span>
01195         {
01196             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Router Lifetime is 0, adding NON-default router.\n"</span>;
01197             <span class="comment">//WEI-The router is advertising itself, BUT not as a default router.</span>
01198             <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a19">sourceLinkLayerAddress</a>().<a class="code" href="class_m_a_c_address.html#a13">isUnspecified</a>())
01199                 neighbour = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a6">addNeighbour</a>(raSrcAddr, ifID);
01200             <span class="keywordflow">else</span>
01201                 neighbour = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a6">addNeighbour</a>(raSrcAddr, ifID,
01202                     ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a19">sourceLinkLayerAddress</a>());
01203             neighbour-&gt;<a class="code" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html#o2">isRouter</a> = <span class="keyword">true</span>;
01204         }
01205     }
01206     <span class="keywordflow">else</span>
01207     {
01208         <span class="comment">//If no Source Link-Layer Address is included, but a corresponding Neighbor</span>
01209         <span class="comment">//Cache entry exists, its IsRouter flag MUST be set to TRUE.</span>
01210         neighbour-&gt;<a class="code" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html#o2">isRouter</a> = <span class="keyword">true</span>;
01211 
01212         <span class="comment">//If a cache entry already exists and is updated with a different link-</span>
01213         <span class="comment">//layer address the reachability state MUST also be set to STALE.</span>
01214         <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a19">sourceLinkLayerAddress</a>().<a class="code" href="class_m_a_c_address.html#a13">isUnspecified</a>() == <span class="keyword">false</span> &amp;&amp;
01215             neighbour-&gt;macAddress.<a class="code" href="class_m_a_c_address.html#a15">equals</a>(ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a19">sourceLinkLayerAddress</a>()) == <span class="keyword">false</span>)
01216             neighbour-&gt;<a class="code" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html#o1">macAddress</a> = ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a19">sourceLinkLayerAddress</a>();
01217 
01218         <span class="comment">/*- If the address is already present in the host's Default Router List</span>
01219 <span class="comment">        as a result of a previously-received advertisement, reset its invalidation</span>
01220 <span class="comment">        timer to the Router Lifetime value in the newly-received advertisement.*/</span>
01221         neighbour-&gt;routerExpiryTime = simTime()+ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a13">routerLifetime</a>();
01222 
01223         <span class="comment">/*- If the address is already present in the host's Default Router List</span>
01224 <span class="comment">        and the received Router Lifetime value is zero, immediately time-out the</span>
01225 <span class="comment">        entry as specified in Section 6.3.5.*/</span>
01226         <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a13">routerLifetime</a>() == 0)
01227         {
01228             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"RA's router lifetime is ZERO. Timing-out entry.\n"</span>;
01229             <a class="code" href="class_i_pv6_neighbour_discovery.html#b13">timeoutDefaultRouter</a>(raSrcAddr, ifID);
01230         }
01231     }
01232 
01233     <span class="comment">//Paragraph Omitted.</span>
01234 
01235     <span class="comment">//If the received Cur Hop Limit value is non-zero the host SHOULD set</span>
01236     <span class="comment">//its CurHopLimit variable to the received value.</span>
01237     <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a7">curHopLimit</a>() != 0)
01238     {
01239         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"RA's Cur Hop Limit is non-zero. Setting host's Cur Hop Limit to "</span>
01240            &lt;&lt; <span class="stringliteral">"received value.\n"</span>;
01241         ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_54">setCurHopLimit</a>(ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a7">curHopLimit</a>());
01242     }
01243 
01244     <span class="comment">//If the received Reachable Time value is non-zero the host SHOULD set its</span>
01245     <span class="comment">//BaseReachableTime variable to the received value.</span>
01246     <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a15">reachableTime</a>() != 0)
01247     {
01248         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"RA's reachable time is non-zero "</span>;
01249         <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a15">reachableTime</a>() != ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_51">reachableTime</a>())
01250         {
01251             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">" and RA's and Host's reachable time differ, \nsetting host's base"</span>
01252                &lt;&lt; <span class="stringliteral">" reachable time to received value.\n"</span>;
01253             ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_55">setBaseReachableTime</a>(ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a15">reachableTime</a>());
01254             <span class="comment">//If the new value differs from the previous value, the host SHOULD</span>
01255             <span class="comment">//recompute a new random ReachableTime value.</span>
01256             ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_56">setReachableTime</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z50_5">generateReachableTime</a>());
01257         }
01258         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; endl;
01259     }
01260 
01261     <span class="comment">//The RetransTimer variable SHOULD be copied from the Retrans Timer field,</span>
01262     <span class="comment">//if the received value is non-zero.</span>
01263     <span class="keywordflow">if</span> (ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a17">retransTimer</a>() != 0)
01264     {
01265         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"RA's retrans timer is non-zero, copying retrans timer variable.\n"</span>;
01266         ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_57">setRetransTimer</a>(ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a17">retransTimer</a>());
01267     }
01268 
01269     <span class="comment">/*If the MTU option is present, hosts SHOULD copy the option's value into</span>
01270 <span class="comment">    LinkMTU so long as the value is greater than or equal to the minimum link MTU</span>
01271 <span class="comment">    [IPv6] and does not exceed the default LinkMTU value specified in the link</span>
01272 <span class="comment">    type specific document (e.g., [IPv6-ETHER]).*/</span>
01273     <span class="comment">//TODO: not done yet</span>
01274 
01275     <a class="code" href="class_i_pv6_neighbour_discovery.html#b31">processRAPrefixInfo</a>(ra, ie);
01276 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b29" doxytag="IPv6NeighbourDiscovery::processRAPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processRAPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ra</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>raCtrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01118 {
01119     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = <a class="code" href="class_i_pv6_neighbour_discovery.html#p1">ift</a>-&gt;<a class="code" href="class_interface_table.html#a5">interfaceAt</a>(raCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a13">interfaceId</a>());
01120 
01121     <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_58">advSendAdvertisements</a>())
01122     {
01123         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Interface is an advertising interface, dropping RA message.\n"</span>;
01124         <span class="keyword">delete</span> ra;
01125         <span class="keywordflow">return</span>;
01126     }
01127     <span class="keywordflow">else</span>
01128     {
01129         <span class="keywordflow">if</span> (<a class="code" href="class_i_pv6_neighbour_discovery.html#b37">validateRAPacket</a>(ra, raCtrlInfo) == <span class="keyword">false</span>)
01130         {
01131             <span class="keyword">delete</span> ra;
01132             <span class="keywordflow">return</span>;
01133         }
01134         <a class="code" href="class_i_pv6_neighbour_discovery.html#b24">cancelRouterDiscovery</a>(ie);<span class="comment">//Cancel router discovery if it is in progress.</span>
01135         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Interface is a host, processing RA.\n"</span>;
01136 
01137         <a class="code" href="class_i_pv6_neighbour_discovery.html#b30">processRAForRouterUpdates</a>(ra, raCtrlInfo);<span class="comment">//See RFC2461: Section 6.3.4</span>
01138 
01139         <span class="comment">//Possible options</span>
01140         <a class="code" href="class_m_a_c_address.html">MACAddress</a> macAddress = ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a19">sourceLinkLayerAddress</a>();
01141         <a class="code" href="_i_n_e_t_defs_8h.html#a4">uint</a> mtu = ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a22">MTU</a>();
01142         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ra-&gt;prefixInformationArraySize(); i++)
01143         {
01144             <a class="code" href="class_i_pv6_n_d_prefix_information.html">IPv6NDPrefixInformation</a>&amp; prefixInfo = ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a26">prefixInformation</a>(i);
01145             <span class="keywordflow">if</span> (prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a10">autoAddressConfFlag</a>() == <span class="keyword">true</span>)<span class="comment">//If auto addr conf is set</span>
01146                 <a class="code" href="class_i_pv6_neighbour_discovery.html#b32">processRAPrefixInfoForAddrAutoConf</a>(prefixInfo, ie);<span class="comment">//We process prefix Info and form an addr</span>
01147         }
01148     }
01149     <span class="keyword">delete</span> raCtrlInfo;
01150     <span class="keyword">delete</span> ra;
01151 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b31" doxytag="IPv6NeighbourDiscovery::processRAPrefixInfo"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processRAPrefixInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ra</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01280 {
01281     <span class="comment">//Continued from section 6.3.4</span>
01282     <span class="comment">/*Prefix Information options that have the "on-link" (L) flag set indicate a</span>
01283 <span class="comment">    prefix identifying a range of addresses that should be considered on-link.</span>
01284 <span class="comment">    Note, however, that a Prefix Information option with the on-link flag set to</span>
01285 <span class="comment">    zero conveys no information concerning on-link determination and MUST NOT be</span>
01286 <span class="comment">    interpreted to mean that addresses covered by the prefix are off-link. The</span>
01287 <span class="comment">    only way to cancel a previous on-link indication is to advertise that prefix</span>
01288 <span class="comment">    with the L-bit set and the Lifetime set to zero. The default behavior (see</span>
01289 <span class="comment">    Section 5.2) when sending a packet to an address for which no information is</span>
01290 <span class="comment">    known about the on-link status of the address is to forward the packet to a</span>
01291 <span class="comment">    default router; the reception of a Prefix Information option with the "on-link "</span>
01292 <span class="comment">    (L) flag set to zero does not change this behavior. The reasons for an address</span>
01293 <span class="comment">    being treated as on-link is specified in the definition of "on-link" in</span>
01294 <span class="comment">    Section 2.1. Prefixes with the on-link flag set to zero would normally have</span>
01295 <span class="comment">    the autonomous flag set and be used by [ADDRCONF].*/</span>
01296     <a class="code" href="class_i_pv6_n_d_prefix_information.html">IPv6NDPrefixInformation</a> prefixInfo;
01297     <span class="comment">//For each Prefix Information option</span>
01298     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ra-&gt;prefixInformationArraySize(); i++)
01299     {
01300         prefixInfo = ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a26">prefixInformation</a>(i);
01301         <span class="keywordflow">if</span> (!prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a8">onlinkFlag</a>()) <span class="keywordflow">break</span>;<span class="comment">//skip to next prefix option</span>
01302 
01303         <span class="comment">//with the on-link flag set, a host does the following:</span>
01304         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Fetching Prefix Information:"</span> &lt;&lt; i+1 &lt;&lt; <span class="stringliteral">" of "</span>
01305            &lt;&lt; ra-&gt;<a class="code" href="class_i_pv6_router_advertisement.html#a25">prefixInformationArraySize</a>() &lt;&lt; endl;
01306         <a class="code" href="_i_n_e_t_defs_8h.html#a4">uint</a> prefixLength = prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a6">prefixLength</a>();
01307         simtime_t validLifetime = prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a12">validLifetime</a>();
01308         <a class="code" href="_i_n_e_t_defs_8h.html#a4">uint</a> preferredLifetime = prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a14">preferredLifetime</a>();
01309         <a class="code" href="class_i_pv6_address.html">IPv6Address</a> prefix = prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a16">prefix</a>();
01310 
01311         <span class="comment">//- If the prefix is the link-local prefix, silently ignore the Prefix</span>
01312         <span class="comment">//Information option.</span>
01313         <span class="keywordflow">if</span> (prefix.<a class="code" href="class_i_pv6_address.html#a26">isLinkLocal</a>())
01314         {
01315             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Prefix is link-local, ignoring prefix.\n"</span>;
01316             <span class="keywordflow">return</span>;
01317         }
01318 
01319         <span class="comment">//- If the prefix is not already present in the Prefix List,</span>
01320         <span class="keywordflow">if</span> (!<a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#z54_3">isPrefixPresent</a>(prefix)) {
01321             <span class="comment">//and the Prefix Information option's Valid Lifetime field is non-zero,</span>
01322             <span class="keywordflow">if</span> (validLifetime != 0)
01323             {
01324                 <span class="comment">/*create a new entry for the prefix and initialize its invalidation</span>
01325 <span class="comment">                timer to the Valid Lifetime value in the Prefix Information option.*/</span>
01326                 <a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#z57_0">addOrUpdateOnLinkPrefix</a>(prefix, prefixLength, ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>(),
01327                     simTime()+validLifetime);
01328             }
01329             <span class="comment">/*- If the Prefix Information option's Valid Lifetime field is zero,</span>
01330 <span class="comment">            and the prefix is not present in the host's Prefix List,</span>
01331 <span class="comment">            silently ignore the option.*/</span>
01332         }
01333         <span class="keywordflow">else</span>
01334         {
01335             <span class="comment">/* If the new Lifetime value is zero, time-out the prefix immediately</span>
01336 <span class="comment">            (see Section 6.3.5).*/</span>
01337             <span class="keywordflow">if</span> (validLifetime == 0)
01338             {
01339                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Prefix Info's valid lifetime is 0, time-out prefix\n"</span>;
01340                 <a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#z57_1">removeOnLinkPrefix</a>(prefix, prefixLength);
01341                 <span class="keywordflow">return</span>;
01342             }
01343             <span class="comment">/*- If the prefix is already present in the host's Prefix List as</span>
01344 <span class="comment">            the result of a previously-received advertisement, reset its</span>
01345 <span class="comment">            invalidation timer to the Valid Lifetime value in the Prefix</span>
01346 <span class="comment">            Information option.*/</span>
01347             <a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#z57_0">addOrUpdateOnLinkPrefix</a>(prefix, prefixLength, ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>(),
01348                 simTime()+validLifetime);
01349         }
01350 
01351         <span class="comment">/*Stateless address autoconfiguration [ADDRCONF] may in some</span>
01352 <span class="comment">        circumstances increase the Valid Lifetime of a prefix or ignore it</span>
01353 <span class="comment">        completely in order to prevent a particular denial of service attack.</span>
01354 <span class="comment">        However, since the effect of the same denial of service targeted at</span>
01355 <span class="comment">        the on-link prefix list is not catastrophic (hosts would send packets</span>
01356 <span class="comment">        to a default router and receive a redirect rather than sending</span>
01357 <span class="comment">        packets directly to a neighbor) the Neighbor Discovery protocol does</span>
01358 <span class="comment">        not impose such a check on the prefix lifetime values.*/</span>
01359     }
01360 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b32" doxytag="IPv6NeighbourDiscovery::processRAPrefixInfoForAddrAutoConf"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processRAPrefixInfoForAddrAutoConf           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_n_d_prefix_information.html">IPv6NDPrefixInformation</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>prefixInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01364 {
01365     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Processing Prefix Info for address auto-configuration.\n"</span>;
01366     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> prefix = prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a16">prefix</a>();
01367     <a class="code" href="_i_n_e_t_defs_8h.html#a4">uint</a> prefixLength = prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a6">prefixLength</a>();
01368     simtime_t preferredLifetime = prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a14">preferredLifetime</a>();
01369     simtime_t validLifetime = prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a12">validLifetime</a>();
01370 
01371     <span class="comment">//RFC 2461: Section 5.5.3</span>
01372     <span class="comment">//First condition tested, the autonomous flag is already set</span>
01373 
01374     <span class="comment">//b) If the prefix is the link-local prefix, silently ignore the Prefix</span>
01375     <span class="comment">//Information option.</span>
01376     <span class="keywordflow">if</span> (prefixInfo.<a class="code" href="class_i_pv6_n_d_prefix_information.html#a16">prefix</a>().<a class="code" href="class_i_pv6_address.html#a26">isLinkLocal</a>() == <span class="keyword">true</span>)
01377     {
01378         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Prefix is link-local, ignore Prefix Information Option\n"</span>;
01379         <span class="keywordflow">return</span>;
01380     }
01381 
01382     <span class="comment">//c) If the preferred lifetime is greater than the valid lifetime, silently</span>
01383     <span class="comment">//ignore the Prefix Information option. A node MAY wish to log a system</span>
01384     <span class="comment">//management error in this case.</span>
01385     <span class="keywordflow">if</span> (preferredLifetime &gt; validLifetime)
01386     {
01387         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Preferred lifetime is greater than valid lifetime, ignore Prefix Information\n"</span>;
01388         <span class="keywordflow">return</span>;
01389     }
01390 
01391     <span class="keywordtype">bool</span> isPrefixAssignedToInterface = <span class="keyword">false</span>;
01392     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ie-&gt;ipv6()-&gt;numAddresses(); i++)
01393     {
01394         <span class="keywordflow">if</span> (ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_3">address</a>(i).<a class="code" href="class_i_pv6_address.html#a21">matches</a>(prefix, prefixLength) == <span class="keyword">true</span>)
01395             isPrefixAssignedToInterface = <span class="keyword">true</span>;
01396     }
01397     <span class="comment">/*d) If the prefix advertised does not match the prefix of an address already</span>
01398 <span class="comment">         in the list, and the Valid Lifetime is not 0, form an address (and add</span>
01399 <span class="comment">         it to the list) by combining the advertised prefix with the links</span>
01400 <span class="comment">         interface identifier as follows:*/</span>
01401     <span class="keywordflow">if</span> (isPrefixAssignedToInterface == <span class="keyword">false</span> &amp;&amp; validLifetime != 0)
01402     {
01403         <a class="code" href="class_i_pv6_address.html">IPv6Address</a> linkLocalAddress = ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_10">linkLocalAddress</a>();
01404         ASSERT(linkLocalAddress.<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>() == <span class="keyword">false</span>);
01405         <a class="code" href="class_i_pv6_address.html">IPv6Address</a> newAddr = linkLocalAddress.<a class="code" href="class_i_pv6_address.html#a17">setPrefix</a>(prefix, prefixLength);
01406         <span class="comment">//TODO: for now we leave the newly formed address as not tentative,</span>
01407         <span class="comment">//according to Greg, we have to always perform DAD for a newly formed address.</span>
01408         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Assigning new address to: "</span> &lt;&lt; ie-&gt;<a class="code" href="class_interface_entry.html#a5">name</a>() &lt;&lt; endl;
01409         ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_0">assignAddress</a>(newAddr, <span class="keyword">false</span>, simTime()+validLifetime,
01410             simTime()+preferredLifetime);
01411     }
01412 
01413     <span class="comment">//TODO: this is the simplified version.</span>
01414     <span class="comment">/*e) If the advertised prefix matches the prefix of an autoconfigured</span>
01415 <span class="comment">       address (i.e., one obtained via stateless or stateful address</span>
01416 <span class="comment">       autoconfiguration) in the list of addresses associated with the</span>
01417 <span class="comment">       interface, the specific action to perform depends on the Valid</span>
01418 <span class="comment">       Lifetime in the received advertisement and the Lifetime</span>
01419 <span class="comment">       associated with the previously autoconfigured address (which we</span>
01420 <span class="comment">       call StoredLifetime in the discussion that follows):</span>
01421 <span class="comment"></span>
01422 <span class="comment">       1) If the received Lifetime is greater than 2 hours or greater</span>
01423 <span class="comment">          than StoredLifetime, update the stored Lifetime of the</span>
01424 <span class="comment">          corresponding address.</span>
01425 <span class="comment"></span>
01426 <span class="comment">       2) If the StoredLifetime is less than or equal to 2 hours and the</span>
01427 <span class="comment">          received Lifetime is less than or equal to StoredLifetime,</span>
01428 <span class="comment">          ignore the prefix, unless the Router Advertisement from which</span>
01429 <span class="comment"></span>
01430 <span class="comment">          this Prefix Information option was obtained has been</span>
01431 <span class="comment">          authenticated (e.g., via IPSec [RFC2402]). If the Router</span>
01432 <span class="comment">          Advertisment was authenticated, the StoredLifetime should be</span>
01433 <span class="comment">          set to the Lifetime in the received option.</span>
01434 <span class="comment"></span>
01435 <span class="comment">       3) Otherwise, reset the stored Lifetime in the corresponding</span>
01436 <span class="comment">          address to two hours.*/</span>
01437 
01438 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b25" doxytag="IPv6NeighbourDiscovery::processRDTimeout"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processRDTimeout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00906 {
00907     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = (<a class="code" href="class_interface_entry.html">InterfaceEntry</a> *)msg-&gt;contextPointer();
00908     RDEntry *rdEntry = <a class="code" href="class_i_pv6_neighbour_discovery.html#b7">fetchRDEntry</a>(ie);
00909     <span class="keywordflow">if</span> (rdEntry-&gt;numRSSent &lt; ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_24">_maxRtrSolicitations</a>())
00910     {
00911         bubble(<span class="stringliteral">"Sending another RS message."</span>);
00912         <a class="code" href="class_i_pv6_neighbour_discovery.html#b22">createAndSendRSPacket</a>(ie);
00913         rdEntry-&gt;numRSSent++;
00914         <span class="comment">//Need to find out if this is the last RS we are sending out.</span>
00915         <span class="keywordflow">if</span> (rdEntry-&gt;numRSSent == ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_24">_maxRtrSolicitations</a>())
00916             scheduleAt(simTime()+ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_22">_maxRtrSolicitationDelay</a>(), msg);
00917         <span class="keywordflow">else</span>
00918             scheduleAt(simTime()+ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_23">_rtrSolicitationInterval</a>(), msg);
00919     }
00920     <span class="keywordflow">else</span>
00921     {
00922         <span class="comment">//RFC 2461, Section 6.3.7</span>
00923         <span class="comment">/*If a host sends MAX_RTR_SOLICITATIONS solicitations, and receives no Router</span>
00924 <span class="comment">        Advertisements after having waited MAX_RTR_SOLICITATION_DELAY seconds after</span>
00925 <span class="comment">        sending the last solicitation, the host concludes that there are no routers</span>
00926 <span class="comment">        on the link for the purpose of [ADDRCONF]. However, the host continues to</span>
00927 <span class="comment">        receive and process Router Advertisements messages in the event that routers</span>
00928 <span class="comment">        appear on the link.*/</span>
00929         bubble(<span class="stringliteral">"Max number of RS messages sent"</span>);
00930         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"No RA messages were received. Assume no routers are on-link"</span>;
00931         <span class="keyword">delete</span> rdEntry;
00932         <span class="keyword">delete</span> msg;
00933     }
00934 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b52" doxytag="IPv6NeighbourDiscovery::processRedirectPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processRedirectPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_redirect.html">IPv6Redirect</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>redirect</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">02145 {
02146     <span class="comment">//First we need to extract information from the redirect message</span>
02147     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> targetAddr = redirect-&gt;<a class="code" href="class_i_pv6_redirect.html#a7">targetAddress</a>();<span class="comment">//Addressed to me</span>
02148     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> destAddr = redirect-&gt;<a class="code" href="class_i_pv6_redirect.html#a10">destinationAddress</a>();<span class="comment">//new dest addr</span>
02149 
02150     <span class="comment">//Optional</span>
02151     <a class="code" href="class_m_a_c_address.html">MACAddress</a> macAddr = redirect-&gt;<a class="code" href="class_i_pv6_redirect.html#a13">targetLinkLayerAddress</a>();
02152 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b26" doxytag="IPv6NeighbourDiscovery::processRSPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::processRSPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>rs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>rsCtrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00938 {
00939     <span class="keywordflow">if</span> (<a class="code" href="class_i_pv6_neighbour_discovery.html#b27">validateRSPacket</a>(rs, rsCtrlInfo) == <span class="keyword">false</span>) return;
00940     <span class="comment">//Find out which interface the RS message arrived on.</span>
00941     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = ift-&gt;interfaceAt(rsCtrlInfo-&gt;interfaceId());
00942     AdvIfEntry *advIfEntry = fetchAdvIfEntry(ie);<span class="comment">//fetch advertising interface entry.</span>
00943 
00944     <span class="comment">//RFC 2461: Section 6.2.6</span>
00945     <span class="comment">//A host MUST silently discard any received Router Solicitation messages.</span>
00946     if (ie-&gt;ipv6()-&gt;advSendAdvertisements())
00947     {
00948         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"This is an advertising interface, processing RS\n"</span>;
00949 
00950         <span class="keywordflow">if</span> (<a class="code" href="class_i_pv6_neighbour_discovery.html#b27">validateRSPacket</a>(rs, rsCtrlInfo) == <span class="keyword">false</span>) return;
00951         EV &lt;&lt; "RS message validated\n";
00952 
00953         <span class="comment">//First we extract RS specific information from the received message</span>
00954         <a class="code" href="class_m_a_c_address.html">MACAddress</a> macAddr = rs-&gt;sourceLinkLayerAddress();
00955         EV &lt;&lt; "MAC Address extracted\n";
00956         delete rs;
00957 
00958         <span class="comment">/*A router MAY choose to unicast the response directly to the soliciting</span>
00959 <span class="comment">        host's address (if the solicitation's source address is not the unspecified</span>
00960 <span class="comment">        address), but the usual case is to multicast the response to the</span>
00961 <span class="comment">        all-nodes group. In the latter case, the interface's interval timer is</span>
00962 <span class="comment">        reset to a new random value, as if an unsolicited advertisement had just</span>
00963 <span class="comment">        been sent(see Section 6.2.4).*/</span>
00964 
00965         <span class="comment">/*In all cases, Router Advertisements sent in response to a Router</span>
00966 <span class="comment">        Solicitation MUST be delayed by a random time between 0 and</span>
00967 <span class="comment">        MAX_RA_DELAY_TIME seconds. (If a single advertisement is sent in</span>
00968 <span class="comment">        response to multiple solicitations, the delay is relative to the</span>
00969 <span class="comment">        first solicitation.)  In addition, consecutive Router Advertisements</span>
00970 <span class="comment">        sent to the all-nodes multicast address MUST be rate limited to no</span>
00971 <span class="comment">        more than one advertisement every MIN_DELAY_BETWEEN_RAS seconds.*/</span>
00972 
00973         <span class="comment">/*A router might process Router Solicitations as follows:</span>
00974 <span class="comment">        - Upon receipt of a Router Solicitation, compute a random delay</span>
00975 <span class="comment">        within the range 0 through MAX_RA_DELAY_TIME. If the computed</span>
00976 <span class="comment">        value corresponds to a time later than the time the next multicast</span>
00977 <span class="comment">        Router Advertisement is scheduled to be sent, ignore the random</span>
00978 <span class="comment">        delay and send the advertisement at the already-scheduled time.*/</span>
00979         cMessage *msg = new cMessage("sendSolicitedRA", MK_SEND_SOL_RTRADV);
00980         msg-&gt;setContextPointer(ie);
00981         simtime_t interval = uniform(0,ie-&gt;ipv6()-&gt;_maxRADelayTime());
00982 
00983         if (interval &lt; advIfEntry-&gt;nextScheduledRATime)
00984         {
00985             simtime_t nextScheduledTime;
00986             nextScheduledTime = simTime()+interval;
00987             scheduleAt(nextScheduledTime, msg);
00988             advIfEntry-&gt;nextScheduledRATime = nextScheduledTime;
00989         }
00990         <span class="comment">//else we ignore the generate interval and send it at the next scheduled time.</span>
00991 
00992         <span class="comment">//We need to keep a log here each time an RA is sent. Not implemented yet.</span>
00993         <span class="comment">//Assume the first course of action.</span>
00994         <span class="comment">/*- If the router sent a multicast Router Advertisement (solicited or</span>
00995 <span class="comment">        unsolicited) within the last MIN_DELAY_BETWEEN_RAS seconds,</span>
00996 <span class="comment">        schedule the advertisement to be sent at a time corresponding to</span>
00997 <span class="comment">        MIN_DELAY_BETWEEN_RAS plus the random value after the previous</span>
00998 <span class="comment">        advertisement was sent. This ensures that the multicast Router</span>
00999 <span class="comment">        Advertisements are rate limited.</span>
01000 <span class="comment"></span>
01001 <span class="comment">        - Otherwise, schedule the sending of a Router Advertisement at the</span>
01002 <span class="comment">        time given by the random value.*/</span>
01003     }
01004     <span class="keywordflow">else</span>
01005     {
01006         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"This interface is a host, discarding RA message\n"</span>;
01007         <span class="keyword">delete</span> rs;
01008     }
01009 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="IPv6NeighbourDiscovery::reachabilityConfirmed"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::reachabilityConfirmed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>neighbour</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>interfaceId</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Public method, it can be invoked from the <a class="el" href="class_i_pv6.html">IPv6</a> module or any other module to let Neighbour Discovery know that the reachability of the given neighbor has just been confirmed (e.g. <a class="el" href="class_t_c_p.html">TCP</a> received ACK of new data from it). Neighbour Discovery can then update the neighbour cache with this information, and cancel the Neighbour Unreachability Detection procedure if it is currently running. <div class="fragment"><pre class="fragment">00316 {
00317     Enter_Method(<span class="stringliteral">"reachabilityConfirmed(%s,if=%d)"</span>, neighbour.<a class="code" href="class_i_pv6_address.html#a11">str</a>().c_str(), interfaceId);
00318     <span class="comment">//hmmm... this should only be invoked if a TCP ACK was received and NUD is</span>
00319     <span class="comment">//currently being performed on the neighbour where the TCP ACK was received from.</span>
00320 
00321     <a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *nce = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a2">lookup</a>(neighbour, interfaceId);
00322 
00323     cMessage *msg = nce-&gt;<a class="code" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html#o7">nudTimeoutEvent</a>;
00324     <span class="keywordflow">if</span> (msg != NULL)
00325     {
00326         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NUD in progress. Cancelling NUD Timer\n"</span>;
00327         bubble(<span class="stringliteral">"Reachability Confirmed via NUD."</span>);
00328         cancelEvent(msg);
00329         <span class="keyword">delete</span> msg;
00330     }
00331 
00332     <span class="comment">// TODO (see header file for description)</span>
00333     <span class="comment">/*A neighbor is considered reachable if the node has recently received</span>
00334 <span class="comment">    a confirmation that packets sent recently to the neighbor were</span>
00335 <span class="comment">    received by its IP layer.  Positive confirmation can be gathered in</span>
00336 <span class="comment">    two ways: hints from upper layer protocols that indicate a connection</span>
00337 <span class="comment">    is making "forward progress", or receipt of a Neighbor Advertisement</span>
00338 <span class="comment">    message that is a response to a Neighbor Solicitation message.</span>
00339 <span class="comment"></span>
00340 <span class="comment">    A connection makes "forward progress" if the packets received from a</span>
00341 <span class="comment">    remote peer can only be arriving if recent packets sent to that peer</span>
00342 <span class="comment">    are actually reaching it.  In TCP, for example, receipt of a (new)</span>
00343 <span class="comment">    acknowledgement indicates that previously sent data reached the peer.</span>
00344 <span class="comment">    Likewise, the arrival of new (non-duplicate) data indicates that</span>
00345 <span class="comment"></span>
00346 <span class="comment">    earlier acknowledgements are being delivered to the remote peer.  If</span>
00347 <span class="comment">    packets are reaching the peer, they must also be reaching the</span>
00348 <span class="comment">    sender's next-hop neighbor; thus "forward progress" is a confirmation</span>
00349 <span class="comment">    that the next-hop neighbor is reachable.  For off-link destinations,</span>
00350 <span class="comment">    forward progress implies that the first-hop router is reachable.</span>
00351 <span class="comment">    When available, this upper-layer information SHOULD be used.</span>
00352 <span class="comment"></span>
00353 <span class="comment">    In some cases (e.g., UDP-based protocols and routers forwarding</span>
00354 <span class="comment">    packets to hosts) such reachability information may not be readily</span>
00355 <span class="comment">    available from upper-layer protocols.  When no hints are available</span>
00356 <span class="comment">    and a node is sending packets to a neighbor, the node actively probes</span>
00357 <span class="comment">    the neighbor using unicast Neighbor Solicitation messages to verify</span>
00358 <span class="comment">    that the forward path is still working.</span>
00359 <span class="comment"></span>
00360 <span class="comment">    The receipt of a solicited Neighbor Advertisement serves as</span>
00361 <span class="comment">    reachability confirmation, since advertisements with the Solicited</span>
00362 <span class="comment">    flag set to one are sent only in response to a Neighbor Solicitation.</span>
00363 <span class="comment">    Receipt of other Neighbor Discovery messages such as Router</span>
00364 <span class="comment">    Advertisements and Neighbor Advertisement with the Solicited flag set</span>
00365 <span class="comment">    to zero MUST NOT be treated as a reachability confirmation.  Receipt</span>
00366 <span class="comment">    of unsolicited messages only confirm the one-way path from the sender</span>
00367 <span class="comment">    to the recipient node.  In contrast, Neighbor Unreachability</span>
00368 <span class="comment">    Detection requires that a node keep track of the reachability of the</span>
00369 <span class="comment">    forward path to a neighbor from the its perspective, not the</span>
00370 <span class="comment">    neighbor's perspective.  Note that receipt of a solicited</span>
00371 <span class="comment">    advertisement indicates that a path is working in both directions.</span>
00372 <span class="comment">    The solicitation must have reached the neighbor, prompting it to</span>
00373 <span class="comment">    generate an advertisement.  Likewise, receipt of an advertisement</span>
00374 <span class="comment">    indicates that the path from the sender to the recipient is working.</span>
00375 <span class="comment">    However, the latter fact is known only to the recipient; the</span>
00376 <span class="comment">    advertisement's sender has no direct way of knowing that the</span>
00377 <span class="comment">    advertisement it sent actually reached a neighbor.  From the</span>
00378 <span class="comment">    perspective of Neighbor Unreachability Detection, only the</span>
00379 <span class="comment">    reachability of the forward path is of interest.*/</span>
00380 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b34" doxytag="IPv6NeighbourDiscovery::resetRATimer"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::resetRATimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ie</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Reset the given interface entry's Router Advertisement timer. This is usually done when a router interface responds (by replying with a Router Advertisement sent to the All-Node multicast group)to a router solicitation Also see: RFC 2461, Section 6.2.6 <div class="fragment"><pre class="fragment">01461 {<span class="comment">//Not used yet but could be useful later on.-WEI</span>
01462     <span class="comment">//Iterate through all RA timers within the Neighbour Discovery module.</span>
01463 <span class="comment">/*</span>
01464 <span class="comment">    for (RATimerList::iterator it=raTimerList.begin(); it != raTimerList.end(); it++)</span>
01465 <span class="comment">    {</span>
01466 <span class="comment">        cMessage *msg = (*it);</span>
01467 <span class="comment">        InterfaceEntry *msgIE = (InterfaceEntry *)msg-&gt;contextPointer();</span>
01468 <span class="comment">        //Find the timer that matches the given Interface Entry.</span>
01469 <span class="comment">        if (msgIE-&gt;outputPort() == ie-&gt;outputPort())</span>
01470 <span class="comment">        {</span>
01471 <span class="comment">            EV &lt;&lt; "Resetting RA timer for port: " &lt;&lt; ie-&gt;outputPort();</span>
01472 <span class="comment">            cancelEvent(msg);//Cancel the next scheduled msg.</span>
01473 <span class="comment">            simtime_t interval</span>
01474 <span class="comment">                = uniform(ie-&gt;ipv6()-&gt;minRtrAdvInterval(),ie-&gt;ipv6()-&gt;maxRtrAdvInterval());</span>
01475 <span class="comment">            scheduleAt(simTime()+interval, msg);</span>
01476 <span class="comment">        }</span>
01477 <span class="comment">    }</span>
01478 <span class="comment">*/</span>
01479 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="IPv6NeighbourDiscovery::resolveNeighbour"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const <a class="el" href="class_m_a_c_address.html">MACAddress</a> &amp; IPv6NeighbourDiscovery::resolveNeighbour           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>nextHop</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>interfaceId</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Public method, to be invoked from the <a class="el" href="class_i_pv6.html">IPv6</a> module to determine link-layer address and the output interface of the next hop.<p>
If the neighbor cache does not contain this address or it's in the state INCOMPLETE, this method will return the NULL address, and the <a class="el" href="class_i_pv6.html">IPv6</a> module should then send the datagram here to IPv6NeighbourDiscovery where it will be stored until neighbour resolution completes.<p>
If the neighbour cache entry is STALE (or REACHABLE but more than reachableTime elapsed since reachability was last confirmed), the link-layer address is still returned and <a class="el" href="class_i_pv6.html">IPv6</a> can send the datagram, but simultaneously, this call should trigger the Neighbour Unreachability Detection procedure to start in the IPv6NeighbourDiscovery module. <div class="fragment"><pre class="fragment">00288 {
00289     Enter_Method(<span class="stringliteral">"resolveNeighbor(%s,if=%d)"</span>, nextHop.<a class="code" href="class_i_pv6_address.html#a11">str</a>().c_str(), interfaceId);
00290 
00291     <a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> *nce = <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a2">lookup</a>(nextHop, interfaceId);
00292     <span class="comment">//InterfaceEntry *ie = ift-&gt;interfaceAt(interfaceId);</span>
00293 
00294     <span class="keywordflow">if</span> (!nce || nce-&gt;reachabilityState==IPv6NeighbourCache::INCOMPLETE)
00295         return <a class="code" href="class_m_a_c_address.html">MACAddress</a>::UNSPECIFIED_ADDRESS;
00296     else if (nce-&gt;reachabilityState==<a class="code" href="class_i_pv6_neighbour_cache.html">IPv6NeighbourCache</a>::STALE)
00297         initiateNeighbourUnreachabilityDetection(nce);
00298     else if (nce-&gt;reachabilityState==<a class="code" href="class_i_pv6_neighbour_cache.html">IPv6NeighbourCache</a>::REACHABLE &amp;&amp;
00299         simTime() &gt; nce-&gt;reachabilityExpires)
00300     {
00301         nce-&gt;<a class="code" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html#o4">reachabilityState</a> = <a class="code" href="class_i_pv6_neighbour_cache.html#w8w5">IPv6NeighbourCache::STALE</a>;
00302         <a class="code" href="class_i_pv6_neighbour_discovery.html#b9">initiateNeighbourUnreachabilityDetection</a>(nce);
00303     }
00304     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nce-&gt;reachabilityState!=IPv6NeighbourCache::REACHABLE)
00305     {
00306         <span class="comment">//reachability state must be either in DELAY or PROBE</span>
00307         ASSERT(nce-&gt;reachabilityState==IPv6NeighbourCache::DELAY ||
00308                nce-&gt;reachabilityState==IPv6NeighbourCache::PROBE);
00309         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NUD in progress.\n"</span>;
00310     }
00311     <span class="comment">//else the entry is REACHABLE and no further action is required here.</span>
00312     <span class="keywordflow">return</span> nce-&gt;<a class="code" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html#o1">macAddress</a>;
00313 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b11" doxytag="IPv6NeighbourDiscovery::selectDefaultRouter"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_address.html">IPv6Address</a> IPv6NeighbourDiscovery::selectDefaultRouter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>outIfID</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">00493 {
00494     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Selecting default router...\n"</span>;
00495     <span class="comment">//draft-ietf-ipv6-2461bis-04.txt Section 6.3.6</span>
00496     <span class="comment">/*The algorithm for selecting a router depends in part on whether or not a</span>
00497 <span class="comment">    router is known to be reachable. The exact details of how a node keeps track</span>
00498 <span class="comment">    of a neighbor's reachability state are covered in Section 7.3.  The algorithm</span>
00499 <span class="comment">    for selecting a default router is invoked during next-hop determination when</span>
00500 <span class="comment">    no Destination Cache entry exists for an off-link destination or when</span>
00501 <span class="comment">    communication through an existing router appears to be failing.  Under normal</span>
00502 <span class="comment">    conditions, a router would be selected the first time traffic is sent to a</span>
00503 <span class="comment">    destination, with subsequent traffic for that destination using the same router</span>
00504 <span class="comment">    as indicated in the Destination Cache modulo any changes to the Destination</span>
00505 <span class="comment">    Cache caused by Redirect messages.</span>
00506 <span class="comment"></span>
00507 <span class="comment">    The policy for selecting routers from the Default Router List is as</span>
00508 <span class="comment">    follows:*/</span>
00509 
00510     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> routerAddr;
00511     <span class="comment">//Cycle through all entries in the neighbour cache entry.</span>
00512     <span class="keywordflow">for</span>(<a class="code" href="class_i_pv6_neighbour_cache.html#w2">IPv6NeighbourCache::iterator</a> it=<a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a4">begin</a>(); it != <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a5">end</a>(); it++)
00513     {
00514         <a class="code" href="class_i_pv6_neighbour_discovery.html#w1">Key</a> key = it-&gt;first;
00515         <a class="code" href="class_i_pv6_neighbour_discovery.html#w2">Neighbour</a> nce = it-&gt;second;
00516         <span class="keywordtype">bool</span> routerExpired = <span class="keyword">false</span>;
00517         <span class="keywordflow">if</span> (nce.isDefaultRouter)
00518         {
00519             <span class="keywordflow">if</span> (simTime()&gt;nce.routerExpiryTime)
00520             {
00521                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Found an expired default router. Deleting entry...\n"</span>;
00522                 <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a10">remove</a>(key.address,key.interfaceID);
00523                 routerExpired = <span class="keyword">true</span>;
00524             }
00525         }
00526 
00527         <span class="keywordflow">if</span> (routerExpired == <span class="keyword">false</span>)
00528         {
00529             <span class="keywordflow">if</span> (nce.reachabilityState == IPv6NeighbourCache::REACHABLE ||
00530                 nce.reachabilityState == IPv6NeighbourCache::STALE ||
00531                 nce.reachabilityState == IPv6NeighbourCache::DELAY)<span class="comment">//TODO: Need to improve this algorithm!</span>
00532             {
00533                 <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Found a router in the neighbour cache(default router list).\n"</span>;
00534                 outIfID = key.interfaceID;
00535                 <span class="keywordflow">if</span> (routerExpired == <span class="keyword">false</span>) return key.address;
00536             }
00537         }
00538     }
00539     EV &lt;&lt; "No suitable routers found.\n";
00540 
00541     <span class="comment">/*1) Routers that are reachable or probably reachable (i.e., in any state</span>
00542 <span class="comment">    other than INCOMPLETE) SHOULD be preferred over routers whose reachability</span>
00543 <span class="comment">    is unknown or suspect (i.e., in the INCOMPLETE state, or for which no Neighbor</span>
00544 <span class="comment">    Cache entry exists). An implementation may choose to always return the same</span>
00545 <span class="comment">    router or cycle through the router list in a round-robin fashion as long as</span>
00546 <span class="comment">    it always returns a reachable or a probably reachable router when one is</span>
00547 <span class="comment">    available.*/</span>
00548 
00549     <span class="comment">/*2) When no routers on the list are known to be reachable or probably</span>
00550 <span class="comment">    reachable, routers SHOULD be selected in a round-robin fashion, so that</span>
00551 <span class="comment">    subsequent requests for a default router do not return the same router until</span>
00552 <span class="comment">    all other routers have been selected.</span>
00553 <span class="comment"></span>
00554 <span class="comment">    Cycling through the router list in this case ensures that all available</span>
00555 <span class="comment">    routers are actively probed by the Neighbor Unreachability Detection algorithm.</span>
00556 <span class="comment">    A request for a default router is made in conjunction with the sending of a</span>
00557 <span class="comment">    packet to a router, and the selected router will be probed for reachability</span>
00558 <span class="comment">    as a side effect.*/</span>
00559 
00560     outIfID = -1;<span class="comment">//nothing found yet</span>
00561     return <a class="code" href="class_i_pv6_address.html">IPv6Address</a>();
00562 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b17" doxytag="IPv6NeighbourDiscovery::sendPacketToIPv6Module"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::sendPacketToIPv6Module           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>destAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>srcAddr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>interfaceId</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create control info and assigns it to a msg. Returns a copy of the msg with the control info. <div class="fragment"><pre class="fragment">00703 {
00704     <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
00705     controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a4">setProtocol</a>(IP_PROT_IPv6_ICMP);
00706     controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a7">setDestAddr</a>(destAddr);
00707     controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a10">setSrcAddr</a>(srcAddr);
00708     controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a12">setHopLimit</a>(255);
00709     controlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a14">setInterfaceId</a>(interfaceId);
00710     msg-&gt;setControlInfo(controlInfo);
00711 
00712     send(msg,<span class="stringliteral">"toIPv6"</span>);
00713 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b35" doxytag="IPv6NeighbourDiscovery::sendPeriodicRA"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::sendPeriodicRA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01482 {
01483     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = (<a class="code" href="class_interface_entry.html">InterfaceEntry</a> *)msg-&gt;contextPointer();
01484     AdvIfEntry *advIfEntry = <a class="code" href="class_i_pv6_neighbour_discovery.html#b6">fetchAdvIfEntry</a>(ie);
01485     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> destAddr = <a class="code" href="class_i_pv6_address.html">IPv6Address</a>(<span class="stringliteral">"FF02::1"</span>);
01486     <a class="code" href="class_i_pv6_neighbour_discovery.html#b28">createAndSendRAPacket</a>(destAddr, ie);
01487     advIfEntry-&gt;numRASent++;
01488     simtime_t nextScheduledTime;
01489 
01490     <span class="comment">//RFC 2461, Section 6.2.4</span>
01491     <span class="comment">/*Whenever a multicast advertisement is sent from an interface, the timer is</span>
01492 <span class="comment">    reset to a uniformly-distributed random value between the interface's</span>
01493 <span class="comment">    configured MinRtrAdvInterval and MaxRtrAdvInterval; expiration of the timer</span>
01494 <span class="comment">    causes the next advertisement to be sent and a new random value to be chosen.*/</span>
01495     simtime_t interval
01496         = uniform(ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_60">minRtrAdvInterval</a>(),ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_59">maxRtrAdvInterval</a>());
01497     nextScheduledTime = simTime() + interval;
01498 
01499     <span class="comment">/*For the first few advertisements (up to MAX_INITIAL_RTR_ADVERTISEMENTS)</span>
01500 <span class="comment">    sent from an interface when it becomes an advertising interface,*/</span>
01501     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Num RA sent is: "</span> &lt;&lt; advIfEntry-&gt;numRASent &lt;&lt; endl;
01502     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"maxInitialRtrAdvertisements is: "</span> &lt;&lt; ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_13">_maxInitialRtrAdvertisements</a>() &lt;&lt; endl;
01503     <span class="keywordflow">if</span>(advIfEntry-&gt;numRASent &lt;= ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_13">_maxInitialRtrAdvertisements</a>())
01504     {
01505         <span class="keywordflow">if</span> (interval &gt; ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_12">_maxInitialRtrAdvertInterval</a>())
01506         {
01507             <span class="comment">//if the randomly chosen interval is greater than MAX_INITIAL_RTR_ADVERT_INTERVAL,</span>
01508             <span class="comment">//the timer SHOULD be set to MAX_INITIAL_RTR_ADVERT_INTERVAL instead.</span>
01509             nextScheduledTime = simTime() + ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_12">_maxInitialRtrAdvertInterval</a>();
01510             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending initial RA but interval is too long. Using default value."</span> &lt;&lt; endl;
01511         }
01512         <span class="keywordflow">else</span>
01513             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending initial RA. Using randomly generated interval."</span> &lt;&lt; endl;
01514     }
01515     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Next scheduled time: "</span> &lt;&lt; nextScheduledTime &lt;&lt; endl;
01516     advIfEntry-&gt;nextScheduledRATime = nextScheduledTime;
01517     ASSERT(nextScheduledTime &gt; simTime());
01518     scheduleAt(nextScheduledTime, msg);
01519 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b18" doxytag="IPv6NeighbourDiscovery::sendQueuedPacketsToIPv6Module"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::sendQueuedPacketsToIPv6Module           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_i_pv6_neighbour_cache_1_1_neighbour.html">Neighbour</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>nce</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send off any queued packets within the Neighbour Discovery module awaiting address resolution. <div class="fragment"><pre class="fragment">00718 {
00719     <a class="code" href="class_i_pv6_neighbour_discovery.html#w0">MsgPtrVector</a>&amp; pendingPackets = nce-&gt;pendingPackets;
00720     <span class="keywordflow">while</span>(!pendingPackets.empty())<span class="comment">//FIXME: pendingPackets are always empty!!!!</span>
00721     {
00722         MsgPtrVector::iterator i = pendingPackets.begin();
00723         cMessage *msg = (*i);
00724         pendingPackets.erase(i);
00725         <a class="code" href="class_i_pv6_neighbour_discovery.html#p0">pendingQueue</a>.remove(msg);
00726         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Sending queued packet "</span> &lt;&lt; msg &lt;&lt; endl;
00727         send(msg,<span class="stringliteral">"toIPv6"</span>);
00728     }
00729 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b45" doxytag="IPv6NeighbourDiscovery::sendSolicitedNA"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::sendSolicitedNA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nsCtrlInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ie</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01765 {
01766     <a class="code" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *na = <span class="keyword">new</span> <a class="code" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a>(<span class="stringliteral">"NApacket"</span>);
01767     <span class="comment">//RFC 2461: Section 7.2.4</span>
01768     <span class="comment">/*A node sends a Neighbor Advertisement in response to a valid Neighbor</span>
01769 <span class="comment">    Solicitation targeting one of the node's assigned addresses.  The</span>
01770 <span class="comment">    Target Address of the advertisement is copied from the Target Address</span>
01771 <span class="comment">    of the solicitation.*/</span>
01772     na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a15">setTargetAddress</a>(ns-&gt;<a class="code" href="class_i_pv6_neighbour_solicitation.html#a7">targetAddress</a>());
01773 
01774     <span class="comment">/*If the solicitation's IP Destination Address is not a multicast address,</span>
01775 <span class="comment">    the Target Link-Layer Address option MAY be omitted; the neighboring node's</span>
01776 <span class="comment">    cached value must already be current in order for the solicitation to have</span>
01777 <span class="comment">    been received. If the solicitation's IP Destination Address is a multicast</span>
01778 <span class="comment">    address, the Target Link-Layer option MUST be included in the advertisement.*/</span>
01779     na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a18">setTargetLinkLayerAddress</a>(ie-&gt;<a class="code" href="class_interface_entry.html#a17">macAddress</a>());<span class="comment">//here, we always include the MAC addr.</span>
01780 
01781     <span class="comment">/*Furthermore, if the node is a router, it MUST set the Router flag to one;</span>
01782 <span class="comment">    otherwise it MUST set the flag to zero.*/</span>
01783     na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a8">setRouterFlag</a>(<a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#a2">isRouter</a>());
01784 
01785     <span class="comment">/*If the (NS)Target Address is either an anycast address or a unicast</span>
01786 <span class="comment">    address for which the node is providing proxy service, or the Target</span>
01787 <span class="comment">    Link-Layer Address option is not included,*/</span>
01788     <span class="comment">//TODO:ANYCAST will not be implemented here!</span>
01789     <span class="keywordflow">if</span> (ns-&gt;<a class="code" href="class_i_pv6_neighbour_solicitation.html#a10">sourceLinkLayerAddress</a>().<a class="code" href="class_m_a_c_address.html#a13">isUnspecified</a>())
01790         <span class="comment">//the Override flag SHOULD be set to zero.</span>
01791         na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a12">setOverrideFlag</a>(<span class="keyword">false</span>);
01792     <span class="keywordflow">else</span>
01793         <span class="comment">//Otherwise, the Override flag SHOULD be set to one.</span>
01794         na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a12">setOverrideFlag</a>(<span class="keyword">true</span>);
01795     <span class="comment">/*Proper setting of the Override flag ensures that nodes give preference to</span>
01796 <span class="comment">    non-proxy advertisements, even when received after proxy advertisements, and</span>
01797 <span class="comment">    also ensures that the first advertisement for an anycast address "wins".*/</span>
01798 
01799     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> naDestAddr;
01800     <span class="comment">//If the source of the solicitation is the unspecified address,</span>
01801     <span class="keywordflow">if</span>(nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>().<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
01802     {
01803         <span class="comment">/*the node MUST set the Solicited flag to zero and multicast the advertisement</span>
01804 <span class="comment">        to the all-nodes address.*/</span>
01805         na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a10">setSolicitedFlag</a>(<span class="keyword">false</span>);
01806         naDestAddr = <a class="code" href="class_i_pv6_address.html#z33_3">IPv6Address::ALL_NODES_2</a>;
01807     }
01808     <span class="keywordflow">else</span>
01809     {
01810         <span class="comment">/*Otherwise, the node MUST set the Solicited flag to one and unicast</span>
01811 <span class="comment">        the advertisement to the Source Address of the solicitation.*/</span>
01812         na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a10">setSolicitedFlag</a>(<span class="keyword">true</span>);
01813         naDestAddr = nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>();
01814     }
01815 
01816     <span class="comment">/*If the Target Address is an anycast address the sender SHOULD delay sending</span>
01817 <span class="comment">    a response for a random time between 0 and MAX_ANYCAST_DELAY_TIME seconds.*/</span>
01818     <span class="comment">/*TODO: More associated complexity for this one. We will have to delay</span>
01819 <span class="comment">    sending off the solicitation. Perhaps the self message could have a context</span>
01820 <span class="comment">    pointer pointing to a struct with enough info to create and send a NA packet.*/</span>
01821 
01822     <span class="comment">/*Because unicast Neighbor Solicitations are not required to include a</span>
01823 <span class="comment">    Source Link-Layer Address, it is possible that a node sending a</span>
01824 <span class="comment">    solicited Neighbor Advertisement does not have a corresponding link-</span>
01825 <span class="comment">    layer address for its neighbor in its Neighbor Cache.  In such</span>
01826 <span class="comment">    situations, a node will first have to use Neighbor Discovery to</span>
01827 <span class="comment">    determine the link-layer address of its neighbor (i.e, send out a</span>
01828 <span class="comment">    multicast Neighbor Solicitation).*/</span>
01829     <span class="comment">//TODO: if above mentioned happens, can addr resolution be performed for ND messages?</span>
01830     <span class="comment">//if no link-layer addr exists for unicast addr when sending solicited NA, we should</span>
01831     <span class="comment">//add the NA to the list of queued packets. What if we have a list of queued</span>
01832     <span class="comment">//packets for different unicast solicitations? each time addr resolution is</span>
01833     <span class="comment">//done we should check the destinations of the list of queued packets and send</span>
01834     <span class="comment">//off the respective ones.</span>
01835     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> myIPv6Addr = ie-&gt;<a class="code" href="class_interface_entry.html#a34">ipv6</a>()-&gt;<a class="code" href="class_i_pv6_interface_data.html#z48_9">preferredAddress</a>();
01836     <a class="code" href="class_i_pv6_neighbour_discovery.html#b17">sendPacketToIPv6Module</a>(na, naDestAddr, myIPv6Addr, ie-&gt;<a class="code" href="class_interface_entry.html#a4">interfaceId</a>());
01837 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b36" doxytag="IPv6NeighbourDiscovery::sendSolicitedRA"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::sendSolicitedRA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cMessage *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01522 {
01523     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Send Solicited RA invoked!\n"</span>;
01524     <a class="code" href="class_interface_entry.html">InterfaceEntry</a> *ie = (<a class="code" href="class_interface_entry.html">InterfaceEntry</a> *)msg-&gt;contextPointer();
01525     <a class="code" href="class_i_pv6_address.html">IPv6Address</a> destAddr = <a class="code" href="class_i_pv6_address.html">IPv6Address</a>(<span class="stringliteral">"FF02::1"</span>);
01526     <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Testing condition!\n"</span>;
01527     <a class="code" href="class_i_pv6_neighbour_discovery.html#b28">createAndSendRAPacket</a>(destAddr, ie);
01528     <span class="keyword">delete</span> msg;
01529 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b46" doxytag="IPv6NeighbourDiscovery::sendUnsolicitedNA"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::sendUnsolicitedNA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_entry.html">InterfaceEntry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ie</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01840 {
01841     <span class="comment">//RFC 2461</span>
01842     <span class="comment">//Section 7.2.6: Sending Unsolicited Neighbor Advertisements</span>
01843 
01844     <span class="comment">/*In some cases a node may be able to determine that its link-layer</span>
01845 <span class="comment">    address has changed (e.g., hot-swap of an interface card) and may</span>
01846 <span class="comment">    wish to inform its neighbors of the new link-layer address quickly.</span>
01847 <span class="comment">    In such cases a node MAY send up to MAX_NEIGHBOR_ADVERTISEMENT</span>
01848 <span class="comment">    unsolicited Neighbor Advertisement messages to the all-nodes</span>
01849 <span class="comment">    multicast address.  These advertisements MUST be separated by at</span>
01850 <span class="comment">    least RetransTimer seconds.</span>
01851 <span class="comment"></span>
01852 <span class="comment">    The Target Address field in the unsolicited advertisement is set to</span>
01853 <span class="comment">    an IP address of the interface, and the Target Link-Layer Address</span>
01854 <span class="comment">    option is filled with the new link-layer address.  The Solicited flag</span>
01855 <span class="comment">    MUST be set to zero, in order to avoid confusing the Neighbor</span>
01856 <span class="comment">    Unreachability Detection algorithm.  If the node is a router, it MUST</span>
01857 <span class="comment">    set the Router flag to one; otherwise it MUST set it to zero.  The</span>
01858 <span class="comment">    Override flag MAY be set to either zero or one.  In either case,</span>
01859 <span class="comment">    neighboring nodes will immediately change the state of their Neighbor</span>
01860 <span class="comment">    Cache entries for the Target Address to STALE, prompting them to</span>
01861 <span class="comment">    verify the path for reachability.  If the Override flag is set to</span>
01862 <span class="comment">    one, neighboring nodes will install the new link-layer address in</span>
01863 <span class="comment">    their caches.  Otherwise, they will ignore the new link-layer</span>
01864 <span class="comment">    address, choosing instead to probe the cached address.</span>
01865 <span class="comment"></span>
01866 <span class="comment">    A node that has multiple IP addresses assigned to an interface MAY</span>
01867 <span class="comment">    multicast a separate Neighbor Advertisement for each address.  In</span>
01868 <span class="comment">    such a case the node SHOULD introduce a small delay between the</span>
01869 <span class="comment">    sending of each advertisement to reduce the probability of the</span>
01870 <span class="comment">    advertisements being lost due to congestion.</span>
01871 <span class="comment"></span>
01872 <span class="comment">    A proxy MAY multicast Neighbor Advertisements when its link-layer</span>
01873 <span class="comment">    address changes or when it is configured (by system management or</span>
01874 <span class="comment">    other mechanisms) to proxy for an address.  If there are multiple</span>
01875 <span class="comment">    nodes that are providing proxy services for the same set of addresses</span>
01876 <span class="comment">    the proxies SHOULD provide a mechanism that prevents multiple proxies</span>
01877 <span class="comment">    from multicasting advertisements for any one address, in order to</span>
01878 <span class="comment">    reduce the risk of excessive multicast traffic.</span>
01879 <span class="comment"></span>
01880 <span class="comment">    Also, a node belonging to an anycast address MAY multicast</span>
01881 <span class="comment">    unsolicited Neighbor Advertisements for the anycast address when the</span>
01882 <span class="comment">    node's link-layer address changes.</span>
01883 <span class="comment"></span>
01884 <span class="comment">    Note that because unsolicited Neighbor Advertisements do not reliably</span>
01885 <span class="comment">    update caches in all nodes (the advertisements might not be received</span>
01886 <span class="comment">    by all nodes), they should only be viewed as a performance</span>
01887 <span class="comment">    optimization to quickly update the caches in most neighbors.  The</span>
01888 <span class="comment">    Neighbor Unreachability Detection algorithm ensures that all nodes</span>
01889 <span class="comment">    obtain a reachable link-layer address, though the delay may be</span>
01890 <span class="comment">    slightly longer.*/</span>
01891 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b13" doxytag="IPv6NeighbourDiscovery::timeoutDefaultRouter"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::timeoutDefaultRouter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>interfaceID</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
RFC 2461: Section 6.3.5 Whenever the Lifetime of an entry in the Default Router List expires, that entry is discarded. When removing a router from the Default Router list, the node MUST update the Destination Cache in such a way that all entries using the router perform next-hop determination again rather than continue sending traffic to the (deleted) router. <div class="fragment"><pre class="fragment">00581 {
00582     <span class="comment">//RFC 2461: Section 6.3.5</span>
00583     <span class="comment">/*Whenever the Lifetime of an entry in the Default Router List expires,</span>
00584 <span class="comment">    that entry is discarded.*/</span>
00585     <a class="code" href="class_i_pv6_neighbour_discovery.html#p4">neighbourCache</a>.<a class="code" href="class_i_pv6_neighbour_cache.html#a10">remove</a>(addr, interfaceID);
00586 
00587     <span class="comment">/*When removing a router from the Default Router list, the node MUST update</span>
00588 <span class="comment">    the Destination Cache in such a way that all entries using the router perform</span>
00589 <span class="comment">    next-hop determination again rather than continue sending traffic to the</span>
00590 <span class="comment">    (deleted) router.*/</span>
00591     <a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#z55_2">purgeDestCacheEntriesToNeighbour</a>(addr, interfaceID);
00592 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b12" doxytag="IPv6NeighbourDiscovery::timeoutPrefixEntry"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void IPv6NeighbourDiscovery::timeoutPrefixEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const <a class="el" href="class_i_pv6_address.html">IPv6Address</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>destPrefix</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>prefixLength</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
RFC 2461: Section 6.3.5 Whenever the invalidation timer expires for a Prefix List entry, that entry is discarded. No existing Destination Cache entries need be updated, however. Should a reachability problem arise with an existing Neighbor Cache entry, Neighbor Unreachability Detection will perform any needed recovery. <div class="fragment"><pre class="fragment">00566 {
00567     <span class="comment">//RFC 2461: Section 6.3.5</span>
00568     <span class="comment">/*Whenever the invalidation timer expires for a Prefix List entry, that</span>
00569 <span class="comment">    entry is discarded.*/</span>
00570     <a class="code" href="class_i_pv6_neighbour_discovery.html#p2">rt6</a>-&gt;<a class="code" href="class_routing_table6.html#z57_1">removeOnLinkPrefix</a>(destPrefix, prefixLength);
00571     <span class="comment">//hmmm... should the unicast address associated with this prefix be deleted</span>
00572     <span class="comment">//as well?-TODO: The address should be timeout/deleted as well!!</span>
00573 
00574     <span class="comment">/*No existing Destination Cache entries need be updated, however. Should a</span>
00575 <span class="comment">    reachability problem arise with an existing Neighbor Cache entry, Neighbor</span>
00576 <span class="comment">    Unreachability Detection will perform any needed recovery.*/</span>
00577 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b48" doxytag="IPv6NeighbourDiscovery::validateNAPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool IPv6NeighbourDiscovery::validateNAPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_advertisement.html">IPv6NeighbourAdvertisement</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>na</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>naCtrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01938 {
01939     <span class="keywordtype">bool</span> result = <span class="keyword">true</span>;<span class="comment">//adopt optimistic approach</span>
01940 
01941     <span class="comment">//RFC 2461:7.1.2 Validation of Neighbor Advertisments(some checks are omitted)</span>
01942     <span class="comment">//A node MUST silently discard any received Neighbor Advertisment messages</span>
01943     <span class="comment">//that do not satisfy all of the following validity checks:</span>
01944 
01945     <span class="comment">//- The IP Hop Limit field has a value of 255, i.e., the packet</span>
01946     <span class="comment">//  could not possibly have been forwarded by a router.</span>
01947     <span class="keywordflow">if</span> (naCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a11">hopLimit</a>() != 255)
01948     {
01949         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Hop Limit is not 255! NA validation failed!\n"</span>;
01950         result = <span class="keyword">false</span>;
01951     }
01952 
01953     <span class="comment">//- Target Address is not a multicast address.</span>
01954     <span class="keywordflow">if</span> (na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a13">targetAddress</a>().<a class="code" href="class_i_pv6_address.html#a23">isMulticast</a>() == <span class="keyword">true</span>)
01955     {
01956         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Target Address is a multicast address! NA validation failed!\n"</span>;
01957         result = <span class="keyword">false</span>;
01958     }
01959 
01960     <span class="comment">//- If the IP Destination Address is a multicast address the Solicited flag</span>
01961     <span class="comment">//  is zero.</span>
01962     <span class="keywordflow">if</span> (naCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a5">destAddr</a>().<a class="code" href="class_i_pv6_address.html#a23">isMulticast</a>())
01963     {
01964         <span class="keywordflow">if</span> (na-&gt;<a class="code" href="class_i_pv6_neighbour_advertisement.html#a9">solicitedFlag</a>() == <span class="keyword">true</span>)
01965         {
01966             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Dest Address is multicast address but solicted flag is 0!\n"</span>;
01967             result = <span class="keyword">false</span>;
01968         }
01969     }
01970 
01971     <span class="keywordflow">if</span> (result == <span class="keyword">true</span>) bubble("NA validation passed.");
01972     else bubble("NA validation failed.");
01973     return result;
01974 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b40" doxytag="IPv6NeighbourDiscovery::validateNSPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool IPv6NeighbourDiscovery::validateNSPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_solicitation.html">IPv6NeighbourSolicitation</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nsCtrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01632 {
01633     <span class="keywordtype">bool</span> result = <span class="keyword">true</span>;
01634     <span class="comment">/*RFC 2461:7.1.1. Validation of Neighbor Solicitations(some checks are omitted)</span>
01635 <span class="comment">    A node MUST silently discard any received Neighbor Solicitation</span>
01636 <span class="comment">    messages that do not satisfy all of the following validity checks:*/</span>
01637     <span class="comment">//- The IP Hop Limit field has a value of 255, i.e., the packet</span>
01638     <span class="comment">//could not possibly have been forwarded by a router.</span>
01639     <span class="keywordflow">if</span> (nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a11">hopLimit</a>() != 255)
01640     {
01641         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Hop limit is not 255! NS validation failed!\n"</span>;
01642         result = <span class="keyword">false</span>;
01643     }
01644     <span class="comment">//- Target Address is not a multicast address.</span>
01645     <span class="keywordflow">if</span> (ns-&gt;<a class="code" href="class_i_pv6_neighbour_solicitation.html#a7">targetAddress</a>().<a class="code" href="class_i_pv6_address.html#a23">isMulticast</a>() == <span class="keyword">true</span>)
01646     {
01647         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Target address is a multicast address! NS validation failed!\n"</span>;
01648         result = <span class="keyword">false</span>;
01649     }
01650     <span class="comment">//- If the IP source address is the unspecified address,</span>
01651     <span class="keywordflow">if</span> (nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>().<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
01652     {
01653         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Source Address is unspecified\n"</span>;
01654         <span class="comment">//the IP destination address is a solicited-node multicast address.</span>
01655         <span class="keywordflow">if</span> (nsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a5">destAddr</a>().<a class="code" href="class_i_pv6_address.html#a21">matches</a>(IPv6Address::SOLICITED_NODE_PREFIX,104) == <span class="keyword">false</span>)
01656         {
01657             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">" but IP dest address is not a solicited-node multicast address! NS validation failed!\n"</span>;
01658             result = <span class="keyword">false</span>;
01659         }
01660         <span class="comment">//there is no source link-layer address option in the message.</span>
01661         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ns-&gt;<a class="code" href="class_i_pv6_neighbour_solicitation.html#a10">sourceLinkLayerAddress</a>().<a class="code" href="class_m_a_c_address.html#a13">isUnspecified</a>() == <span class="keyword">false</span>)
01662         {
01663             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">" but Source link-layer address is not empty! NS validation failed!\n"</span>;
01664             result = <span class="keyword">false</span>;
01665         }
01666         <span class="keywordflow">else</span>
01667             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"NS Validation Passed\n"</span>;
01668     }
01669 
01670     <span class="keywordflow">return</span> result;
01671 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b37" doxytag="IPv6NeighbourDiscovery::validateRAPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool IPv6NeighbourDiscovery::validateRAPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_router_advertisement.html">IPv6RouterAdvertisement</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ra</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>raCtrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01533 {
01534     <span class="keywordtype">bool</span> result = <span class="keyword">true</span>;
01535 
01536     <span class="comment">//RFC 2461: Section 6.1.2 Validation of Router Advertisement Messages</span>
01537     <span class="comment">/*A node MUST silently discard any received Router Advertisement</span>
01538 <span class="comment">    messages that do not satisfy all of the following validity checks:*/</span>
01539     raCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>();
01540     <span class="comment">//- IP Source Address is a link-local address.  Routers must use</span>
01541     <span class="comment">//  their link-local address as the source for Router Advertisement</span>
01542     <span class="comment">//  and Redirect messages so that hosts can uniquely identify</span>
01543     <span class="comment">//  routers.</span>
01544     <span class="keywordflow">if</span> (raCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>().<a class="code" href="class_i_pv6_address.html#a26">isLinkLocal</a>() == <span class="keyword">false</span>)
01545     {
01546         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"RA source address is not link-local. RA validation failed!\n"</span>;
01547         result = <span class="keyword">false</span>;
01548     }
01549 
01550     <span class="comment">//- The IP Hop Limit field has a value of 255, i.e., the packet</span>
01551     <span class="comment">//  could not possibly have been forwarded by a router.</span>
01552     <span class="keywordflow">if</span> (raCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a11">hopLimit</a>() != 255)
01553     {
01554         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Hop limit is not 255! RA validation failed!\n"</span>;
01555         result = <span class="keyword">false</span>;
01556     }
01557 
01558     <span class="comment">//- ICMP Code is 0.</span>
01559     <span class="keywordflow">if</span> (raCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a3">protocol</a>() != <a class="code" href="_i_p_protocol_id__m_8h.html#a23a11">IP_PROT_IPv6_ICMP</a>)
01560     {
01561         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMP Code is not 0! RA validation failed!\n"</span>;
01562         result = <span class="keyword">false</span>;
01563     }
01564 
01565     <span class="keywordflow">return</span> result;
01566 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b27" doxytag="IPv6NeighbourDiscovery::validateRSPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool IPv6NeighbourDiscovery::validateRSPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_router_solicitation.html">IPv6RouterSolicitation</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>rs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>rsCtrlInfo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [protected]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<div class="fragment"><pre class="fragment">01013 {
01014     <span class="keywordtype">bool</span> result = <span class="keyword">true</span>;
01015     <span class="comment">/*6.1.1.  Validation of Router Solicitation Messages</span>
01016 <span class="comment">    A router MUST silently discard any received Router Solicitation</span>
01017 <span class="comment">    messages that do not satisfy all of the following validity checks:</span>
01018 <span class="comment"></span>
01019 <span class="comment">    - The IP Hop Limit field has a value of 255, i.e., the packet</span>
01020 <span class="comment">    could not possibly have been forwarded by a router.*/</span>
01021     <span class="keywordflow">if</span> (rsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a11">hopLimit</a>() != 255)
01022     {
01023         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"Hop limit is not 255! RS validation failed!\n"</span>;
01024         result = <span class="keyword">false</span>;
01025     }
01026     <span class="comment">//- ICMP Code is 0.</span>
01027     <span class="keywordflow">if</span> (rsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a3">protocol</a>() != <a class="code" href="_i_p_protocol_id__m_8h.html#a23a11">IP_PROT_IPv6_ICMP</a>)
01028     {
01029         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"ICMP Code is not 0! RS validation failed!\n"</span>;
01030         result = <span class="keyword">false</span>;
01031     }
01032     <span class="comment">//- If the IP source address is the unspecified address, there is no</span>
01033     <span class="comment">//source link-layer address option in the message.</span>
01034     <span class="keywordflow">if</span> (rsCtrlInfo-&gt;<a class="code" href="class_i_pv6_control_info___base.html#a8">srcAddr</a>().<a class="code" href="class_i_pv6_address.html#a22">isUnspecified</a>())
01035     {
01036         <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">"IP source address is unspecified\n"</span>;
01037         <span class="keywordflow">if</span> (rs-&gt;<a class="code" href="class_i_pv6_router_solicitation.html#a7">sourceLinkLayerAddress</a>().<a class="code" href="class_m_a_c_address.html#a13">isUnspecified</a>() == <span class="keyword">false</span>)
01038         {
01039             <a class="code" href="_i_n_e_t_defs_8h.html#a1">EV</a> &lt;&lt; <span class="stringliteral">" but source link layer address is provided. RS validation failed!\n"</span>;
01040         }
01041     }
01042     <span class="keywordflow">return</span> result;
01043 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p8" doxytag="IPv6NeighbourDiscovery::advIfList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_discovery.html#x3">AdvIfList</a> <a class="el" href="class_i_pv6_neighbour_discovery.html#p8">IPv6NeighbourDiscovery::advIfList</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p6" doxytag="IPv6NeighbourDiscovery::dadList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_discovery.html#x1">DADList</a> <a class="el" href="class_i_pv6_neighbour_discovery.html#p6">IPv6NeighbourDiscovery::dadList</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p3" doxytag="IPv6NeighbourDiscovery::icmpv6"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_c_m_pv6.html">ICMPv6</a>* <a class="el" href="class_i_pv6_neighbour_discovery.html#p3">IPv6NeighbourDiscovery::icmpv6</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="IPv6NeighbourDiscovery::ift"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_interface_table.html">InterfaceTable</a>* <a class="el" href="class_i_pv6_neighbour_discovery.html#p1">IPv6NeighbourDiscovery::ift</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p4" doxytag="IPv6NeighbourDiscovery::neighbourCache"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_cache.html">IPv6NeighbourCache</a> <a class="el" href="class_i_pv6_neighbour_discovery.html#p4">IPv6NeighbourDiscovery::neighbourCache</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p0" doxytag="IPv6NeighbourDiscovery::pendingQueue"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">cQueue <a class="el" href="class_i_pv6_neighbour_discovery.html#p0">IPv6NeighbourDiscovery::pendingQueue</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p5" doxytag="IPv6NeighbourDiscovery::raTimerList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_discovery.html#x0">RATimerList</a> <a class="el" href="class_i_pv6_neighbour_discovery.html#p5">IPv6NeighbourDiscovery::raTimerList</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p7" doxytag="IPv6NeighbourDiscovery::rdList"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_i_pv6_neighbour_discovery.html#x2">RDList</a> <a class="el" href="class_i_pv6_neighbour_discovery.html#p7">IPv6NeighbourDiscovery::rdList</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="p2" doxytag="IPv6NeighbourDiscovery::rt6"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="class_routing_table6.html">RoutingTable6</a>* <a class="el" href="class_i_pv6_neighbour_discovery.html#p2">IPv6NeighbourDiscovery::rt6</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_i_pv6_neighbour_discovery_8h.html">IPv6NeighbourDiscovery.h</a><li><a class="el" href="_i_pv6_neighbour_discovery_8cc.html">IPv6NeighbourDiscovery.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 19 18:22:26 2006 for INET Framework for OMNeT++/OMNEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.0 </small></address>
</body>
</html>
